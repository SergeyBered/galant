<?php
 namespace UmiCms\System\Response\Error\Entry;use UmiCms\System\Orm\iEntity;use UmiCms\System\Orm\Entity\Map\Sort;use UmiCms\System\Orm\Entity\Map\Filter;use UmiCms\System\Response\Error\iEntry;use UmiCms\System\Orm\Entity\iCollection;use UmiCms\System\Hierarchy\Domain\iDetector;use UmiCms\System\Orm\Entity\Facade as AbstractFacade;class Facade extends AbstractFacade implements iFacade {private $domainDetector;public function log($v572d4e421e5e6b9bc11d815e8a027112, $vc13367945d5d4c91047b3b50234aa7ab) {$v1043bfc77febe75fafec0c4309faccf1 = $this->getOneByUrlAndCode($v572d4e421e5e6b9bc11d815e8a027112, $vc13367945d5d4c91047b3b50234aa7ab);if ($v1043bfc77febe75fafec0c4309faccf1 instanceof iEntry) {$v1043bfc77febe75fafec0c4309faccf1->incrementHitsCount();$this->save($v1043bfc77febe75fafec0c4309faccf1);return $v1043bfc77febe75fafec0c4309faccf1;}return $this->createByUrlAndCode($v572d4e421e5e6b9bc11d815e8a027112, $vc13367945d5d4c91047b3b50234aa7ab);}public function getSliceByDomain($v72ee76c5c29383b7c9f9225c1fa4d10b, $v7a86c157ee9713c34fbd7a1ee40f0c5a = 0, $vaa9f73eea60a006820d0f8768bc8a3fc = 20, array $v0aab302bca118b077623619774e51433 = []) {$v0aab302bca118b077623619774e51433 = $v0aab302bca118b077623619774e51433 ?: [iMapper::ID => Sort::SORT_TYPE_DESC];$vcec01d65691ed92b5250d5f413fb82eb = $this->getCollectionSliceWithDomain($v72ee76c5c29383b7c9f9225c1fa4d10b, $v7a86c157ee9713c34fbd7a1ee40f0c5a, $vaa9f73eea60a006820d0f8768bc8a3fc, $v0aab302bca118b077623619774e51433);if ($vcec01d65691ed92b5250d5f413fb82eb->isNotEmpty()) {return $vcec01d65691ed92b5250d5f413fb82eb->getList();}$vb3f2035551f6e48c67489ace9f588f94 = $this->getRepository();$v800be063730e57ca498edc996eac0f85 = $vb3f2035551f6e48c67489ace9f588f94->getSliceByDomain($v72ee76c5c29383b7c9f9225c1fa4d10b, $v7a86c157ee9713c34fbd7a1ee40f0c5a, $vaa9f73eea60a006820d0f8768bc8a3fc, $v0aab302bca118b077623619774e51433);if (count($v800be063730e57ca498edc996eac0f85) > 0) {$this->getCollection()     ->pushList($v800be063730e57ca498edc996eac0f85);}return $v800be063730e57ca498edc996eac0f85;}public function getCountByDomain($v72ee76c5c29383b7c9f9225c1fa4d10b) {$vdb6d9b451b818ccc9a449383f2f0c450 = $this->getCollection()    ->copy()    ->filter([iMapper::DOMAIN_ID => [     Filter::COMPARE_TYPE_EQUALS => $v72ee76c5c29383b7c9f9225c1fa4d10b    ]]);if ($vdb6d9b451b818ccc9a449383f2f0c450->isNotEmpty()) {return $vdb6d9b451b818ccc9a449383f2f0c450->getCount();}$vb3f2035551f6e48c67489ace9f588f94 = $this->getRepository();return $vb3f2035551f6e48c67489ace9f588f94->getCountByDomain($v72ee76c5c29383b7c9f9225c1fa4d10b);}public function create(array $v6dd047148d685270458ecc44ee128a4d = []) {if (!isset($v6dd047148d685270458ecc44ee128a4d[iMapper::URL])) {throw new \ErrorException('Response error entry url expected');}if (!isset($v6dd047148d685270458ecc44ee128a4d[iMapper::CODE])) {throw new \ErrorException('Response error entry code expected');}if (!isset($v6dd047148d685270458ecc44ee128a4d[iMapper::HITS_COUNT])) {$v6dd047148d685270458ecc44ee128a4d[iMapper::HITS_COUNT] = 1;}if (!isset($v6dd047148d685270458ecc44ee128a4d[iMapper::DOMAIN_ID])) {$v6dd047148d685270458ecc44ee128a4d[iMapper::DOMAIN_ID] = $this->domainDetector->detectId();}if (!isset($v6dd047148d685270458ecc44ee128a4d[iMapper::UPDATE_TIME])) {$v6dd047148d685270458ecc44ee128a4d[iMapper::UPDATE_TIME] = time();}return parent::create($v6dd047148d685270458ecc44ee128a4d);}public function save(iEntity $vf5e638cc78dd325906c1298a0c21fb6b) {if (!$this->isValidEntity($vf5e638cc78dd325906c1298a0c21fb6b)) {throw new \ErrorException('Incorrect entity given');}$vf5e638cc78dd325906c1298a0c21fb6b->setUpdateTime(time());$this->getRepository()    ->save($vf5e638cc78dd325906c1298a0c21fb6b);return $this;}public function setDomainDetector(iDetector $v21aed3df2077b5d91ce46bf123446731) {$this->domainDetector = $v21aed3df2077b5d91ce46bf123446731;return $this;}protected function isValidEntity($vf5e638cc78dd325906c1298a0c21fb6b) {return $vf5e638cc78dd325906c1298a0c21fb6b instanceof iEntry;}private function createByUrlAndCode($v572d4e421e5e6b9bc11d815e8a027112, $vc13367945d5d4c91047b3b50234aa7ab) {return $this->create([    iMapper::URL => $v572d4e421e5e6b9bc11d815e8a027112,    iMapper::CODE => $vc13367945d5d4c91047b3b50234aa7ab   ]);}private function getOneByUrlAndCode($v572d4e421e5e6b9bc11d815e8a027112, $vc13367945d5d4c91047b3b50234aa7ab) {$v1043bfc77febe75fafec0c4309faccf1 = $this->getCollection()    ->copy()    ->filter([     iMapper::URL => [      Filter::COMPARE_TYPE_EQUALS => $v572d4e421e5e6b9bc11d815e8a027112     ],     iMapper::CODE => [      Filter::COMPARE_TYPE_EQUALS => $vc13367945d5d4c91047b3b50234aa7ab     ]    ])    ->getFirst();if ($v1043bfc77febe75fafec0c4309faccf1 instanceof iEntry) {return $v1043bfc77febe75fafec0c4309faccf1;}$v1043bfc77febe75fafec0c4309faccf1 = $this->getRepository()    ->getOneByEqualityMap([     iMapper::URL => $v572d4e421e5e6b9bc11d815e8a027112,     iMapper::CODE => $vc13367945d5d4c91047b3b50234aa7ab    ]);if ($v1043bfc77febe75fafec0c4309faccf1 instanceof iEntry) {$this->getCollection()     ->push($v1043bfc77febe75fafec0c4309faccf1);}return $v1043bfc77febe75fafec0c4309faccf1;}private function getCollectionSliceWithDomain($v72ee76c5c29383b7c9f9225c1fa4d10b, $v7a86c157ee9713c34fbd7a1ee40f0c5a = 0, $vaa9f73eea60a006820d0f8768bc8a3fc = 20, array $v0aab302bca118b077623619774e51433 = []) {return $this->getCollection()    ->copy()    ->filter([iMapper::DOMAIN_ID => [     Filter::COMPARE_TYPE_EQUALS => $v72ee76c5c29383b7c9f9225c1fa4d10b    ]])    ->sort($v0aab302bca118b077623619774e51433)    ->slice($v7a86c157ee9713c34fbd7a1ee40f0c5a, $vaa9f73eea60a006820d0f8768bc8a3fc);}}