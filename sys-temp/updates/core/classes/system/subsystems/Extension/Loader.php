<?php
 namespace UmiCms\System\Extension;use UmiCms\Classes\System\Entities\Directory\iFactory as DirectoryFactory;use UmiCms\Classes\System\Entities\File\iFactory as FileFactory;use UmiCms\Libs\AutoloadMapLoader;class Loader implements iLoader {private $directoryFactory;private $fileFactory;private $module;public function __construct(DirectoryFactory $vb7a82c37d8c13db7202ec4890aa47a7d, FileFactory $ve9d2ea3c13cc8f3b974ffbe8695cba02) {$this->directoryFactory = $vb7a82c37d8c13db7202ec4890aa47a7d;$this->fileFactory = $ve9d2ea3c13cc8f3b974ffbe8695cba02;}public function setModule(\def_module $v22884db148f0ffb0d830ba431102b0b5) {$this->module = $v22884db148f0ffb0d830ba431102b0b5;return $this;}public function loadCommon() {$v5f8f22b8cdbaeee8cf857673a9b6ba20 = $this->getDirectory();if (!$v5f8f22b8cdbaeee8cf857673a9b6ba20->isExists()) {return $this;}$this->includeList($v5f8f22b8cdbaeee8cf857673a9b6ba20, 'includes_*.php');$this->includeList($v5f8f22b8cdbaeee8cf857673a9b6ba20, 'events_*.php');$this->implementList($v5f8f22b8cdbaeee8cf857673a9b6ba20, 'common_*.php');$this->implementList($v5f8f22b8cdbaeee8cf857673a9b6ba20, '__events_*.php');return $this;}public function loadAdmin() {$v5f8f22b8cdbaeee8cf857673a9b6ba20 = $this->getDirectory();if (!$v5f8f22b8cdbaeee8cf857673a9b6ba20->isExists()) {return $this;}$this->addFilesToAutoload()    ->implementList($v5f8f22b8cdbaeee8cf857673a9b6ba20, 'admin_*.php');return $this;}public function loadSite() {$v5f8f22b8cdbaeee8cf857673a9b6ba20 = $this->getDirectory();if (!$v5f8f22b8cdbaeee8cf857673a9b6ba20->isExists()) {return $this;}$this->addFilesToAutoload()    ->implementList($v5f8f22b8cdbaeee8cf857673a9b6ba20, 'site_*.php');return $this;}private function addFilesToAutoload() : iLoader {$v5f8f22b8cdbaeee8cf857673a9b6ba20 = $this->getDirectory();if (!$v5f8f22b8cdbaeee8cf857673a9b6ba20->isExists()) {return $this;}$vf946d757784a420bfae40a0d63fb5a43 = $this->getFilesListByPattern($v5f8f22b8cdbaeee8cf857673a9b6ba20, 'autoload_*.php');$v65ce55520291631ec618ade25f9c3fac = new AutoloadMapLoader();foreach ($vf946d757784a420bfae40a0d63fb5a43 as $v8c7dd922ad47494fc02c388e12c00eac) {$v1d78dc8ed51214e518b5114fe24490ae = $v65ce55520291631ec618ade25f9c3fac->fromFile($v8c7dd922ad47494fc02c388e12c00eac)     ->getMap();\umiAutoload::addClassesToAutoload($v1d78dc8ed51214e518b5114fe24490ae);}return $this;}private function getDirectory() {$vd6fe1d0be6347b8ef2427fa629c04485 = sprintf('%s%s/ext/', SYS_MODULES_PATH, get_class($this->getModule()));return $this->getDirectoryFactory()    ->create($vd6fe1d0be6347b8ef2427fa629c04485);}private function implementList(\iUmiDirectory $v5f8f22b8cdbaeee8cf857673a9b6ba20, $v240bf022e685b0ee30ad9fe9e1fb5d5b) {$ve9d2ea3c13cc8f3b974ffbe8695cba02 = $this->getFileFactory();$v22884db148f0ffb0d830ba431102b0b5 = $this->getModule();foreach ($v5f8f22b8cdbaeee8cf857673a9b6ba20->getList($v240bf022e685b0ee30ad9fe9e1fb5d5b) as $v47826cacc65c665212b821e6ff80b9b0) {$v8c7dd922ad47494fc02c388e12c00eac = $ve9d2ea3c13cc8f3b974ffbe8695cba02->create($v47826cacc65c665212b821e6ff80b9b0);$v5b063e275d506f65ebf1b02d926f19a4 = $v8c7dd922ad47494fc02c388e12c00eac->getFileName();$v6f66e878c62db60568a3487869695820 = str_replace('.php', '', $v5b063e275d506f65ebf1b02d926f19a4);$v22884db148f0ffb0d830ba431102b0b5->__loadLib($v5b063e275d506f65ebf1b02d926f19a4, $v5f8f22b8cdbaeee8cf857673a9b6ba20->getPath() . '/');$v22884db148f0ffb0d830ba431102b0b5->__implement($v6f66e878c62db60568a3487869695820, true);}}private function includeList(\iUmiDirectory $v5f8f22b8cdbaeee8cf857673a9b6ba20, $v240bf022e685b0ee30ad9fe9e1fb5d5b) {foreach ($v5f8f22b8cdbaeee8cf857673a9b6ba20->getList($v240bf022e685b0ee30ad9fe9e1fb5d5b) as $v47826cacc65c665212b821e6ff80b9b0) {require_once $v47826cacc65c665212b821e6ff80b9b0;}}private function getModule() {if (!$this->module instanceof \def_module) {throw new \DependencyNotInjectedException('You should inject module first!');}return $this->module;}private function getDirectoryFactory() {return $this->directoryFactory;}private function getFileFactory() {return $this->fileFactory;}private function getFilesListByPattern(\iUmiDirectory $v5f8f22b8cdbaeee8cf857673a9b6ba20, $v240bf022e685b0ee30ad9fe9e1fb5d5b) : array {$v45b963397aa40d4a0063e0d85e4fe7a1 = [];foreach ($v5f8f22b8cdbaeee8cf857673a9b6ba20->getList($v240bf022e685b0ee30ad9fe9e1fb5d5b) as $v47826cacc65c665212b821e6ff80b9b0) {$v45b963397aa40d4a0063e0d85e4fe7a1[] = $v47826cacc65c665212b821e6ff80b9b0;}return $v45b963397aa40d4a0063e0d85e4fe7a1;}}