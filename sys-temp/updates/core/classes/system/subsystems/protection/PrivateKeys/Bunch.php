<?php
 namespace UmiCms\System\Protection\PrivateKeys;use \iConfiguration as iConfig;use UmiCms\System\Protection\iEncrypter as iCryptographer;use UmiCms\Classes\System\Entities\File\iFactory as iFileFactory;class Bunch implements iBunch {private $config;private $cryptographer;private $fileFactory;public function __construct(   iCryptographer $ve700af1332ed9aa14f321e194cd8c925, iConfig $v2245023265ae4cf87d02c8b6ba991139, iFileFactory $ve9d2ea3c13cc8f3b974ffbe8695cba02  ) {$this->cryptographer = $ve700af1332ed9aa14f321e194cd8c925;$this->config = $v2245023265ae4cf87d02c8b6ba991139;$this->fileFactory = $ve9d2ea3c13cc8f3b974ffbe8695cba02;}public function get(string $vb068931cc450442b63f5b3d276ea4297) : string {$vd6fe1d0be6347b8ef2427fa629c04485 = $this->resolveFilePath($vb068931cc450442b63f5b3d276ea4297);$v8c7dd922ad47494fc02c388e12c00eac = $this->fileFactory->create($vd6fe1d0be6347b8ef2427fa629c04485);if (!$v8c7dd922ad47494fc02c388e12c00eac->isExists()) {throw new \ErrorException(sprintf('Cannot read key "%s"', $vb068931cc450442b63f5b3d276ea4297));}$v9a0364b9e99bb480dd25e1f0284c8555 = (string) $v8c7dd922ad47494fc02c388e12c00eac->getContent();if ($v9a0364b9e99bb480dd25e1f0284c8555 === '') {throw new \ErrorException(sprintf('Key "%s" is empty', $vb068931cc450442b63f5b3d276ea4297));}return $this->cryptographer->decrypt($v9a0364b9e99bb480dd25e1f0284c8555);}public function set(string $vb068931cc450442b63f5b3d276ea4297, string $v9a0364b9e99bb480dd25e1f0284c8555) : iBunch {if ($v9a0364b9e99bb480dd25e1f0284c8555 === '') {throw new \ErrorException(     sprintf('Cannot write empty content for key "%s"', $vb068931cc450442b63f5b3d276ea4297)    );}$v9a0364b9e99bb480dd25e1f0284c8555 = $this->normaliseKey($v9a0364b9e99bb480dd25e1f0284c8555);$vd6fe1d0be6347b8ef2427fa629c04485 = $this->resolveFilePath($vb068931cc450442b63f5b3d276ea4297);$v8c7dd922ad47494fc02c388e12c00eac = $this->fileFactory->create($vd6fe1d0be6347b8ef2427fa629c04485);$v9a0364b9e99bb480dd25e1f0284c8555 = $this->cryptographer->encrypt($v9a0364b9e99bb480dd25e1f0284c8555);$v8c7dd922ad47494fc02c388e12c00eac->putContent($v9a0364b9e99bb480dd25e1f0284c8555);$v8c7dd922ad47494fc02c388e12c00eac->refresh();if (!$v8c7dd922ad47494fc02c388e12c00eac->isExists()) {throw new \ErrorException(sprintf('Cannot write key "%s"', $vb068931cc450442b63f5b3d276ea4297));}return $this;}public function delete(string $vb068931cc450442b63f5b3d276ea4297) : iBunch {$vd6fe1d0be6347b8ef2427fa629c04485 = $this->resolveFilePath($vb068931cc450442b63f5b3d276ea4297);$v8c7dd922ad47494fc02c388e12c00eac = $this->fileFactory->create($vd6fe1d0be6347b8ef2427fa629c04485);if (!$v8c7dd922ad47494fc02c388e12c00eac->isExists()) {throw new \ErrorException(sprintf('Cannot read key "%s"', $vb068931cc450442b63f5b3d276ea4297));}$v8c7dd922ad47494fc02c388e12c00eac->delete();$v8c7dd922ad47494fc02c388e12c00eac->refresh();if ($v8c7dd922ad47494fc02c388e12c00eac->isExists()) {throw new \ErrorException(sprintf('Cannot delete key "%s"', $vb068931cc450442b63f5b3d276ea4297));}return $this;}private function resolveFilePath(string $v5b063e275d506f65ebf1b02d926f19a4) : string {$v5f8f22b8cdbaeee8cf857673a9b6ba20 = $this->config->includeParam('private-keys-path');return $v5f8f22b8cdbaeee8cf857673a9b6ba20 . '/' . $this->cryptographer->encrypt($v5b063e275d506f65ebf1b02d926f19a4);}private function normaliseKey(string $v9a0364b9e99bb480dd25e1f0284c8555) : string {$v9a0364b9e99bb480dd25e1f0284c8555 = trim($v9a0364b9e99bb480dd25e1f0284c8555);$v9a0364b9e99bb480dd25e1f0284c8555 = str_replace('\\n', PHP_EOL, $v9a0364b9e99bb480dd25e1f0284c8555);$v9a0364b9e99bb480dd25e1f0284c8555 = str_replace('\n', PHP_EOL, $v9a0364b9e99bb480dd25e1f0284c8555);$v9a0364b9e99bb480dd25e1f0284c8555 = str_replace('\n\\', PHP_EOL, $v9a0364b9e99bb480dd25e1f0284c8555);$v9a0364b9e99bb480dd25e1f0284c8555 = str_replace('\r\n', PHP_EOL, $v9a0364b9e99bb480dd25e1f0284c8555);return str_replace('\r', PHP_EOL, $v9a0364b9e99bb480dd25e1f0284c8555);}}