var NullItem=function(){this.draw=function(){},this.expand=function(){}};function filter(){this.AllText=[],this.Props={},this.EntIDs=[],this.Parents=[],this.Langs=[],this.Domains=[],this.Orders={},this.Perms=!0,this.Full=!0,this.FldsOr=!1,this.Depth=null,this.CheckVirtual=!0,this.Page=null,this.Limit=null,this.hTypes=[],this.oTypes=[],this.setAllTextSearch=function(e){if(e instanceof Array){if(this.AllText.join()==e.join())return;this.AllText.length?this.AllText=this.AllText.concat(e):this.AllText=e}else this.AllText.push(e)},this.getAllTextSearch=function(){return this.AllText},this.setHTypes=function(e){e instanceof Array?this.hTypes=e:this.hTypes.push(e)},this.setPropertyEqual=function(e,t){null==this.Props[e]&&(this.Props[e]={}),this.Props[e].eq=t},this.setPropertyNotEqual=function(e,t){null==this.Props[e]&&(this.Props[e]={}),this.Props[e].ne=t},this.setPropertyLike=function(e,t){null==this.Props[e]&&(this.Props[e]={}),this.Props[e].like=t},this.setPropertyLess=function(e,t){null==this.Props[e]&&(this.Props[e]={}),this.Props[e].lt=t},this.setPropertyGreater=function(e,t){null==this.Props[e]&&(this.Props[e]={}),this.Props[e].gt=t},this.setPropertyBetween=function(e,t,n){null==this.Props[e]&&(this.Props[e]={}),this.Props[e].gt=t,this.Props[e].lt=n},this.removeProperty=function(e){this.Props[e]=void 0},this.addOrder=function(e,t){var n=!0;null==t||!1!==t&&"DESC"!=t.toUpperCase()&&"BACKWARD"!=t.toUpperCase()||(n=!1),this.Orders[e]=n},this.setOrder=function(e,t){var n=!0;null==t||!1!==t&&"DESC"!=t.toUpperCase()&&"BACKWARD"!=t.toUpperCase()||(n=!1),this.Orders={},this.Orders[e]=n},this.setPermissions=function(e){this.Perms=null==e||!!e},this.setParentElements=function(e){e instanceof Array?this.Parents=e:this.Parents.push(e)},this.setDepth=function(e){void 0!==e&&(this.Depth=parseInt(e))},this.setEntityIDs=function(e){e instanceof Array?this.EntIDs=e:this.EntIDs.push(e)},this.setDomain=function(e){e instanceof Array?this.Domains=e:this.Domains.push(e)},this.setLang=function(e){e instanceof Array?this.Langs=e:this.Langs.push(e)},this.setHtypes=function(e){e instanceof Array?this.hTypes=e:this.hTypes.push(e)},this.setOtypes=function(e){e instanceof Array?this.oTypes=e:this.oTypes.push(e)},this.setVirtualCopyChecking=function(e){this.CheckVirtual=void 0===e||!!e},this.setViewMode=function(e){this.Full=void 0===e||!!e},this.setConditionModeOr=function(e){this.FldsOr=void 0===e||!!e},this.getParents=function(){return this.Parents},this.setPage=function(e){this.Page=parseInt(e)},this.getPage=function(){return this.Page},this.setLimit=function(e){this.Limit=parseInt(e)},this.getLimit=function(){return this.Limit},this.getQueryString=function(e){var t=[],n=0;if(e instanceof Object){var i={};for(n in e.Props)i[n]=e.Props[n];for(n in this.Props)i[n]=this.Props[n];for(n in i)for(var a in i[n])if(i[n][a]instanceof Array)for(var l=0;l<i[n][a].length;l++)t.push("fields_filter["+n+"]["+a+"][]="+encodeURIComponent(i[n][a][l]));else t.push("fields_filter["+n+"]["+a+"]="+encodeURIComponent(i[n][a]));for(n=0;n<this.AllText.length;n++)t.push("search-all-text[]="+encodeURIComponent(this.AllText[n]));for(n=0;n<e.AllText.length;n++)t.push("search-all-text[]="+encodeURIComponent(e.AllText[n]));for(t.length?(jQuery("#search_result").addClass("active"),jQuery("#search_result").html(getLabel("js-search-result"))):this.Parents.length||e.Parents.length||(jQuery("#search_result").html(""),jQuery("#search_result").removeClass("active")),n=0;n<this.EntIDs.length;n++)t.push("id[]="+this.EntIDs[n]);for(n=0;n<e.EntIDs.length;n++)t.push("id[]="+e.EntIDs[n]);for(n=0;n<this.Parents.length;n++)t.push("rel[]="+this.Parents[n]);for(n=0;n<e.Parents.length;n++)t.push("rel[]="+e.Parents[n]);for(n=0;n<this.hTypes.length;n++)t.push("hierarchy_types[]="+this.hTypes[n]);for(n=0;n<this.Domains.length;n++)t.push("domain_id[]="+this.Domains[n]);for(n=0;n<e.Domains.length;n++)t.push("domain_id[]="+e.Domains[n]);for(n=0;n<this.Langs.length;n++)t.push("lang_id[]="+this.Langs[n]);for(n=0;n<e.Langs.length;n++)t.push("lang_id[]="+e.Langs[n]);for(n=0;n<e.oTypes.length;n++)t.push("object_type[]="+e.oTypes[n]);for(n in i={},e.Orders)i[n]=e.Orders[n];for(n in this.Orders)i[n]=this.Orders[n];for(n in i)t.push("order_filter["+n+"]="+(i[n]?"asc":"desc"));null!==this.Perms&&(this.Perms?t.push("permissions"):e.Perms&&t.push("permissions")),null!==this.CheckVirtual&&(this.CheckVirtual?t.push("virtuals"):e.CheckVirtual&&t.push("virtuals")),null!==this.Depth?t.push("depth="+this.Depth):null!==e.Depth&&t.push("depth="+e.Depth),null!==this.Page?t.push("p="+this.Page):null!==e.Page&&t.push("p="+e.Page),null!==this.Limit?t.push("per_page_limit="+this.Limit):null!==e.Limit&&t.push("per_page_limit="+e.Limit),(this.FldsOr||e.FldsOd)&&t.push("or-mode"),(this.Full||e.Full)&&t.push("viewMode=full")}else{for(n in this.Props)for(var a in this.Props[n])if(this.Props[n][a]instanceof Array)for(l=0;l<this.Props[n][a].length;l++)t.push("fields_filter["+n+"]["+a+"][]="+encodeURIComponent(this.Props[n][a][l]));else t.push("fields_filter["+n+"]["+a+"]="+encodeURIComponent(this.Props[n][a]));for(n=0;n<this.AllText.length;n++)t.push("search-all-text[]="+encodeURIComponent(this.AllText[n]));for(n=0;n<this.EntIDs.length;n++)t.push("id[]="+this.EntIDs[n]);for(n=0;n<this.Parents.length;n++)t.push("rel[]="+this.Parents[n]);for(n=0;n<this.Domains.length;n++)t.push("domain_id[]="+this.Domains[n]);for(n=0;n<this.Langs.length;n++)t.push("lang_id[]="+this.Langs[n]);for(n in this.Orders)t.push("order_filter["+n+"]="+(this.Orders[n]?"asc":"desc"));this.Perms&&t.push("permissions"),this.CheckVirtual&&t.push("virtuals"),null!==this.Depth&&t.push("depth="+this.Depth),null!==this.Page&&t.push("p="+this.Page),null!==this.Limit&&t.push("per_page_limit="+this.Limit),this.FldsOr&&t.push("or-mode"),this.Full&&t.push("viewMode=full")}return t.push("childs"),t.push("links"),t.push("templates"),"?"+t.join("&")},this.clear=function(){this.AllText=[],this.Props={},this.EntIDs=[],this.Parents=[],this.Langs=[],this.Domains=[],this.Orders={},this.Perms=!0,this.Depth=null,this.Page=null,this.Limit=null,this.Full=!0,this.FldsOr=!1,this.CheckVirtual=null},this.empty=function(){var e=0,t=0;for(var n in this.Props)if(++e)break;for(var n in this.Orders)if(++t)break;return!this.AllText.length&&!this.EntIDs.length&&!this.Parents.length&&!this.Langs.length&&!this.Domains.length&&!e&&!t&&this.Perms&&this.Full&&!this.Depth&&!this.Page&&!this.FldsOr&&!this.CheckVirtual};var e=function(t){if(!t||"object"!=typeof t)return t;var n,i,a="function"==typeof t.pop?[]:{};for(n in t)t.hasOwnProperty(n)&&(i=t[n],a[n]=i&&"object"==typeof i?e(i):i);return a};this.clone=function(){return e(this)}}var TableItem=function(e,t,n,a,l){var o=parseInt(n.id),r=parseInt(n["object-id"]),s=this,c=n,d=t,u=a||null,p=l||"after",h=void 0!==n["force-draw"]?parseInt(n["force-draw"]):1,f=void 0!==n.childs?parseInt(n.childs):0,m=n.basetype&&"string"==typeof n.basetype.module?n.basetype.module:"content",g=n.basetype&&"string"==typeof n.basetype.method?n.basetype.method:"",v=n.basetype&&"string"==typeof n.basetype._value?n.basetype._value:"",b=e.iconsPath,y=void 0!==n.iconbase?n.iconbase:b+"ico_"+m+"_"+g+".png",C=null,w=null,L=null,x=null,k=SettingsStore.getInstance(),I=null,_=!1,T=e.flatMode,j=e.objectTypesMode,E=null,A=null,N="boolean"!=typeof e.hasCheckboxes||e.hasCheckboxes;this.checkBox=null,this.element=null,this.control=e,this.childsContainer=null,this.id=o,this.objectId=r,this.name=void 0!==n.name?n.name:getLabel("js-smc-noname-page"),this.isRoot=!d,this.loaded=!1,this.viewLink=void 0!==n.link&&n.link,this.editLink=void 0!==n["edit-link"]&&n["edit-link"],this.createLink=void 0!==n["create-link"]&&n["create-link"],this.permissions=void 0!==n.permissions?parseInt(n.permissions):0,this.isActive=void 0!==n["is-active"]?parseInt(n["is-active"]):0,j&&(this.isActive=!0),this.isVirtualCopy=void 0!==n["has-virtual-copy"],this.isOriginal=void 0!==n["is-original"],this.lockedBy="object"==typeof n["locked-by"]?n["locked-by"]:null,this.expiration="object"==typeof n.expiration?n.expiration:null,this.templateId=void 0!==n["template-id"]?n["template-id"]:null,this.langId=void 0!==n["lang-id"]?n["lang-id"]:null,this.domainId=void 0!==n["domain-id"]?n["domain-id"]:null,this.allowCopy=void 0===n["allow-copy"]||parseInt(n["allow-copy"]),this.allowActivity=void 0===n["allow-activity"]||parseInt(n["allow-activity"]),this.allowDrag=void 0===n["allow-drag"]||n["allow-drag"],this.parent=d,this.childs=[],this.hasChilds=f>0||0==o,this.labelControl=null,this.position=!1,this.isExpanded=!1,this.filter=new filter,this.level=d?d.level+1:0,this.ignoreEmptyFilter=!1,this.pageLimits=this.control.PerPageLimits,this.nextSibling="object"==typeof n.nextSibling?n.nextSibling:null,this.row=null,this.editableFieldTypeList=["boolean","color","counter","date","domain_id","domain_id_list","file","float","img_file","int","link_to_object_type","name","price","optioned","relation","string","string","swf_file","tags","text","video_file","multiple_image","multiple_file","lang_id","lang_id_list"],this.pageing={total:0,limit:0,offset:0},this.baseModule=m,this.baseMethod=g;var S=function(e,t){if(!T||"pages"===s.control.contentType)return t;if(!s.control.enableObjectsActivity)return!0;var n=$(s.control.dataSet.getCommonFields());return $('field[name = "disabled"]',n).length>0?0===e.getValue("disabled").length:""!==(t||e.getValue("is_activated")||e.getValue("is_active")||e.getValue("activated"))},P=function(e,t){var n=document.createElement("col");n.style.width=t,$(e).append(n)},M=function(e){var t=$(e),n=B(),i=V();t.html("");var a,l=parseInt(n.name.params[0]);for(var o in P(t,l+"px"),n)i.hasOwnProperty(o)&&(a=n[o].params[0],P(t,a));P(t,"100%")},D=function(e){s.isActive=S(s,s.isActive);var t=B(),n=V(),i=document.createElement("tr");i.setAttribute("rel",o),i.className="table-row tollbar level-"+s.level,i.rel=o,s.row=i,w=i,s.labelControl=w;var a=t.name,r=document.createElement("td");if(r.classList.add("table-cell"),r.id="c_"+s.control.id+"_"+o+"_name",r.width=parseInt(a.params[0]),r.name="name",!1!==editableCell.enableEdit){var c=document.createElement("i");c.className="small-ico i-change editable",c.title=getLabel("js-table-control-fast-edit"),c.id="e_"+s.control.id+"_"+s.id+"_name",r.appendChild(c)}var d=document.createElement("div");d.style.owerflow="hidden",r.appendChild(d);var h=null;j||(h=new editableCell(s,r,a,c)),h instanceof editableCell&&!h.isActive&&$(c).detach(),(C=document.createElement("span")).className="catalog-toggle";var f=document.createElement("span");f.classList.add("catalog-toggle-wrapper"),f.onclick=function(){return s.toggle(this),!1},s.hasChilds?f.appendChild(C):f.className="catalog-toggle-off",s.control.flatMode||d.appendChild(f);var m=document.createElement("div");m.classList.add("checkbox");var g=document.createElement("input");g.setAttribute("type","checkbox"),g.value=o,g.classList.add("row_selector"),m.appendChild(g);var k=jQuery(i);if(k.on("mousedown",function(e){s.control.handleMouseDown(e,o)}),k.on("mouseup",function(e){s.control.handleMouseUp(e,s)}),N&&(s.checkBox=m,d.appendChild(m)),(x=document.createElement("img")).style.border="0px",x.setAttribute("alt",v),x.setAttribute("title",v),x.setAttribute("src",y),x.className="ti-icon",x.onmousedown=function(){return!1},s.control.allowDrag&&s.allowDrag&&(x.style.cursor="move"),s.control.flatMode||s.control.objectTypesMode?x=null:d.appendChild(x),s.expiration){var I=s.expiration.status;if(I){var _=I.id,P=I._value;if(_){var D=document.createElement("img"),H=b+"ico_"+_+".png";D.setAttribute("src",H),D.setAttribute("alt",P),D.setAttribute("title",P),D.className="page-status",d.appendChild(D)}}}L=document.createElement("a");var O=s.getValue("name"),F=String("string"==typeof O&&O.length?O:"");F.length||(F=getLabel("js-smc-noname-page"));var R=F.replace(/<[^>]+>/g,"");if(R=s.viewLink?R+" "+s.viewLink:R,d.title=R,L.className="name_col",L.href=s.editLink,L.innerHTML=F,s.editLink||(L.className="name_col unactive"),$(L).on("mousedown click mouseup",function(e){return 1!==e.button&&e.preventDefault(),!0}),d.appendChild(L),"string"==typeof s.editLink){var Q=document.createElement("a");Q.classList.add("small-ico"),Q.classList.add("i-edit"),Q.classList.add("stucktotext"),Q.classList.add("editable"),Q.setAttribute("href",s.editLink),Q.setAttribute("title",getLabel("js-goto-edit-page")),d.appendChild(Q)}if(s.isVirtualCopy){var X=document.createElement("span");X.className="label-virtual",X.innerHTML=s.isOriginal?getLabel("js-smc-original"):getLabel("js-smc-virtual-copy"),d.appendChild(X)}s.isActive||s.control.objectTypesMode||i.classList.add("disabled"),i.appendChild(r);var z=2;for(var U in t){var q=n[U],W=t[U].params;if("static"===W[1]&&(q=t[U]),q){z++;var G=document.createElement("td");G.id="c_"+s.control.id+"_"+o+"_"+U,G.className="table-cell",G.style.width=W[0],G.style.maxWidth=W[0],G.name=U,F=s.getValue(U);var Y=document.createElement("div");if(Y.style.cursor="text",Y.style.width="100%",Y.classList.add("cell-item"),Y.innerHTML=F,h=null,-1!==s.editableFieldTypeList.indexOf(q.dataType)&&!1!==editableCell.enableEdit){var Z=document.createElement("i");Z.className="small-ico i-change editable",Z.title=getLabel("js-table-control-fast-edit"),Z.id="e_"+s.control.id+"_"+s.id+"_"+U,G.appendChild(Z),h=new editableCell(s,G,q,Z)}G.appendChild(Y),h instanceof editableCell&&!h.isActive&&$(Z).detach(),"is_activated"!==U&&"active"!==U&&"is_active"!==U||(A=G),i.appendChild(G)}}var K=document.createElement("td");if(K.className="table-cell",K.style.width="100%",i.appendChild(K),u){var J=null;J="after"===p.toLowerCase()?u.element.nextSibling:u.element,s.element=J?e.insertBefore(i,J):e.appendChild(i)}else s.element=e.appendChild(i);if(s.control.dragAllowed&&s.allowDrag){var ee,te="child",ne=!1;jQuery(w).draggable({appendTo:"body",distance:Control.DragSensitivity,handle:".ti-icon, a",cursorAt:{right:-2},helper:function(){var e=document.createElement("div");if("objects"===s.control.contentType)e.innerHTML="<div>"+s.name+"</div>",e.className="ti-draggable",jQuery(e).css({position:"absolute",background:"url("+y+") no-repeat 0 4px","padding-left":"20px"});else{for(key in s.setSelected(!0),s.control.selectedList[s.id]=s,s.control.selectedList)e.innerHTML+="<div>"+s.control.selectedList[key].name+"</div>";e.className="ti-draggable",jQuery(e).css({position:"absolute","padding-left":"20px"})}return e},start:function(){Control.DraggableItem=s,Control.DragMode=!0,s.control.toolbar&&s.control.toolbar.hide()},stop:function(){Control.HandleItem&&(Control.HandleItem.deInitDroppable(),Control.DraggableItem&&Control.DraggableItem.tryMoveTo(Control.HandleItem,te)),Control.DraggableItem=null,Control.DragMode=!1,jQuery(".pages-bar a").off("mouseover"),ne=!1,window.clearTimeout(ee)},drag:function(e){var t=jQuery(".pages-bar a");t.on("mouseover",function(){if(!ne){ne=!0;var e=this;ee=window.setTimeout(function(){$(e).trigger("click")},1e3)}}),t.on("mouseout",function(){ne&&(ne=!1,window.clearTimeout(ee))});var n=e.pageX,i=e.pageY,a=Control.detectItemByMousePointer(n,i),l=Control.HandleItem;if(l&&l.deInitDroppable(),Control.HandleItem=a,a){var o=i-jQuery(a.control.initContainer).position().top-a.position.top-301;te=o>61?"after":o>55?"child":"before",a.initDroppable(te)}}})}var ie=document.createElement("tr"),ae=document.createElement("td");T||z++,ae.colSpan=z,ie.appendChild(ae);var le=document.createElement("table");le.classList.add("table"),le.style.tableLayout="fixed";var oe=document.createElement("colgroup");M(oe),le.appendChild(oe);var re=document.createElement("tr");switch(re.classList.add("table-row"),re.classList.add("level-"+s.level),re.style.display="none",(E=document.createElement("td")).classList.add("pages-bar"),E.classList.add("table-cell"),E.id="pb_"+s.control.id+"_"+s.id,E.colSpan=z,re.appendChild(E),ae.appendChild(le),le.appendChild(re),s.childsContainer=le,!0){case!i.nextSibling:e.appendChild(ie);break;case"before"===l:i.parentNode.insertBefore(ie,i.nextSibling);break;case"after"===l:i.parentNode.insertBefore(ie,i)}s.resizeColumn("name",parseInt(a.params[0]))};this.tryMoveTo=function(e,t){if(e){var n=this.control.getRootNodeId(),a=e.id,l=1,o="";if("pages"==this.control.contentType&&(l="child"!==t?1:0),"before"==t&&("pages"==this.control.contentType?(n=e.id,o=a=e.parent.id):(n=e.id,a=e.id)),"after"==t)if("pages"==this.control.contentType){var r=e.getNextSibling();a=e.parent.id,n=r?r.id:this.control.getRootNodeId(),o=e.id}else a=e.id,o=e.id;if("objects"==this.control.contentType&&(o=a),e===this)return!1;if(e.checkIsChild(this))return!1;if(n==this.id)return!1;var s=e;1==l&&"pages"==this.control.contentType&&(s=e.parent?e.parent:e.control.getRoot());var c=[],d=0;for(i in this.control.selectedList)c[d++]=i;this.control.dataSet.execute("move",{element:this.id,before:n,after:o,rel:a,"as-sibling":l,domain:e.control.getRoot().name,childs:1,links:1,virtuals:1,permissions:1,templates:1,receiver_item:s,handle_item:this,viewMode:"full",moveMode:t,selected_list:c})}},this.initDroppable=function(e){e=e||"child";var t=Control.DraggableItem,n=jQuery(this.control.initContainer).offset();if(t){if(t===this)return!1;if(this.checkIsChild(t))return!1;var i=Control.dropIndicator;if(oTable){var a=jQuery(oTable.container).width();a<this.position.right&&(this.position.right=a)}"after"==e&&(i.style.top=this.position.bottom+n.top+"px",i.style.left=this.position.left+n.left+"px",i.style.width=this.position.right-this.position.left),"before"==e&&(i.style.top=this.position.top+n.top+i.offsetHeight+"px",i.style.left=this.position.left+n.left+"px",i.style.width=this.position.right-this.position.left+"px"),"child"==e&&(i.style.top=this.position.bottom+n.top+"px",i.style.left=this.position.left+n.left+20+"px",i.style.width=this.position.right+n.left-20-this.position.left+"px"),i.style.display="",setTimeout(W,3239)}},this.deInitDroppable=function(){Control.dropIndicator&&(Control.dropIndicator.style.display="none")};var B=function(){if(s.control.usedColumns)return s.control.usedColumns;var e={},t=k.get(s.control.id,"used-columns");if(!1===t&&(0==(t=s.control.visiblePropsMenu).length&&(t=s.control.dataSet.getDefaultFields()),t||(t="")),t.length)for(var n=t.split("|"),i=0;i<n.length;i++){var a=n[i],l=n[i],o=[],r=a.indexOf("[");r&&(l=a.substring(0,r),o=a.substring(r+1,a.length-1).split(",")),e[l]={name:l,params:o}}e.name||(e.name={name:"name",params:["250px"]});var c=s.control.sequencePropsMenu;return e=H(e,c),s.control.usedColumns=e,e},H=function(e,t){var n,i={},a=0;for(n in e)e.hasOwnProperty(t[a])||(delete t[a],t.splice(a)),e.hasOwnProperty(n)&&(-1===t.indexOf(n)&&t.push(n),i[t[a]]=e[t[a]]||"",a++);return i},O=function(){var e=B(),t=[];for(name in e){var n=e[name];n&&(t[t.length]=name+"["+n.params.join(",")+"]")}k.set(s.control.id,t.join("|"),"used-columns")},F=function(){if(s.control.columnsMenu)return s.control.columnsMenu;var e={};return $.each(V(),function(t,n){-1===$.inArray(n.fieldName,s.control.requiredPropsMenu)&&(e[t]=n)}),s.control.columnsMenu=e,e},R=function(e){s.control.columnsMenu=e},V=function(){if(s.control.columnsTable)return s.control.columnsTable;for(var e=s.control.dataSet.getCommonFields(),t=B(),n=1,i={},a=0;a<e.length;a++){n++;for(var l=e[a].getElementsByTagName("field"),o=!1,r=0;r<l.length;r++){var c=l[r],d=c.getAttribute("name"),u=c.getElementsByTagName("type")[0].getAttribute("data-type");if(!g(d,u)){var p=d in t,h=c.getAttribute("title"),f=c.getAttribute("id"),m=c.getAttribute("guide-id");i[d]={caption:h,icon:p?"checked":"undefined",id:f,title:h,fieldName:d,dataType:u,guideId:m,checked:p,execute:function(e){e.checked?s.removeColumn(e.fieldName):s.appendColumn(e.fieldName),Control.recalcItemsPosition()}},n++,a<l.length-1&&(o=!0)}}o&&(i[n+"-sep"]="-")}return s.control.columnsTable=i,i;function g(e,t){if(-1===$.inArray(t,s.editableFieldTypeList))return!0;for(var n=s.control.dataSet.getFieldsStoplist(),i=0;i<n.length;i++)if(n[i]==e)return!0;return!1}};this.resizeColumn=function(e,t){var n=B();if(!n[e])return!1;for(var i=0;i<s.childs.length;i++){var a=s.control.items[s.childs[i]];a&&a.resizeColumn(e,t)}if(s.isRoot){if(!(l=document.getElementById("h_"+s.control.id+"_"+e)))return!1;l.style.width=t+"px",l.style.maxWidth=t+"px",n[e].params[0]=t+"px",s.control.usedColumns=n,O()}else{var l;if(!(l=document.getElementById("c_"+s.control.id+"_"+s.id+"_"+e)))return!1;l.style.width=t+"px",l.style.maxWidth=t+"px"}var o=$(l);o.attr("width",t),this.recalculateNameCellWidth(o);var r=$("colgroup",s.control.initContainer);return M(r),!0},this.recalculateNameCellWidth=function(e){var t=$("a.name_col",e);t.length&&t.css({width:this.calculateNameCellContainerWidth(e)})},this.calculateNameCellContainerWidth=function(e){var t=parseInt(e.attr("width")),n=$("div.checkbox",e).outerWidth(!0),i=$("img.ti-icon",e);return t-n-(i.length?i.outerWidth(!0)?parseInt(i.outerWidth(!0)):16:0)-parseInt($("i.i-change",e).outerWidth())-parseInt($("a.i-edit",e).outerWidth())-parseInt(e.css("padding-left"))-parseInt(e.css("padding-right"))},this.startResizeColumn=function(e,t){var n=$(document.createElement("div")),i=$(this.control.initContainer),a=i.offset();n.addClass("resizer"),n.css({top:a.top,left:t.clientX,height:i.outerHeight()+"px"});$(document).on("mouseup",function(){$(document).off("mouseup"),$(document).off("mousemove");var t=$("#h_"+s.control.id+"_"+e),i=n.position().left-t.offset().left;i=Math.min(i,TableItem.maxColumnWidth),(i=Math.max(i,TableItem.minColumnWidth))!==t.outerWidth()&&(s.resizeColumn(e,i),Control.recalcItemsPosition()),n.detach()}),$(document).on("mousemove",function(e){!function(){try{document.body.style["-moz-user-select"]="none",document.body.style["-khtml-user-select"]="none",document.body.onselectstart=function(){return!1},document.selection.empty()}catch(e){}}(),n.css("left",e.clientX)}),$("body").append(n)},this.appendColumn=function(e){var t=B(),n=F(),i=n[e];if(!i||t[e])return!1;for(var a=0;a<s.childs.length;a++){var l=s.control.items[s.childs[a]];l&&l.appendColumn(e)}if(s.isRoot){(u=document.createElement("th")).className="table-cell",u.setAttribute("id","h_"+s.control.id+"_"+e),u.setAttribute("name",name),u.name=e,u.style.width="200px";var o=document.createElement("span");o.onmousedown=function(t){t||(t=window.event),s.startResizeColumn(e,t)},u.appendChild(o);var r=document.createElement("div");r.classList.add("table-title"),r.title=i.title,r.innerHTML=i.title,u.appendChild(r),s.element.insertBefore(u,s.element.lastChild),t[e]={name:e,params:["200px"]},s.control.usedColumns=t,n[e].checked=!0,n[e].icon="checked",R(n);var c=document.createElement("div");c.setAttribute("id","f_"+s.control.id+"_"+e),c.style.width="100%",s.control.onDrawFieldFilter(n[e],c,t[e].params),u.appendChild(c);var d=document.getElementById("pb_"+s.control.id+"_"+s.id);d&&(d.colSpan+=1),O(),z()}else{var u;if((u=document.createElement("td")).id="c_"+s.control.id+"_"+s.id+"_"+e,u.style.width="280px",u.style.maxWidth="200px",u.className="table-cell",u.name=e,document.getElementById(u.id))return!0;var p=s.getValue(e);s.element.insertBefore(u,s.element.lastChild),s.childsContainer.parentNode.colSpan+=1;var h=document.createElement("i");h.className="small-ico i-change editable",h.title=getLabel("js-table-control-fast-edit"),h.id="e_"+s.control.id+"_"+s.id+"_"+e,u.appendChild(h);var f=document.createElement("div");f.style.cursor="text",f.style.width="100%",f.classList.add("cell-item"),f.innerHTML=p,u.appendChild(f);var m=new editableCell(s,u,i,h);m instanceof editableCell&&!m.isActive&&$(h).detach()}var g=$("colgroup",s.control.initContainer);return M(g),!0},this.removeColumn=function(e){var t=B(),n=F(),i=n[e];if(!i||!t[e])return!1;for(var a=0;a<s.childs.length;a++){var l=s.control.items[s.childs[a]];l&&l.removeColumn(e)}if(s.isRoot){if(!(u=document.getElementById("h_"+s.control.id+"_"+e)))return!1;u.parentNode.removeChild(u);var o=document.getElementById("f_"+s.control.id+"_"+e);o&&o.parentNode.removeChild(o);var r={};for(var c in t)c!=e&&(r[c]=t[c]);s.control.usedColumns=r,n[e].checked=!1,n[e].icon="undefined",R(n),s.control.onRemoveColumn(i),s.childsContainer.parentNode.parentNode.colSpan-=1;var d=document.getElementById("pb_"+s.control.id+"_"+s.id);d&&(d.colSpan-=1),O(),z()}else{var u;if(!(u=document.getElementById("c_"+s.control.id+"_"+s.id+"_"+e)))return!1;u.parentNode.removeChild(u),s.childsContainer.parentNode.parentNode.colSpan-=1}return M($("colgroup",s.control.initContainer)),!0},this.exportCallback=function(e){var t=function(e,n,i,a){var l=s.getExportLink(e,n);$.ajax({url:l,dataType:"json",method:"get"}).done(function(l){if("boolean"==typeof l.is_complete)return!0===l.is_complete?a():t(e,n,i,a);X(i,"Unknown")}).fail(function(e,t){X(i,t)})};$.get("/styles/skins/modern/design/js/smc/html/quickExportDialog.html",function(n){n=n.replace(/{{label:(.+)}}/gi,function(e,t){return getLabel(t)}),openDialog("",getLabel("js-csv-export"),{confirmText:getLabel("js-csv-export-button"),html:n,confirmCallback:function(n){var i=$("#popupLayer_"+n);Q(function(a){$("#quick_csv_encoding",i).hide(),$("div.eip_buttons",i).hide(),$("div.exchange_container",i).show(),t(e,a,n,function(){!function(e,t,n){closeDialog(n);var i=s.getExportLink(e,t);window.location=i+"&download=1"}(e,a,n)})})},openCallback:function(){initSelectizer()}})})},this.importCallback=function(e){e="number"==typeof e?e:null;var t=function(e,n,i){var a=new FormData;a.append("file",e),a.append("csrf",csrfProtection.getToken()),$.ajax({url:n,dataType:"json",method:"post",processData:!1,contentType:!1,data:a}).done(function(a){return"string"==typeof a.error?X(i,a.error):"boolean"==typeof a.is_complete?!0===a.is_complete?window.location.reload():t(e,n,i):void X(i,"Unknown")}).fail(function(e,t){X(i,t)})};$.get("/styles/skins/modern/design/js/smc/html/quickImportDialog.html",function(n){n=n.replace(/{{label:(.+)}}/gi,function(e,t){return getLabel(t)}),openDialog("",getLabel("js-csv-import"),{confirmText:getLabel("js-csv-import-button"),html:n,confirmCallback:function(n){var i=$("#popupLayer_"+n);Q(function(a){$("#import-csv-form",i).hide(),$("div.eip_buttons",i).hide(),$("div.exchange_container",i).show(),function(e,t,n,i){var a=s.getImportLink(e,t),l=$("#popupLayer_"+n),o=$("#import-csv-form",l),r=new FormData;r.append("csv-file",$('input[name = "csv-file"]',o).prop("files")[0]),r.append("csrf",csrfProtection.getToken()),r.append("upload",1),$.ajax({url:a,dataType:"json",method:"post",processData:!1,contentType:!1,data:r}).done(function(e){return"string"==typeof e.error?X(n,e.error):"string"==typeof e.file?i(e.file,a,n):void X(n,"Unknown")}).fail(function(e,t){X(n,t)})}(e,a,n,t)})},openCallback:function(){initSelectizer()}})})};var Q=function(e){var t=document.querySelector("select[name=encoding]"),n=null;t&&"number"==typeof t.selectedIndex&&(n=t.item(t.selectedIndex).text),e(n)},X=function(e,t){closeDialog(e),$.jGrowl(t,{header:getLabel("js-error-header")})},z=function(){var e=B(),t=V();for(var n in e){var i=t[n];"static"==e[n].params[1]&&((i=e[n]).title=getLabel("js-smc-"+n)),i&&0}},U=function(e){return function(t){return t||(t=window.event),s.startResizeColumn(e,t),!0}},q=function(){!function(){if(!Control.dropIndicator){var e=document.createElement("div");e.className="ti-drop",Control.dropIndicator=document.body.appendChild(e)}}();var e=B(),t=V(),n=document.createElement("tr");n.setAttribute("name",s.control.id),n.className="table-row title";var i=e.name,a=document.createElement("th");a.className="table-cell",a.id="h_"+s.control.id+"_name",a.setAttribute("name","name"),a.name=d,a.width=parseInt(i.params[0]);var l=document.createElement("div");l.classList.add("table-title"),l.classList.add("disabled");var o=getLabel("js-smc-name-column");if(s.control.labelFirstColumn.length>0&&(o=s.control.labelFirstColumn),l.innerHTML=o,l.title=o,(h=document.createElement("span")).onmousedown=U("name"),a.appendChild(h),a.appendChild(l),s.control.enableEdit){var r=document.createElement("div");r.className="input-search",r.id="f_"+s.control.id+"_name",s.control.onDrawFieldFilter("name",r,i.params),a.appendChild(r)}n.appendChild(a);var c=2;for(var d in e){var u=t[d],p=e[d].params;if("static"==p[1]&&((u=e[d]).title=getLabel("js-smc-"+d)),u){c++;var h,f=document.createElement("th");f.classList.add("table-cell"),f.id="h_"+s.control.id+"_"+d,f.setAttribute("name",d),f.style.width=p[0],(l=document.createElement("div")).classList.add("table-title"),l.classList.add("disabled"),l.title=u.title,l.innerHTML=u.title,f.appendChild(l),(h=document.createElement("span")).onmousedown=U(d),f.appendChild(h);var m=document.createElement("div");m.id="f_"+s.control.id+"_"+d,m.style.width="100%",s.control.onDrawFieldFilter(u,m,p),f.appendChild(m),n.appendChild(f),0}}var g,v=document.createElement("th");if(v.classList.add("table-cell"),v.classList.add("plus"),v.style.width="100%",v.style.textAlign="left",v.style.verticalAlign="middle",!s.control.objectTypesMode&&(g=F(),Object.keys(g).length>0)){var b=document.createElement("i");b.classList.add("small-ico"),b.classList.add("i-add"),b.classList.add("pointer"),jQuery(b).on("click",function(e){jQuery.cmenu.hideAll(),jQuery.cmenu.lockHiding=!0,jQuery.cmenu.show(jQuery.cmenu.getMenu(F()),s.control.initContainer.offsetParent,e)}),jQuery(b).on("mouseout",function(){jQuery.cmenu.lockHiding=!1}),v.oncontextmenu=function(){return!1},v.appendChild(b)}n.appendChild(v),jQuery(n).on("click",function(e){var t=e.target;t!==v&&TableItem.orderByColumn(t.parentNode.getAttribute("name"),s.control,t)}),z();var y=document.createElement("tBody");y.classList.add("level-"+s.level),y.style.display="none";var C=document.createElement("tr");C.style.display="none",C.classList.add("table-row"),(E=document.createElement("td")).classList.add("pages-bar"),E.classList.add("table-cell"),E.id="pb_"+s.control.id+"_"+s.id,T||c++,E.colSpan=c,C.appendChild(E),y.appendChild(C),s.element=s.control.container.appendChild(n),s.childsContainer=s.control.container.appendChild(y),s.control.initContainer=s.control.container,s.control.container=s.childsContainer,T&&!j&&s.showCsvButtons(s.exportCallback,s.importCallback),s.expand()};this.showCsvButtons=function(e,t){if(!this.control.disableCSVButtons){s.hideCsvButtons();var n=document.createElement("div");n.id="csv-buttons";var i=document.createElement("a"),a=document.createElement("i");if(a.className="small-ico i-csv-export",i.appendChild(a),i.appendChild(document.createTextNode(getLabel("js-csv-export"))),i.href="#",i.className="csvLink csvExport btn-action",i.onclick=e,n.appendChild(i),!this.control.hideCsvImportButton){var l=document.createElement("a"),o=document.createElement("i");o.className="small-ico i-csv-import",l.appendChild(o),l.appendChild(document.createTextNode(getLabel("js-csv-import"))),l.href="#",l.className="csvLink csvImport btn-action",l.onclick=t,n.appendChild(l)}document.getElementById("csv-buttons-zone").appendChild(n),s.csvButtons=n}},this.hideCsvButtons=function(){s.csvButtons&&(jQuery(s.csvButtons).remove(),s.csvButtons=!1),jQuery("#csv-buttons-zone").html("")},this.getExportLink=function(e,t){var n=B(),i=this.control.getCurrentFilter().getQueryString(),a=document.location.pathname;try{var l=s.control.dataSet.getPathModuleMethod()}catch(e){}if(a!==l&&0===a.indexOf(l)){var o=a.substring(l.length);a=new RegExp("/([/0-9]*)/").test(o)?a:l}else a=l;var r=a+i+"&xmlMode=force&export=csv";for(var c in n)if(n.hasOwnProperty(c)){var d=n[c].name;"name"!==d&&(r+="&used-fields[]="+d)}Array.isArray(e)&&e.forEach(function(e){r+="&rel[]="+e}),r+="&hierarchy-level=100";var u=this.control.dataSet.getDefaultFilter();return u.Langs[0]&&(r+="&lang_id[]="+u.Langs[0]),u.Domains[0]&&(r+="&domain_id[]="+u.Domains[0]),"string"==typeof t&&t.length>0&&(r+="&encoding="+t),r},this.getImportLink=function(e,t){var n=this.control.getCurrentFilter().getQueryString(),i=document.location.pathname;return i+=n+"&xmlMode=force&import=csv",e&&(i+="&rel[]="+e),"string"==typeof t&&t.length>0&&(i+="&encoding="+t),i};var W=function(){s===Control.HandleItem&&s.expand()};this.draw=function(){t?h||D(d.childsContainer):h||q()},this.appendChild=function(e){return new TableItem(this.control,s,e)},this.appendAfter=function(e,t){return new TableItem(this.control,s,e,t,"after")},this.appendBefore=function(e,t){return new TableItem(this.control,s,e,t,"before")},this.appendFirst=function(e){return 2==this.childsContainer.childNodes.length?this.appendChild(e):void 0!==this.childsContainer.childNodes[2].rel&&this.appendBefore(e,this.control.getItem(this.childsContainer.childNodes[1].rel))},this.getPreviousSibling=function(){var e=this.element.previousSibling;return e&&e.rel?this.control.getItem(e.rel):null},this.getNextSibling=function(){var e=this.element.nextSibling;return e&&e.rel?this.control.getItem(e.rel):null},this.clear=function(){if(this.isRoot)for(var e=this.element.parentNode;e.firstChild;)e.removeChild(e.firstChild);else this.element.parentNode&&(this.element.parentNode.removeChild(this.element.nextSibling),this.element.parentNode.removeChild(this.element))},this.checkIsChild=function(e){for(var t=this.parent;t;){if(e===t)return!0;t=t.parent}return!1},this.recalcPosition=function(){if(s.isRoot)return!1;try{for(var e=this.parent;e;){if(!e.isExpanded)return this.position=!1,!1;e=e.parent}var t=this.control.getRoot().childsContainer,n=jQuery(w).position();return this.position={left:n.left,top:n.top,right:n.left+t.offsetWidth,bottom:n.top+jQuery(w).height()},this.position}catch(e){return this.position=!1,!1}},this.setLoaded=function(e){this.loaded=e,C&&C.setAttribute("src",b+"collapse.png")};var G=function(e){if(!e||!e.type)return"";var t=function(t){return e.value._value||e.value||t||""};switch(e.type){case"int":case"float":case"price":case"link_to_object_type":case"counter":return t(0);case"tags":case"string":return function(){var n=t();if("email"==e.restriction)return'<a href="mailto:'+n+'" title="'+n+'" class="link">'+n+"</a>";"object"==typeof n&&"[object Array]"===Object.prototype.toString.call(n)&&(n=n.join(", "));n=/https?:\/\//.test(n)?'<a href="'+n+'" title="'+n+'" class="link">'+n+"</a>":'<span title="'+n+'">'+n+"</span>";return n}();case"color":return function(){var t=e.value?e.value:"";t&&(t='<div class="color table"><span class="value">'+t+'</span><span class="color-box"><i style="background-color: '+t+'"></i></span></div>');return t}();case"domain_id":return function(){var e=t();"object"==typeof e&&"object"==typeof e.domain&&(e=e.domain.host||"");return e}();case"domain_id_list":return function(){var e=t();if("object"!=typeof e)return e;if(!e.domain[0])return e.domain.host||"";for(var n=[],i=0;i<e.domain.length;i++){var a=e.domain[i].host||"";a&&n.push(a)}return n.join(", ")}();case"text":return t();case"boolean":return function(){if(t())return'<img alt="" style="width:13px;height:13px;" src="/styles/skins/modern/design/img/tree/checked.png" />';return""}();case"img_file":return function(){var t=e.value;if(!t)return"";var n=t._value,i=n.substring(0,n.lastIndexOf(".")),a="";"string"==typeof n&&(tmp=n.split(/\//),a=tmp[tmp.length-1]);if("1"==t.is_broken)t='<span title="404" style="color:red;font-weight: bold;cursor: pointer;">?</span>',t+='&nbsp;&nbsp;<span style="text-decoration: line-through;" title="'+n+'">'+a+"</span>";else{var l=t.ext,o="/autothumbs.php?img="+i+"_sl_180_120."+l;t='<img alt="" style="width:13px;height:13px;cursor: pointer;" src="/styles/skins/modern/design/img/image.png" onmouseover="TableItem.showPreviewImage(event, \''+o+"')\" />",t+='&nbsp;&nbsp;<span title="'+n+'">'+a+"</span>"}return t}();case"video_file":case"swf_file":case"file":return function(){var t=e.value;if(!t)return"";src=t._value,t="1"==t.is_broken?src?'<span style="text-decoration: line-through;" title="'+src+'">'+src+"</span>":"":src?'<span title="'+src+'">'+src+"</span>":"";return t}();case"relation":return function(){var e=t();if(!e)return"";var n="";if(e.item[0]){for(var i=0;i<e.item.length;i++)n+=e.item[i].name,i<e.item.length-1&&(n+=", ");n='<span title="'+n+'">'+n+"</span>"}else{n=e.item.name;var a="relation-value";null!=e.item.guid&&(a=e.item.guid),n='<span title="'+n+'" class="c-'+a+'">'+n+"</span>"}return n}();case"date":return e.value["formatted-date"];case"optioned":return getLabel("js-optioned-value-hidden");case"lang_id":return function(){let e=t();"object"==typeof e&&"object"==typeof e.lang&&(e=e.lang._value||"");return e}();case"lang_id_list":return function(){let e=t();if("object"!=typeof e)return e;if(!e.lang[0])return e.lang._value||"";let n=[];for(let t=0;t<e.lang.length;t++){let i=e.lang[t]._value||"";i&&n.push(i)}return n.join(", ")}();case"multiple_file":case"multiple_image":return function(){let t=Array.isArray(e.value)?e.value:[e.value],n=e.type,i="",a="";return $.each(t,function(e,t){if("multiple_image"==n){let e=t._value.substring(0,t._value.lastIndexOf(".")),n=t.ext;a='src="/styles/skins/modern/design/img/image.png" onmouseover="TableItem.showPreviewImage(event, \'/autothumbs.php?img='+e+"_sl_180_120."+n+"')\" />&nbsp;"}else a='src="/styles/skins/modern/design/img/ico_file.gif" title="'+t._value+'"/>&nbsp;';i+='<img alt="" style="width:13px;height:13px;cursor: pointer;" '+a}),i}();default:return""}};this.getValue=function(e){var t=B()[e];if("name"===e)return this.control.onGetValueCallback(this.name,e,this);if(t&&"static"===t.params[1])return this.control.onGetValueCallback(t,e,this);if(!c.properties||!c.properties.group)return"&nbsp;";var n=this.getProperty(e);return null===n?this.control.onGetValueCallback("",e,this):(n=this.control.onGetValueCallback(n,e,this),G(n))},this.getProperty=function(e){if(!c.properties||!c.properties.group)return null;for(var t=void 0!==c.properties.group[0]?c.properties.group:[c.properties.group],n=0;n<t.length;n++)if(t[n].property)for(var i=void 0!==t[n].property[0]?t[n].property:[t[n].property],a=0;a<i.length;a++)if(i[a].name===e)return i[a];return null},this.getData=function(){return c},this.setPageing=function(e){if(!e||!E)return!1;if(this.pageing=e,E.parentNode.style.display="none",E.classList.add("panel-sorting"),E.innerHTML="",E.style.textAlign="left",this.isRoot&&this.setPageingLimits(e),!(e.total<=e.limit&&e.offset<=0)){E.parentNode.style.display="";for(var t,n=function(e){return function(){return s.filter.setPage(e),s.applyFilter(s.filter,!0),!1}},i=Math.ceil(e.total/e.limit),a=Math.ceil(e.offset/e.limit),l=!0,o=Math.ceil(e.total/e.limit)-1,r=function(e){return 0!=e&&e!=o&&Math.abs(e-a)>1},c=0;c<i;c+=1)r(c)?(l&&((t=document.createElement("a")).href="#",t.innerHTML="â€¦",t.className="pagination-ellipsis",t.onclick=function(){return!1},E.appendChild(t)),l=!1):(l=!0,(t=document.createElement("a")).href="#",a==c&&(t.className="current"),t.innerHTML=c+1,t.onclick=n(c),E.appendChild(t))}},this.expand=function(){if(!this.hasChilds)return!1;this.isExpanded=!0,this.loaded||(this.loaded=!0,this.initFilter(o),this.control.load(this.filter)),C&&C.classList.add("switch"),this.childsContainer.style.display="",$(this.childsContainer).find(".checkbox input:checked").parent().addClass("checked"),$(this.childsContainer).find(".checkbox").on("click",function(){$(this).toggleClass("checked")}),this.loaded&&Control.recalcItemsPosition(),this.control.saveItemState(this.id)},this.collapse=function(){if(!this.hasChilds)return!1;this.isExpanded=!1,C&&C.classList.remove("switch"),this.childsContainer.style.display="none",Control.recalcItemsPosition(),this.control.saveItemState(this.id)},this.toggle=function(e){this.hasChilds&&($(e).toggleClass("switch"),this.isExpanded?this.collapse():this.expand())},this.update=function(e){if(e){if(this.id!=e.id)return!1;if(c=e,void 0!==e["template-id"]&&(this.templateId=e["template-id"]),void 0!==e.link&&e.link!=this.viewLink&&(this.viewLink=e.link,w.setAttribute("href",this.viewLink)),void 0!==e.childs&&parseInt(e.childs)!==f){f=parseInt(e.childs),this.hasChilds=f>0||0==o;var t=$("td.table-cell > div > span:first",w);s.hasChilds?(t.removeClass("catalog-toggle-off"),t.removeClass("switch"),t.addClass("catalog-toggle-wrapper"),t.empty(),(C=document.createElement("span")).className="catalog-toggle switch",C.src="/styles/skins/modern/design/img/tree/collapse.png",t.append(C)):(t.removeClass("catalog-toggle-wrapper"),t.removeClass("switch"),t.addClass("catalog-toggle-off"),t.empty())}var n=void 0!==e["is-active"]?parseInt(e["is-active"]):0;n!==this.isActive&&(this.isActive=n,this.isActive=S(this,this.isActive),this.isActive||s.control.objectTypesMode?jQuery(s.row).removeClass("disabled"):jQuery(s.row).addClass("disabled"),A&&jQuery("div",A).html(G({type:"boolean",value:this.isActive}))),void 0!==e.name&&e.name!=this.name&&(this.name=e.name.length?e.name:"",L.innerHTML=this.name.length?this.name:getLabel("js-smc-noname-page"))}},this.applyFilter=function(e,t){e instanceof Object?this.filter=e:this.filter.clear(),this.initFilter(!t),this.loaded&&(this.control.removeItem(o,!0),this.loaded=!1,this.isExpanded&&this.expand())},this.initFilter=function(e){e&&this.initRelationFilter(),j&&e||this.initSearchQuery()},this.initRelationFilter=function(){this.filter.setParentElements(o)},this.initSearchQuery=function(){var e=new SearchAllTextStorage(this.control.id).load();e.length>0&&this.filter.setAllTextSearch(e)},this.check=function(){N&&$(s.checkBox).toggleClass("checked")},this.isCheckboxAvailable=function(){return N},this.setSelected=function(e){e?(I||(I=w.className,w.classList.add("selected")),N&&$(this.checkBox).addClass("checked"),_=!0):(I&&(I=null),$(w).removeClass("selected"),N&&$(this.checkBox).removeClass("checked"),_=!1)},this.getSelected=function(){return _},this.setPageingLimits=function(e){var t=function(e){return function(){return s.filter.setPage(0),s.filter.setLimit(e),s.applyFilter(s.filter,!0),!1}},n=document.getElementById("per_page_limit");for(var i in n.innerHTML="<span>"+getLabel("js-label-elements-per-page")+"</span>",s.pageLimits){var a=document.createElement("a");a.className="per_page_limit",a.rel="0",a.innerHTML=s.pageLimits[i],a.onclick=t(s.pageLimits[i]),s.pageLimits[i]==e.limit&&(a.className+=" current"),n.appendChild(a)}},this.getUrl=function(){var e=TemplatesDataSet.getInstance().getDomainsList();if(!e)return s.viewLink;for(var t in e)if(e[t].id==s.domainId)return e[t].url+s.viewLink;return s.viewLink},t?(t.childs.push(o),h&&D(d.childsContainer)):h&&q()};TableItem.minColumnWidth=150,TableItem.maxColumnWidth=800,TableItem.orderByColumn=function(e,t,n){if(!t||!e||!n)return!1;var i,a="";t.orderColumn===n?(""==(a=n.classList.contains("switch")?"":"switch")&&n.classList.remove("switch"),""!==a&&n.classList.add(a)):(t.orderColumn&&(t.orderColumn.classList.remove("switch"),t.orderColumn.classList.add("disabled")),t.orderColumn=n,t.orderColumn.classList.remove("disabled")),i=""==a?"asc":"desc";var l=t.dataSet.getDefaultFilter();l.setOrder(e,i),t.dataSet.setDefaultFilter(l),t.applyFilter()},TableItem.showPreviewImage=function(e,t){if(e&&t){var n=e.target?e.target:e.toElement,i=e.pageX?e.pageX:e.clientX,a=e.pageY?e.pageY:e.clientY,l=document.createElement("img");l.setAttribute("src",t),l.src=t,l.className="img-fieled-preview",l.style.position="absolute",l.style.width="180px",l.style.height="120px",l.style.top=a+10+"px",l.style.left=i+10+"px",l.style.border="1px solid #666",document.body.appendChild(l),n.onmouseout=function(){l.parentNode.removeChild(l)}}};var TreeToolbar=function(e){var t=this,n=e,i=null,a=parseInt(n.container.style.zIndex)||0,l=n.dataSet;this.highlight=null,this.element=null,this.buttons=[];var o,r=function(){h();for(var e=0;e<t.buttons.length;e++)t.buttons[e].isAllwaisActive||t.buttons[e].element.classList.add("disabled")},s=function(){var e,t,n,a=i.control,o=u(),r=!1,s=!1;for(e in o)r=(n=o[e]).domainId,s=n.langId;var c=TemplatesDataSet.getInstance(),d=c.getLangsList(),p=c.getDomainsList(),h=function(e){var t,n=[];for(t in o)n.push(t);return l.addEventHandler("onBeforeExecute",createConfirm(a.dataSet)),l.execute("copyElementToSite",{element:n,"lang-id":e.data.langId,"domain-id":e.data.domainId,templates:1,childs:1,permissions:1,virtuals:1,links:1}),!1},f=[];for(e=0;e<p.length;e++){var m=p[e],g=r==m.id,v=[];for(t=0;t<d.length;t++){var b=d[t],y=g&&s==b.id;v.push({className:y?"checked":"undefined",caption:b.nodeValue,data:{domainId:m.id,langId:b.id},release:h})}f.push({className:g?"checked":"undefined",caption:m.host,chEl:!0,submenu:v})}return f},c=function(e,t){var n=document.createElement("li");e.appendChild(n),t.chEl&&(t.chEl=document.createElement("ul")),g(n,t)},d=function(){return 1==h()},u=function(){return n.selectedList},p=function(){return Object.keys(u())},h=function(){return p().length},f=function(e){return e?"small-ico i-hidden":"small-ico i-vision"},m=function(e){return e?getLabel("js-disable-page"):getLabel("js-enable-page")},g=function(e,n){var a=document.createElement("a");a.className="icon-action";var o=n.name||"toolbtn",r=n.caption||"",s=n.href||null,d="small-ico "+(n.className||""),u=n.init||function(){},p=n.hint||"",h=n.data||null,f=n.chEl||null,m=n.alwaysActive||!1;(b=document.createElement("i")).className=d,a.appendChild(b);var g=e.appendChild(a);null!==f&&e.appendChild(f);var v={name:o,href:s,className:d,init:u,element:g,data:h,caption:r,chEl:f,isAllwaisActive:m};if(t.buttons.push(v),null!==s&&g.setAttribute("href",s),g.setAttribute("title",p),$(g).data("info",h),""!==r&&(g.innerHTML=r,g.className=n.className&&"undefined"!=n.className?n.className:""),"function"==typeof n.release?(g.onclick=function(e){return!!l.isAvailable()&&(e.stopPropagation(),null!==i&&!$(this).hasClass("disabled")||m?n.release(v):void 0)},g.onmouseup=function(e){e.stopPropagation()}):(g.onclick=function(e){return e.stopPropagation(),!!l.isAvailable()&&((null!==i&&i.focus||m)&&i.focus(),!0)},g.onmouseup=function(e){e.stopPropagation()}),g.name=o,null!==f&&null!=n.submenu&&n.submenu.length>0)for(var b=0,y=n.submenu.length;b<y;b++)c(f,n.submenu[b])};this.show=function(e,n){if(n=n||!1,void 0===e||i===e&&!n)return!1;(i=e).isDefault&&(i.labelControl.className+=" main-page"),function(){h();for(var e=0;e<t.buttons.length;e++)t.buttons[e].init(t.buttons[e])}(),this.element.style.display=""},this.hide=function(){i&&(i.getSelected()?i.labelControl.classList.add("selected"):i.isVirtualCopy?i.labelControl.classList.add("virtual"):(i.labelControl.classList.remove("virtual"),i.labelControl.classList.remove("selected")),i.isDefault&&(i.labelControl.className+=" main-page"),i=null),r()},"object"==typeof n?((o=document.createElement("div")).className="tree-highlight",o.style.display="none",o.style.position="absolute",o.style.zIndex=a-1,t.highlight=n.container.appendChild(o),function(){var a=document.getElementById("tree_toolbar_"+n.uid);g(a,{name:"ico_add",className:"i-add",hint:getLabel("js-add-subpage"),init:function(e){var t=null!==i&&"string"==typeof i.createLink,n=!1;t&&(n=i.permissions&&4&i.permissions||!i.permissions),t&&n&&d?(e.element.setAttribute("href",i.createLink),e.element.classList.remove("disabled")):e.element.classList.add("disabled")}}),g(a,{name:"ico_edit",className:"i-edit",hint:getLabel("js-edit-page"),init:function(e){var t=null!==i&&!1!==i.editLink,n=!1;if(t&&(n=2&i.permissions),t&&n&&d){var a=getLabel("js-edit-page"),l=i.editLink;e.element.classList.remove("disabled"),i.lockedBy&&(a=getLabel("js-page-is-locked"),l="#",e.element.classList.add("disabled")),e.element.setAttribute("title",a),e.element.setAttribute("href",l)}else e.element.classList.add("disabled")},release:function(){return null===i||!i.lockedBy||(alert(getLabel("js-page-is-locked")),!1)}}),g(a,{name:"blocking",className:"i-hidden",hint:getLabel("js-disable-page"),init:function(e){if(null!==i&&i.allowActivity){var t=f(i.isActive),n=m(i.isActive);e.element.firstChild.className=t,e.element.setAttribute("href","#"),e.element.setAttribute("title",n),e.element.classList.remove("disabled")}else e.element.classList.add("disabled")},release:function(t){if(null!==i){var n="",a="",l=new PageTreeRecursiveOperator(e);if(d())n=f(!i.isActive),a=m(!i.isActive),t.element.setAttribute("title",a),t.element.firstChild.className=n,l.switchActivity(i.id,!i.isActive);else{var o=u(),r=!1,s=!1;for(var c in o)o.hasOwnProperty(c)&&(o[c].isActive?r=!0:s=!0);var h=!r&&s;n=f(h),a=m(h),t.element.setAttribute("title",a),t.element.firstChild.className=n;var g=p();l.switchActivity(g,h)}}return!1}}),g(a,{name:"copy",className:"i-copy-virtual",hint:getLabel("js-vcopy-str"),init:function(e){null!==i&&i.allowCopy&&d()?e.element.classList.remove("disabled"):e.element.classList.add("disabled")},release:function(){return null!==i&&(i.className="ti virtual",i.isDefault&&(i.labelControl.className+=" main-page"),i.isVirtualCopy=!0,l.execute("tree_copy_element",{element:i.id,childs:1,links:1,virtuals:1,permissions:1,handle_item:i,copy_all:0})),!1}}),g(a,{name:"clone",className:"i-copy",hint:getLabel("js-copy-str"),init:function(e){null!==i&&i.allowCopy&&d()?e.element.classList.remove("disabled"):e.element.classList.add("disabled")},release:function(){return null!==i&&l.execute("tree_copy_element",{element:i.id,childs:1,links:1,permissions:1,handle_item:i,copy_all:0,clone_mode:1}),!1}}),g(a,{name:"view",className:"i-see",hint:getLabel("js-view-page"),init:function(e){null!==i&&!1!==i.viewLink&&d()?(e.element.setAttribute("href",i.getUrl()),e.element.setAttribute("target","_blank"),e.element.classList.remove("disabled")):e.element.classList.add("disabled")}}),g(a,{name:"ico_del",className:"i-remove",hint:getLabel("js-del-str"),init:function(e){var t=getLabel("js-delete"),n=null!==i&&i.id>0,a=!1;n&&(a=i.permissions&&8&i.permissions||!i.permissions),n&&a?(e.element.setAttribute("title",t),e.element.setAttribute("href","#"),e.element.classList.remove("disabled")):e.element.classList.add("disabled")},release:function(){if(null!==i)if(i.lockedBy)alert(getLabel("js-page-is-locked"));else{var t=new PageTreeRecursiveOperator(e);if(d())t.putToTrash(i.id,!0);else{for(var n=u(),a=0,l=n.length;a<l;a++)if(n[a].lockedBy)return alert(getLabel("js-page-is-locked")+"\n"+getLabel("js-steal-lock-question")),ContextMenu.getInstance().terminate(),!1;var o=p();t.putToTrash(o,!0)}}return!1}});var o=document.createElement("ul");c(o,{name:"copy-other",className:"i-copy-other",hint:getLabel("js-crossdomain-copy"),chEl:!0,init:function(e){var t=s();e.chEl.innerHTML="";for(var n=0,a=t.length;n<a;n++)c(e.chEl,t[n]);null!==i?e.element.classList.remove("disabled"):e.element.classList.add("disabled")}}),a.appendChild(o),a.onclick=function(e){e.stopPropagation()},g(a,{name:"selectAll",className:"i-select",hint:getLabel("js-select-all"),alwaysActive:!0,init:function(e){e.element.classList.remove("disabled")},release:function(){n.select(n.items)}}),g(a,{name:"unSelectAll",className:"i-unselect",hint:getLabel("js-un-select-all"),alwaysActive:!0,init:function(e){e.element.classList.remove("disabled")},release:function(){n.unSelect(n.items),t.hide()}}),g(a,{name:"invertAll",className:"i-invertselect",hint:getLabel("js-invert-all"),init:function(e){null!==i?e.element.classList.remove("disabled"):e.element.classList.add("disabled")},release:function(){n.forEachItem(n.items,function(e){n.toggleItemSelection(e)})}}),t.element=a,r()}()):alert("Can't create toolbar without control object"),this.getButton=function(e){return _.findWhere(this.buttons,{name:e})}},TableToolbar=function(e){var t=this,n=e,i=null,a=parseInt(n.container.style.zIndex)||0,l=n.dataSet;this.TableTollbarFunctions={delButton:{name:"ico_del",className:"i-remove",hint:getLabel("js-delete"),init:function(e){var t=$(e.element);void 0!==i&&o(i)?t.removeClass("disabled"):t.addClass("disabled")},release:function(){if(void 0===i)return!1;var t=s();if("pages"===e.contentType){return new PageTreeRecursiveOperator(e).putToTrash(t,!0),!1}return l.execute("tree_delete_element",{element:t,selected_items:n.selectedList}),!1}},killPageButton:{name:"ico_kill_page",className:"i-remove",hint:getLabel("js-delete"),init:function(e){var t=$(e.element);void 0!==i&&o(i)?t.removeClass("disabled"):t.addClass("disabled")},release:function(){if(void 0===i)return!1;var t=s();return new PageTreeRecursiveOperator(e).remove(t,!0),!1}},editButton:{name:"ico_edit",className:"i-edit",hint:getLabel("js-edit-item"),init:function(e){var t=$(e.element);void 0!==i&&!1!==i.editLink&&r(i)?(t.attr("href",i.editLink),t.removeClass("disabled")):t.addClass("disabled")},release:function(e){return!1===$(e.element).hasClass("disabled")}},addButton:{name:"ico_add",className:"i-add",hint:getLabel("js-add-page"),init:function(e){var t=$(e.element);void 0!==i&&"string"==typeof i.createLink?(t.attr("href",i.createLink),t.removeClass("disabled")):(t.removeAttr("href"),t.addClass("disabled"))},release:function(e){return!1===$(e.element).hasClass("disabled")}},blockingButton:{name:"blocking",hint:getLabel("js-disable-page"),className:"",init:function(t){if(void 0===i)return t.element.style.display="none",!1;var n=i.allowActivity&&("pages"==e.contentType||"objects"==e.contentType&&e.enableObjectsActivity);if(void 0!==i&&n){var a=i.isActive?"small-ico i-hidden":"small-ico i-vision",l=i.isActive?getLabel("js-disable-page"):getLabel("js-enable-page");"objects"==e.contentType&&(l=i.isActive?getLabel("js-disable"):getLabel("js-enable")),$("i",$(t.element)).attr("class",a),t.element.setAttribute("href","#"),t.element.setAttribute("title",l),t.element.style.display="inline-block"}else t.element.style.display="none"},release:function(t){if(void 0!==i){var n=i.isActive?"small-ico i-vision":"small-ico i-hidden",a=i.isActive?getLabel("js-enable"):getLabel("js-disable");t.element.setAttribute("title",a),$("i",$(t.element)).attr("class",n);var o=s();if("pages"===e.contentType)return new PageTreeRecursiveOperator(e).switchActivity(o,!i.isActive),!1;l.execute("tree_set_activity",{element:o,object:o,active:i.isActive?0:1,selected_items:i.control.selectedList,viewMode:"full"})}return!1}},viewButton:{name:"view",hint:getLabel("js-view-page"),className:"i-see",init:function(e){"object"==typeof i&&i.getData&&"guide"==i.getData().guide?(e.element.setAttribute("href",window.pre_lang+"/admin/data/guide_items/"+i.id+"/"),e.element.style.display="inline-block"):"object"==typeof i&&!1!==i.viewLink?(e.element.setAttribute("href",i.getUrl()),e.element.style.display="inline-block"):e.element.style.display="none"}},csvExportButton:{name:"csvExport",hint:getLabel("js-csv-export"),className:"i-csv-export",alwaysActive:!0,needHide:n.hideQuickCsvExportButton,init:function(e){d()&&"object"==typeof n.selectedList&&0!==Object.keys(n.selectedList).length?v(e):y(e)},release:function(){return p("exportCallback"),!1}},csvImportButton:{name:"csvImport",hint:getLabel("js-csv-import"),className:"i-csv-import",alwaysActive:!0,needHide:n.hideQuickCsvImportButton,init:function(e){d()||y(e)},release:function(){return p("importCallback"),!1}},restoreButton:{name:"i-restore",hint:getLabel("js-trash-restore"),className:"i-restore",init:function(e){var t=$(e.element);void 0!==i&&o(i)?t.removeClass("disabled"):t.addClass("disabled")},release:function(){if(void 0!==i){var e=s();return new PageTreeRecursiveOperator(n).restoreFromTrash(e),!1}return!1}},moveButton:{name:"moveElement",hint:getLabel("js-change-parent"),className:"i-move-other",init:function(e){(n.flatMode||"pages"!==n.contentType||uAdmin.data&&"catalog"!=uAdmin.data.module)&&$(e.element).hide()},release:function(){CatalogModule.openCategoriesWindow(i)}},delIndex:{name:"deleteIndex",hint:getLabel("js-indexing-deleting-confirmation"),className:"i-remove",init:function(e){0===_.keys(n.selectedList).length?g(e):v(e)},release:function(){var e=_.keys(n.selectedList);e.length>0&&AdminIndexing.Controller._deleteIndexes(e)}},selectAllButton:{name:"selectAll",hint:getLabel("js-select-all"),className:"i-select",alwaysActive:!0,init:function(e){},release:function(){return n.select(n.items),!1}},unSelectAllButton:{name:"unSelectAll",hint:getLabel("js-un-select-all"),className:"i-unselect",alwaysActive:!0,init:function(e){},release:function(){return n.unSelect(n.items),t.hide(),!1}},invertAllButton:{name:"invertAll",hint:getLabel("js-invert-all"),className:"i-invertselect",init:function(e){void 0!==i?v(e):g(e)},release:function(){return n.forEachItem(n.items,function(e){n.toggleItemSelection(e)}),0===_.size(n.selectedList)&&t.hide(),!1}},copyButton:{name:"copy",className:"i-copy-virtual",hint:getLabel("js-vcopy-str"),init:function(e){"pages"!==n.contentType&&$(e.element).hide()},release:function(){return void 0!==i&&(i.className="ti virtual",i.isDefault&&(i.labelControl.className+=" main-page"),i.isVirtualCopy=!0,l.execute("tree_copy_element",{element:i.id,childs:1,links:1,virtuals:1,permissions:1,handle_item:i,copy_all:0})),!1}},cloneButton:{name:"clone",className:"i-copy",hint:getLabel("js-copy-str"),init:function(e){"pages"!==n.contentType&&$(e.element).hide()},release:function(){return void 0!==i&&l.execute("tree_copy_element",{element:i.id,childs:1,links:1,permissions:1,handle_item:i,copy_all:0,clone_mode:1}),!1}}},this.highlight=null,this.element=null,this.buttons=[],this.menu=[this.TableTollbarFunctions.viewButton,this.TableTollbarFunctions.blockingButton,this.TableTollbarFunctions.addButton,this.TableTollbarFunctions.editButton,this.TableTollbarFunctions.delButton,this.TableTollbarFunctions.csvExportButton,this.TableTollbarFunctions.csvImportButton,this.TableTollbarFunctions.moveButton,this.TableTollbarFunctions.copyButton,this.TableTollbarFunctions.cloneButton],this.__selectButtons=[this.TableTollbarFunctions.selectAllButton,this.TableTollbarFunctions.unSelectAllButton,this.TableTollbarFunctions.invertAllButton],this.__singleActionButtons=[this.TableTollbarFunctions.editButton,this.TableTollbarFunctions.addButton,this.TableTollbarFunctions.viewButton,this.TableTollbarFunctions.copyButton,this.TableTollbarFunctions.cloneButton],this.__exchangeButtons=[this.TableTollbarFunctions.csvExportButton,this.TableTollbarFunctions.csvImportButton];var o=function(e){return e.permissions&&8&e.permissions||!e.permissions},r=function(e){return!1!==e.editLink&&(e.permissions&&2&e.permissions||!e.permissions)},s=function(){var e=[],t=n.selectedList;if(Object.keys(t).length>0)for(var i in t)t.hasOwnProperty(i)&&e.push(i);return e};let c=function(){var e=Object.keys(n.items),a=e.length>1?2:1;i=n.items[e[a]],h(),y(t.menu),g(t.__selectButtons[2])};let d=function(){return!(!n||n.objectTypesMode||n.disableCSVButtons)};var u,p=function(e){if(function(){var e=n;if(!d())return!1;var t=e.selectedList,i=t&&t.length>0?t:e.items;return Object.keys(i).length>0}()&&-1!==["importCallback","exportCallback"].indexOf(e)){var t=n,i=t.selectedList?t.selectedList:{},a=i&&Object.keys(i).length>0?i:t.items,l=a[Object.keys(a)[0]],o=[],r=Object.keys(t.getCurrentFilter().Props).length>0;for(var s in a)if(a.hasOwnProperty(s)){a[s];r||o.push(parseInt(s))}var c="importCallback"===e?l.id:o;l[e](c)}},h=function(){for(var e=0;e<t.buttons.length;e++)t.buttons[e].init(t.buttons[e])},f=function(e,n){var a=document.createElement("a");a.className="icon-action";var o=n.name||"toolbtn",r=n.href||"#",s="small-ico "+(n.className||""),c=n.init||function(){},d=n.hint||"",u=n.alwaysActive||!1,p=document.createElement("i");p.className=s,a.appendChild(p);var h=e.appendChild(a),f={name:o,href:r,className:s,init:c,element:h};n.element=h,t.buttons.push(f),h.setAttribute("href",r),h.setAttribute("title",d),"function"==typeof n.release?h.onclick=function(){return!!l.isAvailable()&&(!(!i&&!u||$(this).hasClass("disabled"))&&n.release(f))}:h.onclick=function(){return!!l.isAvailable()&&(!(!u&&$(this).hasClass("disabled"))&&(i&&i.focus&&i.focus(),!0))},h.name=o},m=function(e){var n=t.element,i=jQuery(e.element,n);return i.length>0?i.eq(0):null},g=function(e){var t=m(e);t&&t.addClass("disabled")},v=function(e){var t=m(e);t&&t.removeClass("disabled")},b=function(e,t){t="function"==typeof t?t:function(){};!function(){for(var n=0;n<e.length;n++){var i=e[n];t(i)}}()},y=function(e){b(e,g)},C=function(e){b(e,v)};this.show=function(e,n){if(n=n||!1,void 0===e||i===e&&!n)return!1;i=e;var a=Object.keys(i.control.selectedList).length;C(this.menu),v(this.__selectButtons[2]),a>1&&y(this.__singleActionButtons),h(),d()||y(t.__exchangeButtons),this.element.style.display=""},this.hide=function(){i&&(i.getSelected()?i.labelControl.classList.add("selected"):i.isVirtualCopy?i.labelControl.classList.add("virtual"):(i.labelControl.classList.remove("virtual"),i.labelControl.classList.remove("selected")),y(this.menu),g(this.__selectButtons[2]),i=null)},"object"==typeof n?((u=document.createElement("div")).className="tree-highlight",u.style.display="none",u.style.position="absolute",u.style.zIndex=a-1,t.highlight=n.container.appendChild(u),function(){if(null!==n.toolbarFunctions){let e=Object.keys(n.toolbarFunctions);for(let i=0,a=e.length;i<a;i++)t.TableTollbarFunctions[e[i]]=n.toolbarFunctions[e[i]]}if(null!==n.toolbarMenu){t.menu=[];for(let e=0,i=n.toolbarMenu.length;e<i;e++)t.menu.push(t.TableTollbarFunctions[n.toolbarMenu[e]])}if(TTCustomizer.menu.length>0&&_.keys(TTCustomizer.buttons).length>0){_.extend(t.TableTollbarFunctions,TTCustomizer.buttons),TTCustomizer.extendDefault||(t.menu=[]);for(let e=0,n=TTCustomizer.menu.length;e<n;e++)t.menu.push(t.TableTollbarFunctions[TTCustomizer.menu[e]])}let e=document.getElementById("tollbar_wrapper");for(let n=0,i=t.menu.length;n<i;n++){let i=t.menu[n];i.needHide||"ico_add"===i.name&&TableToolbar.disableAddButton||f(e,i)}for(let n=0,i=t.__selectButtons.length;n<i;n++)f(e,t.__selectButtons[n]);t.element=e,n.dataSet.addEventHandler("onAfterLoad",c),y(t.menu),g(t.__selectButtons[2]),d()&&C(t.__exchangeButtons)}()):alert("Can't create toolbar without control object")};TableToolbar.disableAddButton=!1;var Control=function(e,t,n){var i=this,a=e,l=t,o="boolean"==typeof(n="object"==typeof n?n:{}).draw&&n.draw,r="boolean"==typeof n.expandAll&&n.expandAll,s="function"==typeof n.toolbar&&n.toolbar,c=null,d=null,u="boolean"==typeof n.ignoreHierarchy&&n.ignoreHierarchy,p="function"==typeof n.onRenderComplete?n.onRenderComplete:function(){},h=new filter,f=SettingsStore.getInstance(),m="function"==typeof n.onItemClick?n.onItemClick:function(){return!0},g="function"==typeof n.onItemSelect?n.onItemSelect:function(){return!0},v="function"==typeof n.onTargetSelect?n.onTargetSelect:function(){return!0};Control.instances[Control.instances.length]=this,this.container="object"==typeof n.container?n.container:document.body,this.dataSet=a,this.toolbar=null,this.items={},this.id=n.id||Math.random(),this.uid=n.uid||Math.round(1e5*Math.random()),this.iconsPath=n.iconsPath||"/styles/skins/modern/design/img/tree/",this.flatMode=n.flatMode||!1,this.defaultRootMode=n.defaultRootMode||!1,this.objectTypesMode=n.objectTypesMode||!1,this.contentType=n.contentType||"pages",this.enableObjectsActivity=n.enableObjectsActivity||!1,this.lastClicked=null,this.selectedList={},this.targetsList={},this.dragAllowed="boolean"!=typeof n.allowDrag||n.allowDrag,this.onGetValueCallback="function"==typeof n.onGetValueCallback?n.onGetValueCallback:function(e,t,n){return e},this.onDrawFieldFilter="function"==typeof n.onDrawFieldFilter?n.onDrawFieldFilter:function(e,t){return!1},this.onRemoveColumn="function"==typeof n.onRemoveColumn?n.onRemoveColumn:function(e){return!1},this.initContainer=this.container,this.disableCSVButtons=n.disableCSVButtons||!1,this.hideCsvImportButton=n.hideCsvImportButton||!1,this.hideQuickCsvImportButton=n.hideQuickCsvImportButton||!1,this.hideQuickCsvExportButton=n.hideQuickCsvExportButton||!1,this.disableTooManyChildsNotification=n.disableTooManyChildsNotification||!1,this.labelFirstColumn="string"==typeof n.label_first_column?n.label_first_column:"",this.PerPageLimits="array"==typeof n.perPageLimits?n.perPageLimits:[10,20,50,100],this.enableEdit=n.enableEdit,this.visiblePropsMenu=n.visiblePropsMenu,this.requiredPropsMenu=n.requiredPropsMenu,this.sequencePropsMenu=n.sequencePropsMenu,this.toolbarFunctions=n.toolbarFunctions||null,this.toolbarMenu=n.toolbarMenu||null,this.disableNameFilter=n.disableNameFilter||!1,this.hasCheckboxes="boolean"!=typeof n.hasCheckboxes||n.hasCheckboxes,this.isCanSelect="boolean"!=typeof n.isCanSelect||n.isCanSelect,this.onElementMouseOver="function"==typeof n.onElementMouseOver?n.onElementMouseOver:function(){},this.onElementMouseOut="function"==typeof n.onElementMouseOut?n.onElementMouseOut:function(){},this.onElementClick="function"==typeof n.onElementClick?n.onElementClick:function(){},this.noCheckboxes=!!parseInt(n.noCheckboxes);var b=function(e,t,n){if("object"!=typeof t||void 0===e)return!1;n||(n=!1);for(var a=t.id,l=0;l<e.length;l++){var o=void 0!==e[l].parentId?parseInt(e[l].parentId):0;if(u&&(o=0),o==a||n){var s=parseInt(e[l].id);i.items[s]?i.items[s].update(e[l]):(i.items[s]=t.appendChild(e[l]),(r||i.getItemState(s))&&i.items[s].expand()),b(e,i.items[s])}}!function(){for(var t=null,n=null,a=0;a<e.length;a++)t="object"==typeof e[a]?e[a]:{},n="object"==typeof e[a+1]?e[a+1]:{},i.getItem(t.id).nextSibling=i.getItem(n.id)}()},y=function(e){var t=e.objects,n=e.filter,a=e.paging,l=n.getParents();null!=n.Parents&&(a.parent=n.Parents[0]),n.AllText.length>0&&0==a.total&&0==l.length&&openDialog(getLabel("js-smc-empty-result"),getLabel("js-smc-empty-title"));var o=!1;l.length||(l=[c||0],o=!0);for(var r=0;r<l.length;r++){var s=parseInt(l[r]),d=void 0!==i.items[s]?i.items[s]:i.items[c];b(t,d,o),d&&(d.setLoaded(!0),d.setPageing(a))}p(),Control.recalcItemsPosition(),Control.HandleItem&&i.toolbar&&i.toolbar.show(Control.HandleItem,!0)};a.addEventHandler("onAfterLoad",y),a.addEventHandler("onAfterPieceLoad",y),a.addEventHandler("onInitComplete",function(){void 0===i.items[c]&&(i.items[c]=new l(i,null,{id:c||0,iconbase:"/styles/skins/modern/design/img/tree/ico_domain.png"})),i.items[c].draw(),s&&(i.toolbar=new s(i)),(i.getItemState(c)||0!==c)&&i.items[c].expand()}),a.addEventHandler("onBeforeRefresh",function(){i.removeItem(c),d&&(i.initContainer&&(i.container=i.initContainer),i.setRootNode(d,!0).draw());Control.recalcItemsPosition()}),a.addEventHandler("onAfterExecute",function(e){var t=e.objects,n=e.error,a=e.params,l=(a.paging,a.handle_item),o=a.selected_items;let r=!1;var s={};o?s=o:l&&(s[l.id]=l);var c=e.method;if(n){var d=jQuery(n).find("type").text();if("__alias__"==d){var u=a;jQuery(n).find("item").each(function(){var e=jQuery(this).attr("path")+""+jQuery(this).attr("alias"),t="<form method='post' id='' enctype='multipart/form-data' ";t+=" action=''>"+getLabel("js-smc-control-page-already-exist",e),t+="<br/><label for='new_alias'>"+getLabel("js-content-alias-copy")+"</label> <br/> ",t+=jQuery(this).attr("path")+"<input type='text' class='default alt-name' name='new_alias"+jQuery(this).attr("id")+"'  value='"+jQuery(this).attr("alt_name_normal")+"'  id='new_alias"+jQuery(this).attr("id")+"' size='15' />",t+="</form>";var n=this;openDialog("",getLabel("js-move-title"),{html:t,width:400,confirmText:getLabel("js-content-alias-new"),cancelButton:!0,cancelText:getLabel("js-content-alias-change"),cancelCallback:function(e){u["move["+jQuery(n).attr("id")+"]"]=1,p(function(){closeDialog(e)},jQuery(n).attr("id"))},confirmCallback:function(e,t){u["alias["+jQuery(n).attr("id")+"]"]=jQuery("#new_alias"+jQuery(n).attr("id"),t).val(),p(function(){closeDialog(e)},jQuery(n).attr("id"))}})});var p=function(t,n){var i="function"==typeof t?t:function(){},a=e.HandleItem;a?(n&&(u.element=[],u.element.push(n)),a.control.dataSet.execute(""+c.toLowerCase(),u),i()):i()}}else if("__template_not_exists__"==d){var h=jQuery(n).find("text").text();openDialog("","ÐžÑˆÐ¸Ð±ÐºÐ°",{html:h})}else alert(n.firstChild.nodeValue)}else{switch(c.toLowerCase()){case"tree_kill_element":case"restore_element":case"del":case"tree_delete_element":for(var f in s){var m=s[f];i.removeItem(f),delete i.selectedList[f],m.parent&&m.parent.parent&&b(t,m.parent.parent)}Control.HandleItem=null,i.toolbar&&i.toolbar.hide();break;case"export":e.objects[0].file&&(window.location=e.objects[0].file);break;case"move":case"tree_move_element":var g=a.receiver_item,v=a.before?g.control.getItem(a.before):null,y=a.after?g.control.getItem(a.after):null;if(!g)break;if("objects"===g.control.contentType){if(g=g.control.getRoot(),t.length&&l){var C=t[0]||[],w=t[1]||[],L=t[2]||[];l.parent&&l.parent.update(L),g.update(w),l.control.removeItem(l.id),m=null,a["as-sibling"]?m=v?g.appendBefore(C,v):y?g.appendAfter(C,y):g.appendChild(C):g.loaded&&(m=g.appendFirst(C)),m&&(g.control.items[m.id]=m)}break}if(0===t.length)break;var x=[];x.id=g.id,x["is-active"]=g.isActive,x.childs=0;var k=[];for(var I in t){var _=t[I],T=_.id,j=i.selectedList[T];j&&(k[j.parent.id]?k[j.parent.id]++:k[j.parent.id]=1),i.removeItem(T),delete i.selectedList[T],(m=a["as-sibling"]?v?g.appendBefore(_,v):y?g.appendAfter(_,y):g.appendChild(_):g.appendFirst(_))&&(g.control.items[m.id]=m,x.childs++,m.control.getSelectionCallback()(m))}for(f in k){var E=i.getItem(f);if(E){var A=[],N=$("tr[rel="+E.id+"] + tr > td > table.table > tr[rel]").length;A.id=E.id,A["is-active"]=E.isActive,A.childs=N-k[f],E.update(A)}}g.update(x);break;case"change_template":!function(){if(e.HandleItem&&e.HandleItem.control&&e.HandleItem.control.toolbar){var t=e.HandleItem.control.toolbar;if("function"==typeof t.getButton){var n=t.getButton("amend").element,i=$(n).next("ul").find("li a"),a=parseInt(e.params["template-id"]);i.removeClass("checked"),i.each(function(){$(this).data("info")==a&&$(this).addClass("checked")})}}}();break;case"copyelementtosite":!function(){for(var e in t){var n=t[e],i="tree-content-sitetree-"+n["domain-id"],a=!1;for(var l in Control.instances){var o=Control.instances[l];o.id==i&&(a=o)}if("object"==typeof a){var r=a.getRoot(),s=n.id;a.items[s]?a.items[s].update(n):a.items[s]=r.appendChild(n)}}}();break;case"copy":case"tree_copy_element":r=!0;default:for(var f in s){var S=i.items[f].parent,P=S?S.id:0;r=!i.items[P]||r,b(t,S,r)}}i.toolbar&&l===Control.HandleItem&&i.toolbar.show(Control.HandleItem,!0),Control.recalcItemsPosition(),Control.PrepareDrag=!1,Control.startDragItem=null,Control.PrepareDrag=!1,Control.DragMode=!1}}),this.initContainer.style.position="relative",this.init=function(){a.init()},this.load=function(e,t){a.load(e)},this.getItemByPosition=function(e,t){var n=null;for(var i in this.items)if(this.items[i]){var a=this.items[i].position;if(t>a.top&&t<=a.bottom&&e>a.left&&e<=a.right){n=this.items[i];break}}return n},this.getItem=function(e){return"object"==typeof this.items[parseInt(e)]&&this.items[parseInt(e)]},this.setRootNode=function(e,t){return d=e,c=e.id,this.items[c]=new l(i,null,e),t&&(this.items[c].loaded=!0),this.items[c]},this.getRootNodeId=function(){return c},this.getRoot=function(){return this.items[c]},this.applyBehaviour=function(e){return!m||m(e)},this.saveItemState=function(e){var t=parseInt(e);if(this.items[t]){var n=this.items[t],a=f.get(i.id,"expanded"),l="{"+n.id+"}";return"string"!=typeof a&&(a=""),-1===a.indexOf(l)||n.isExpanded?!(-1!==a.indexOf(l)||!n.isExpanded)&&(a+=l,f.set(i.id,a,"expanded"),!0):(a=a.replace(l,""),f.set(i.id,a,"expanded"),!0)}},this.applyFilter=function(e){if(this.selectItems([]),null!=e&&e instanceof Object&&(h=e),h){var t=!1;for(var n in this.targetsList)this.targetsList[n].applyFilter(h.clone()),t=!0;t||i.items[c].applyFilter(h.clone(),!0)}},this.getCurrentFilter=function(){return h},this.toggleItemSelection=function(e){e&&(e.getSelected()?(e.setSelected(!1),delete this.selectedList[e.id],g(e,!1)):(e.setSelected(!0),this.selectedList[e.id]=e,g(e,!0)))},this.toggleRangeSelection=function(e){if(this.lastClicked){for(var t=e.parent.childs,n=t.indexOf(e.id),i=t.indexOf(this.lastClicked.id),a=Math.min(n,i),l=Math.max(n,i),o=t.slice(a,l+1),r=[],s=0;s<t.length;s++)r.push(this.getItem(t[s]));this.unSelect(r);var c=null,d=[];for(s=0;s<o.length;s++)c=this.getItem(o[s]),d.push(c);this.select(d)}},this.forEachItem=function(e,t){var n="function"==typeof t?t:function(){},i=!Array.isArray(e);$.each(e,function(e,t){i&&0==e||t&&n(t,e)})},this.unSelect=function(e){var t=this;this.forEachItem(e,function(e){e.setSelected(!1),delete t.selectedList[e.id]}),this.HandleItem=null,this.toolbar.hide()},this.select=function(e){var t=this;this.forEachItem(e,function(e){e.setSelected(!0),t.selectedList[e.id]=e,i.HandleItem=e}),this.toolbar.show(this.HandleItem)},this.setSelectionCallback=function(e,t){if("function"==typeof e)if(t)g=e;else{var n=g;g=function(t,i){n(t,i),e(t,i)}}},this.getSelectionCallback=function(){return g},this.selectItems=function(e){for(var t in e instanceof Array||(e=[e]),this.selectedList)this.toggleItemSelection(this.selectedList[t]);this.selectedList={};for(t=0;t<e.length;t++)this.toggleItemSelection(e[t])},this.setTargetItems=function(e){for(var t in this.targetsList={},e)this.targetsList[t]=e[t];v(this.targetsList)},this.isTarget=function(e){for(var t in this.targetsList)if(this.targetsList[t]==e)return!0;return!1},this.setTargetSelectCallback=function(e){"function"==typeof e&&(v=e)},this.getItemState=function(e){var t=parseInt(e);if(this.items[t]){var n=this.items[t];if(!n.hasChilds)return!1;var a=f.get(i.id,"expanded"),l="{"+n.id+"}";return"string"!=typeof a&&(a=""),-1!==a.indexOf(l)}return!1},this.removeItem=function(e,t){var n=parseInt(e);if(this.items[n]){for(var i=this.items[n],a=(i.parent,0);a<i.childs.length;a++)this.removeItem(i.childs[a]);i.childs=[],t||(this.items[n]=!1,i.clear())}},this.expandAll=function(){for(id in r=!0,this.items)this.items[id].expand()},this.collapseAll=function(){for(id in r=!1,this.items)this.items[id].collapse()},this.recalcItemsPosition=function(){for(var e in this.items)this.items.hasOwnProperty(e)&&this.items[e]&&this.items[e].recalcPosition&&this.items[e].recalcPosition()},this.handleMouseDown=function(e,t){var n=e.target,a=i.getItem(t),l=a.checkBox,o=e.button,r=a.element,s=r==n||n.parentNode.parentNode==r,c=n==l||n.parentNode==l;if($(n).hasClass("name_col"))s=r==n||n.parentNode.parentNode.parentNode==r;if(2==o&&a.getSelected()&&1==Object.keys(a.control.selectedList).length)return!0;a instanceof TreeItem&&!$(n).hasClass("catalog-toggle")&&!$(n).hasClass("catalog-toggle-wrapper")&&i.toggleSelection(a,e),(s||c)&&a instanceof TableItem&&i.toggleSelection(a,e),e.shiftKey&&i.toggleRangeSelection(a),this.saveSelectedItem(t),"ti-toggle"!=e.target.className.toLowerCase()&&(Control.PrepareDrag=!0,Control.startDragItem=Control.HandleItem,Control.startDragX=e.pageX,Control.startDragY=e.pageY)},this.handleMouseUp=function(e,t){var n=0==e.button;if(Control.enabled&&n&&t){var i=Control.HandleItem,a=this.toolbar,l=Object.keys(this.selectedList).length;!Control.DragMode&&i&&((i.getSelected()||l>0)&&a&&a.show(i,!0),this.lastClicked=i),0===l&&a&&a.hide(),Control.PrepareDrag=!1,Control.startDragItem=null,Control.DragMode=!1}},this.saveSelectedItem=function(e){if(Control.instances.length&&!Control.DragMode&&Control.enabled){var t=this.getItem(e),n=this.selectedList,i=Object.keys(n),a=n[parseInt(i[i.length-1])];return Control.HandleItem=i.length>0?a:null,t.getSelected()&&(Control.HandleItem=t),t}},this.toggleSelection=function(e){i.toggleItemSelection(e)},o&&i.init()};function createAddButton(e,t,n,i,a){e.ControlInstance=t;var l=function(){var l=0,o=null,r=!1;for(p in t.selectedList)l++,o=p;var s=t.selectedList[o]?t.selectedList[o]:null;for(p=0;p<i.length;p++)if(null==o&&!0===i[p]||null!=o&&(i[p]===s.baseMethod||"*"===i[p])){r=!0;break}r&&"function"==typeof a&&(r=a(s));var c=n.replace(/\{id\}/,o||"0");c=(c=c.replace(/\{\$param0\}/,o||"0")).replace(/\{\$pre_lang\}/,window.pre_lang);var d=document.querySelector(".domains_selector > select");if(d){var u=d.options[d.selectedIndex].text;c=-1!=c.indexOf("?")?c+"&domain="+u:c+"?domain="+u}e.addLink=c;for(var p=0;p<e.linkCache.length;p++)e.linkCache[p].href=e.addLink,e.linkCache[p].param0=o||"0";"a"==e.tagName.toLowerCase()&&(e.href=e.addLink,e.param0=o||"0");var h=!1;l>1||!r?"none"!=e.style.display&&(e.style.display="none",h=!0):"none"==e.style.display&&(e.style.display="",h=!0),h&&Control.recalcItemsPosition()};t.setSelectionCallback(function(e,t){setTimeout(l,100)});var o=n.replace(/\{id\}/,"0");o=(o=o.replace(/\{\$param0\}/,"0")).replace(/\{\$pre_lang\}/,window.pre_lang),e.addLink=o,e.linkCache=e.getElementsByTagName("a"),l()}function filterController(e,t,n,i,a,l){var o=this,r=null,s=null,c=null,d=null,u=null,p=null,h=null,f=null,m=null,g=null,v=null,b=t,y=null,C=0,w={},L={},x=e.id+"_fc",k={},I=null,_=!0,T=i,j=a&&a.nativeAdvancedMode,E=a&&a.interfaceLang?a.interfaceLang:null;this.control=null,this.getId=function(){return x},this.changeMode=function(){_?(_=!1,c.style.display="block",s.style.display="none",g.childNodes[0].nodeValue=getLabel("js-filter-normal-mode")):(_=!0,c.style.display="none",s.style.display="",g.childNodes[0].nodeValue=getLabel("js-filter-extended-mode")),Control.recalcItemsPosition()};var A=function(e){13==(window.event?event.keyCode:e.keyCode)&&(j?_self.applyFilter():o.applyFilterAdvanced())},N=function(e){j||o.applyFilterAdvanced()};this.applyFilterAdvanced=function(){if(!(C>0)){var e=new filter;for(var t in L){if(L.hasOwnProperty(t))if("select"==L[t].tagName.toLowerCase())-2!=(l=L[t].options[L[t].selectedIndex].value)&&e.setPropertyEqual(t,l);else switch(L[t].type){case"button":break;case"checkbox":e.setPropertyEqual(t,L[t].checked?1:0);break;case"text":switch(w[t].dataType){case"tags":var n=L[t].value;if(""==n)break;n=n.split(",");for(var i=0;i<n.length;i++)n[i]=n[i].replace(/^\s+|\s+$/,"");n.length&&e.setPropertyLike(t,n);break;case"float":case"price":case"counter":case"int":if(!(l=L[t].value.replace(/^\s+|\s+$/,"")).length)break;"<"==l[0]?e.setPropertyLess(t,l.replace(/[^\d.]*/,"")):">"==l[0]?e.setPropertyGreater(t,l.replace(/[^\d.]*/,"")):(l=l.split("-")).length>1?e.setPropertyBetween(t,l[0].replace(/[^\d.]*/,""),l[1].replace(/[^\d.]*/,"")):e.setPropertyEqual(t,l[0].replace(/[^\d.]*/,""));break;case"date":var a=[],l=L[t].value;if(null!=L[t].isEmpty&&1==L[t].isEmpty)break;if(l.length>0){var o=-1,r=l.indexOf("-");-1!=(o=l.indexOf("<"))?e.setPropertyLess(t,-1!=r?l.substring(o+1,r-1):l.substring(o+1)):-1!=(o=l.indexOf(">"))?e.setPropertyGreater(t,-1!=r?l.substring(o+1,r-1):l.substring(o+1)):(-1!=r&&(a=l.split(/\s-\s/)),2==a.length?e.setPropertyBetween(t,a[0],a[1]):e.setPropertyEqual(t,l))}break;case"relation":null!=L[t].value&&L[t].value.length&&e.setPropertyEqual(t,L[t].value);break;default:null!=L[t].value&&L[t].value.length&&e.setPropertyLike(t,L[t].value)}break;default:null!=L[t].value&&L[t].value.length&&e.setPropertyEqual(t,L[t].value)}}e.setConditionModeOr(!1),y.applyFilter(e)}},this.applyFilter=function(){var e=new filter;if(_){var t=r.value.replace(/^\s*|\s*$/,"");l.save([]),0==t.length?y.flatMode||y.objectTypesMode||y.defaultRootMode||e.setParentElements(0):(t=/^".*"$|^'.*'$/.test(t)?t.substr(1,t.length-2):t.split(" "),l.save(t),e.setAllTextSearch(t)),e.setConditionModeOr(!0)}else{for(var n=c.getElementsByTagName("input"),i=0;i<n.length;i++)if(null==n[i].id||null!=w["row_"+n[i].id])switch(n[i].type){case"button":break;case"checkbox":e.setPropertyEqual(n[i].name,n[i].checked?1:0);break;case"text":switch(w["row_"+n[i].id].field.getElementsByTagName("type")[0].getAttribute("data-type")){case"tags":for(var a=n[i].value.split(","),o=0;o<a.length;o++)a[o]=a[o].replace(/^\s+|\s+$/,"");e.setPropertyEqual(n[i].name,a);break;case"float":case"price":case"int":"<"==(t=n[i].value.replace(/^\s+|\s+$/,""))[0]?e.setPropertyLess(n[i].name,t.replace(/[^\d.]*/,"")):">"==t[0]?e.setPropertyGreater(n[i].name,t.replace(/[^\d.]*/,"")):(t=t.split("-")).length>1?e.setPropertyBetween(n[i].name,t[0].replace(/[^\d.]*/,""),t[1].replace(/[^\d.]*/,"")):e.setPropertyEqual(n[i].name,t[0].replace(/[^\d.]*/,""));break;case"date":var s=[];t=n[i].value;if(null!=n[i].isEmpty&&1==n[i].isEmpty)break;if(t.length>0){var d=-1,p=t.indexOf("-");-1!=(d=t.indexOf("<"))?e.setPropertyLess(n[i].name,-1!=p?t.substring(d+1,p-1):t.substring(d+1)):-1!=(d=t.indexOf(">"))?e.setPropertyGreater(n[i].name,-1!=p?t.substring(d+1,p-1):t.substring(d+1)):(-1!=p&&(s=t.split(/\s-\s/)),2==s.length?e.setPropertyBetween(n[i].name,s[0],s[1]):e.setPropertyEqual(n[i].name,t))}break;case"relation":e.setPropertyLike(n[i].name,n[i].value);break;default:e.setPropertyLike(n[i].name,n[i].value)}break;default:e.setPropertyEqual(n[i].name,n[i].value)}n=c.getElementsByTagName("select");for(a=null,i=0;i<n.length;i++)if(n[i].id!="select_"+x){a=[];for(o=0;o<n[i].options.length;o++)n[i].options[o].selected&&a.push(n[i].options[o].value);e.setPropertyEqual(n[i].name,a)}j?e.setConditionModeOr(!u.checked):e.setConditionModeOr(!0)}y.applyFilter(e)};var S=function(){if(f.options.length){var e=m.getValue();if(""!==e){var t=Q(w[e].field);if(t){w[e].used=!0,c.getElementsByTagName("table")[0].tBodies[1].appendChild(t),m.clear(),m.removeOption(e);var n=[];for(var i in w)w[i].used&&n.push(w[i].field.getAttribute("id"));SettingsStore.getInstance().set(x,n.join(","),I?""+I:"default"),n.length>1?d.style.display="":d.style.display="none",Control.recalcItemsPosition()}}}},P=function(e,t){var n=null;switch(t){case"int":n=new RegExp("^[<>]?[ ]?\\d*( ?- ?\\d*)?$"),getLabel("js-filter-enter-natural-number");break;case"float":n=new RegExp("^[<>]?[ ]?\\d*[\\.]*\\d*( ?- ?\\d*[\\.]*\\d*)?$"),getLabel("js-filter-enter-float-number");break;case"date":n=/(^[<>]{1}.*)|(^(((\d\d?[.]\d\d?([.]\d\d(\d\d)?)?)?((\s+|^\s*)\d\d?:\d\d)?)|Ð¿Ð¾Ð·Ð°Ð²Ñ‡ÐµÑ€Ð°|Ð²Ñ‡ÐµÑ€Ð°|ÑÐµÐ³Ð¾Ð´Ð½Ñ|Ð·Ð°Ð²Ñ‚Ñ€Ð°|Ð¿Ð¾ÑÐ»ÐµÐ·Ð°Ð²Ñ‚Ñ€Ð°)?(\s*-\s*(((\d\d?[.]\d\d?([.]\d\d(\d\d)?)?)?(\s+\d\d?:\d\d)?)|Ð¿Ð¾Ð·Ð°Ð²Ñ‡ÐµÑ€Ð°|Ð²Ñ‡ÐµÑ€Ð°|ÑÐµÐ³Ð¾Ð´Ð½Ñ|Ð·Ð°Ð²Ñ‚Ñ€Ð°|Ð¿Ð¾ÑÐ»ÐµÐ·Ð°Ð²Ñ‚Ñ€Ð°))?)$/i}return function(){if(e){var t=e.classList.contains("_error");n.test(e.value)?t&&(e.classList.remove("_error"),C--):t||(e.classList.add("_error"),C++)}}},M=function(e){W("/udata://core/getDomainsList/",function(t){var n=t.responseXML.getElementsByTagName("domain");B(e,-2,getLabel("js-smc-no-filter"));for(var i=0;i<n.length;i++)B(e,n[i].getAttribute("id"),n[i].getAttribute("decoded-host"));new ControlComboBox({el:$(e)})})};let D=function(e){W("/udata://core/getLangsList/",function(t){let n=t.responseXML.getElementsByTagName("lang");B(e,-2,getLabel("js-smc-no-filter"));for(let t=0;t<n.length;t++)B(e,n[t].getAttribute("id"),n[t].getAttribute("decoded-host"));new ControlComboBox({el:$(e)})})};var B=function(e,t,n){var i=document.createElement("option");i.value=t,i.appendChild(document.createTextNode(n)),e.appendChild(i)},H=function(e,t){if(null!=k[t])if("empty"!==k[t]){for(var n in k[t])B(e,k[t][n].id,k[t][n].value);new ControlComboBox({el:$(e)})}else{var i=e.name,a=e.id,l=V("string",a,i,t,!1),o=e.parentNode;o.removeChild(e),o.appendChild(l),L[i]&&(L[i]=l)}else{W("/admin/data/guide_items_all/"+t+".xml?allow-empty",function(n){if(n.responseXML.getElementsByTagName("empty").length)k[t]="empty";else{var i=n.responseXML.getElementsByTagName("object"),a=[];j||a.push({id:-2,value:getLabel("js-smc-no-filter")});for(var l=0;l<i.length;l++)a.push({id:i[l].getAttribute("id"),value:i[l].getAttribute("name")});k[t]=a}H(e,t)})}},O=function(e,t,n){if("function"==typeof e[t]){var i=e[t];e[t]=function(e){i(e),n(e)}}else e[t]=n},F=function(e){var t=document.createElement("input");if(e instanceof Object)for(var n in e)e.hasOwnProperty(n)&&t.setAttribute(n,e[n]);return"fcLogicInput"!=e.class&&t.classList.add("default"),t},R=function(e,t){var n=document.createElement("div");n.className="filter sel";var i=document.createElement("select");if("object"==typeof t&&"[object Array]"===Object.prototype.toString.call(t))for(var a in t)B(i,t[a][1],t[a][0]);if("object"==typeof e)for(var l in e)e.hasOwnProperty(l)&&("multiple"!=l||(l=!e[l]))&&i.setAttribute(l,e[l]);return n.appendChild(i),n},V=function(e,t,n,i,a){var l=null;switch(e){case"string":case"wysiwyg":case"text":case"password":case"tags":case"color":case"link_to_object_type":l=F({type:"text",class:"fcStringInput",name:n,id:t});break;case"date":(l=F({type:"text",class:"fcStringInput",name:n,id:t})).setAttribute("placeholder",getLabel("js-filter-date-format")),l.onkeyup=P(l,"date");break;case"boolean":case"file":case"img_file":case"swf_file":if(j)(l=document.createElement("div")).className="checkbox",l.appendChild(F({type:"checkbox",class:"fcBooleanInput",name:n,id:t})),l.onclick=function(){$(this).toggleClass("checked")};else{var o="boolean"==e?getLabel("js-value-yes"):getLabel("js-value-file-yes"),r=getLabel("js-value-no");l=R({name:n,id:t,multiple:!1},[[getLabel("js-smc-no-filter"),-2],[o,"1"],[r,"0"]])}break;case"int":case"counter":(l=F({type:"text",class:"fcStringInput",name:n,id:t})).onkeyup=P(l,"int");break;case"float":case"price":(l=F({type:"text",class:"fcStringInput",name:n,id:t})).onkeyup=P(l,"float");break;case"relation":l=R({name:n,id:t,multiple:null!=a&&0==a}),H(l.lastChild,i);break;case"domain_id":l=R({name:n,id:t,multiple:!1}),M(l.lastChild);break;case"domain_id_list":l=R({name:n,id:t,multiple:!0}),M(l.lastChild);break;case"lang_id":l=R({name:n,id:t,multiple:!1}),D(l.lastChild);break;case"lang_id_list":l=R({name:n,id:t,multiple:!0}),D(l.lastChild)}if(l)if(l.classList.contains("checkbox"))O(l.firstChild,"onkeyup",A);else if(l.classList.contains("sel")){var s=l.lastChild;s&&(s.onchange=N)}else O(l,"onkeyup",A);return l},Q=function(e){var t,n=e.getElementsByTagName("type")[0],i=e.getAttribute("name"),a=x+"_id_"+i,l="row_"+a;if(null==(t=V(n.getAttribute("data-type"),a,i,e.getAttribute("guide-id"))))return null;var o=document.createElement("tr"),r=document.createElement("td"),s=document.createElement("td"),c=document.createElement("td"),u=document.createElement("label");u.setAttribute("for",a),u.appendChild(document.createTextNode(e.getAttribute("title"))),r.className="fcTitleCell",r.appendChild(u),s.className="fcValueCell",s.appendChild(t);var p,h=document.createElement("i");return h.className="small-ico i-remove",h.alt=getLabel("js-filter-remove-field"),h.title=getLabel("js-filter-remove-field"),h.onclick=(p=l,function(){var e=document.getElementById(p);if(e){e.parentNode.removeChild(e),w[p].used=!1,m.clearOptions();var t=[],n=0;for(var i in w)w[i].used?(t.push(w[i].field.getAttribute("id")),n++):m.addOption({text:w[i].field.getAttribute("title"),value:i});SettingsStore.getInstance().set(x,t.join(","),I?""+I:"default"),d.style.display=n>1?"":"none"}Control.recalcItemsPosition()}),c.className="fcDeleteCell",c.appendChild(h),o.id=l,o.appendChild(r),o.appendChild(s),o.appendChild(c),o},X=function(){if(j){for(;h.tBodies[1].childNodes.length;)h.tBodies[1].removeChild(h.tBodies[1].firstChild);m.clear(!0),m.clearOptions();var e=0;for(var t in m.lock(),w)if(w[t].used){var n=Q(w[t].field);n&&(h.tBodies[1].appendChild(n),e++)}else m.addOption({text:w[t].field.getAttribute("title"),value:t});f.disabled=!1,m.unlock(),d&&(d.style.display=e>1?"":"none"),Control.recalcItemsPosition()}},z=function(t){if(j){var n=document.createElement("div");(g=document.createElement("a")).href="javascript:filterController.getInstanceById('"+x+"').changeMode();",n.className="fcModeContainer",n.appendChild(g),g.appendChild(document.createTextNode(getLabel("js-filter-extended-mode")))}(s=document.createElement("div")).className="input-search",r=F({type:"text",class:"default",name:"quicksearch",id:x+"_id_quicksearch",value:l&&l.load().join(" ")||""});var i=F({type:"button"});if(r.className="default",i.className="fcApplyButton",i.onclick=o.applyFilter,$(window).on("keydown",function(e){13==e.keyCode&&$(r).is(":focus")&&(e.preventDefault(),o.applyFilter())}),s.appendChild(r),s.appendChild(i),j){c=document.createElement("div"),(h=document.createElement("table")).className="fcTable",h.appendChild(document.createElement("tbody")),h.appendChild(document.createElement("tbody")),h.appendChild(document.createElement("tbody"));var a=document.createElement("tr"),b=document.createElement("td"),C=document.createElement("td"),w=document.createElement("td"),L=document.createElement("i");(f=document.createElement("select")).className="fcAddSelect default newselect",f.id="select_"+x,f.style.width="100%",L.className="small-ico i-add",L.alt=getLabel("js-filter-add-field"),L.title=getLabel("js-filter-add-field"),L.onclick=S,C.className="fcFreeFieldsCell",w.className="fcAddCell",b.appendChild(document.createTextNode(getLabel("js-filter-fields-list"))),C.colSpan=1,C.width="250px",C.appendChild(f),w.appendChild(L),a.appendChild(b),a.appendChild(C),a.appendChild(w),h.tBodies[0].appendChild(a);var k=document.createElement("tr"),I=document.createElement("td");I.colSpan=3,I.innerHTML="&nbsp;",k.appendChild(I),h.tBodies[0].appendChild(k),a.className="fcAddRow";var _=document.createElement("tr"),E=document.createElement("td");E.colSpan=3,E.className="fcLogicCell",d=document.createElement("div"),u=F({type:"radio",class:"fcLogicInput",value:"and",name:x+"_logic",id:x+"_logic_and",checked:!0,selected:!0}),p=F({type:"radio",class:"fcLogicInput",value:"or",name:x+"_logic",id:x+"_logic_or"});var A=document.createElement("span"),N=document.createElement("label"),P=document.createElement("label"),M=document.createElement("span"),D=document.createElement("span");A.className="fcLogicTitle",A.appendChild(document.createTextNode(getLabel("js-filter-search-matches"))),d.appendChild(A),u.style.border="0",p.style.border="0",N.className="fcLogicLabel",N.htmlFor=x+"_logic_and",M.className="fcLogicLine",N.appendChild(document.createTextNode(getLabel("js-filter-with-all-fields"))),M.appendChild(N),M.appendChild(u),d.appendChild(M),D.className="fcLogicLine",P.className="fcLogicLabel",P.htmlFor=x+"_logic_or",P.appendChild(document.createTextNode(getLabel("js-filter-one-at-least"))),D.appendChild(P),D.appendChild(p),d.appendChild(D),E.appendChild(d),_.appendChild(E),h.tBodies[2].appendChild(_);var B=document.createElement("tr"),H=document.createElement("td");applyButton=F({type:"button",value:getLabel("js-filter-do")}),applyButton.onclick=o.applyFilter,applyButton.className="fcApplyButton btn color-blue pull-right",H.colSpan=3,H.className="fcApplyCell",H.appendChild(applyButton),B.appendChild(H),h.tBodies[2].appendChild(B),c.className="fcContainer",c.style.display="none",c.appendChild(h)}var O=document.createElement("div"),R=document.createElement("span");v=document.createElement("span"),R.appendChild(document.createTextNode(getLabel("js-filter-current-rubrics"))),O.appendChild(R),O.appendChild(v),O.className="fcTargetContainer",J();var V=document.createElement("div");if(V.style.clear="both",V.innerHTML="&nbsp;",T)T.appendChild(s),j&&(T.appendChild(n),T.appendChild(c)),T.appendChild(O);else{(T=document.createElement("div")).className="filter-container",T.appendChild(s),j&&(T.appendChild(n),T.appendChild(c)),T.appendChild(O);var Q=document.getElementById("filterWrapper_"+e.uid);null==Q?y.container.parentNode.insertBefore(T,y.container):Q.appendChild(T)}null!=(m=$(f).selectize({allowEmptyOption:!0,create:!1,hideSelected:!0,onDropdownOpen:function(e){U(e)},onDropdownClose:function(e){q(e)}}))[0]&&(m=m[0].selectize),j&&(u.checked=!0,X())},U=function(e){$(e).closest(".overflow-block").css("overflow","visible"),$(e).closest(".table-cell > div").css("overflow","visible")},q=function(e){$(e).closest(".overflow-block").css("overflow","auto"),$(e).closest(".table-cell > div").css("overflow","hidden")},W=function(e,t){var n=function(){if(window.XMLHttpRequest)try{return new XMLHttpRequest}catch(e){}else if(window.ActiveXObject){try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}return null}();n.onreadystatechange=function(){4==n.readyState&&(200==n.status?t(n):Y("Request failed"))},n.open("GET",e,!0),n.send(null)};this.init=function(){if(j){var e=y.dataSet.getCommonTypeId();e>0&&(b=e),b?(sUrl="/utype/"+b+"/",E&&(sUrl+="?lang="+E)):(sUrl="/utype/dominant/"+b+"/",E&&(sUrl+="?lang="+E)),W(sUrl,function(e){var t=e.responseXML.getElementsByTagName("field");G(t),z(e.responseXML)})}else z()};var G=function(e){for(var t=e,n=["symlink"],i=null,a=!1,l=SettingsStore.getInstance().get(x,I?""+I:"default"),o=!1===l?[]:l.split(","),r=!1,s=y.dataSet.getFieldsStoplist(),c=0;c<t.length;c++){var d=t[c].getAttribute("name");a=!1,i=t[c].getElementsByTagName("type")[0].getAttribute("data-type");for(var u=0;u<s.length;u++)if(d==s[u]){a=!0;break}for(u=0;u<n.length&&!a;u++)if(i==n[u]){a=!0;break}if(!a){var p="row_"+x+"_id_"+t[c].getAttribute("name"),h=t[c].getAttribute("id");r=!1;for(var f=0;f<o.length;f++)if(h==o[f]){r=!0;break}w[p]={used:r,field:t[c]}}}},Y=function(e){},Z=!1,K=function(){var e=this.id.substr((x+"_link_").length);return delete y.targetsList[e],ee({}),!1},J=function(){v.parentNode.style.display="none"},ee=function(e){for(var t,n,i,a=!1,l=null,o=0;v.firstChild;)v.removeChild(v.firstChild);for(var r in y.targetsList)o++,l=y.targetsList[r].id,t=y.targetsList[r].id,n=y.targetsList[r].name,i=void 0,(i=document.createElement("a")).className="fcTarget",i.id=x+"_link_"+t,i.href="#",i.title=getLabel("js-filter-delete-category"),i.onclick=K,i.appendChild(document.createTextNode(n)),v.childNodes.length&&v.appendChild(document.createTextNode(", ")),v.appendChild(i);o?v.parentNode.style.display="":J(),j&&(1==o?(sUrl="/utype/dominant/"+l+"/",a=!0,I=l):(sUrl="/utype/"+b+"/",a=!1,I=null),Z!=a&&(w={},f.disabled=!0,W(sUrl,function(e){if(e.responseXML){var t=e.responseXML.getElementsByTagName("field");t.length&&G(t),X()}}),Z=a))};null!=e&&null!=t&&(filterController.instances[filterController.instances.length]=this,y=e,this.control=y,b=t||0,y.iconsPath,j||(y.onDrawFieldFilter=function(t,n,i){if("name"==t&&e.disableNameFilter)return!1;if("name"!=t||e.disableNameFilter||(t={dataType:"string",fieldName:"name",guideId:1}),!i||"static"!==i[1]){var a=x+"_id_"+t.fieldName;t.dataType||(t.dataType="string");var l=V(t.dataType,a,t.fieldName,t.guideId,!1);l&&(w[t.fieldName]=t,l.classList.contains("sel")?L[t.fieldName]=$(l).find("select")[0]:L[t.fieldName]=l,i&&i[0]&&(l.style.width="100%"),n.appendChild(l),"boolean,file,img_file,swf_file".indexOf(t.dataType)>=0&&setTimeout(function(){new ControlComboBox({el:$(l.lastChild)})},50))}},y.onRemoveColumn=function(e){"name"!=e&&(delete w[e.fieldName],delete L[e.fieldName])}),y.setTargetSelectCallback(ee),null==n||0==n?this.init():y.dataSet.addEventHandler("onInitComplete",this.init))}function TemplatesDataSet(){var e,t=null,n=null,i=null,a=function(e){var a=e.responseXML;t=o(a.getElementsByTagName("template")),n=o(a.getElementsByTagName("domain")),i=o(a.getElementsByTagName("lang"))},l=function(e){var t=[];t.nodeValue=e.textContent||e.text;for(var n=0;n<e.attributes.length;n++){var i=e.attributes.item(n);t[i.nodeName]=i.nodeValue}return t},o=function(e){for(var t=[],n=0;n<e.length;n++){var i=e[n],a=l(i);t.push(a)}return t};this.getLangsList=function(){return i},this.getDomainsList=function(){return n},this.getTemplatesList=function(e,n){if(!e&&!n)return t;for(var i=[],a=0;a<t.length;a++){var l=t[a];l["domain-id"]==e&&l["lang-id"]==n&&i.push(l)}return i},(e=function(){if(window.XMLHttpRequest)try{return new XMLHttpRequest}catch(e){}else if(window.ActiveXObject){try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}return null}()).onreadystatechange=function(){if(4==e.readyState)return 200==e.status&&void a(e)},e.open("GET","/admin/umiTemplates/domainTemplates.xml",!0),e.send(null)}function dataSet(e,t,n,i){var a=e,l=null!=n?n:"",o="",r=null,s=[],c=!1,d=!1,u=[],p=[],h=0,f=[],m="",g=[],v=[],b=[],y=[],C=[],w=[],L=[],x=[],k=[],I=[],_=(i="object"==typeof i?i:{},Array.isArray(i.onInitEndRequests)?i.onInitEndRequests:[]);this.init=function(){if(d)return!0;d=!0;var e=function(e){if(e.responseXML&&(p=e.responseXML.getElementsByTagName("group")),c=!0,!j("onInitComplete"))return!1},t="/admin/"+a+"/dataset_config.xml"+(l.length?"?param="+l:"");return A(t,function(t){for(var n=t.responseXML.getElementsByTagName("method"),i=0;i<n.length;i++){var a=n[i];if("true"!=a.getAttribute("forload")){for(var l={},r=0;r<a.attributes.length;r++){var s=a.attributes[r];"aliases"!=s.nodeName&&(l[s.nodeName]=s.nodeValue)}l.name=a.childNodes[0].nodeValue;var d=a.getAttribute("aliases");if(d){l.aliases=d.split(",");for(var p=0;p<l.aliases.length;p++)l.aliases[p]=l.aliases[p].replace(/^\s+|\s+$/,"")}else l.aliases=[];u.push(l)}else o=a.childNodes[0].nodeValue}var g=t.responseXML.getElementsByTagName("exclude");if(g.length)for(i=0;i<g.length;i++)g[i].childNodes.length&&f.push(g[i].childNodes[0].nodeValue);var v=t.responseXML.getElementsByTagName("default");v.length&&v[0].childNodes.length&&(m=v[0].childNodes[0].nodeValue);var b=t.responseXML.getElementsByTagName("type");if(b.length){for(i=0;i<b.length;i++)if(b[i].getAttribute("common")){var y=b[i].getAttribute("common").toLowerCase();if("1"==y||"true"==y){var C="/utype/"+(h=b[i].getAttribute("id"))+"/";interfaceLang&&(C+="?lang="+interfaceLang),A(C,e);break}"custom"==y&&(h=b[i].getAttribute("id"),A(C=h,e))}}else if(c=!0,!j("onInitComplete"))return!1}),function(e){for(var t=null,n=0;n<e.length;n++)"string"==typeof(t=e[n]).url&&"function"==typeof t.callback&&A(t.url,t.callback)}(_),d},this.load=function(e){if(!c)return!1;if(!j("onBeforeLoad"))return!1;var t="/admin/"+a+"/"+o+".xml"+N(e,!0);A(t,function(t){var n={},i=S(t.responseXML,!1,n);0==i.length?$(".overflow #nodata").show():$(".overflow #nodata").hide();var a={objects:i,filter:e,paging:n};if("string"!=typeof i&&null!==i||(a.error=i),c=!0,!j("onAfterLoad",a))return!1})},this.getPathModuleMethod=function(){return"/admin/"+a+"/"+o},this.refresh=function(e){if(!c)return!1;if(!j("onBeforeRefresh"))return!1;if(s.length){var t=0,n=function(e,i){var a={},l=S(e.responseXML,!1,a),o={objects:l,filter:i,paging:a};if("string"!=typeof l&&null!==l||(o.error=l),j("onAfterPieceLoad",o),++t>=s.length){if(c=!0,!j("onAfterRefresh",{objects:g}))return!1}else A(d+N(s[t]),n,s[t])};c=!1,A((d="/admin/"+a+"/"+o+".xml")+N(s[t]),n,s[t])}else{var i=[],l="";l=null==e||0==e?"id":"rel";for(var r=0;r<g.length;r++)i.push(g[r][l]);c=!1;var d="/admin/"+a+"/"+o+".xml?"+l+"="+i.join(",");g=[],A(d,function(e,t){var n={},i=S(e.responseXML,!1,n),a={objects:i,filter:new filter,paging:n};"string"!=typeof i&&null!==i||(a.error=i),c=!0,j("onAfterPieceLoad",a),j("onAfterRefresh",{objects:g})})}},this.isMethodSupported=function(e,t){var n=e.toUpperCase(),i=null!=t&&1==t;for(var a in u)if("function"!=typeof u[a]){if(u[a].name.toUpperCase()==n)return!i||u[a].name;for(var l=0;l<u[a].aliases.length;l++)if(u[a].aliases[l].toUpperCase()==n)return!i||u[a].name}return!1},this.getMethodsList=function(){return u},this.getCommonFields=function(){return p},this.getDefaultFields=function(){return m},this.getFieldsStoplist=function(){return f},this.getCommonTypeId=function(){return h},this.getModule=function(){return a},this.execute=function(e,t){if(!c)return!1;var n=this.isMethodSupported(e,!0);if(!n)return!1;var i={method:e,params:t,objects:[]};if(!j("onBeforeExecute",i))return!1;var a=T(n),l=window.pre_lang+"/admin/"+a+"/"+n+".xml",o=new Array("csrf="+csrfProtection.getToken());for(var r in t)if(t[r]instanceof Array)for(var s=0;s<t[r].length;s++)o.push(r+"[]="+t[r][s]);else o.push(r+"="+t[r]);c=!1,l=l+"?"+o.join("&"),A(l,function(e){Control.enabled=!0;var t={},n=S(e.responseXML,!0,t);if(M(n),i.objects=n,i.paging=t,"string"!=typeof n&&null!==n||(i.error=n),n.error&&(i.error=n.error),i.HandleItem=jQuery.extend(!0,{},Control.HandleItem),c=!0,!j("onAfterExecute",i))return!1})},this.getLoadedTree=function(){return g},this.isAvailable=function(){return c},this.clearFiltersCache=function(){s=[]},this.setDefaultFilter=function(e){r=e},this.getDefaultFilter=function(){return r},this.addEventHandler=function(e,t){var n=E(e);return null!==n&&(n[n.length]={active:!0,handler:t},n.length-1)},this.removeEventHandler=function(e,t){var n=E(e);if(null===n)return!1;n[t].active=!1};var T=function(e){for(var t=e.toUpperCase(),n=0;n<u.length;n++)if(u[n].name.toUpperCase()==t&&u[n].module)return u[n].module;return a},j=function(e,t){if(!d)return!1;var n=!0,i=E(e);if(null===i)return!1;for(var a in i)i[a].active&&(n=n&&!1!==i[a].handler(t));return n},E=function(e){switch(e.toUpperCase()){case"ONINITCOMPLETE":return v;case"ONBEFORELOAD":return b;case"ONAFTERLOAD":return y;case"ONBEFOREEXECUTE":return C;case"ONAFTEREXECUTE":return w;case"ONBEFOREREFRESH":return L;case"ONAFTERREFRESH":return x;case"ONAFTERPIECELOAD":return k;case"ONREQUESTFAILED":return I;default:return null}},A=function(e,t,n){var i=function(){if(window.XMLHttpRequest)try{return new XMLHttpRequest}catch(e){}else if(window.ActiveXObject){try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}return null}();i.onreadystatechange=function(){4==i.readyState&&(0,200===i.status||403===i.status?t(i,n):j("onRequestFailed"))},i.open("GET",e,!0),i.send(null)},N=function(e,t){var n="";if(e instanceof Object)r.Full||e.setViewMode(!1),n=e.getQueryString(r),null!=t&&!0===t&&s.push(e);else if(e instanceof Object){var i,a=[];if(null!=e.id)e.id instanceof Array?i=e.id:(i=[]).push(e.id),a.push("id="+i.join(","));if(null!=e.rel)e.rel instanceof Array?i=e.rel:(i=[]).push(e.rel),a.push("rel="+i.join(","));a.length&&(n="?"+a.join("&"),null!=t&&!0===t&&s.push(e))}return n+"&r="+Math.random()},S=function(e,t,n){var i=[],a=e.getElementsByTagName("data");if(!a.length)return i;for(var l=(a=a[0]).childNodes,o=0;o<l.length;o++){var r=l[o];if("error"==r.nodeName)return{error:r};if("page"==r.nodeName||"object"==r.nodeName||"type"==r.nodeName||"response"==r.nodeName){for(var s={},c=0;c<r.attributes.length;c++){var d=r.attributes[c];s[d.nodeName]=d.nodeValue}P(s,r.childNodes),i.push(s),null!=t&&!1!==t||g.push(s)}}return null!=n&&n instanceof Object&&(n.total=parseInt(a.getAttribute("total"))||i.length,n.offset=parseInt(a.getAttribute("offset"))||0,n.limit=parseInt(a.getAttribute("limit"))||i.length),i},P=function(e,t){if(1!=t.length||3!=t[0].nodeType)for(var n=0;n<t.length;n++){var i=t[n],a={};if(1!=i.nodeType)a=i.nodeValue;else if(i.attributes.length||1!=i.childNodes.length||3!=i.childNodes[0].nodeType){for(var l=0;l<i.attributes.length;l++){var o=i.attributes[l];a[o.nodeName]=o.nodeValue}P(a,i.childNodes)}else a=i.childNodes[0].nodeValue;if(null==e[i.nodeName])e[i.nodeName]=a;else if(e[i.nodeName]instanceof Array)e[i.nodeName].push(a);else{var r=[];r.push(e[i.nodeName]),r.push(a),e[i.nodeName]=r}}else e._value=t[0].nodeValue},M=function(e){if(e instanceof Array)for(var t=0;t<e.length;t++)for(var n=0;n<g.length;n++)if(e[t].id==g[n].id){for(var i in e[t])g[n][i]=e[t][i];break}};void 0!==t&&0!=t||this.init()}function SettingsStore(){var e=window.settingsStoreData||{},t=this,n=[];this.loaded=!!window.settingsStoreData;this.get=function(t,n){return n=l(n),!!e[t]&&(!!e[t][n]&&e[t][n])},this.packValueList=function(e){return e.join("|")},this.unpackValueList=function(e){return e.toString().split("|")},this.set=function(t,n,i){if(!t)return!1;var a="/admin/users/saveUserSettings/?key="+t+"&value="+n;if(i=l(i))for(var r=0;r<i.length;r++)a+="&tags[]="+i[r];else i={};o(a,function(e){});for(r=0;r<i.length;r++){var s=i[r];e[t]||(e[t]={}),e[t][s]=n||void 0}},this.list=function(t){t=l(t);var n=[];for(key in e){var i=e[key],a=!1;for(var o in t){var r=t[o];for(var s in i)s==r&&(a=i[s])}a&&(n[key]=a)}return n},this.callback=function(e){return"function"==typeof e&&(callback=e),this},this.load=function(){if(this.loaded)return!0;setTimeout(function(){var e="/udata/users/loadUserSettings/?r="+Math.random();o(e,function(e){t.loaded=!0,r(e.responseXML),i("onLoadComplete")})},50)},this.addEventHandler=function(e,t){var n=a(e);return null!==n&&(n[n.length]={active:!0,handler:t},this.loaded&&"ONLOADCOMPLETE"==e.toUpperCase()&&t(),n.length-1)};var i=function(e,t){var n=a(e);if(null===n)return!1;for(var i in n)n[i].active&&n[i].handler(t)},a=function(e){switch(e.toUpperCase()){case"ONLOADCOMPLETE":return n;default:return null}},l=function(e){var t=typeof e;return"object"==t?e.length>0?e:(e.push("common"),e):"string"==t?new Array(e):"undefined"==t&&new Array("common")},o=function(e,t){var n=function(){if(window.XMLHttpRequest)try{return new XMLHttpRequest}catch(e){}else if(window.ActiveXObject){try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(e){}try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}return null}();n.onreadystatechange=function(){4==n.readyState&&(200==n.status?t(n):i("onRequestFailed"))},n.open("GET",e,!1),n.send(null)},r=function(t){for(var n=t.getElementsByTagName("item"),i=0;i<n.length;i++){var a=n[i],l=a.getAttribute("key");e[l]={};for(var o=a.childNodes,r="",s="",c=0;c<o.length;c++){var d=o[c];"value"!=d.nodeName||(r=d.firstChild.nodeValue,s=d.getAttribute("tag"),e[l][s]=r)}}};this.loaded&&i("onLoadComplete")}function SearchAllTextStorage(e){this.index="search-string",this.filterTag=e,this.save=function(e){var t=SettingsStore.getInstance(),n=t.packValueList(e);t.set(this.index,n,this.filterTag)},this.load=function(){var e=SettingsStore.getInstance(),t=e.get(this.index,this.filterTag);return!1===t?[]:e.unpackValueList(t)}}function PageTreeRecursiveOperator(e){var t=!1,n={},i=50,a=50,l=403;function o(e){var t=Array.isArray(e)?e:[e];return t.forEach(function(e,n){t[n]=parseInt(e)}),t}function r(e,t){var n=function(e){var t=[];return $("child",e).each(function(){t.push($(this).attr("id"))}),t}(e);return 0===n.length?[t]:n}function s(e){h(e,"getInactiveChildrenPart",v)}function c(e){h(e,"getActiveChildrenPart",b)}function d(e){h(e,"getChildrenPart",C)}function u(e){h(e,"getDeletedChildrenPart",w)}function p(e){h(e,"getDeletedChildrenPart",L)}function h(t,n,i){!function(t,n,i){$.ajax({url:window.pre_lang+"/admin/"+e.dataSet.getModule()+"/"+n+"/.xml",dataType:"xml",method:"get",data:{parentId:t},success:i,error:_})}(t,n,function(e){var n=r(e,t);i(n,t)})}function f(e){openDialog("",getLabel("js-del-object-title-short"),{html:getLabel("js-del-page-warning"),confirmText:getLabel("js-del-do"),cancelButton:!0,cancelText:getLabel("js-cancel"),confirmCallback:function(t){closeDialog(t),e()}})}function m(e){n[e]=e}function g(e){return!!n[e]}function v(e,t){y(e,t,!0)}function b(e,t){y(e,t,!1)}function y(t,n,i){if(g(n)){var l=e.dataSet;l.isAvailable()?l.execute("tree_set_activity",{element:t,selected_items:I(t),active:i?1:0,parent_id:n,is_last_iteration:k(t,n)}):x(y,[t,n,i],a)}}function C(t,n){if(g(n)){var i=e.dataSet;i.isAvailable()?i.execute("tree_delete_element",{element:t,selected_items:I(t),allow:!0,parent_id:n,is_last_iteration:k(t,n)}):x(C,[t,n],a)}}function w(t,n){if(g(n)){var i=e.dataSet;i.isAvailable()?i.execute("restore_element",{element:t,selected_items:I(t),parent_id:n,is_last_iteration:k(t,n)}):x(w,[t,n],a)}}function L(t,n){if(g(n)){var i=e.dataSet;i.isAvailable()?i.execute("tree_kill_element",{element:t,selected_items:I(t),parent_id:n,is_last_iteration:k(t,n)}):x(L,[t,n],a)}}function x(e,t,n){setTimeout(function(){e.apply(this,t)},n)}function k(e,t){return 1===e.length&&e[0]===t}function I(t){var n={};return $(t).each(function(){var t=e.getItem(this);t&&(n[t.id]=t)}),n}function _(e){e.status&&e.status===l?T("error-require-more-permissions"):T("js-server_error")}function T(e){$.jGrowl(getLabel(e),{header:getLabel("js-error-header")})}this.init=function(){var a;a=this,e.dataSet.addEventHandler("onAfterExecute",function(e){var l,o=e.params.parent_id;return e.params.is_last_iteration?(function(e){delete n[e],0===Object.keys(n).length&&function(e){t=!1;var n=e?e.toString():"";getPopupByName(n)?closeDialog(n):closeDialog()}(e)}(o),!0):(l=e.params.element.length,t||l!==i||function(e){t||(t=!0,$.get("/styles/skins/modern/design/js/common/html/ProgressBar.html",function(t){openDialog("",getLabel("js-operation-processing"),{name:e,html:t,width:460,cancelButton:!1,stdButtons:!1,closeButton:!1,customClass:"modalUp"})}))}(o),function(e,t){var n=t.params.parent_id;"tree_set_activity"===t.method&&e.switchActivity(n,t.params.active),"restore_element"===t.method&&e.restoreFromTrash(n),"tree_delete_element"===t.method&&e.putToTrash(n,!1),"tree_kill_element"===t.method&&e.remove(n,!1)}(a,e),!0)})},this.switchActivity=function(e,t){t?this.activate(e):this.deactivate(e)},this.activate=function(e){var t=o(e);t.forEach(m),t.forEach(s)},this.deactivate=function(e){var t=o(e);t.forEach(m),t.forEach(c)},this.putToTrash=function(e,t){var n=o(e);function i(){n.forEach(d)}n.forEach(m),t?f(i):i()},this.restoreFromTrash=function(e){var t=o(e);t.forEach(m),t.forEach(u)},this.remove=function(e,t){var n=o(e);function i(){n.forEach(p)}n.forEach(m),t?f(i):i()},this.init()}Control.DragMode=!1,Control.PrepareDrag=!1,Control.startDragX=0,Control.startDragY=0,Control.startDragItem=null,Control.DragSensitivity=7,Control.HandleItem=null,Control.DraggableItem=null,Control.instances=[],Control.enabled=!0,Control.getInstanceById=function(e){for(var t=0;t<Control.instances.length;t++)if(Control.instances[t].id===e)return Control.instances[t];return null},Control.recalcItemsPosition=function(){for(var e=0;e<Control.instances.length;e++)Control.instances[e].recalcItemsPosition()},Control.detectItemByMousePointer=function(e,t){var n=Control.HandleItem;if(n){var i=jQuery(n.control.initContainer).position(),a=n.position;if(t>a.top+i.top&&t<=a.bottom+i.top&&e>a.left+i.left&&e<=a.right+i.left)return n}for(var l=null,o=0;o<Control.instances.length;o++){var r=Control.instances[o];i=jQuery(r.initContainer).offset();if(l=r.getItemByPosition(e-i.left,t-i.top))break}return l},Control.handleMouseUp=function(e){if(Control.enabled){if(!Control.DragMode&&Control.HandleItem){if(e.altKey);else if((e.ctrlKey||e.metaKey)&&2!=e.button);else if(e.shiftKey&&2!=e.button);else{var t=e.target;if(!(0!==e.button||t.classList.contains("editable")||t.classList.contains("cmenuItem")||t.classList.contains("catalog-toggle")||t.classList.contains("catalog-toggle-wrapper")||void 0!==t.type&&"checkbox"!==t.type.toLocaleLowerCase()))if(void 0===t.type&&Control.HandleItem.check(),Control.HandleItem.control.toggleItemSelection(Control.HandleItem),Control.HandleItem.getSelected())Control.HandleItem.control.toolbar&&Control.HandleItem.control.toolbar.show(Control.HandleItem);else{var n=Object.keys(Control.HandleItem.control.selectedList);n.length>0?(Control.HandleItem.control.toggleItemSelection(Control.HandleItem.control.selectedList[n.length-1]),Control.HandleItem.control.toolbar&&Control.HandleItem.control.toolbar.show(Control.HandleItem)):Control.HandleItem.control.toolbar&&Control.HandleItem.control.toolbar.hide()}}Control.HandleItem.control.lastClicked=Control.HandleItem}Control.PrepareDrag=!1,Control.startDragItem=null,Control.DragMode=!1}},jQuery(window).on("resize",function(e){Control.recalcItemsPosition()}),filterController.instances=[],filterController.getInstanceById=function(e){for(var t=0;t<filterController.instances.length;t++)if(filterController.instances[t].getId()===e)return filterController.instances[t];return null},TemplatesDataSet.instance=null,TemplatesDataSet.getInstance=function(){return TemplatesDataSet.instance||(TemplatesDataSet.instance=new TemplatesDataSet),TemplatesDataSet.instance},SettingsStore.instance=null,SettingsStore.getInstance=function(){return SettingsStore.instance||(SettingsStore.instance=new SettingsStore),SettingsStore.instance},jQuery(function(){SettingsStore.getInstance().load()});var editableCell=function(e,t,n,i){var a,l=this,o=n,r=n.fieldName||n.name,s=e,c="pages"!==s.control.contentType,d="",u="";this.isActive=!1,this.element=t,function(){(function(){if(!editableCell.enableEdit)return!1;if(_.contains(editableCell.ignoreDataTypes,n.dataType))return!1;if(_.contains(editableCell.ignorePropNames,r))return!1;return!0})()&&($(i).on("click",function(){if(editableCell.activeCell)return;l.makeEditable()}),l.isActive=!0)}(),this.prepareSaveData=function(){a&&l.save(a.val(),!1)},this.makeEditable=function(){editableCell.activeCell=l,p()};var p=function(){$.ajax({url:m("get"),type:"GET",dataType:"xml",success:g,error:function(e,t,n){h(n,"get")}})},h=function(e,t){f(getLabel("js-edcell-"+t+"-error")+e)},f=function(e){editableCell.activeCell=!1,$.jGrowl(e,{header:getLabel("js-error-header")})},m=function(e){var t=window.pre_lang+"/admin/content/"+e+"_editable_region/"+s.id+"/"+r+".xml";return c&&(t+="?is_object=1"),t},g=function(e){var t=e.getElementsByTagName("error");t.length>0?f(t[0].firstChild.nodeValue):v(e)},v=function(e){var t=e.getElementsByTagName("property"),n=b(t),i=e.getElementsByTagName("value"),a=y(i),l=!1,o=!1;switch(n){case"wysiwyg":case"text":case"string":case"int":case"price":case"float":case"tags":case"link_to_object_type":case"counter":w(a);break;case"date":a=C(i),k(a);break;case"boolean":A(a);break;case"relation":i=e.getElementsByTagName("item"),l="multiple"===t[0].getAttribute("multiple"),o="1"===t[0].getAttribute("public-guide"),E(i,l,o);break;case"name":i=e.getElementsByTagName("name"),a=y(i),w(a);break;case"color":j(a);break;case"img_file":case"swf_file":case"video_file":case"file":I(a);break;case"domain_id_list":case"domain_id":var r=e.getElementsByTagName("domain");$.each(r,function(e,t){var n=$(t);n.attr("name",n.attr("host"))}),E(r,l="domain_id_list"===n,o,{type:"",sourceUri:"/admin/data/getDomainList/"});break;case"optioned":N(e);break;case"multiple_image":case"multiple_file":S(e);break;case"lang_id_list":case"lang_id":{let t=e.getElementsByTagName("lang");$.each(t,function(e,t){let n=$(t);n.attr("name",n.html())}),E(t,l="lang_id_list"===n,o,{type:"",sourceUri:"/admin/data/getLangsList/"});break}default:f(getLabel("js-edcell-unsupported-type"))}},b=function(e){if("name"===r)return"name";var t="";return void 0!==e[0]&&(t=e[0].getAttribute("type")||""),t},y=function(e){var t;return e.length>0&&(t=e[0].firstChild?e[0].firstChild.nodeValue:""),t||""},C=function(e){var t;return e.length>0&&(t=e[0].firstChild?e[0].getAttribute("formatted-date"):""),t||""};this.registerOutsideClick=function(){$(window).on("click",l.outSideClick)},this.unregisterOutsideClick=function(){$(window).off("click",l.outSideClick)},this.outSideClick=function(e){$(l.element).prop("id")!=$(e.target).closest("td").prop("id")&&l.prepareSaveData()};var w=function(e){_editControl=document.createElement("input"),_editControl.setAttribute("type","text"),_editControl.value=e,_editControl.className="editableCtrl default",(a=$(_editControl)).on("keyup",L),a.on("blur",function(){editableCell.activeCell&&l.prepareSaveData()});var t=x();u=t.html(),d=e,t.html(""),a.appendTo(t),a.trigger("focus")},L=function(e){var t=Number(window.event?window.event.keyCode:e.which);27===t&&l.restore(),13===t&&editableCell.activeCell&&l.prepareSaveData()},x=function(){return $("div",l.element)},k=function(e){_editControl=document.createElement("input"),_editControl.setAttribute("type","text"),_editControl.value=e,_editControl.className="default",(a=$(_editControl)).on("keyup",L),a.on("blur",function(e){if(e.relatedTarget||e.toElement){var t=$(e.relatedTarget).closest("table").hasClass("ui-datepicker-calendar");editableCell.activeCell&&!t&&l.prepareSaveData()}});var t=x();u=t.html(),d=e,t.html(""),a.appendTo(t),a.trigger("focus"),a.datepicker({dateFormat:"yy-mm-dd",onClose:function(e){/\d{1,2}:\d{1,2}(:\d{1,2})?$/.exec(e)||(e+=" 00:00:00"),a.val(e),editableCell.activeCell&&l.prepareSaveData()}}),a.datepicker("show")},I=function(e){var t=x();u=t.html(),d=e;var n=_.template($("#fast-edit-file-control").html())({id:l.element.id+"_input_id",value:e});t.html(""),t=$(n).appendTo(t),(a=$("input",t)).on("keyup",L),a.on("change",function(){return a.trigger("focus"),!0}),l.registerOutsideClick();var i=o.dataType||"";$("a.icon-action",t).on("click",function(){var e;switch(i){case"img_file":e="image=1";break;case"swf_file":case"video_file":e="video=1";break;default:e=""}T(a,e)}),a.trigger("focus")},T=function(e,t){var n=e.attr("id"),i=e.val(),a=i.match(/(.*\/)/),l=a?a[0]:"",o=[];o.push("id="+n),o.push("file="+i),o.push("folder="+l),o.push("lang="+window.lang_id),o.push("objectId="+s.objectId),o.push("pageId="+s.id),o.push("fieldName="+r),t&&o.push(t),$.openPopupLayer({name:"Filemanager",title:getLabel("js-file-manager"),width:1200,height:600,url:"/styles/common/other/elfinder/umifilebrowser.html?"+o.join("&")});var c=$("div#popupLayer_Filemanager div.popupBody"),d=_.template($("#file-browser-options").html())({watermarkMessage:getLabel("js-water-mark"),rememberMessage:getLabel("js-remember-last-dir"),remember:getCookie("remember_last_folder",!0)});c.append(d)},j=function(e){d=e;var t=x();u=t.html(),t.html("");t=$('<div class="color table"><input type="text" class="default"></div>').appendTo(t),a=$("input",t),e&&a.val(e),a.on("keyup",L),a.on("blur",function(){editableCell.activeCell&&l.prepareSaveData()}),new colorControl(t,{}),$(t).on("hidePicker",function(){editableCell.activeCell&&l.prepareSaveData()})},E=function(e,t,n,i){i=i||{};var r=$(e);$(l.element).addClass("hide-editable");var s=x();s.css("overflow","visible"),u=s.html();var c='<div class="layout-col-control quick selectize-container"><select id="" class="default" '+(t?"multiple":"")+' autocomplete="off"></select></div>';s.html("");var d=$(c).appendTo(s);if(a=$("select",d),$.each(r,function(e,t){var n=$(t);a.append($("<option>",{value:n.attr("id"),text:n.attr("name"),selected:!0}))}),n){var p='<div class="layout-col-icon"><a id="" title="'+getLabel("js-new_guide_item_title")+'" class="icon-action relation-add"><i class="small-ico i-add"></i></a></div>';s.append(p)}i=$.extend({container:s,type:o.guideId,preload:!1},i);var h,f=new ControlRelation(i);f.loadItemsAll(function(e){h=f.selectize;var t=e.responseXML.getElementsByTagName("object");if(t.length>0)f.updateElements(e);else{t=e.responseXML.getElementsByTagName("empty");var n=String(t[0].getAttribute("result")).toLowerCase().replace(/[\s]/g,"");"toomuchitems"===n&&(h=f.makeSearch())}h.on("change",function(){l.prepareSaveData()}),h.lock(),$.each(r,function(e,t){var n=$(t);h.addItem(n.attr("id"),!0)}),h.unlock(),h.editableCell=l},!0),l.registerOutsideClick(),s.on("keyup",L),l.prepareSaveData=function(){if($(l.element).removeClass("hide-editable"),h){for(var e=[],t=0;t<h.items.length;t++){var n=h.items[t];e.push(n)}l.save(e)}}},A=function(e){var t=x();u=t.html(),t.html(""),(a=$('<div class="checkbox '+(e?"checked":"")+'"><input type="checkbox editableCtrl"></div>').appendTo(t)).on("click",function(){var e=$(this);e.toggleClass("checked");var t=e.hasClass("checked")?1:0;return l.save(t,!0),_.contains(["is_activated","is_active","active"],l.element.name)&&s.update({"is-active":t,id:s.id}),!0}),l.registerOutsideClick();var n=a.children("input").eq(0);n.trigger("focus"),a.trigger("focus"),n.on("keydown",L)},N=function(e){l.restore(),$.ajax({url:"/styles/skins/modern/design/js/common/optioned_template.html",dataType:"html",success:function(t){var n=$($.parseHTML(t)),i=n.find("#field_template").html(),a=n.find("#option_template").html(),l=e.getElementsByTagName("property")[0],o=e.getElementsByTagName("title")[0].innerHTML,s=l.getAttribute("guide-id"),c="data["+l.getAttribute("object-id")+"]["+r+"]",d="1"===l.getAttribute("public-guide"),u=uAdmin.data["pre-lang"],p="stores_state"===r,f=p?"int":"float",g=[];$(e).find("option").each(function(e,t){var n=$(t).find("object");g.push({label:n.attr("name"),labelRemoveOption:getLabel("js-remove-option"),inputName:c,position:e,relationId:n.attr("id"),value:$(t).attr(f),isStores:p})});var v="";$.each(g,function(e,t){v+=$.tmpl(a,t)[0].outerHTML});var b={title:o,guideId:s,inputName:c,isPublic:d,langPrefix:u,type:f,labelEditGuideItems:getLabel("js-edit-guide-items"),labelAddRelationItem:getLabel("js-add-relation-item"),labelAddOption:getLabel("js-add-option"),optionsHtml:v},y=$.tmpl(i,b);openDialog("",getLabel("js-editable-optioned-field"),{width:800,html:y,cancelButton:!0,confirmText:getLabel("js-save"),cancelText:getLabel("js-new_guide_item_cancel"),openCallback:function(){initOptionedFields()},confirmCallback:function(e){var t=$("#optionedFieldForm").serialize();t+="&csrf="+csrfProtection.getToken(),$.ajax({type:"POST",url:m("save"),dataType:"xml",data:t,success:function(){$.jGrowl(getLabel("js-property-saved-success"))},error:function(e,t,n){h(n,"save")},complete:function(){closeDialog(e)}})},cancelCallback:function(e){closeDialog(e)}})}})},S=function(e){u=x().html(),l.restore(),$.ajax({url:"/styles/skins/modern/design/js/common/dialog_edit_field_template.html",dataType:"html",success:function(t){var n,i,a,l=$($.parseHTML(t)),o=e.getElementsByTagName("property")[0],r=o.getAttribute("type");"multiple_file"==r?(i=l.find("#field_template_files").html(),a=l.find("#value_template_file").html(),n=getLabel("js-editable-multiple_file-field")):(i=l.find("#field_template_images").html(),a=l.find("#value_template_image").html(),n=getLabel("js-editable-multiple_image-field"));var s=e.getElementsByTagName("title")[0].innerHTML,c="idm"+o.getAttribute("id"),d="data["+o.getAttribute("object-id")+"]",u=[];$(o).find("value").each(function(e,t){var n=$(t);u.push({id:n.attr("id"),path:n.html(),alt:n.attr("alt"),title:n.attr("title"),order:n.attr("ord"),folderHash:n.attr("folder_hash"),fileHash:n.attr("file_hash"),inputName:d,position:e})});var p="";$.each(u,function(e,t){p+=$.tmpl(a,t)[0].outerHTML});var f={title:s,elemId:c,inputName:d,valuesHtml:p},g=$.tmpl(i,f);openDialog("",n,{width:800,html:g,cancelButton:!0,confirmText:getLabel("js-save"),cancelText:getLabel("js-new_guide_item_cancel"),openCallback:function(){"multiple_file"==r?$("div.multifile").each(function(){new ControlMultiFile({container:$(this)})}):$("div.multiimage").each(function(){new ControlMultiImage({container:$(this)})})},confirmCallback:function(e){var t=$("#optionedFieldForm").serialize();t+="&csrf="+csrfProtection.getToken(),$.ajax({type:"POST",url:m("save"),dataType:"xml",data:t,success:P,error:function(e,t,n){h(n,"save")},complete:function(){closeDialog(e)}})},cancelCallback:function(e){closeDialog(e)}})}})},P=function(e){var t=e.getElementsByTagName("error");if(t.length>0)return f(t[0].firstChild.nodeValue),void l.restore();var n=x(),i=e.getElementsByTagName("property"),a=e.getElementsByTagName("value"),o=y(a);!function(t){switch(t){case"wysiwyg":case"text":case"int":case"price":case"float":case"tags":case"counter":case"link_to_object_type":return void l(o);case"date":return void l(C(a));case"string":return void function(){var e=i[0].getAttribute("restriction");o&&"email"===e&&(o="<a href='mailto:"+o+"' title='"+o+"' class='link'>"+o+"</a>");l(o)}();case"boolean":return o=Number(o),n.html(o?'<img alt="" style="width:13px;height:13px;" src="/styles/skins/modern/design/img/tree/checked.png" />':""),void(d=o);case"relation":return void function(){if(1===(a=e.getElementsByTagName("item")).length){var t=a[0].getAttribute("name")||"",i=a[0].getAttribute("guid")||"relation-value";o='<span title="'+t+'" class="c-'+i+'">'+t+"</span>"}else if(a.length>1)for(var r=0;r<a.length;r++)o+=a[r].getAttribute("name")||"",r<a.length-1&&(o+=", ");n.css("overflow","hidden"),l(o)}();case"domain_id":case"domain_id_list":return void function(){if(a=e.getElementsByTagName("domain"),o="",1===a.length)o=a[0].getAttribute("host")||"";else if(a.length>1)for(var t=0;t<a.length;t++){var n=a[t].getAttribute("host")||"";o+=n,t<a.length-1&&n.length>0&&(o+=", ")}l(o)}();case"lang_id":case"lang_id_list":return void function(){let t=e.getElementsByTagName("lang"),n="";if(1===t.length)n=t[0].innerHTML||"";else if(t.length>1)for(let e=0;e<t.length;e++){let i=t[e].innerHTML||"";n+=i,e<t.length-1&&i.length>0&&(n+=", ")}l(n)}();case"name":return a=e.getElementsByTagName("name"),o=y(a),n.html(u),n.find(".name_col").text(o),s.checkBox=$("div.checkbox",n).get(0),void(d=o);case"color":return void function(){var e='<div class="color table"><span class="value">'+o+'</span><span class="color-box"><i style="background-color: '+o+'"></i></span></div>';0===d.length?n.html(e):n.html(u);var t=$(".value",n),i=$(".color-box i",n);t.html(o),i.css("background-color",o),d=o}();case"video_file":case"swf_file":case"file":case"img_file":return void function(){if(a.length>0){let e=$(a[0]),n=e.attr("path"),i=n.substring(0,n.lastIndexOf("."));if("."===i)return void l("");let r=n.substring(1),s=e.attr("ext"),c=e.attr("name"),d=e.attr("is_broken"),u="img_file"===t?"fast-edit-image-preview":"fast-edit-file-preview",p=_.template($("#"+u).html());o=p({filePath:r,filePathWithoutExt:i,fileName:c,ext:s,isBroken:d})}l(o)}();case"multiple_file":case"multiple_image":return void function(){let e="";a.length>0&&$.each(a,function(n,i){let a=(i=$(i)).attr("path"),l=a.substring(0,a.lastIndexOf(".")),o=a.substring(1);if("multiple_image"==t){let e=i.attr("ext"),t="/autothumbs.php?img="+l+"_sl_180_120."+e;str='src="/styles/skins/modern/design/img/image.png" onmouseover="TableItem.showPreviewImage(event, \''+t+"')\" />&nbsp;"}else str='src="/styles/skins/modern/design/img/ico_file.gif" title="'+o+'"/>&nbsp;';e+='<img alt="" style="width:13px;height:13px;cursor: pointer;" '+str});l(e)}();default:return void f(getLabel("js-edcell-unsupported-type"))}function l(e){n.html(e),d=e}}(b(i)),function(){window.onAfterSetProperty&&onAfterSetProperty(s.id,r,o);$.jGrowl(getLabel("js-property-saved-success")),u=x().html(),Control.recalcItemsPosition()}()},M=function(e){return""==e||(!(isNaN(parseFloat(e))||!e.match(/^[0-9eE.,]+$/))||($.jGrowl(getLabel("js-error-validate-number"),{header:getLabel("js-error-header")}),!1))};this.save=function(e,t){return l.unregisterOutsideClick(),_.isArray(e)||t||d!=e&&(n=e,i=o.dataType||"",-1===["int","price","float","counter"].indexOf(i)||M(n))?(a=e,$.ajax({type:"POST",url:m("save"),dataType:"xml",data:{"data[]":a,csrf:csrfProtection.getToken()},success:P,error:function(e,t,n){h(n,"save")},complete:function(){editableCell.activeCell===l&&(editableCell.activeCell=!1)}}),!0):(this.restore(),!1);var n,i,a},this.restore=function(){l.unregisterOutsideClick(),$(l.element).removeClass("hide-editable"),editableCell.activeCell=!1;var e=x();e.html(u);var t=$("div.checkbox",e)[0];s.isCheckboxAvailable()&&t&&(s.checkBox=t),Control.recalcItemsPosition()},this.getEditControl=function(){return a}};editableCell.activeCell=!1,editableCell.ignoreDataTypes=["wysiwyg"],editableCell.ignorePropNames=[];var TreeItem=function(e,t,n,a,l){var o=parseInt(n.id),r=this,s=n,c=t,d=a||null,u=l||"after",p=void 0!==n["force-draw"]?parseInt(n["force-draw"]):1,h=void 0!==n.childs?parseInt(n.childs):0,f=void 0!==n.basetype&&"string"==typeof n.basetype._value?n.basetype._value:"",m=e.iconsPath,g=void 0!==n.basetype&&"string"==typeof n.basetype.module?n.basetype.module:"content",v=void 0!==n.basetype&&"string"==typeof n.basetype.method?n.basetype.method:"",b=void 0!==n.iconbase?n.iconbase:m+"ico_"+g+"_"+v+".png",y=null,C=null,w=null,L=null,x=(SettingsStore.getInstance(),null),k=!1,I=null,_="boolean"!=typeof e.hasCheckboxes||e.hasCheckboxes,T="boolean"!=typeof e.isCanSelect||e.isCanSelect;this.element=null,this.checkBox=null,this.control=e,this.childsContainer=null,this.id=o,this.name=void 0!==n.name?n.name:"noname",this.isRoot=0===o,this.loaded=!1,this.viewLink=void 0!==n.link&&n.link,this.editLink=void 0!==n["edit-link"]&&n["edit-link"],this.createLink=void 0!==n["create-link"]&&n["create-link"],this.permissions=void 0!==n.permissions?parseInt(n.permissions):0,this.isActive=void 0!==n["is-active"]?parseInt(n["is-active"]):0,this.isVirtualCopy=void 0!==n["has-virtual-copy"],this.isOriginal=void 0!==n["is-original"],this.lockedBy="object"==typeof n["locked-by"]?n["locked-by"]:null,this.expiration="object"==typeof n.expiration?n.expiration:null,this.isDefault=void 0!==n["is-default"],this.templateId=void 0!==n["template-id"]?n["template-id"]:null,this.langId=void 0!==n["lang-id"]?n["lang-id"]:null,this.domainId=void 0!==n["domain-id"]?n["domain-id"]:null,this.allowCopy=void 0===n["allow-copy"]||parseInt(n["allow-copy"]),this.allowActivity=void 0===n["allow-activity"]||parseInt(n["allow-activity"]),this.allowDrag=void 0===n["allow-drag"]||n["allow-drag"],this.parent=c,this.childs=[],this.hasChilds=h>0||0==o,this.labelControl=null,this.position=!1,this.isExpanded=!1,this.filter=new filter,this.pageing={total:0,limit:0,offset:0},this.baseModule=void 0!==n.basetype&&"string"==typeof n.basetype.module?n.basetype.module:"content",this.baseMethod=void 0!==n.basetype&&"string"==typeof n.basetype.method?n.basetype.method:"";var j=function(e){var t=document.createElement("li");t.setAttribute("rel",o),t.classList.add("ti"),t.classList.add("tollbar"),t.rel=o,t.onmousedown=function(){return!1},(C=document.createElement("div")).classList.add("ti"),C.classList.add("tree_line"),r.isVirtualCopy&&(C.className+=" virtual"),r.isDefault&&(C.className+=" main-page"),jQuery(C).on("mouseover",function(){r.control.onElementMouseOver(r,this)}),jQuery(C).on("mouseout",function(){r.control.onElementMouseOut(r,this)}),jQuery(C).on("click",function(e){r.control.onElementClick(r,this,e)}),(y=document.createElement("span")).className="catalog-toggle";var n=document.createElement("span");if(n.classList.add("catalog-toggle-wrapper"),n.onclick=function(e){return r.toggle(this),!1},r.hasChilds?n.appendChild(y):n.className="catalog-toggle-off",C.appendChild(n),_){var i=document.createElement("div");i.classList.add("checkbox");var a=document.createElement("input");a.setAttribute("type","checkbox"),a.value=o,a.classList.add("row_selector"),i.appendChild(a),r.checkBox=i,C.appendChild(i)}if(T){var l=jQuery(C);l.on("mousedown",function(e){r.control.handleMouseDown(e,o)}),l.on("mouseup",function(e){r.control.handleMouseUp(e,r)})}if((L=document.createElement("img")).style.border="0px",L.setAttribute("alt",f),L.setAttribute("title",f),L.setAttribute("src",b),L.className="ti-icon",L.onmousedown=function(){return!1},r.control.allowDrag&&r.allowDrag&&(L.style.cursor="move"),C.appendChild(L),r.expiration){var s=r.expiration.status;if(s){var c=s.id,p=s._value;if(c){var h=document.createElement("img"),g=m+"ico_"+c+".png";h.setAttribute("src",g),h.setAttribute("alt",p),h.setAttribute("title",p),h.className="page-status",C.appendChild(h)}}}w=document.createElement("a");var v=r.name;if("string"!=typeof v&&(v=getLabel("js-smc-noname-page")),w.innerHTML=v,r.viewLink&&(w.title=r.viewLink),w.setAttribute("href","#"),r.editLink&&(w.setAttribute("href",r.editLink),w.onclick=function(){return r.control.applyBehaviour(r)}),$(w).on("mousedown click mouseup",function(e){return 1!==e.button&&e.preventDefault(),!0}),C.appendChild(w),r.isVirtualCopy){var x=document.createElement("span");x.className="label-virtual",x.innerHTML=r.isOriginal?getLabel("js-smc-original"):getLabel("js-smc-virtual-copy"),C.appendChild(x)}if(r.editLink){var k=document.createElement("a");k.classList.add("small-ico"),k.classList.add("i-edit"),k.setAttribute("href",r.editLink),C.appendChild(k)}if(r.labelControl=t.appendChild(C),r.isActive||C.classList.add("disabled"),(I=document.createElement("div")).className="pages-bar",I.style.display="none",r.pagesBar=t.appendChild(I),childsContainer=document.createElement("ul"),childsContainer.className="ti-childs-container",childsContainer.style.display="none",r.childsContainer=t.appendChild(childsContainer),d){var j=null;j="after"==u.toLowerCase()?d.element.nextSibling:d.element,r.element=j?e.insertBefore(t,j):e.appendChild(t)}else r.element=e.appendChild(t);if(r.control.dragAllowed&&r.allowDrag){var E,A="child",N=!1;jQuery(C).draggable({appendTo:"body",distance:Control.DragSensitivity,handle:".ti-icon, a",cursorAt:{right:-2},helper:function(){r.setSelected(!0),r.control.selectedList[r.id]=r;var e=document.createElement("div");for(key in r.control.selectedList)e.innerHTML+="<div>"+r.control.selectedList[key].name+"</div>";return e.className="ti-draggable",jQuery(e).css({position:"absolute","padding-left":"20px"}),e},start:function(){Control.DraggableItem=r,Control.DragMode=!0,r.control.toolbar&&r.control.toolbar.hide()},stop:function(){Control.HandleItem&&(Control.HandleItem.deInitDroppable(),Control.DraggableItem&&Control.DraggableItem.tryMoveTo(Control.HandleItem,A)),Control.DraggableItem=null,Control.DragMode=!1,jQuery(".pages-bar a").off("mouseover"),N=!1,window.clearTimeout(E)},drag:function(e,t){jQuery(".pages-bar a").on("mouseover",function(){if(!N){N=!0;var e=this;E=window.setTimeout(function(){$(e).trigger("click")},1e3)}}),jQuery(".pages-bar a").on("mouseout",function(){N&&(N=!1,window.clearTimeout(E))});var n=e.pageX,i=e.pageY,a=Control.detectItemByMousePointer(n,i),l=Control.HandleItem;if(l&&l.deInitDroppable(),Control.HandleItem=a,a){var o=jQuery(a.control.initContainer).position(),r=a.position.bottom-a.position.top,s=i-o.top-a.position.top;s<r/3&&(A="before"),s>r/3&&s<2*r/3&&(A="child"),s>2*r/3&&(A="after"),a.isRoot&&(A="child"),a.initDroppable(A)}}})}},E=function(){if(!Control.dropIndicator){var e=document.createElement("div");e.className="ti-drop",Control.dropIndicator=document.body.appendChild(e)}j(r.control.container)},A=function(){r!==Control.HandleItem||r.isExpanded||r.expand()};this.draw=function(){t?p||j(c.childsContainer):p||E()},this.appendChild=function(e){return new TreeItem(this.control,r,e)},this.appendAfter=function(e,t){return new TreeItem(this.control,r,e,t,"after")},this.appendBefore=function(e,t){return new TreeItem(this.control,r,e,t,"before")},this.appendFirst=function(e){return this.childsContainer.childNodes.length?void 0!==this.childsContainer.childNodes[0].rel?this.appendBefore(e,this.control.getItem(this.childsContainer.childNodes[0].rel)):void 0:this.appendChild(e)},this.getPreviousSibling=function(){var e=this.element.previousSibling;return e&&e.rel?this.control.getItem(e.rel):null},this.getNextSibling=function(){var e=this.element.nextSibling;return e&&e.rel?this.control.getItem(e.rel):null},this.clear=function(){this.element.parentNode&&this.element.parentNode.removeChild(this.element)},this.checkIsChild=function(e){for(var t=this.parent;t;){if(e===t)return!0;t=t.parent}return!1},this.recalcPosition=function(){try{var e=jQuery(C).position();return this.position={left:e.left,top:e.top,right:this.control.initContainer.offsetWidth,bottom:e.top+C.offsetHeight},this.position}catch(e){return!1}},this.getValue=function(e){if(!s.properties)return!1;if(!s.properties.group)return!1;for(var t=void 0!==s.properties.group[0]?s.properties.group:[s.properties.group],n=0;n<t.length;n++)if(t[n].property)for(var i=void 0!==t[n].property[0]?t[n].property:[t[n].property],a=0;a<i.length;a++)if(i[a].name==e)return i[a].value;return!1},this.check=function(){$(checkbox).toggleClass("checked")},this.isCheckboxAvailable=function(){return _},this.getData=function(){return s},this.setLoaded=function(e){this.loaded=e},this.setPageing=function(e){if(!e)return!1;if(this.pageing=e,I.style.display="none",I.innerHTML="",I.style.textAlign="left",e.total<2){I.parentNode.style.display="";var t=document.createElement("span");t.className="empty-result",this.isRoot&&(I.style.textAlign="center"),I.appendChild(t)}if(e.total>e.limit||e.offset>0){var n=document.createElement("span");n.appendChild(document.createTextNode(getLabel("js-pages-label"))),n.className="pagesLabel",I.appendChild(n),I.style.display="";for(var i=Math.ceil(e.total/e.limit),a=Math.ceil(e.offset/e.limit),l=function(e){return function(){return r.filter.setPage(e),r.applyFilter(r.filter,!0),!1}},o=!1,s=!1,c=0;c<i;c++)0!=c&&c!=Math.ceil(e.total/e.limit)-1&&Math.abs(c-a)>15?(o||((s=document.createElement("a")).href="#",a==c&&(s.className="current"),s.innerHTML="&#8230;",s.className="current",s.onclick=function(){return!1},I.appendChild(s)),o=!0):(o=!1,(s=document.createElement("a")).href="#",a==c&&(s.className="current"),s.innerHTML=c+1,s.onclick=l(c),I.appendChild(s))}},this.expand=function(){if(!this.hasChilds)return!1;$(y).addClass("switch"),this.isExpanded=!0,this.loaded||(this.initFilter(o),this.control.load(this.filter)),this.childsContainer.style.display="";var e=this.pageing;e.total>e.limit&&(r.pagesBar.style.display=""),Control.recalcItemsPosition(),this.control.saveItemState(this.id)},this.collapse=function(){if(!this.hasChilds)return!1;this.isExpanded=!1,y.setAttribute("src",m+"expand.png"),$(y).removeClass("switch"),this.childsContainer.style.display="none",r.pagesBar.style.display="none",Control.recalcItemsPosition(),this.control.saveItemState(this.id)},this.toggle=function(e){this.hasChilds&&($(e).toggleClass("switch"),this.isExpanded?this.collapse():this.expand())},this.update=function(e){if(e){if(this.id!=e.id)return!1;if(void 0!==e["template-id"]&&(this.templateId=e["template-id"]),void 0!==e.link&&e.link!=this.viewLink&&(this.viewLink=e.link,C.setAttribute("href",this.viewLink)),void 0!==e.childs&&parseInt(e.childs)!==h){h=parseInt(e.childs),this.hasChilds=h>0||0==o;var t=$("span",C);r.hasChilds?(t.removeClass("catalog-toggle-off"),t.removeClass("switch"),t.addClass("catalog-toggle-wrapper"),t.empty(),(y=document.createElement("span")).className="catalog-toggle switch",t.append(y)):(t.removeClass("catalog-toggle-wrapper"),t.removeClass("switch"),t.addClass("catalog-toggle-off"),t.empty())}var n=void 0!==e["is-active"]?parseInt(e["is-active"]):0;n!==this.isActive&&(this.isActive=n,this.isActive?$(C).removeClass("disabled"):$(C).addClass("disabled")),void 0!==e.name&&e.name!=this.name&&(this.name=e.name.length?e.name:"",w.innerHTML=this.name.length?this.name:getLabel("js-smc-noname-page"))}},this.tryMoveTo=function(e,t){if(e){var n=this.control.getRootNodeId(),a=e.id,l="child"!==t?1:0;if("before"==t&&(n=e.id,a=e.parent.id),"after"==t){var o=e.getNextSibling();a=e.parent.id,n=o?o.id:this.control.getRootNodeId()}if(e===this)return!1;if(e.checkIsChild(this))return!1;if(n==this.id)return!1;var r=e;l&&(r=e.parent?e.parent:e.control.getRoot());var s=[],c=0;for(i in this.control.selectedList)s[c++]=i;this.control.dataSet.execute("move",{element:this.id,before:n,rel:a,"as-sibling":l,domain:e.control.getRoot().name,childs:1,links:1,virtuals:1,permissions:1,templates:1,receiver_item:r,handle_item:this,selected_list:s})}},this.initDroppable=function(e){e=e||"child";var t=Control.DraggableItem,n=jQuery(this.control.initContainer).position();if(t){if(t===this)return!1;if(this.checkIsChild(t))return!1;var i=Control.dropIndicator;"after"==e&&(i.style.top=this.position.bottom+n.top+"px",i.style.left=this.position.left+n.left+"px",i.style.width=this.position.right-this.position.left+"px"),"before"==e&&(i.style.top=this.position.top+n.top+i.offsetHeight+"px",i.style.left=this.position.left+n.left+"px",i.style.width=this.position.right-this.position.left+"px"),"child"==e&&(i.style.top=this.position.bottom+n.top+"px",i.style.left=this.position.left+n.left+20+"px",i.style.width=this.position.right+n.left-40-this.position.left+"px"),i.style.display="",setTimeout(A,3239)}},this.deInitDroppable=function(){Control.dropIndicator&&(Control.dropIndicator.style.display="none")},this.applyFilter=function(e,t){e instanceof Object?this.filter=e:this.filter.clear(),this.initFilter(!t),this.loaded&&(this.control.removeItem(o,!0),this.loaded=!1,this.isExpanded&&this.expand())},this.initFilter=function(e){e&&this.initRelationFilter(),this.initSearchQuery()},this.initRelationFilter=function(){this.filter.setParentElements(o)},this.initSearchQuery=function(){var e=new SearchAllTextStorage(this.control.id).load();e.length>0&&this.filter.setAllTextSearch(e)},this.setSelected=function(e){e?(x||(x=C.className,C.classList.add("selected"),r.isDefault&&(C.className+=" main-page")),_&&$(this.checkBox).addClass("checked"),k=!0):(x&&(r.isDefault&&(C.className+=" main-page"),x=null),$(C).removeClass("selected"),_&&$(this.checkBox).removeClass("checked"),k=!1)},this.getSelected=function(){return k},this.getUrl=function(){var e=TemplatesDataSet.getInstance().getDomainsList();if(!e)return r.viewLink;for(var t in e)if(e[t].id==r.domainId)return e[t].url+r.viewLink;return r.viewLink},this.active=function(){return!!r.isActive},t?(t.childs[t.childs.length]=o,j(c.childsContainer)):E()};ContextMenu={},ContextMenu.itemHandlers={},ContextMenu.itemHandlers.viewElement=function(e){if(!Control.HandleItem)return!1;if(!Control.HandleItem.id)return!1;var t,n,i=Control.HandleItem.control.selectedList,a=0;for(t in i)n=i[t],a++;if(!n)return!1;var l=n.getData().link;if(!l)return!1;var o=1!=a;return{caption:getLabel("js-"+e[0]),icon:"i-see",visible:!0,disabled:o,execute:function(){return window.location=l,!1}}},ContextMenu.itemHandlers.copyUrl=function(e){if(!Control.HandleItem)return!1;if(!Control.HandleItem.id)return!1;var t,n,i=Control.HandleItem.control.selectedList,a=0;for(t in i)n=i[t],a++;if(!n)return!1;var l=n.getData().link;if(!l)return!1;var o=1!=a;return{caption:getLabel("js-"+e[0]),icon:"i-copy-url",visible:!0,disabled:o,onRender:function(e){if(!window.ZeroClipboard.isFlashUnusable()){$(e).attr("data-clipboard-text",location.protocol+"//"+location.hostname+l);new ZeroClipboard(e)}},execute:function(e){window.ZeroClipboard.isFlashUnusable()&&$.jGrowl(getLabel("js-error-copy-url-flash-player-disabled"),{header:"UMI.CMS",life:1e4})}}},ContextMenu.itemHandlers.changeParent=function(e){if(!Control.HandleItem)return!1;if(!Control.HandleItem.id)return!1;var t=this;return this.moveItem=function(e){if(window.page_id==e)return!1;jQuery.ajax({url:"/admin/content/tree_move_element.json",type:"get",dataType:"json",data:{element:window.page_id,rel:e,return_copies:1},success:function(e){oFilterController.applyFilterAdvanced()}})},{caption:getLabel("js-"+e[0]),icon:e[1],visible:!0,execute:function(e){var n='&callback=changeParentControlsList["'+Control.HandleItem.id+'"].moveItem';window.page_id=Control.HandleItem.id,window.changeParentControlsList||(window.changeParentControlsList={}),window.changeParentControlsList[Control.HandleItem.id]=t,jQuery.openPopupLayer({name:"Sitetree",title:getLabel("js-choice-page"),width:620,height:335,url:"/styles/common/js/parents.html?id="+Control.HandleItem.id+(Control.HandleItem.baseModule?"&module="+Control.HandleItem.baseModule:"")+(window.lang_id?"&lang_id="+window.lang_id:"")+n})}}},ContextMenu.itemHandlers.editItem=function(e){if(!Control.HandleItem)return!1;if(!Control.HandleItem.id)return!1;var t,n,i=Control.HandleItem.control.selectedList,a=0;for(t in i)n=i[t],a++;if(!n)return!1;var l=n.editLink;if(!l)return!1;var o=1!=a||!l;return{caption:getLabel("js-"+e[0]),icon:"i-edit",visible:!0,disabled:o,execute:function(){return window.location=l,!1}}},ContextMenu.itemHandlers.addItem=function(e){if(!Control.HandleItem)return!1;var t,n,i=Control.HandleItem.control.selectedList,a=0;for(t in i)n=i[t],a++;if(!n)return!1;var l=n.createLink;if(!l)return!1;var o=1!=a||!l;return{caption:getLabel("js-"+e[0]),icon:"i-add",visible:!0,disabled:o,execute:function(){return window.location=l,!1}}},ContextMenu.itemHandlers.filterItem=function(e){if(!Control.HandleItem)return!1;if(!Control.HandleItem.id)return!1;if(Control.HandleItem.control.flatMode||Control.HandleItem.control.objectTypesMode)return!1;var t,n=Control.HandleItem.control,i=Control.HandleItem.control.selectedList,a=0,l=!1;for(t in i){var o=i[t];n.isTarget(o)?l=!0:!0,a++}var r=!1;return 1==a&&(o.hasChilds||(r=!0)),{caption:getLabel("js-"+e[0]),icon:l?"i-search-section":"i-search-section disabled",visible:!0,disabled:r,execute:function(){var e=Control.HandleItem.control;return e.setTargetItems(l?{}:e.selectedList),!1}}},ContextMenu.itemHandlers.activeItem=function(e){if(!Control.HandleItem)return!1;if(!Control.HandleItem.id)return!1;if(Control.HandleItem.control.flatMode||Control.HandleItem.control.objectTypesMode)return!1;var t,n=Control.HandleItem.control.selectedList,i=!1,a=!1;for(t in n)n[t].isActive?i=!0:a=!0;var l=i&&!a;return{caption:getLabel("js-"+e[0]),icon:l?"i-hidden":"i-vision",visible:!0,execute:function(){var e,t=Control.HandleItem.control,i=[];for(e in n)i.push(e);return"pages"===t.contentType?(new PageTreeRecursiveOperator(t).switchActivity(i,!l),!1):(t.dataSet.execute("tree_set_activity",{element:i,selected_items:n,active:l?0:1}),!1)}}},ContextMenu.itemHandlers.activeObjectItem=function(e){if(!Control.HandleItem)return!1;if(!Control.HandleItem.id)return!1;if(!Control.HandleItem.control.flatMode)return!1;var t,n=Control.HandleItem.control.selectedList,i=!1,a=!1;for(t in n){var l=n[t];l.getValue("is_activated")||l.getValue("is_active")||l.getValue("activated")?i=!0:a=!0}var o=i&&!a;return{caption:getLabel("js-"+e[0]),icon:o?"i-vision":"i-hidden",visible:!0,execute:function(){var e,t=Control.HandleItem.control,i=[];for(e in n)i.push(e);return t.dataSet.execute("tree_set_activity",{element:Control.HandleItem.id,object:i,handle_item:Control.HandleItem,selected_items:n,viewMode:"full",active:o?0:1}),!1}}},ContextMenu.itemHandlers.deleteItem=function(e){if(!Control.HandleItem)return!1;if(!Control.HandleItem.id)return!1;var t=Control.HandleItem.control.selectedList;return!(Object.keys(t).length<1)&&{caption:getLabel("js-"+e[0]),icon:"i-remove",visible:!0,execute:function(){var e=Control.HandleItem.control,t=[],n=e.selectedList;if(n instanceof Array)for(var i=0;i<n.length;i++){var a=n[i];if(a.lockedBy)return alert(getLabel("js-page-is-locked")+"\n"+getLabel("js-steal-lock-question")),ContextMenu.getInstance().terminate(),!1;t.push(a)}if(n instanceof Object)for(var l in n)t.push(l);if("pages"===e.contentType){return new PageTreeRecursiveOperator(e).putToTrash(t,!0),!1}return e.dataSet.execute("tree_delete_element",{element:t,selected_items:n}),!1}}},ContextMenu.itemHandlers.templatesItem=function(e){if(!Control.HandleItem)return!1;if(!Control.HandleItem.id)return!1;if(Control.HandleItem.control.flatMode||Control.HandleItem.control.objectTypesMode)return!1;var t,n=Control.HandleItem.control.selectedList,i=!1,a=!1,l=!1,o=!1;for(t in n){var r=n[t];i&&a||(i=r.langId,a=r.domainId),l&&o&&l!=r.templateId&&(l=!1),l||o||(l=r.templateId,o=!0)}var s={},c=TemplatesDataSet.getInstance().getTemplatesList(a,i),d=function(e){return function(){if(!Control.HandleItem)return!1;var t,i=Control.HandleItem.control,a=[];for(t in n)a.push(t);return i.dataSet.execute("change_template",{element:a,selected_items:n,"template-id":e,templates:1,childs:1,permissions:1,virtuals:1,links:1}),!1}};for(t in c){var u=c[t],p=u.id,h=u.title,f=!1;p&&(l&&l==p&&(f=!0),s[p]={icon:f?"checked":"undefined",caption:h,execute:d(p)})}return{caption:getLabel("js-"+e[0]),icon:"i-amend",visible:!0,execute:function(){return!1},submenu:s}},ContextMenu.itemHandlers.storeGoodsItem=function(){if(!Control.HandleItem)return!1;if(!Control.HandleItem.id)return!1;var e,t,n=Control.HandleItem.control.selectedList,i=0;for(e in n)t=n[e],i++;if(!t)return!1;var a=window.pre_lang+"/admin/eshop/store_view/"+t.id+"/";if(!a)return!1;var l=1!=i;return{title:getLabel("js-view-store-goods"),callback:function(){return window.location=a,!1},disabled:l}},ContextMenu.itemHandlers.guideViewItem=function(){if(!Control.HandleItem)return!1;if(!Control.HandleItem.id)return!1;var e,t,n=Control.HandleItem.control.selectedList,i=0;for(e in n)t=n[e],i++;if(!t)return!1;var a=window.pre_lang+"/admin/data/guide_items/"+t.id+"/";if(!a)return!1;var l=i>1;return{caption:getLabel("js-view-guide-items"),icon:"view",execute:function(){return window.location=a,!1},disabled:l}},ContextMenu.itemHandlers.viewMessage=function(){if(!Control.HandleItem)return!1;if(!Control.HandleItem.id)return!1;var e,t,n=Control.HandleItem.control.selectedList,i=0;for(e in n)t=n[e],i++;if(!t)return!1;var a=window.pre_lang+"/admin/webforms/message/"+t.id+"/",l=i>1;return{caption:getLabel("js-view-message"),icon:"view",execute:function(){return window.location=a,!1},disabled:l}},ContextMenu.getExchangeSourceItem=function(){if(!Control.HandleItem)return!1;if(!Control.HandleItem.id)return!1;if(Control.HandleItem.control.objectTypesMode||Control.HandleItem.control.flatMode)return!1;var e,t,n=Control.HandleItem.control.selectedList,i=0;for(e in n)t=n[e],i++;return!(!t.hasChilds||1!==i)&&t},ContextMenu.itemHandlers.csvExport=function(e){var t=ContextMenu.getExchangeSourceItem();return!!t&&{caption:getLabel("js-csv-export"),icon:e[1],visible:!0,execute:function(){t.exportCallback([t.id])}}},ContextMenu.itemHandlers.csvImport=function(e){var t=ContextMenu.getExchangeSourceItem();return!!t&&{caption:getLabel("js-csv-import"),icon:e[1],visible:!0,execute:function(){t.importCallback(t.id)}}},ContextMenu.itemHandlers.restoreItem=function(e){return!!Control.HandleItem&&(!!Control.HandleItem.id&&(!(Control.HandleItem.control.selectedList.length<1)&&{caption:getLabel("js-trash-restore"),icon:e[1],visible:!0,execute:function(){var e,t=[],n=Control.HandleItem.control.selectedList;for(e in n)t.push(e);return new PageTreeRecursiveOperator(Control).restoreFromTrash(t),!1}}))},ContextMenu.itemHandlers.copyItemOld=function(e){if(!Control.HandleItem)return!1;if(!Control.HandleItem.id)return!1;if(Control.HandleItem.control.flatMode||Control.HandleItem.control.objectTypesMode)return!1;var t,n,i,a=Control.HandleItem.control,l=a.selectedList,o=!1,r=!1;for(t in l)o=(i=l[t]).domainId,r=i.langId;var s=TemplatesDataSet.getInstance(),c=s.getLangsList(),d=s.getDomainsList(),u=function(e,t){return function(){var n,i=[];for(n in l)i.push(n);return a.dataSet.addEventHandler("onBeforeExecute",createConfirm(a.dataSet)),a.dataSet.execute("copyElementToSite",{element:i,handle_item:$.extend(!0,{},Control.HandleItem),selected_items:l,"lang-id":t,"domain-id":e,templates:1,childs:1,permissions:1,virtuals:1,links:1}),!1}},p={};for(t=0;t<d.length;t++){var h=d[t],f=o==h.id,m={};for(n=0;n<c.length;n++){var g=c[n],v=f&&r==g.id;m[g.id]={icon:v?"checked":"undefined",caption:g.nodeValue,execute:u(h.id,g.id)}}p[h.id]={icon:f?"checked":"undefined",caption:h.host,execute:function(){return!1},submenu:m}}return{caption:getLabel("js-"+e[0]),icon:"i-copy-other",visible:!0,execute:function(){return!1},submenu:p}},ContextMenu.itemHandlers.typeRemove=function(){},ContextMenu.itemHandlers.typeEdit=function(){},ContextMenu.allowControlEnable=!0,function(e,t){"use strict";var n,i,a,l=e,o=l.document,r=l.navigator,s=l.setTimeout,c=l.clearTimeout,d=l.setInterval,u=l.clearInterval,p=l.getComputedStyle,h=l.encodeURIComponent,f=l.ActiveXObject,m=l.Error,g=l.Number.parseInt||l.parseInt,v=l.Number.parseFloat||l.parseFloat,b=l.Number.isNaN||l.isNaN,y=l.Date.now,C=l.Object.keys,w=l.Object.defineProperty,L=l.Object.prototype.hasOwnProperty,x=l.Array.prototype.slice,k=function(){var e=function(e){return e};if("function"==typeof l.wrap&&"function"==typeof l.unwrap)try{var t=o.createElement("div"),n=l.unwrap(t);1===t.nodeType&&n&&1===n.nodeType&&(e=l.unwrap)}catch(e){}return e}(),I=function(e){return x.call(e,0)},_=function(){var e,t,n,i,a,l=I(arguments),o=l[0]||{};for(e=1,t=l.length;e<t;e++)if(null!=(n=l[e]))for(i in n)L.call(n,i)&&(o[i],o!==(a=n[i])&&void 0!==a&&(o[i]=a));return o},T=function(e){var t,n,i,a;if("object"!=typeof e||null==e||"number"==typeof e.nodeType)t=e;else if("number"==typeof e.length)for(t=[],n=0,i=e.length;n<i;n++)L.call(e,n)&&(t[n]=T(e[n]));else for(a in t={},e)L.call(e,a)&&(t[a]=T(e[a]));return t},j=function(e,t){for(var n={},i=0,a=t.length;i<a;i++)t[i]in e&&(n[t[i]]=e[t[i]]);return n},E=function(e,t){var n={};for(var i in e)-1===t.indexOf(i)&&(n[i]=e[i]);return n},A=function(e,t){if(e&&1===e.nodeType&&e.ownerDocument&&t&&(1===t.nodeType&&t.ownerDocument&&t.ownerDocument===e.ownerDocument||9===t.nodeType&&!t.ownerDocument&&t===e.ownerDocument))do{if(e===t)return!0;e=e.parentNode}while(e);return!1},N=function(e){var t;return"string"==typeof e&&e&&(t=e.split("#")[0].split("?")[0],t=e.slice(0,e.lastIndexOf("/")+1)),t},S=function(){var e,t,n;if(o.currentScript&&(e=o.currentScript.src))return e;if(1===(t=o.getElementsByTagName("script")).length)return t[0].src||void 0;if("readyState"in t[0])for(n=t.length;n--;)if("interactive"===t[n].readyState&&(e=t[n].src))return e;return"loading"===o.readyState&&(e=t[t.length-1].src)?e:(e=function(){var e,t;try{throw new m}catch(e){t=e}return t&&(e=t.sourceURL||t.fileName||function(e){var t,n;return"string"==typeof e&&e&&((n=e.match(/^(?:|[^:@]*@|.+\)@(?=http[s]?|file)|.+?\s+(?: at |@)(?:[^:\(]+ )*[\(]?)((?:http[s]?|file):\/\/[\/]?.+?\/[^:\)]*?)(?::\d+)(?::\d+)?/))&&n[1]?t=n[1]:(n=e.match(/\)@((?:http[s]?|file):\/\/[\/]?.+?\/[^:\)]*?)(?::\d+)(?::\d+)?/))&&n[1]&&(t=n[1])),t}(t.stack)),e}())?e:void 0},P=null==e.opener&&(!!e.top&&e!=e.top||!!e.parent&&e!=e.parent),M={bridge:null,version:"0.0.0",pluginType:"unknown",disabled:null,outdated:null,sandboxed:null,unavailable:null,degraded:null,deactivated:null,overdue:null,ready:null},D={},B={},H=null,$=0,O=0,F={ready:"Flash communication is established",error:{"flash-disabled":"Flash is disabled or not installed. May also be attempting to run Flash in a sandboxed iframe, which is impossible.","flash-outdated":"Flash is too outdated to support ZeroClipboard","flash-sandboxed":"Attempting to run Flash in a sandboxed iframe, which is impossible","flash-unavailable":"Flash is unable to communicate bidirectionally with JavaScript","flash-degraded":"Flash is unable to preserve data fidelity when communicating with JavaScript","flash-deactivated":"Flash is too outdated for your browser and/or is configured as click-to-activate.\nThis may also mean that the ZeroClipboard SWF object could not be loaded, so please check your `swfPath` configuration and/or network connectivity.\nMay also be attempting to run Flash in a sandboxed iframe, which is impossible.","flash-overdue":"Flash communication was established but NOT within the acceptable time limit","version-mismatch":"ZeroClipboard JS version number does not match ZeroClipboard SWF version number","clipboard-error":"At least one error was thrown while ZeroClipboard was attempting to inject your data into the clipboard","config-mismatch":"ZeroClipboard configuration does not match Flash's reality","swf-not-found":"The ZeroClipboard SWF object could not be loaded, so please check your `swfPath` configuration and/or network connectivity"}},R=["flash-unavailable","flash-degraded","flash-overdue","version-mismatch","config-mismatch","clipboard-error"],V=["flash-disabled","flash-outdated","flash-sandboxed","flash-unavailable","flash-degraded","flash-deactivated","flash-overdue"],Q=new RegExp("^flash-("+V.map(function(e){return e.replace(/^flash-/,"")}).join("|")+")$"),X=new RegExp("^flash-("+V.slice(1).map(function(e){return e.replace(/^flash-/,"")}).join("|")+")$"),z={swfPath:(N(S())||function(){var e,t,n,i=o.getElementsByTagName("script");for(e=i.length;e--;){if(!(n=i[e].src)){t=null;break}if(n=N(n),null==t)t=n;else if(t!==n){t=null;break}}return t||void 0}()||"")+"ZeroClipboard.swf",trustedDomains:e.location.host?[e.location.host]:[],cacheBust:!0,forceEnhancedClipboard:!1,flashLoadTimeout:3e4,autoActivate:!0,bubbleEvents:!0,containerId:"global-zeroclipboard-html-bridge",containerClass:"global-zeroclipboard-container",swfObjectId:"global-zeroclipboard-flash-bridge",hoverClass:"zeroclipboard-is-hover",activeClass:"zeroclipboard-is-active",forceHandCursor:!1,title:null,zIndex:999999999},U=function(e){void 0===e?(!function(e){if(e)for(var t in e)L.call(e,t)&&delete e[t]}(B),H=null):"string"==typeof e&&L.call(B,e)&&delete B[e]},q=function(e){return"string"==typeof e&&e&&/^[A-Za-z][A-Za-z0-9_:\-\.]*$/.test(e)},W=function(e){var t;if("string"==typeof e&&e?(t=e,e={}):"object"==typeof e&&e&&"string"==typeof e.type&&e.type&&(t=e.type),t){t=t.toLowerCase(),!e.target&&(/^(copy|aftercopy|_click)$/.test(t)||"error"===t&&"clipboard-error"===e.name)&&(e.target=a),_(e,{type:t,target:e.target||i||null,relatedTarget:e.relatedTarget||null,currentTarget:M&&M.bridge||null,timeStamp:e.timeStamp||y()||null});var n=F[e.type];return"error"===e.type&&e.name&&n&&(n=n[e.name]),n&&(e.message=n),"ready"===e.type&&_(e,{target:null,version:M.version}),"error"===e.type&&(Q.test(e.name)&&_(e,{target:null,minimumVersion:"11.0.0"}),X.test(e.name)&&_(e,{version:M.version})),"copy"===e.type&&(e.clipboardData={setData:ke.setData,clearData:ke.clearData}),"aftercopy"===e.type&&(e=re(e,H)),e.target&&!e.relatedTarget&&(e.relatedTarget=G(e.target)),Y(e)}},G=function(e){var t=e&&e.getAttribute&&e.getAttribute("data-clipboard-target");return t?o.getElementById(t):null},Y=function(e){if(e&&/^_(?:click|mouse(?:over|out|down|up|move))$/.test(e.type)){var t=e.target,n="_mouseover"===e.type&&e.relatedTarget?e.relatedTarget:void 0,i="_mouseout"===e.type&&e.relatedTarget?e.relatedTarget:void 0,a=ge(t),r=l.screenLeft||l.screenX||0,s=l.screenTop||l.screenY||0,c=o.body.scrollLeft+o.documentElement.scrollLeft,d=o.body.scrollTop+o.documentElement.scrollTop,u=a.left+("number"==typeof e._stageX?e._stageX:0),p=a.top+("number"==typeof e._stageY?e._stageY:0),h=u-c,f=p-d,m=r+h,g=s+f,v="number"==typeof e.movementX?e.movementX:0,b="number"==typeof e.movementY?e.movementY:0;delete e._stageX,delete e._stageY,_(e,{srcElement:t,fromElement:n,toElement:i,screenX:m,screenY:g,pageX:u,pageY:p,clientX:h,clientY:f,x:h,y:f,movementX:v,movementY:b,offsetX:0,offsetY:0,layerX:0,layerY:0})}return e},Z=function(e){var t=e&&"string"==typeof e.type&&e.type||"";return!/^(?:(?:before)?copy|destroy)$/.test(t)},K=function(e,t,n,i){i?s(function(){e.apply(t,n)},0):e.apply(t,n)},J=function(e){if("object"==typeof e&&e&&e.type){var t=Z(e),n=D["*"]||[],i=D[e.type]||[],a=n.concat(i);if(a&&a.length){var o,r,s,c,d;for(o=0,r=a.length;o<r;o++)c=this,"string"==typeof(s=a[o])&&"function"==typeof l[s]&&(s=l[s]),"object"==typeof s&&s&&"function"==typeof s.handleEvent&&(c=s,s=s.handleEvent),"function"==typeof s&&(d=_({},e),K(s,c,[d],t))}return this}},ee=function(e){var t=e.target||i||null,l="swf"===e._source;switch(delete e._source,e.type){case"error":var o="flash-sandboxed"===e.name||function(e){var t=null;return(!1===P||e&&"error"===e.type&&e.name&&-1!==R.indexOf(e.name))&&(t=!1),t}(e);"boolean"==typeof o&&(M.sandboxed=o),-1!==V.indexOf(e.name)?_(M,{disabled:"flash-disabled"===e.name,outdated:"flash-outdated"===e.name,unavailable:"flash-unavailable"===e.name,degraded:"flash-degraded"===e.name,deactivated:"flash-deactivated"===e.name,overdue:"flash-overdue"===e.name,ready:!1}):"version-mismatch"===e.name&&(n=e.swfVersion,_(M,{disabled:!1,outdated:!1,unavailable:!1,degraded:!1,deactivated:!1,overdue:!1,ready:!1})),be();break;case"ready":n=e.swfVersion;var r=!0===M.deactivated;_(M,{disabled:!1,outdated:!1,sandboxed:!1,unavailable:!1,degraded:!1,deactivated:!1,overdue:r,ready:!r}),be();break;case"beforecopy":a=t;break;case"copy":var s,c,d=e.relatedTarget;!B["text/html"]&&!B["text/plain"]&&d&&(c=d.value||d.outerHTML||d.innerHTML)&&(s=d.value||d.textContent||d.innerText)?(e.clipboardData.clearData(),e.clipboardData.setData("text/plain",s),c!==s&&e.clipboardData.setData("text/html",c)):!B["text/plain"]&&e.target&&(s=e.target.getAttribute("data-clipboard-text"))&&(e.clipboardData.clearData(),e.clipboardData.setData("text/plain",s));break;case"aftercopy":te(e),ke.clearData(),t&&t!==pe()&&t.focus&&t.focus();break;case"_mouseover":ke.focus(t),!0===z.bubbleEvents&&l&&(t&&t!==e.relatedTarget&&!A(e.relatedTarget,t)&&ne(_({},e,{type:"mouseenter",bubbles:!1,cancelable:!1})),ne(_({},e,{type:"mouseover"})));break;case"_mouseout":ke.blur(),!0===z.bubbleEvents&&l&&(t&&t!==e.relatedTarget&&!A(e.relatedTarget,t)&&ne(_({},e,{type:"mouseleave",bubbles:!1,cancelable:!1})),ne(_({},e,{type:"mouseout"})));break;case"_mousedown":he(t,z.activeClass),!0===z.bubbleEvents&&l&&ne(_({},e,{type:e.type.slice(1)}));break;case"_mouseup":fe(t,z.activeClass),!0===z.bubbleEvents&&l&&ne(_({},e,{type:e.type.slice(1)}));break;case"_click":a=null,!0===z.bubbleEvents&&l&&ne(_({},e,{type:e.type.slice(1)}));break;case"_mousemove":!0===z.bubbleEvents&&l&&ne(_({},e,{type:e.type.slice(1)}))}if(/^_(?:click|mouse(?:over|out|down|up|move))$/.test(e.type))return!0},te=function(e){if(e.errors&&e.errors.length>0){var t=T(e);_(t,{type:"error",name:"clipboard-error"}),delete t.success,s(function(){ke.emit(t)},0)}},ne=function(e){if(e&&"string"==typeof e.type&&e){var t,n=e.target||null,i=n&&n.ownerDocument||o,a={view:i.defaultView||l,canBubble:!0,cancelable:!0,detail:"click"===e.type?1:0,button:"number"==typeof e.which?e.which-1:"number"==typeof e.button?e.button:i.createEvent?0:1},r=_(a,e);n&&i.createEvent&&n.dispatchEvent&&(r=[r.type,r.canBubble,r.cancelable,r.view,r.detail,r.screenX,r.screenY,r.clientX,r.clientY,r.ctrlKey,r.altKey,r.shiftKey,r.metaKey,r.button,r.relatedTarget],(t=i.createEvent("MouseEvents")).initMouseEvent&&(t.initMouseEvent.apply(t,r),t._source="js",n.dispatchEvent(t)))}},ie=function(e){for(var t=e&&e.parentNode;t&&"OBJECT"===t.nodeName&&t.parentNode;)t=t.parentNode;return t||null},ae=function(){var e,t=M.bridge,n=ie(t);if(!t){var i=ue(l.location.host,z),a="never"===i?"none":"all",r=ce(_({jsVersion:ke.version},z)),s=z.swfPath+se(z.swfPath,z);n=function(){var e=o.createElement("div");return e.id=z.containerId,e.className=z.containerClass,e.style.position="absolute",e.style.left="0px",e.style.top="-9999px",e.style.width="1px",e.style.height="1px",e.style.zIndex=""+we(z.zIndex),e}();var c=o.createElement("div");n.appendChild(c),o.body.appendChild(n);var u=o.createElement("div"),p="activex"===M.pluginType;u.innerHTML='<object id="'+z.swfObjectId+'" name="'+z.swfObjectId+'" width="100%" height="100%" '+(p?'classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000"':'type="application/x-shockwave-flash" data="'+s+'"')+">"+(p?'<param name="movie" value="'+s+'"/>':"")+'<param name="allowScriptAccess" value="'+i+'"/><param name="allowNetworking" value="'+a+'"/><param name="menu" value="false"/><param name="wmode" value="transparent"/><param name="flashvars" value="'+r+'"/><div id="'+z.swfObjectId+'_fallbackContent">&nbsp;</div></object>',t=u.firstChild,u=null,k(t).ZeroClipboard=ke,n.replaceChild(t,c),function(){var e=z.flashLoadTimeout;if("number"==typeof e&&e>=0){var t=Math.min(1e3,e/10),n=z.swfObjectId+"_fallbackContent";O=d(function(){var e=o.getElementById(n);ve(e)&&(be(),M.deactivated=null,ke.emit({type:"error",name:"swf-not-found"}))},t)}}()}return t||((t=o[z.swfObjectId])&&(e=t.length)&&(t=t[e-1]),!t&&n&&(t=n.firstChild)),M.bridge=t||null,t},le=function(){var e=M.bridge;if(e){var t=ie(e);t&&("activex"===M.pluginType&&"readyState"in e?(e.style.display="none",function n(){if(4===e.readyState){for(var i in e)"function"==typeof e[i]&&(e[i]=null);e.parentNode&&e.parentNode.removeChild(e),t.parentNode&&t.parentNode.removeChild(t)}else s(n,10)}()):(e.parentNode&&e.parentNode.removeChild(e),t.parentNode&&t.parentNode.removeChild(t))),be(),M.ready=null,M.bridge=null,M.deactivated=null,n=void 0}},oe=function(e){var t={},n={};if("object"==typeof e&&e){for(var i in e)if(i&&L.call(e,i)&&"string"==typeof e[i]&&e[i])switch(i.toLowerCase()){case"text/plain":case"text":case"air:text":case"flash:text":t.text=e[i],n.text=i;break;case"text/html":case"html":case"air:html":case"flash:html":t.html=e[i],n.html=i;break;case"application/rtf":case"text/rtf":case"rtf":case"richtext":case"air:rtf":case"flash:rtf":t.rtf=e[i],n.rtf=i}return{data:t,formatMap:n}}},re=function(e,t){if("object"!=typeof e||!e||"object"!=typeof t||!t)return e;var n={};for(var i in e)if(L.call(e,i))if("errors"===i){n[i]=e[i]?e[i].slice():[];for(var a=0,l=n[i].length;a<l;a++)n[i][a].format=t[n[i][a].format]}else if("success"!==i&&"data"!==i)n[i]=e[i];else{n[i]={};var o=e[i];for(var r in o)r&&L.call(o,r)&&L.call(t,r)&&(n[i][t[r]]=o[r])}return n},se=function(e,t){return null==t||t&&!0===t.cacheBust?(-1===e.indexOf("?")?"?":"&")+"noCache="+y():""},ce=function(e){var t,n,i,a,o="",r=[];if(e.trustedDomains&&("string"==typeof e.trustedDomains?a=[e.trustedDomains]:"object"==typeof e.trustedDomains&&"length"in e.trustedDomains&&(a=e.trustedDomains)),a&&a.length)for(t=0,n=a.length;t<n;t++)if(L.call(a,t)&&a[t]&&"string"==typeof a[t]){if(!(i=de(a[t])))continue;if("*"===i){r.length=0,r.push(i);break}r.push.apply(r,[i,"//"+i,l.location.protocol+"//"+i])}return r.length&&(o+="trustedOrigins="+h(r.join(","))),!0===e.forceEnhancedClipboard&&(o+=(o?"&":"")+"forceEnhancedClipboard=true"),"string"==typeof e.swfObjectId&&e.swfObjectId&&(o+=(o?"&":"")+"swfObjectId="+h(e.swfObjectId)),"string"==typeof e.jsVersion&&e.jsVersion&&(o+=(o?"&":"")+"jsVersion="+h(e.jsVersion)),o},de=function(e){if(null==e||""===e)return null;if(""===(e=e.replace(/^\s+|\s+$/g,"")))return null;var t=e.indexOf("//"),n=(e=-1===t?e:e.slice(t+2)).indexOf("/");return(e=-1===n?e:-1===t||0===n?null:e.slice(0,n))&&".swf"===e.slice(-4).toLowerCase()?null:e||null},ue=function(e,t){var n=de(t.swfPath);null===n&&(n=e);var i=function(e){var t,n,i,a=[];if("string"==typeof e&&(e=[e]),"object"!=typeof e||!e||"number"!=typeof e.length)return a;for(t=0,n=e.length;t<n;t++)if(L.call(e,t)&&(i=de(e[t]))){if("*"===i){a.length=0,a.push("*");break}-1===a.indexOf(i)&&a.push(i)}return a}(t.trustedDomains),a=i.length;if(a>0){if(1===a&&"*"===i[0])return"always";if(-1!==i.indexOf(e))return 1===a&&e===n?"sameDomain":"always"}return"never"},pe=function(){try{return o.activeElement}catch(e){return null}},he=function(e,t){var n,i,a,l=[];if("string"==typeof t&&t&&(l=t.split(/\s+/)),e&&1===e.nodeType&&l.length>0)if(e.classList)for(n=0,i=l.length;n<i;n++)e.classList.add(l[n]);else if(e.hasOwnProperty("className")){for(a=" "+e.className+" ",n=0,i=l.length;n<i;n++)-1===a.indexOf(" "+l[n]+" ")&&(a+=l[n]+" ");e.className=a.replace(/^\s+|\s+$/g,"")}return e},fe=function(e,t){var n,i,a,l=[];if("string"==typeof t&&t&&(l=t.split(/\s+/)),e&&1===e.nodeType&&l.length>0)if(e.classList&&e.classList.length>0)for(n=0,i=l.length;n<i;n++)e.classList.remove(l[n]);else if(e.className){for(a=(" "+e.className+" ").replace(/[\r\n\t]/g," "),n=0,i=l.length;n<i;n++)a=a.replace(" "+l[n]+" "," ");e.className=a.replace(/^\s+|\s+$/g,"")}return e},me=function(e,t){var n=p(e,null).getPropertyValue(t);return"cursor"!==t||n&&"auto"!==n||"A"!==e.nodeName?n:"pointer"},ge=function(e){var t={left:0,top:0,width:0,height:0};if(e.getBoundingClientRect){var n=e.getBoundingClientRect(),i=l.pageXOffset,a=l.pageYOffset,r=o.documentElement.clientLeft||0,s=o.documentElement.clientTop||0,c=0,d=0;if("relative"===me(o.body,"position")){var u=o.body.getBoundingClientRect(),p=o.documentElement.getBoundingClientRect();c=u.left-p.left||0,d=u.top-p.top||0}t.left=n.left+i-r-c,t.top=n.top+a-s-d,t.width="width"in n?n.width:n.right-n.left,t.height="height"in n?n.height:n.bottom-n.top}return t},ve=function(e){if(!e)return!1;var t=p(e,null),n=v(t.height)>0,i=v(t.width)>0,a=v(t.top)>=0,l=v(t.left)>=0,o=n&&i&&a&&l,r=o?null:ge(e);return"none"!==t.display&&"collapse"!==t.visibility&&(o||!!r&&(n||r.height>0)&&(i||r.width>0)&&(a||r.top>=0)&&(l||r.left>=0))},be=function(){c($),$=0,u(O),O=0},ye=function(){var e;if(i&&(e=ie(M.bridge))){var t=ge(i);_(e.style,{width:t.width+"px",height:t.height+"px",top:t.top+"px",left:t.left+"px",zIndex:""+we(z.zIndex)})}},Ce=function(e){!0===M.ready&&(M.bridge&&"function"==typeof M.bridge.setHandCursor?M.bridge.setHandCursor(e):M.ready=!1)},we=function(e){return/^(?:auto|inherit)$/.test(e)?e:("number"!=typeof e||b(e)?"string"==typeof e&&(t=we(g(e,10))):t=e,"number"==typeof t?t:"auto");var t},Le=function(t){var n,i,a,l=M.sandboxed,o=null;if(t=!0===t,!1===P)o=!1;else{try{i=e.frameElement||null}catch(e){a={name:e.name,message:e.message}}if(i&&1===i.nodeType&&"IFRAME"===i.nodeName)try{o=i.hasAttribute("sandbox")}catch(e){o=null}else{try{n=document.domain||null}catch(e){n=null}(null===n||a&&"SecurityError"===a.name&&/(^|[\s\(\[@])sandbox(es|ed|ing|[\s\.,!\)\]@]|$)/.test(a.message.toLowerCase()))&&(o=!0)}}return M.sandboxed=o,l===o||t||xe(f),o},xe=function(e){var t,n,i=!1,a=!1,l=!1,o="";function s(e){var t=e.match(/[\d]+/g);return t.length=3,t.join(".")}function c(e){var t;e&&(i=!0,e.version&&(o=s(e.version)),!o&&e.description&&(o=s(e.description)),e.filename&&(t=e.filename,l=!!t&&(t=t.toLowerCase())&&(/^(pepflashplayer\.dll|libpepflashplayer\.so|pepperflashplayer\.plugin)$/.test(t)||"chrome.plugin"===t.slice(-13))))}if(r.plugins&&r.plugins.length)c(r.plugins["Shockwave Flash"]),r.plugins["Shockwave Flash 2.0"]&&(i=!0,o="2.0.0.11");else if(r.mimeTypes&&r.mimeTypes.length)c((n=r.mimeTypes["application/x-shockwave-flash"])&&n.enabledPlugin);else if(void 0!==e){a=!0;try{t=new e("ShockwaveFlash.ShockwaveFlash.7"),i=!0,o=s(t.GetVariable("$version"))}catch(n){try{t=new e("ShockwaveFlash.ShockwaveFlash.6"),i=!0,o="6.0.21"}catch(n){try{t=new e("ShockwaveFlash.ShockwaveFlash"),i=!0,o=s(t.GetVariable("$version"))}catch(e){a=!1}}}}M.disabled=!0!==i,M.outdated=o&&v(o)<v("11.0.0"),M.version=o||"0.0.0",M.pluginType=l?"pepper":a?"activex":i?"netscape":"unknown"};xe(f),Le(!0);var ke=function(){if(!(this instanceof ke))return new ke;"function"==typeof ke._createClient&&ke._createClient.apply(this,I(arguments))};w(ke,"version",{value:"2.2.0",writable:!1,configurable:!0,enumerable:!0}),ke.config=function(){return function(e){if("object"==typeof e&&null!==e)for(var t in e)if(L.call(e,t))if(/^(?:forceHandCursor|title|zIndex|bubbleEvents)$/.test(t))z[t]=e[t];else if(null==M.bridge)if("containerId"===t||"swfObjectId"===t){if(!q(e[t]))throw new Error("The specified `"+t+"` value is not valid as an HTML4 Element ID");z[t]=e[t]}else z[t]=e[t];return"string"==typeof e&&e?L.call(z,e)?z[e]:void 0:T(z)}.apply(this,I(arguments))},ke.state=function(){return function(){return Le(),{browser:j(r,["userAgent","platform","appName"]),flash:E(M,["bridge"]),zeroclipboard:{version:ke.version,config:ke.config()}}}.apply(this,I(arguments))},ke.isFlashUnusable=function(){return function(){return!!(M.disabled||M.outdated||M.sandboxed||M.unavailable||M.degraded||M.deactivated)}.apply(this,I(arguments))},ke.on=function(){return function(e,t){var i,a,l,o={};if("string"==typeof e&&e)l=e.toLowerCase().split(/\s+/);else if("object"==typeof e&&e&&void 0===t)for(i in e)L.call(e,i)&&"string"==typeof i&&i&&"function"==typeof e[i]&&ke.on(i,e[i]);if(l&&l.length){for(i=0,a=l.length;i<a;i++)o[e=l[i].replace(/^on/,"")]=!0,D[e]||(D[e]=[]),D[e].push(t);if(o.ready&&M.ready&&ke.emit({type:"ready"}),o.error){for(i=0,a=V.length;i<a;i++)if(!0===M[V[i].replace(/^flash-/,"")]){ke.emit({type:"error",name:V[i]});break}void 0!==n&&ke.version!==n&&ke.emit({type:"error",name:"version-mismatch",jsVersion:ke.version,swfVersion:n})}}return ke}.apply(this,I(arguments))},ke.off=function(){return function(e,t){var n,i,a,l,o;if(0===arguments.length)l=C(D);else if("string"==typeof e&&e)l=e.split(/\s+/);else if("object"==typeof e&&e&&void 0===t)for(n in e)L.call(e,n)&&"string"==typeof n&&n&&"function"==typeof e[n]&&ke.off(n,e[n]);if(l&&l.length)for(n=0,i=l.length;n<i;n++)if(e=l[n].toLowerCase().replace(/^on/,""),(o=D[e])&&o.length)if(t)for(a=o.indexOf(t);-1!==a;)o.splice(a,1),a=o.indexOf(t,a);else o.length=0;return ke}.apply(this,I(arguments))},ke.handlers=function(){return function(e){return"string"==typeof e&&e?T(D[e])||null:T(D)}.apply(this,I(arguments))},ke.emit=function(){return function(e){var t,n,i;if((e=W(e))&&!ee(e))return"ready"===e.type&&!0===M.overdue?ke.emit({type:"error",name:"flash-overdue"}):(t=_({},e),J.call(this,t),"copy"===e.type&&(n=(i=oe(B)).data,H=i.formatMap),n)}.apply(this,I(arguments))},ke.create=function(){return function(){var e=M.sandboxed;if(Le(),"boolean"!=typeof M.ready&&(M.ready=!1),M.sandboxed!==e&&!0===M.sandboxed)M.ready=!1,ke.emit({type:"error",name:"flash-sandboxed"});else if(!ke.isFlashUnusable()&&null===M.bridge){var t=z.flashLoadTimeout;"number"==typeof t&&t>=0&&($=s(function(){"boolean"!=typeof M.deactivated&&(M.deactivated=!0),!0===M.deactivated&&ke.emit({type:"error",name:"flash-deactivated"})},t)),M.overdue=!1,ae()}}.apply(this,I(arguments))},ke.destroy=function(){return function(){ke.clearData(),ke.blur(),ke.emit("destroy"),le(),ke.off()}.apply(this,I(arguments))},ke.setData=function(){return function(e,t){var n;if("object"==typeof e&&e&&void 0===t)n=e,ke.clearData();else{if("string"!=typeof e||!e)return;(n={})[e]=t}for(var i in n)"string"==typeof i&&i&&L.call(n,i)&&"string"==typeof n[i]&&n[i]&&(B[i]=n[i])}.apply(this,I(arguments))},ke.clearData=function(){return U.apply(this,I(arguments))},ke.getData=function(){return function(e){return void 0===e?T(B):"string"==typeof e&&L.call(B,e)?B[e]:void 0}.apply(this,I(arguments))},ke.focus=ke.activate=function(){return function(e){if(e&&1===e.nodeType){i&&(fe(i,z.activeClass),i!==e&&fe(i,z.hoverClass)),i=e,he(e,z.hoverClass);var t=e.getAttribute("title")||z.title;if("string"==typeof t&&t){var n=ie(M.bridge);n&&n.setAttribute("title",t)}var a=!0===z.forceHandCursor||"pointer"===me(e,"cursor");Ce(a),ye()}}.apply(this,I(arguments))},ke.blur=ke.deactivate=function(){return function(){var e=ie(M.bridge);e&&(e.removeAttribute("title"),e.style.left="0px",e.style.top="-9999px",e.style.width="1px",e.style.height="1px"),i&&(fe(i,z.hoverClass),fe(i,z.activeClass),i=null)}.apply(this,I(arguments))},ke.activeElement=function(){return function(){return i||null}.apply(this,I(arguments))};var Ie=0,_e={},Te=0,je={},Ee={};_(z,{autoActivate:!0});var Ae=function(e){if(!e||!e.type)return!1;if(e.client&&e.client!==this)return!1;var t=_e[this.id],n=t&&t.elements,i=!!n&&n.length>0,a=!e.target||i&&-1!==n.indexOf(e.target),l=e.relatedTarget&&i&&-1!==n.indexOf(e.relatedTarget),o=e.client&&e.client===this;return!(!t||!(a||l||o))},Ne=function(e){var t=_e[this.id];if("object"==typeof e&&e&&e.type&&t){var n=Z(e),i=t&&t.handlers["*"]||[],a=t&&t.handlers[e.type]||[],o=i.concat(a);if(o&&o.length){var r,s,c,d,u;for(r=0,s=o.length;r<s;r++)d=this,"string"==typeof(c=o[r])&&"function"==typeof l[c]&&(c=l[c]),"object"==typeof c&&c&&"function"==typeof c.handleEvent&&(d=c,c=c.handleEvent),"function"==typeof c&&(u=_({},e),K(c,d,[u],n))}}},Se=function(e){return"string"==typeof e&&(e=[]),"number"!=typeof e.length?[e]:e},Pe=function(e){if(e&&1===e.nodeType){var t=function(e){(e||(e=l.event))&&("js"!==e._source&&(e.stopImmediatePropagation(),e.preventDefault()),delete e._source)},n=function(n){(n||(n=l.event))&&(t(n),ke.focus(e))};e.addEventListener("mouseover",n,!1),e.addEventListener("mouseout",t,!1),e.addEventListener("mouseenter",t,!1),e.addEventListener("mouseleave",t,!1),e.addEventListener("mousemove",t,!1),Ee[e.zcClippingId]={mouseover:n,mouseout:t,mouseenter:t,mouseleave:t,mousemove:t}}},Me=function(e){if(e&&1===e.nodeType){var t=Ee[e.zcClippingId];if("object"==typeof t&&t){for(var n,i,a=["move","leave","enter","out","over"],l=0,o=a.length;l<o;l++)"function"==typeof(i=t[n="mouse"+a[l]])&&e.removeEventListener(n,i,!1);delete Ee[e.zcClippingId]}}};ke._createClient=function(){(function(e){var t=this;t.id=""+Ie++,_e[t.id]={instance:t,elements:[],handlers:{}},e&&t.clip(e),ke.on("*",function(e){return t.emit(e)}),ke.on("destroy",function(){t.destroy()}),ke.create()}).apply(this,I(arguments))},ke.prototype.on=function(){return function(e,t){var i,a,l,o={},r=_e[this.id],s=r&&r.handlers;if(!r)throw new Error("Attempted to add new listener(s) to a destroyed ZeroClipboard client instance");if("string"==typeof e&&e)l=e.toLowerCase().split(/\s+/);else if("object"==typeof e&&e&&void 0===t)for(i in e)L.call(e,i)&&"string"==typeof i&&i&&"function"==typeof e[i]&&this.on(i,e[i]);if(l&&l.length){for(i=0,a=l.length;i<a;i++)o[e=l[i].replace(/^on/,"")]=!0,s[e]||(s[e]=[]),s[e].push(t);if(o.ready&&M.ready&&this.emit({type:"ready",client:this}),o.error){for(i=0,a=V.length;i<a;i++)if(M[V[i].replace(/^flash-/,"")]){this.emit({type:"error",name:V[i],client:this});break}void 0!==n&&ke.version!==n&&this.emit({type:"error",name:"version-mismatch",jsVersion:ke.version,swfVersion:n})}}return this}.apply(this,I(arguments))},ke.prototype.off=function(){return function(e,t){var n,i,a,l,o,r=_e[this.id],s=r&&r.handlers;if(!s)return this;if(0===arguments.length)l=C(s);else if("string"==typeof e&&e)l=e.split(/\s+/);else if("object"==typeof e&&e&&void 0===t)for(n in e)L.call(e,n)&&"string"==typeof n&&n&&"function"==typeof e[n]&&this.off(n,e[n]);if(l&&l.length)for(n=0,i=l.length;n<i;n++)if((o=s[e=l[n].toLowerCase().replace(/^on/,"")])&&o.length)if(t)for(a=o.indexOf(t);-1!==a;)o.splice(a,1),a=o.indexOf(t,a);else o.length=0;return this}.apply(this,I(arguments))},ke.prototype.handlers=function(){return function(e){var t=null,n=_e[this.id]&&_e[this.id].handlers;return n&&(t="string"==typeof e&&e?n[e]?n[e].slice(0):[]:T(n)),t}.apply(this,I(arguments))},ke.prototype.emit=function(){return function(e){if(Ae.call(this,e)){"object"==typeof e&&e&&"string"==typeof e.type&&e.type&&(e=_({},e));var t=_({},W(e),{client:this});Ne.call(this,t)}return this}.apply(this,I(arguments))},ke.prototype.clip=function(){return function(e){if(!_e[this.id])throw new Error("Attempted to clip element(s) to a destroyed ZeroClipboard client instance");e=Se(e);for(var t=0;t<e.length;t++)if(L.call(e,t)&&e[t]&&1===e[t].nodeType){e[t].zcClippingId?-1===je[e[t].zcClippingId].indexOf(this.id)&&je[e[t].zcClippingId].push(this.id):(e[t].zcClippingId="zcClippingId_"+Te++,je[e[t].zcClippingId]=[this.id],!0===z.autoActivate&&Pe(e[t]));var n=_e[this.id]&&_e[this.id].elements;-1===n.indexOf(e[t])&&n.push(e[t])}return this}.apply(this,I(arguments))},ke.prototype.unclip=function(){return function(e){var t=_e[this.id];if(!t)return this;for(var n,i=t.elements,a=(e=void 0===e?i.slice(0):Se(e)).length;a--;)if(L.call(e,a)&&e[a]&&1===e[a].nodeType){for(n=0;-1!==(n=i.indexOf(e[a],n));)i.splice(n,1);var l=je[e[a].zcClippingId];if(l){for(n=0;-1!==(n=l.indexOf(this.id,n));)l.splice(n,1);0===l.length&&(!0===z.autoActivate&&Me(e[a]),delete e[a].zcClippingId)}}return this}.apply(this,I(arguments))},ke.prototype.elements=function(){return function(){var e=_e[this.id];return e&&e.elements?e.elements.slice(0):[]}.apply(this,I(arguments))},ke.prototype.destroy=function(){return function(){_e[this.id]&&(this.unclip(),this.off(),delete _e[this.id])}.apply(this,I(arguments))},ke.prototype.setText=function(e){if(!_e[this.id])throw new Error("Attempted to set pending clipboard data from a destroyed ZeroClipboard client instance");return ke.setData("text/plain",e),this},ke.prototype.setHtml=function(e){if(!_e[this.id])throw new Error("Attempted to set pending clipboard data from a destroyed ZeroClipboard client instance");return ke.setData("text/html",e),this},ke.prototype.setRichText=function(e){if(!_e[this.id])throw new Error("Attempted to set pending clipboard data from a destroyed ZeroClipboard client instance");return ke.setData("application/rtf",e),this},ke.prototype.setData=function(){if(!_e[this.id])throw new Error("Attempted to set pending clipboard data from a destroyed ZeroClipboard client instance");return ke.setData.apply(this,I(arguments)),this},ke.prototype.clearData=function(){if(!_e[this.id])throw new Error("Attempted to clear pending clipboard data from a destroyed ZeroClipboard client instance");return ke.clearData.apply(this,I(arguments)),this},ke.prototype.getData=function(){if(!_e[this.id])throw new Error("Attempted to get pending clipboard data from a destroyed ZeroClipboard client instance");return ke.getData.apply(this,I(arguments))},"function"==typeof define&&define.amd?define(function(){return ke}):"object"==typeof module&&module&&"object"==typeof module.exports&&module.exports?module.exports=ke:e.ZeroClipboard=ke}(function(){return this||window}());var TTCustomizer={buttons:{},menu:[],extendDefault:!1,extend:function(e){return _.keys(e).length>0&&(_.extend(this.buttons,e),!0)}};