var rus2eng={"А":"A","Б":"B","В":"V","Г":"G","Д":"D","Е":"E","Ё":"YO","Ж":"ZH","З":"Z","И":"I","Й":"J","К":"K","Л":"L","М":"M","Н":"N","О":"O","П":"P","Р":"R","С":"S","Т":"T","У":"U","Ф":"F","Х":"H","Ц":"C","Ч":"CH","Ш":"SH","Щ":"SHCH","Ъ":"","Ы":"Y","Ь":"","Э":"EH","Ю":"YU","Я":"YA","а":"a","б":"b","в":"v","г":"g","д":"d","е":"e","ё":"yo","ж":"zh","з":"z","и":"i","й":"j","к":"k","л":"l","м":"m","н":"n","о":"o","п":"p","р":"r","с":"s","т":"t","у":"u","ф":"f","х":"h","ц":"c","ч":"ch","ш":"sh","щ":"shch","ъ":"","ы":"y","ь":"","э":"eh","ю":"yu","я":"ya"},eng2rus={"А":"A",YA:"Я"},rus2engRE=/(?:[АБВГДЕЁЖЗИЙКЛМНОПРСТУФХЦЧШЩЪЫЬЭЮЯабвгдеёжзийклмнопрстуфхцчшщъыьэюя])/g,eng2rusRE=/(?:YA|A)/g;function trCallbackRu(e){return rus2eng[e]}function trCallbackEn(e){return eng2rus[e]}function transliterateRu(e){return e.replace(rus2engRE,trCallbackRu)}function transliterateEn(e){return e}function base64encode(e){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),n=new Array,o=0;for(o=0;o<e.length;o++){var l=e.charCodeAt(o);l>127&&(l="АБВГДЕЖЗИЙКЛМНОПРСТУФХЦЧШЩЪЫЬЭЮЯабвгдежзийклмнопрстуфхцчшщъыьэюя".indexOf(e.charAt(o))+163)<163||n.push(l)}var i=new Array,a=n.length-n.length%3,s=0;for(o=0;o<a;o+=3)s=(n[o]<<16)+(n[o+1]<<8)+n[o+2],i.push(t[s>>18&63]+t[s>>12&63]+t[s>>6&63]+t[63&s]);switch(n.length-a){case 1:s=n[a]<<4,i.push(t[s>>6&63]+t[63&s]+"==");break;case 2:s=(n[a]<<10)+(n[a+1]<<2),i.push(t[s>>12&63]+t[s>>6&63]+t[63&s]+"=")}return i.join("")}var parsedCookies=null;function setCookie(e,t,n){var o="";if(n){var l=new Date;l.setTime(l.getTime()+n),o="; expires="+l.toGMTString()}null===t&&(o="; expires=Thu, 01-Jan-1970 00:00:01 GMT"),document.cookie=e+"="+t+o+"; path=/",parsedCookies&&(null!=t?parsedCookies[e]=t:delete parsedCookies[e])}function getCookie(e,t){if(void 0===t&&(t=!1),!parsedCookies||t){parsedCookies={};for(var n=document.cookie.split(";"),o=0;o<n.length;o++){var l=n[o].split("=");parsedCookies[l[0].replace(/^\s/,"")]=l[1]}}return parsedCookies[e]||null}function getArgumentList(){for(var e=new Object,t=location.search.substring(1).split("&"),n=0;n<t.length;n++){var o=t[n].indexOf("=");if(-1!==o){var l=t[n].substring(0,o),i=t[n].substring(o+1);e[l]=unescape(i)}}return e}function getMaxFileSize(){var e=new XMLHttpRequest;if(e.open("GET","/udata/data/getAllowedMaxFileSize",!1),e.send(),200!=e.status)return 83886080;var t=1024*/<!\[CDATA\[(.*)]]>/.exec(e.responseText)[1]*1024;return"number"==typeof t?t:83886080}function getCsrfToken(){return window.csrfProtection&&window.csrfProtection.getToken?csrfProtection.getToken():parent&&parent.csrfProtection&&parent.csrfProtection.getToken?parent.csrfProtection.getToken():parent&&parent.uAdmin&&parent.uAdmin.csrf?parent.uAdmin.csrf:""}function relationControl(e,t,n,o){var l=this,a=e,s=t||e,r=!0,d=null,u=null,c=null,p=null,m=null,h=null,f=null,g=null,y=null,v=0,b=0,C=o||"/admin/data/guide_items_all/";this.addObjectToGuide=function(e,t,n){var o="object"==typeof u?u.value:e,l=parseInt(a)>0?parseInt(a):parseInt(t),i={url:"",data:null},r={id:0,name:""},c=document.getElementById("relationButton"+s),p=null,h=null;"string"!=typeof o||o.length<=0||l<=0||(i.url="/admin/udata://data/addObjectToGuide/.json",i.data={param0:o,param1:l},c.setAttribute("disabled",""),jQuery.ajax({url:i.url,dataType:"json",data:i.data,type:"post",success:function(e){if(void 0!==e.data&&void 0!==e.data.object){if(r.id=parseInt(e.data.object.id),isNaN(r.id)||r.id<=0)return;r.name=e.data.object.name,"function"==typeof n&&n(r.name,r.id),c.removeAttribute("disabled"),m&&(p=jQuery("option:selected",d),h=jQuery("option:last",d),p=p.detach(),jQuery(h).replaceWith(p))}},error:function(){c.removeAttribute("disabled")}}))},this.rescan=function(){(u=document.getElementById("relationInput"+s))&&(u.onkeyup=function(e){13==(e?e.keyCode:event.keyCode)&&c?l.addItem():l.doSearch()})},this.getValue=function(){for(var e=jQuery("option:selected",jQuery(d)),t={},n=0;n<e.length;n++)t[e[n].value]=jQuery(e[n]).text();return t},this.loadItems=function(e){jQuery.ajax({url:C+a+".xml?limit&search[]="+encodeURIComponent(e),type:"get",complete:function(e,t){l.updateItems(e)}})},this.loadItemsAll=function(){jQuery.ajax({url:C+a+".xml?allow-empty",type:"get",complete:function(e,t){l.updateItemsAll(e)}})},this.updateItemsAll=function(e){if(e.responseXML.getElementsByTagName("empty").length){if(u){u.onkeyup=function(e){switch(e?e.keyCode:event.keyCode){case 38:g.length&&(y>0||null==y)&&k(null===y?g.length-1:y-1);break;case 40:g.length&&(y<g.length-1||null==y)&&k(null===y?0:y+1);break;case 13:w(),x();break;case 27:x();break;default:clearTimeout(f),f=setTimeout(function(){l.doSearchAjax()},500)}},u.onblur=function(){h&&(v<parseInt(h.style.left)||v>parseInt(h.style.left)+parseInt(h.offsetWidth)||b<parseInt(h.style.top)||b>parseInt(h.style.top)+parseInt(h.offsetHeight))&&x()};var t=e.responseXML.getElementsByTagName("empty")[0].getAttribute("total");m||((m=new Option(" ","")).innerHTML=getLabel("js-relation-total")+t+". "+getLabel("js-relation-use_search"),d.insertBefore(m,d.firstChild))}}else{var o=e.responseXML.getElementsByTagName("object"),i=[],a=0;for(a=0;a<d.options.length;a++)d.options[a].selected&&i.push(d.options[a].value);for(jQuery("option",d).each(function(){this.selected&&0!==this.value.length||jQuery(this).remove()}),n&&$(d).prepend("<option value=''> </option>"),a=0;a<o.length;a++){var s=o[a].getAttribute("id"),r=!1;for(var c in i)if(i[c]==s){r=!0,delete i[c];break}if(!r){var p=o[a].getAttribute("name"),C=new Option(p,s);C.innerHTML=p,d.appendChild(C)}}if(jQuery.browser.msie){var j=d.style.display;d.style.display="none",d.style.display=j}}},this.updateItems=function(e){if(y=null,(g=e.responseXML.getElementsByTagName("object")).length){var t=null;if(!h){(h=document.createElement("div")).className="relationAutosuggest";var n=jQuery(u).offset();h.style.position="absolute",h.style.zIndex=1050,h.style.width=u.clientWidth+"px",h.style.top=n.top+u.offsetHeight+"px",h.style.left=n.left+"px",t=document.createElement("ul"),h.appendChild(t),document.body.appendChild(h)}for(h.style.display="",jQuery(document).on("mousemove",j),t=h.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(i=0;i<g.length;i++){var o=g[i].getAttribute("name"),l=document.createElement("li");l.innerHTML=o,l.onmouseover=function(){k(this.suggestIndex)},l.onmouseout=function(){this.className=""},l.onclick=function(){w(),x()},l.suggestIndex=i,t.appendChild(l)}}};var j=function(e){return e?(v=e.pageX,b=e.pageY):(v=event.clientX+document.body.scrollLeft,b=event.clientY+document.body.scrollTop),!0};this.addItem=function(e,t){(e&&e.length||u&&u.value.length)&&(N(),L(),d.multiple||!p||e||t?((p=new Option(e||u.value,t||u.value)).innerHTML=(t?"":"&rarr;&nbsp;&nbsp;")+(e||u.value),d.options.length?d.insertBefore(p,d.firstChild):d.appendChild(p)):(p.innerHTML=(t?"":"&rarr;&nbsp;&nbsp;")+u.value,p.value=t||u.value,d.selectedIndex=0),u.value="",p.selected=!0,jQuery.browser.msie&&setTimeout(function(){p.selected=!1,p.selected=!0},20))};var k=function(e){if("none"!=h.style.display){var t=h.firstChild,n=t.childNodes.item(y);n&&(n.className=""),t.childNodes.item(e).className="active",y=e}},w=function(){if(h&&"none"!=h.style.display&&null!==y){for(var e=g[y].getAttribute("name"),t=g[y].getAttribute("id"),n=!1,o=0;o<d.options.length;o++)if(d.options[o].value==t){n=!0,d.options[o].selected=!0;break}n||l.addItem(e,t)}else u.value.length&&c&&l.addItem()},x=function(){h&&"none"!=h.style.display&&(h.style.display="none",jQuery(document).off("mousemove",j))};this.doSearch=function(){var e=u.value.toLowerCase();if(N(),""!=e)for(var t=0;t<d.options.length;t++){var n=d.options[t].text,o=n.replace(/^.\s\s/,"");if(n.substring(0,e.length).toLowerCase()===e||o.substring(0,e.length).toLowerCase()===e){if(!d.multiple)return void(d.selectedIndex=t);"optgroup"!=d.firstChild.nodeName.toLowerCase()&&(E(),searchGroup=d.firstChild,itemsGroup=d.lastChild);var l=d.options[t];if(l.parentNode==searchGroup)continue;if(l.oldPrevSibling=l.previousSibling,itemsGroup.removeChild(l),searchGroup.appendChild(l),5==searchGroup.childNodes.length)return}}else d.multiple&&L()},this.doSearchAjax=function(){u.value&&this.loadItems(u.value)};var E=function(){var e=document.createElement("optgroup");e.label="Search results";var t=document.createElement("optgroup");for(t.label="------------------------------------------------";d.firstChild;){var n=d.firstChild;d.removeChild(n),t.appendChild(n)}d.appendChild(e),d.appendChild(t)},L=function(){if(d.firstChild&&"optgroup"==d.firstChild.nodeName.toLowerCase()){d.removeChild(d.firstChild);for(var e=d.firstChild;e.firstChild;){var t=e.firstChild;e.removeChild(t),d.appendChild(t)}d.removeChild(e)}},N=function(){if(d.firstChild&&"optgroup"==d.firstChild.nodeName.toLowerCase())for(var e=d.firstChild,t=d.lastChild;e.firstChild;){var n=e.firstChild;e.removeChild(n),void 0===n.oldPrevSibling&&null!=n.oldPrevSibling||(n.oldPrevSibling&&n.oldPrevSibling.nextSibling?t.insertBefore(n,n.oldPrevSibling.nextSibling):null===n.oldPrevSibling?t.insertBefore(n,t.firstChild):t.appendChild(n),n.oldPrevSibling=void 0)}};!function(){if(d=document.getElementById("relationSelect"+s),u=document.getElementById("relationInput"+s),c=document.getElementById("relationButton"+s),d){jQuery("option",d).each(function(){this.selected||0===this.value.length||(r=!1)}),c&&(c.onclick=function(){l.addObjectToGuide(null,null,function(e,t){l.addItem(e,t)})}),u&&(u.onkeyup=function(e){if(13==(e?e.keyCode:event.keyCode)&&c)return l.addItem(),!1;l.doSearch()},u.onkeydown=function(e){if(13==(e?e.keyCode:event.keyCode))return!1});var e=function(){r&&(l.loadItemsAll(),r=!1)};d.onmouseover=e,d.onfocus=e;for(var t=0;t<d.childNodes.length;t++)1!=d.childNodes[t].nodeType&&(d.removeChild(d.childNodes[t]),t=0);n&&0==jQuery("option[value='']",d).length&&jQuery(d).prepend("<option value=''></option>")}else alert("Select input for field #"+s+" not found")}()}function symlinkControl(e,t,n,o,l,i){l=l instanceof Array?l:[l];var a=this,s=e,r=n instanceof Array?n:[n],d=r?"&hierarchy_types="+r.join("-"):"",u=l instanceof Array?"&hierarchy_types="+l.join(","):"",c=t||null,p=null,m=null,h=null,f=null,g=null,y=null,v=null,b=0,C=0;let j=0;o||(o={});var k=o.iconsPath||"/styles/skins/modern/design/img/tree/",w=o.fadeColorStart||[255,0,0],x=o.fadeColorEnd||[255,255,255],E=o.inputName||"symlinkInput"+s,L=o.noImages||!1,N=o.treeURL||"/styles/common/js/tree.html",Q=o.rootId,I=o.popupTitle||getLabel("js-cms-eip-symlink-choose-element"),T=void 0===o.showSuggestType||o.showSuggestType,_=void 0===o.cutSuggestNames||o.cutSuggestNames,A=parseInt(o.suggestDivWidth),S={},B=i?"&callback=symlinkControlsList."+s+".onlyOne":"";this.loadItems=function(e){jQuery.ajax({url:"/admin/content/load_tree_node.xml?limit&domain_id[]="+(window.domain_id?window.domain_id:"1")+d+(window.lang_id?"&lang_id="+window.lang_id:"")+(Q?"&rel="+Q:"")+"&search-all-text[]="+encodeURIComponent(e),type:"get",complete:function(e,t){a.updateItems(e)}})},this.onlyOne=function(e,t,n,o){jQuery.closePopupLayer("Sitetree"),confirm(getLabel("js-island-change-symlink-warning"))&&(jQuery("a.button",f).trigger("click"),a.addItem(e,t,o,n),jQuery('form input[name="save-mode"]:first').trigger("click"))},this.updateItems=function(e){var t,n=jQuery("html.u-eip").length>0;if(v=null,(t=e.responseXML.getElementsByTagName("page")).length){y=t;for(var o=[],l=0;l<y.length;l++)S[y[l].getAttribute("id")]||(o[o.length]=y[l]);y=o;var i=null;if(!g){(g=document.createElement("div")).className="symlinkAutosuggest";var a=jQuery(m).offset();g.style.position="absolute",g.style.zIndex=1100,g.style.width=m.clientWidth+"px",isNaN(A)||(g.style.width=A+"px"),g.style.top=a.top+m.offsetHeight+"px",g.style.left=a.left+"px",n&&(g.style.backgroundColor="white",g.style.border="1px solid #ccc"),i=document.createElement("ul"),g.appendChild(i),document.body.appendChild(g)}for(M(),jQuery(document).on("mousemove",G),i=g.firstChild;i.firstChild;)i.removeChild(i.firstChild);for(l=0;l<y.length;l++)if(!S[y[l].getAttribute("id")]){var s=V(y[l].getElementsByTagName("name")[0]),r=V(y[l].getElementsByTagName("basetype")[0]),d=y[l].getAttribute("link"),u=document.createElement("li"),c=document.createElement("span"),p=document.createElement("a");u.title=s,_&&s.length>20&&(s=s.substr(0,20)+"..."),d.length>55&&(d=d.substr(0,55)+"..."),u.appendChild(document.createTextNode(s)),T&&u.appendChild(c),c.appendChild(document.createTextNode(" ("+r+")")),n?(c.style.display="block",u.className="symlink-item-delete",u.style.padding="3px"):(u.appendChild(document.createElement("br")),u.appendChild(p),p.appendChild(document.createTextNode(d)),p.href=d,p.target="_blank"),u.onmouseover=function(){O(this.suggestIndex)},u.onclick=function(){H(),R()},u.suggestIndex=l,i.appendChild(u)}}},this.doSearch=function(){var e=m.value;a.loadItems(e)};var O=function(e){var t=jQuery("html.u-eip").length>0;if("none"!=g.style.display){var n=g.firstChild,o=n.childNodes.item(v);o&&(t?o.style.backgroundColor="":o.className=""),t?n.childNodes.item(e).style.backgroundColor="#ceeaf6":n.childNodes.item(e).className="active",v=e}},H=function(){if(g&&"none"!=g.style.display&&null!==v){var e=y[v].getAttribute("id"),t=V(y[v].getElementsByTagName("name")[0]),n=y[v].getAttribute("link"),o=y[v].getElementsByTagName("basetype")[0],l="",i=(l=o.getAttribute("module"))?l:"",s=(l=o.getAttribute("method"))?l:"";a.addItem(e,t,[i,s],n)}};this.appendStub=function(){let e=document.createElement("input");e.type="hidden",e.name=E,e.name=E.replace(/\[]$/,""),a.stub=e,a.container.parentNode.insertBefore(e,p)},this.delStub=function(){a.stub&&a.stub.remove()},this.addItem=function(e,t,n,o){if(this.delPlaceHolder(),void 0===S[e]){var l=jQuery("html.u-eip").length>0,i=document.createElement("li"),a=document.createElement("span"),s=document.createElement("a"),r=document.createElement("a"),d=document.createElement("input"),u=this;if(d.type="hidden",d.name=E,d.value=e,r.input=d,s.href=o,j++,u.delStub(),L)r.appendChild(document.createTextNode("[x]"));else{var c=document.createElement("img");c.src=k+"symlink_delete.png",c.alt="delete",l&&(c.className="symlink-item-delete"),r.appendChild(c)}if(r.href="javascript:void(0);",l?r.style.marginRight="5px":r.className="button",r.onclick=function(){this.input.parentNode.removeChild(this.input),f.removeChild(this.parentNode),u.addPlaceHolder(),delete S[e],0===--j&&u.appendStub()},a.dataset.basetype=n[0]+" "+n[1],l&&(a.style.marginLeft="5px"),a.appendChild(document.createTextNode(t)),s.appendChild(document.createTextNode(o)),!L){var m=document.createElement("img");m.src=k+"ico_"+n[0]+"_"+n[1]+".png",i.appendChild(m)}i.appendChild(a);a.style.maxWidth=f.parentNode.offsetWidth-70+"px",i.appendChild(r),l?delete s:i.appendChild(s),f.appendChild(i),p.parentNode.insertBefore(d,p),i.style.backgroundColor=makeHexRgb(w),i.startColor=w,i.endColor=x,i.pname=t,i.fade=P,setTimeout(function(){i.fade()},2e3),S[e]=!0,jQuery("#eip_page").length&&(frameElement.height=jQuery("#eip_page").height()>500?500:jQuery("#eip_page").height())}},this.delPlaceHolder=function(){jQuery(".eip-placeholder",f).length>=1&&jQuery(".eip-placeholder",f).remove()},this.addPlaceHolder=function(e){var t=document.createElement("li"),n=e||getLabel("js-cms-eip-symlink-no-elements");t.className="eip-placeholder",t.appendChild(document.createTextNode(n)),jQuery("li",f).length<1&&f.appendChild(t)};var P=function(){if(null==this.fadeColor&&(this.fadeColor=[],this.fadeColor[0]=this.startColor[0],this.fadeColor[1]=this.startColor[1],this.fadeColor[2]=this.startColor[2]),Math.round(this.fadeColor[0]+this.fadeColor[1]+this.fadeColor[2])!=Math.round(this.endColor[0]+this.endColor[1]+this.endColor[2])){this.fadeColor[0]+=(this.endColor[0]-this.startColor[0])/50,this.fadeColor[1]+=(this.endColor[1]-this.startColor[1])/50,this.fadeColor[2]+=(this.endColor[2]-this.startColor[2])/50,this.style.backgroundColor=makeHexRgb(this.fadeColor);var e=this;setTimeout(function(){e.fade()},20)}},M=function(){if(g){var e=jQuery(m).offset();g.style.width=m.clientWidth,g.style.top=e.top+m.offsetHeight,g.style.left=e.left,g.style.display=""}},R=function(){g&&"none"!=g.style.display&&(g.style.display="none",jQuery(document).off("mousemove",G))},G=function(e){return e?(b=e.pageX,C=e.pageY):(b=event.clientX+document.body.scrollLeft,C=event.clientY+document.body.scrollTop),!0},V=function(e){return e.firstChild&&3==e.firstChild.nodeType?e.firstChild.nodeValue:e.nodeValue};!function(){if(window.symlinkControlsList||(window.symlinkControlsList={}),window.symlinkControlsList[s]=a,p=document.getElementById("symlinkInput"+s)){f=document.createElement("ul"),p.appendChild(f);var e=document.createElement("div");p.appendChild(e),(m=document.createElement("input")).setAttribute("placeholder",getLabel("js-cms-eip-symlink-search")),e.className="pick-element",e.appendChild(m),m.style.width=e.parentNode.offsetWidth-46+"px",m.style.minWidth=e.parentNode.offsetWidth-46+"px",h=L?document.createElement("input"):document.createElement("img"),e.appendChild(h),m.type="text",L?(h.type="button",h.value="╘"):(h.src="/styles/skins/modern/design/img/tree.png",h.height="18"),h.className="treeButton",h.onclick=function(){jQuery.openPopupLayer({name:"Sitetree",title:I,width:620,height:335,url:N+"?id="+s+(c?"&module="+c:"")+u+(window.lang_id?"&lang_id="+window.lang_id:"")+(Q?"&root_id="+Q:"")+B})},f.className="pageslist",m.onkeypress=function(e){if(13==(e?e.keyCode:window.event.keyCode))return!1},m.onkeyup=function(e){switch(e?e.keyCode:window.event.keyCode){case 38:y.length&&(v>0||null==v)&&O(null===v?y.length-1:v-1);break;case 40:y.length&&(v<y.length-1||null==v)&&O(null===v?0:v+1);break;case 13:return H(),R(),!1;case 27:R();break;default:a.doSearch()}},m.onblur=function(){g&&(b<parseInt(g.style.left)||b>parseInt(g.style.left)+parseInt(g.offsetWidth)||C<parseInt(g.style.top)||C>parseInt(g.style.top)+parseInt(g.offsetHeight))&&R()}}else alert("Symlink container #"+s+" not found")}()}var hex=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function makeHexRgb(e){for(var t="",n=0;n<3;n++)t=t+hex[Math.floor(e[n]/16)]+hex[Math.floor(e[n]%16)];return"#"+t}function fileControl(name,options){var _self=this,container=document.getElementById("fileControlContainer_"+name),select=null,inputName=options.inputName||name,imagesOnly=options.imagesOnly||!1,videosOnly=options.videosOnly||!1,folderHash=options.folderHash,fileHash=options.fileHash,lang=options.lang||"ru",fm=options.fm||"flash",cwd=".",defaultCwd=".",loaded=!1,construct=function(){select=document.createElement("select"),container.appendChild(select),select.onmouseover=function(){loaded||loadListing()},window["fileControlSelect_"+name]=select,select.id="fileControlSelect_"+name,select.name=inputName,select.control=_self,select.className="fileControlSelect",-1==navigator.userAgent.toLowerCase().indexOf("firefox")&&-1==navigator.userAgent.toLowerCase().indexOf("chrome")||(select.addEventListener("drop",doDrop,!1),select.addEventListener("dragexit",dragExit,!1),select.addEventListener("dragover",dragExit,!1),jQuery(select).addClass("dragNDrop"));var option=document.createElement("option");option.innerHTML="",option.value="",option.selected=!0,select.appendChild(option);var img=document.createElement("img");img.src="/styles/common/images/browse_folder.png";var a=document.createElement("a");a.href="javascript:void(0);",a.onclick=function(){var functionName="show"+fm+"FileBrowser";eval(functionName+"(select.id, defaultCwd, imagesOnly, videosOnly, folderHash, fileHash, lang)")},a.appendChild(img),container.appendChild(a)};function doDrop(e){dragExit(e);var t=e.dataTransfer.files[0];jQuery.ajax({url:"/admin/filemanager/uploadfile/?filename="+t.name+"&csrf="+uAdmin.csrf+"&folder="+base64encode(cwd.substr(1))+(imagesOnly?"&showOnlyImages=1":"")+(videosOnly?"&showOnlyVideos=1":""),type:"POST",processData:!1,data:t,complete:function(e,t){_self.updateItem(e)}})}function dragExit(e){e.stopPropagation(),e.preventDefault()}var showflashFileBrowser=function(e,t,n,o,l,i,a){var s,r="id="+e;r=r+"&file="+(cwd.replace(/^\.\//,"/")+(-1!=(s=select.value.lastIndexOf("/"))?select.value.substr(s):select.value)),t&&(r=r+"&folder="+t),n&&(r+="&image=1"),o&&(r+="&video=1"),jQuery.openPopupLayer({name:"Filemanager",title:getLabel("js-file-manager"),width:1200,height:600,url:"/styles/common/other/filebrowser/umifilebrowser.html?"+r})},showelfinderFileBrowser=function(e,t,n,o,l,i,a){var s,r="id="+e;r=r+"&file="+(cwd.replace(/^\.\//,"/")+(-1!=(s=select.value.lastIndexOf("/"))?select.value.substr(s):select.value)),t&&(r=r+"&folder="+t),n&&(r+="&image=1"),o&&(r+="&video=1"),void 0!==l&&(r=r+"&folder_hash="+l),void 0!==i&&(r=r+"&file_hash="+i),a&&(r=r+"&lang="+a),$.openPopupLayer({name:"Filemanager",title:getLabel("js-file-manager"),width:1200,height:600,url:"/styles/common/other/elfinder/umifilebrowser.html?"+r});var d=jQuery("div#popupLayer_Filemanager div.popupBody");d.length||(d=jQuery(window.parent.document.getElementById("popupLayer_Filemanager")).find("div.popupBody"));var u='<div id="watermark_wrapper"><label for="add_watermark">';u+=getLabel("js-water-mark"),u+='</label><input type="checkbox" name="add_watermark" id="add_watermark"/>',u+='<label for="remember_last_folder">',u+=getLabel("js-remember-last-dir"),u+='</label><input type="checkbox" name="remember_last_folder" id="remember_last_folder"',getCookie("remember_last_folder",!0)&&(u+='checked="checked"'),u+="/></div>",d.append(u)};this.clearItems=function(){for(;select.options.length;)select.options[0].parentNode.removeChild(select.options[0]);var e=document.createElement("option");e.innerHTML="",e.value=cwd+"/",e.selected=!0,select.appendChild(e),loaded=!1};var loadListing=function(){loaded=!0,jQuery.ajax({url:"/admin/filemanager/getfilelist/?folder="+base64encode(cwd.substr(1))+(imagesOnly?"&showOnlyImages=1":"")+(videosOnly?"&showOnlyVideos=1":""),type:"get",complete:function(e,t){_self.updateItems(e)}})};this.updateItems=function(e){if(e.responseXML.getElementsByTagName("empty").length){var t=document.createElement("option");t.value="",t.disabled="disable",t.appendChild(document.createTextNode(getLabel("js-files-use_search"))),select.appendChild(t)}else{var n=e.responseXML.getElementsByTagName("file");select.options.length||this.add(null,!0);for(var o=0;o<n.length;o++)this.add(n[o].getAttribute("name"));if(jQuery.browser.msie){var l=select.style.display;select.style.display="none",select.style.display=l}}},this.setFolder=function(e,t){0!==e.indexOf("./")&&(e="."+e);var n=new RegExp("[/]+$","g");e=(e+"").replace(n,""),cwd!=e&&(cwd=e,this.clearItems()),null!=t&&t&&(defaultCwd=e)},this.add=function(e,t){if(!e||e.length){e||(e=""),-1!=e.lastIndexOf("/")&&(this.setFolder(e.substr(0,e.lastIndexOf("/"))),e=e.substr(e.lastIndexOf("/")+1));for(var n=0;n<select.options.length;n++)if(select.options[n].innerHTML==e)return void(t&&(select.options[n].selected=t));var o=document.createElement("option");o.innerHTML=e,o.value=(0!=cwd.indexOf("./")?".":"")+cwd+"/"+e,null!=t&&t&&(o.selected=!0),select.appendChild(o)}},this.updateItem=function(e){var t=e.responseXML.getElementsByTagName("file");select.options.length||this.add(null,!0);for(var n=0;n<t.length;n++)this.add(t[n].getAttribute("name"),!0);if(jQuery.browser.msie){var o=select.style.display;select.style.display="none",select.style.display=o}},construct()}var askSupport=function(){var e='<h3 id="license_message">'+getLabel("js-now-we-will-check-your-domain-key")+"</h3>";e+='<div id="ask_support_form">',e+='<div id="loading"></div>',e+='<span id="show_info" style="">'+getLabel("js-info")+"</span>",e+='<div id="info_support">',e+='<div class="left"><h4>'+getLabel("js-when-creating-request-remember")+"</h4>",e+="<ul>",e+="<li>"+getLabel("js-i-hate-multiple-questions")+"</li>",e+="<li>"+getLabel("js-i-want-postpone")+"</li>",e+="<li>"+getLabel("js-i-hate-doubles")+"</li>",e+="<li>"+getLabel("js-no-demo")+"</li>",e+="</ul></div>",e+='<div class="right"><h4>'+getLabel("js-i-decline-support")+"</h4>",e+="<ul>",e+="<li>"+getLabel("js-if-somebody-do-something-perverted")+"</li>",e+="<li>"+getLabel("js-if-you-have-not-read-manual")+"</li>",e+="<li>"+getLabel("js-if-mysql-has-gone-away")+"</li>",e+="</ul></div>",e+='<div class="clear"></div>',e+="</div>",e+='<div id="form_body"></div>',e+="</div>",e+='<div class="eip_buttons">',e+='<input id="checkLicenseKey" type="button" value="'+getLabel("js-send")+'" class="ok" style="display:none;"/>',e+='<input id="stop_btn" type="button" value="'+getLabel("js-close")+'" class="stop" />',e+='<div style="clear: both;"></div>',e+="</div>",openDialog({stdButtons:!1,title:getLabel("js-ask-support"),text:e,width:637,OKCallback:function(){}}),$("#stop_btn").one("click",function(){closeDialog()}),jQuery(document).ajaxStart(function(){jQuery("#loading").html('<img src="/styles/skins/modern/design/img/ajax_loader.gif" alt="Loading..." />')}),jQuery.ajax({type:"POST",url:"/udata/system/checkLicenseKey/",dataType:"xml",success:function(e){jQuery("#form_body").html(""),jQuery("#loading").html("");var t="",n=e.getElementsByTagName("error");n.length&&(t=n[0].firstChild.nodeValue);var o=e.getElementsByTagName("notes");o.length&&(t+=o[0].firstChild.nodeValue),jQuery("#license_message").html(t);var l=e.getElementsByTagName("form");if(l.length){var i=e.getElementsByTagName("user");jQuery("#form_body").html('<form id="support_request" action="" method="post">'+l[0].firstChild.nodeValue+"</form>"),jQuery('input[name="data[fio_frm]"]').val(i[0].getAttribute("name")),jQuery("#email_frm").val(i[0].getAttribute("email"));var a=jQuery('input[name="data[cms_domain]"]').parent();jQuery('input[name="data[cms_domain]"]').remove();var s=document.createElement("select");s.name="data[cms_domain]";for(var r=e.getElementsByTagName("domains"),d=0;d<r[0].getElementsByTagName("domain").length;d++){var u=r[0].getElementsByTagName("domain");u=u[d];var c=document.createElement("option");c.value=u.getAttribute("host"),u.getAttribute("host")==i[0].getAttribute("domain")&&(c.selected=!0),c.appendChild(document.createTextNode(u.getAttribute("host"))),s.appendChild(c)}a.append(s),jQuery("#attach_file").parent("div").remove(),jQuery(".button_1").remove(),jQuery("#checkLicenseKey").attr("style",""),jQuery("#show_info").attr("style","display:inline-block;"),jQuery("#show_info").on("click",function(){jQuery("#info_support").toggle("slow")}),jQuery.centerPopupLayer(),jQuery("#checkLicenseKey").on("click",function(){return jQuery.ajax({type:"POST",url:"/udata/system/sendSupportRequest/",data:jQuery("#support_request").serializeArray(),success:function(e){jQuery("#loading").html("");var n=e.getElementsByTagName("error");n.length&&(t='<span style="color:red;">'+n[0].firstChild.nodeValue+"</span>");var o=e.getElementsByTagName("success");o.length&&(t=o[0].firstChild.nodeValue,jQuery("#ask_support_form").remove(),jQuery("#checkLicenseKey").remove()),jQuery("#license_message").html(t),jQuery.centerPopupLayer()}}),!1})}},error:function(e,t,n){window.session&&window.session.stopAutoActions()}})};function colorControl(e,t){var n={colorBox:'<span class="color-box"><i></i></span>',container:e,assets:{js:"/styles/common/js/jquery/colorpicker/js/bootstrap-colorpicker.js",jsMin:"/styles/common/js/jquery/colorpicker/js/bootstrap-colorpicker.min.js",css:"/styles/common/js/jquery/colorpicker/css/bootstrap-colorpicker.min.css"}},o={options:{defaultValues:{component:".color-box",customClass:"color-picker"},user:(t=t||{}).pickerOptions||{}}};function l(e,t){jQuery('<script src="'+e+'" type="text/javascript" charset="utf-8"><\/script>').appendTo("head"),jQuery('<link href="'+t+'" rel="stylesheet" charset="utf-8"><\/script>').appendTo("head")}jQuery.extend(o.options.user,o.options.defaultValues),jQuery.extend(t,n),jQuery(t.colorBox).insertAfter(jQuery("input",e)),"function"!=typeof jQuery.colorpicker&&(t.debug?l(t.assets.js,t.assets.css):l(t.assets.jsMin,t.assets.css)),jQuery(t.container).colorpicker(o.options.user)}