(function(e){var t,i,n=this,o=Math.round,r=0,a=1,s=2,d=3,u=4,l=5,c=6,p={},h={_isAMomentObject:null,_i:null,_f:null,_l:null,_strict:null,_isUTC:null,_offset:null,_pf:null,_lang:null},m="undefined"!=typeof module&&module.exports&&"undefined"!=typeof require,f=/^\/?Date\((\-?\d+)/i,y=/(\-)?(?:(\d*)\.)?(\d+)\:(\d+)(?:\:(\d+)\.?(\d{3})?)?/,g=/^(-)?P(?:(?:([0-9,.]*)Y)?(?:([0-9,.]*)M)?(?:([0-9,.]*)D)?(?:T(?:([0-9,.]*)H)?(?:([0-9,.]*)M)?(?:([0-9,.]*)S)?)?|([0-9,.]*)W)$/,v=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|S{1,4}|X|zz?|ZZ?|.)/g,_=/(\[[^\[]*\])|(\\)?(LT|LL?L?L?|l{1,4})/g,b=/\d\d?/,w=/\d{1,3}/,j=/\d{1,4}/,E=/[+\-]?\d{1,6}/,k=/\d+/,A=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,I=/Z|[\+\-]\d\d:?\d\d/gi,T=/T/i,Q=/[\+\-]?\d+(\.\d{1,3})?/,C=/\d/,M=/\d\d/,x=/\d{3}/,S=/\d{4}/,N=/[+-]?\d{6}/,L=/[+-]?\d+/,D=/^\s*(?:[+-]\d{6}|\d{4})-(?:(\d\d-\d\d)|(W\d\d$)|(W\d\d-\d)|(\d\d\d))((T| )(\d\d(:\d\d(:\d\d(\.\d+)?)?)?)?([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,q=[["YYYYYY-MM-DD",/[+-]\d{6}-\d{2}-\d{2}/],["YYYY-MM-DD",/\d{4}-\d{2}-\d{2}/],["GGGG-[W]WW-E",/\d{4}-W\d{2}-\d/],["GGGG-[W]WW",/\d{4}-W\d{2}/],["YYYY-DDD",/\d{4}-\d{3}/]],B=[["HH:mm:ss.SSSS",/(T| )\d\d:\d\d:\d\d\.\d{1,3}/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],Y=/([\+\-]|\d\d)/gi,O="Date|Hours|Minutes|Seconds|Milliseconds".split("|"),P={Milliseconds:1,Seconds:1e3,Minutes:6e4,Hours:36e5,Days:864e5,Months:2592e6,Years:31536e6},W={ms:"millisecond",s:"second",m:"minute",h:"hour",d:"day",D:"date",w:"week",W:"isoWeek",M:"month",y:"year",DDD:"dayOfYear",e:"weekday",E:"isoWeekday",gg:"weekYear",GG:"isoWeekYear"},H={dayofyear:"dayOfYear",isoweekday:"isoWeekday",isoweek:"isoWeek",weekyear:"weekYear",isoweekyear:"isoWeekYear"},G={},z="DDD w W M D d".split(" "),R="M D H h m s w W".split(" "),U={M:function(){return this.month()+1},MMM:function(e){return this.lang().monthsShort(this,e)},MMMM:function(e){return this.lang().months(this,e)},D:function(){return this.date()},DDD:function(){return this.dayOfYear()},d:function(){return this.day()},dd:function(e){return this.lang().weekdaysMin(this,e)},ddd:function(e){return this.lang().weekdaysShort(this,e)},dddd:function(e){return this.lang().weekdays(this,e)},w:function(){return this.week()},W:function(){return this.isoWeek()},YY:function(){return te(this.year()%100,2)},YYYY:function(){return te(this.year(),4)},YYYYY:function(){return te(this.year(),5)},YYYYYY:function(){var e=this.year();return(e>=0?"+":"-")+te(Math.abs(e),6)},gg:function(){return te(this.weekYear()%100,2)},gggg:function(){return te(this.weekYear(),4)},ggggg:function(){return te(this.weekYear(),5)},GG:function(){return te(this.isoWeekYear()%100,2)},GGGG:function(){return te(this.isoWeekYear(),4)},GGGGG:function(){return te(this.isoWeekYear(),5)},e:function(){return this.weekday()},E:function(){return this.isoWeekday()},a:function(){return this.lang().meridiem(this.hours(),this.minutes(),!0)},A:function(){return this.lang().meridiem(this.hours(),this.minutes(),!1)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes()},s:function(){return this.seconds()},S:function(){return de(this.milliseconds()/100)},SS:function(){return te(de(this.milliseconds()/10),2)},SSS:function(){return te(this.milliseconds(),3)},SSSS:function(){return te(this.milliseconds(),3)},Z:function(){var e=-this.zone(),t="+";return e<0&&(e=-e,t="-"),t+te(de(e/60),2)+":"+te(de(e)%60,2)},ZZ:function(){var e=-this.zone(),t="+";return e<0&&(e=-e,t="-"),t+te(de(e/60),2)+te(de(e)%60,2)},z:function(){return this.zoneAbbr()},zz:function(){return this.zoneName()},X:function(){return this.unix()},Q:function(){return this.quarter()}},F=["months","monthsShort","weekdays","weekdaysShort","weekdaysMin"];function $(e,t){return function(i){return te(e.call(this,i),t)}}function V(e,t){return function(i){return this.lang().ordinal(e.call(this,i),t)}}for(;z.length;)i=z.pop(),U[i+"o"]=V(U[i],i);for(;R.length;)i=R.pop(),U[i+i]=$(U[i],2);function X(){}function K(e){pe(e),J(this,e)}function Z(e){var t=ae(e),i=t.year||0,n=t.month||0,o=t.week||0,r=t.day||0,a=t.hour||0,s=t.minute||0,d=t.second||0,u=t.millisecond||0;this._milliseconds=+u+1e3*d+6e4*s+36e5*a,this._days=+r+7*o,this._months=+n+12*i,this._data={},this._bubble()}function J(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return t.hasOwnProperty("toString")&&(e.toString=t.toString),t.hasOwnProperty("valueOf")&&(e.valueOf=t.valueOf),e}function ee(e){return e<0?Math.ceil(e):Math.floor(e)}function te(e,t,i){for(var n=""+Math.abs(e),o=e>=0;n.length<t;)n="0"+n;return(o?i?"+":"":"-")+n}function ie(e,i,n,o){var r,a,s=i._milliseconds,d=i._days,u=i._months;s&&e._d.setTime(+e._d+s*n),(d||u)&&(r=e.minute(),a=e.hour()),d&&e.date(e.date()+d*n),u&&e.month(e.month()+u*n),s&&!o&&t.updateOffset(e),(d||u)&&(e.minute(r),e.hour(a))}function ne(e){return"[object Array]"===Object.prototype.toString.call(e)}function oe(e,t,i){var n,o=Math.min(e.length,t.length),r=Math.abs(e.length-t.length),a=0;for(n=0;n<o;n++)(i&&e[n]!==t[n]||!i&&de(e[n])!==de(t[n]))&&a++;return a+r}function re(e){if(e){var t=e.toLowerCase().replace(/(.)s$/,"$1");e=W[e]||H[t]||t}return e}function ae(e){var t,i,n={};for(i in e)e.hasOwnProperty(i)&&(t=re(i))&&(n[t]=e[i]);return n}function se(i){var n,o;if(0===i.indexOf("week"))n=7,o="day";else{if(0!==i.indexOf("month"))return;n=12,o="month"}t[i]=function(r,a){var s,d,u=t.fn._lang[i],l=[];if("number"==typeof r&&(a=r,r=e),d=function(e){var i=t().utc().set(o,e);return u.call(t.fn._lang,i,r||"")},null!=a)return d(a);for(s=0;s<n;s++)l.push(d(s));return l}}function de(e){var t=+e,i=0;return 0!==t&&isFinite(t)&&(i=t>=0?Math.floor(t):Math.ceil(t)),i}function ue(e,t){return new Date(Date.UTC(e,t+1,0)).getUTCDate()}function le(e){return ce(e)?366:365}function ce(e){return e%4==0&&e%100!=0||e%400==0}function pe(e){var t;e._a&&-2===e._pf.overflow&&(t=e._a[a]<0||e._a[a]>11?a:e._a[s]<1||e._a[s]>ue(e._a[r],e._a[a])?s:e._a[d]<0||e._a[d]>23?d:e._a[u]<0||e._a[u]>59?u:e._a[l]<0||e._a[l]>59?l:e._a[c]<0||e._a[c]>999?c:-1,e._pf._overflowDayOfYear&&(t<r||t>s)&&(t=s),e._pf.overflow=t)}function he(e){return null==e._isValid&&(e._isValid=!isNaN(e._d.getTime())&&e._pf.overflow<0&&!e._pf.empty&&!e._pf.invalidMonth&&!e._pf.nullInput&&!e._pf.invalidFormat&&!e._pf.userInvalidated,e._strict&&(e._isValid=e._isValid&&0===e._pf.charsLeftOver&&0===e._pf.unusedTokens.length)),e._isValid}function me(e){return e?e.toLowerCase().replace("_","-"):e}function fe(e,i){return i._isUTC?t(e).zone(i._offset||0):t(e).local()}function ye(e){var i,n,o,r,a=0,s=function(e){if(!p[e]&&m)try{require("./lang/"+e)}catch(e){}return p[e]};if(!e)return t.fn._lang;if(!ne(e)){if(n=s(e))return n;e=[e]}for(;a<e.length;){for(i=(r=me(e[a]).split("-")).length,o=(o=me(e[a+1]))?o.split("-"):null;i>0;){if(n=s(r.slice(0,i).join("-")))return n;if(o&&o.length>=i&&oe(r,o,!0)>=i-1)break;i--}a++}return t.fn._lang}function ge(e,t){return e.isValid()?(t=ve(t,e.lang()),G[t]||(G[t]=function(e){var t,i,n,o=e.match(v);for(t=0,i=o.length;t<i;t++)U[o[t]]?o[t]=U[o[t]]:o[t]=(n=o[t]).match(/\[[\s\S]/)?n.replace(/^\[|\]$/g,""):n.replace(/\\/g,"");return function(n){var r="";for(t=0;t<i;t++)r+=o[t]instanceof Function?o[t].call(n,e):o[t];return r}}(t)),G[t](e)):e.lang().invalidDate()}function ve(e,t){var i=5;function n(e){return t.longDateFormat(e)||e}for(_.lastIndex=0;i>=0&&_.test(e);)e=e.replace(_,n),_.lastIndex=0,i-=1;return e}function _e(e,t){var i=t._strict;switch(e){case"DDDD":return x;case"YYYY":case"GGGG":case"gggg":return i?S:j;case"Y":case"G":case"g":return L;case"YYYYYY":case"YYYYY":case"GGGGG":case"ggggg":return i?N:E;case"S":if(i)return C;case"SS":if(i)return M;case"SSS":if(i)return x;case"DDD":return w;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":return A;case"a":case"A":return ye(t._l)._meridiemParse;case"X":return Q;case"Z":case"ZZ":return I;case"T":return T;case"SSSS":return k;case"MM":case"DD":case"YY":case"GG":case"gg":case"HH":case"hh":case"mm":case"ss":case"ww":case"WW":return i?M:b;case"M":case"D":case"d":case"H":case"h":case"m":case"s":case"w":case"W":case"e":case"E":return b;default:return new RegExp(function(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}(e.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(e,t,i,n,o){return t||i||n||o})))}}function be(e){var t=(e=e||"").match(I)||[],i=((t[t.length-1]||[])+"").match(Y)||["-",0,0],n=60*i[1]+de(i[2]);return"+"===i[0]?-n:n}function we(e,t,i){var n,o=i._a;switch(e){case"M":case"MM":null!=t&&(o[a]=de(t)-1);break;case"MMM":case"MMMM":null!=(n=ye(i._l).monthsParse(t))?o[a]=n:i._pf.invalidMonth=t;break;case"D":case"DD":null!=t&&(o[s]=de(t));break;case"DDD":case"DDDD":null!=t&&(i._dayOfYear=de(t));break;case"YY":o[r]=de(t)+(de(t)>68?1900:2e3);break;case"YYYY":case"YYYYY":case"YYYYYY":o[r]=de(t);break;case"a":case"A":i._isPm=ye(i._l).isPM(t);break;case"H":case"HH":case"h":case"hh":o[d]=de(t);break;case"m":case"mm":o[u]=de(t);break;case"s":case"ss":o[l]=de(t);break;case"S":case"SS":case"SSS":case"SSSS":o[c]=de(1e3*("0."+t));break;case"X":i._d=new Date(1e3*parseFloat(t));break;case"Z":case"ZZ":i._useUTC=!0,i._tzm=be(t);break;case"w":case"ww":case"W":case"WW":case"d":case"dd":case"ddd":case"dddd":case"e":case"E":e=e.substr(0,1);case"gg":case"gggg":case"GG":case"GGGG":case"GGGGG":e=e.substr(0,2),t&&(i._w=i._w||{},i._w[e]=t)}}function je(e){var i,n,o,l,c,p,h,m,f,y,g=[];if(!e._d){for(o=function(e){var t=new Date;return e._useUTC?[t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate()]:[t.getFullYear(),t.getMonth(),t.getDate()]}(e),e._w&&null==e._a[s]&&null==e._a[a]&&(c=function(i){var n=parseInt(i,10);return i?i.length<3?n>68?1900+n:2e3+n:n:null==e._a[r]?t().weekYear():e._a[r]},null!=(p=e._w).GG||null!=p.W||null!=p.E?h=Qe(c(p.GG),p.W||1,p.E,4,1):(m=ye(e._l),f=null!=p.d?Ie(p.d,m):null!=p.e?parseInt(p.e,10)+m._week.dow:0,y=parseInt(p.w,10)||1,null!=p.d&&f<m._week.dow&&y++,h=Qe(c(p.gg),y,f,m._week.doy,m._week.dow)),e._a[r]=h.year,e._dayOfYear=h.dayOfYear),e._dayOfYear&&(l=null==e._a[r]?o[r]:e._a[r],e._dayOfYear>le(l)&&(e._pf._overflowDayOfYear=!0),n=Ae(l,0,e._dayOfYear),e._a[a]=n.getUTCMonth(),e._a[s]=n.getUTCDate()),i=0;i<3&&null==e._a[i];++i)e._a[i]=g[i]=o[i];for(;i<7;i++)e._a[i]=g[i]=null==e._a[i]?2===i?1:0:e._a[i];g[d]+=de((e._tzm||0)/60),g[u]+=de((e._tzm||0)%60),e._d=(e._useUTC?Ae:function(e,t,i,n,o,r,a){var s=new Date(e,t,i,n,o,r,a);e<1970&&s.setFullYear(e);return s}).apply(null,g)}}function Ee(e){e._a=[],e._pf.empty=!0;var t,i,n,o,r,a=ye(e._l),s=""+e._i,u=s.length,l=0;for(n=ve(e._f,a).match(v)||[],t=0;t<n.length;t++)o=n[t],(i=(s.match(_e(o,e))||[])[0])&&((r=s.substr(0,s.indexOf(i))).length>0&&e._pf.unusedInput.push(r),s=s.slice(s.indexOf(i)+i.length),l+=i.length),U[o]?(i?e._pf.empty=!1:e._pf.unusedTokens.push(o),we(o,i,e)):e._strict&&!i&&e._pf.unusedTokens.push(o);e._pf.charsLeftOver=u-l,s.length>0&&e._pf.unusedInput.push(s),e._isPm&&e._a[d]<12&&(e._a[d]+=12),!1===e._isPm&&12===e._a[d]&&(e._a[d]=0),je(e),pe(e)}function ke(t){var i=t._i,n=f.exec(i);i===e?t._d=new Date:n?t._d=new Date(+n[1]):"string"==typeof i?function(e){var t,i,n=e._i,o=D.exec(n);if(o){for(e._pf.iso=!0,t=0,i=q.length;t<i;t++)if(q[t][1].exec(n)){e._f=q[t][0]+(o[6]||" ");break}for(t=0,i=B.length;t<i;t++)if(B[t][1].exec(n)){e._f+=B[t][0];break}n.match(I)&&(e._f+="Z"),Ee(e)}else e._d=new Date(n)}(t):ne(i)?(t._a=i.slice(0),je(t)):function(e){return"[object Date]"===Object.prototype.toString.call(e)||e instanceof Date}(i)?t._d=new Date(+i):"object"==typeof i?function(e){var t;e._d||(t=ae(e._i),e._a=[t.year,t.month,t.day,t.hour,t.minute,t.second,t.millisecond],je(e))}(t):t._d=new Date(i)}function Ae(e){var t=new Date(Date.UTC.apply(null,arguments));return e<1970&&t.setUTCFullYear(e),t}function Ie(e,t){if("string"==typeof e)if(isNaN(e)){if("number"!=typeof(e=t.weekdaysParse(e)))return null}else e=parseInt(e,10);return e}function Te(e,i,n){var o,r=n-i,a=n-e.day();return a>r&&(a-=7),a<r-7&&(a+=7),o=t(e).add("d",a),{week:Math.ceil(o.dayOfYear()/7),year:o.year()}}function Qe(e,t,i,n,o){var r,a=Ae(e,0,1).getUTCDay();return{year:(r=7*(t-1)+((i=null!=i?i:o)-o)+(o-a+(a>n?7:0)-(a<o?7:0))+1)>0?e:e-1,dayOfYear:r>0?r:le(e-1)+r}}function Ce(e){var i=e._i,n=e._f;return null===i?t.invalid({nullInput:!0}):("string"==typeof i&&(e._i=i=ye().preparse(i)),t.isMoment(i)?(e=function(e){var t,i={};for(t in e)e.hasOwnProperty(t)&&h.hasOwnProperty(t)&&(i[t]=e[t]);return i}(i))._d=new Date(+i._d):n?ne(n)?function(e){var t,i,n,o,r;if(0===e._f.length)return e._pf.invalidFormat=!0,void(e._d=new Date(NaN));for(o=0;o<e._f.length;o++)r=0,(t=J({},e))._pf={empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1},t._f=e._f[o],Ee(t),he(t)&&(r+=t._pf.charsLeftOver,r+=10*t._pf.unusedTokens.length,t._pf.score=r,(null==n||r<n)&&(n=r,i=t));J(e,i||t)}(e):Ee(e):ke(e),new K(e))}for(U.DDDD=$(U.DDD,3),J(X.prototype,{set:function(e){var t,i;for(i in e)"function"==typeof(t=e[i])?this[i]=t:this["_"+i]=t},_months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),months:function(e){return this._months[e.month()]},_monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),monthsShort:function(e){return this._monthsShort[e.month()]},monthsParse:function(e){var i,n,o;for(this._monthsParse||(this._monthsParse=[]),i=0;i<12;i++)if(this._monthsParse[i]||(n=t.utc([2e3,i]),o="^"+this.months(n,"")+"|^"+this.monthsShort(n,""),this._monthsParse[i]=new RegExp(o.replace(".",""),"i")),this._monthsParse[i].test(e))return i},_weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdays:function(e){return this._weekdays[e.day()]},_weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysShort:function(e){return this._weekdaysShort[e.day()]},_weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),weekdaysMin:function(e){return this._weekdaysMin[e.day()]},weekdaysParse:function(e){var i,n,o;for(this._weekdaysParse||(this._weekdaysParse=[]),i=0;i<7;i++)if(this._weekdaysParse[i]||(n=t([2e3,1]).day(i),o="^"+this.weekdays(n,"")+"|^"+this.weekdaysShort(n,"")+"|^"+this.weekdaysMin(n,""),this._weekdaysParse[i]=new RegExp(o.replace(".",""),"i")),this._weekdaysParse[i].test(e))return i},_longDateFormat:{LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D YYYY",LLL:"MMMM D YYYY LT",LLLL:"dddd, MMMM D YYYY LT"},longDateFormat:function(e){var t=this._longDateFormat[e];return!t&&this._longDateFormat[e.toUpperCase()]&&(t=this._longDateFormat[e.toUpperCase()].replace(/MMMM|MM|DD|dddd/g,function(e){return e.slice(1)}),this._longDateFormat[e]=t),t},isPM:function(e){return"p"===(e+"").toLowerCase().charAt(0)},_meridiemParse:/[ap]\.?m?\.?/i,meridiem:function(e,t,i){return e>11?i?"pm":"PM":i?"am":"AM"},_calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},calendar:function(e,t){var i=this._calendar[e];return"function"==typeof i?i.apply(t):i},_relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},relativeTime:function(e,t,i,n){var o=this._relativeTime[i];return"function"==typeof o?o(e,t,i,n):o.replace(/%d/i,e)},pastFuture:function(e,t){var i=this._relativeTime[e>0?"future":"past"];return"function"==typeof i?i(t):i.replace(/%s/i,t)},ordinal:function(e){return this._ordinal.replace("%d",e)},_ordinal:"%d",preparse:function(e){return e},postformat:function(e){return e},week:function(e){return Te(e,this._week.dow,this._week.doy).week},_week:{dow:0,doy:6},_invalidDate:"Invalid date",invalidDate:function(){return this._invalidDate}}),(t=function(t,i,n,o){var r;return"boolean"==typeof n&&(o=n,n=e),(r={})._isAMomentObject=!0,r._i=t,r._f=i,r._l=n,r._strict=o,r._isUTC=!1,r._pf={empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1},Ce(r)}).utc=function(t,i,n,o){var r;return"boolean"==typeof n&&(o=n,n=e),(r={})._isAMomentObject=!0,r._useUTC=!0,r._isUTC=!0,r._l=n,r._i=t,r._f=i,r._strict=o,r._pf={empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1},Ce(r).utc()},t.unix=function(e){return t(1e3*e)},t.duration=function(e,i){var n,o,r,a=e,p=null;return t.isDuration(e)?a={ms:e._milliseconds,d:e._days,M:e._months}:"number"==typeof e?(a={},i?a[i]=e:a.milliseconds=e):(p=y.exec(e))?(n="-"===p[1]?-1:1,a={y:0,d:de(p[s])*n,h:de(p[d])*n,m:de(p[u])*n,s:de(p[l])*n,ms:de(p[c])*n}):(p=g.exec(e))&&(n="-"===p[1]?-1:1,a={y:(r=function(e){var t=e&&parseFloat(e.replace(",","."));return(isNaN(t)?0:t)*n})(p[2]),M:r(p[3]),d:r(p[4]),h:r(p[5]),m:r(p[6]),s:r(p[7]),w:r(p[8])}),o=new Z(a),t.isDuration(e)&&e.hasOwnProperty("_lang")&&(o._lang=e._lang),o},t.version="2.5.1",t.defaultFormat="YYYY-MM-DDTHH:mm:ssZ",t.updateOffset=function(){},t.lang=function(e,i){return e?(i?function(e,t){t.abbr=e,p[e]||(p[e]=new X),p[e].set(t),p[e]}(me(e),i):null===i?(!function(e){delete p[e]}(e),e="en"):p[e]||ye(e),(t.duration.fn._lang=t.fn._lang=ye(e))._abbr):t.fn._lang._abbr},t.langData=function(e){return e&&e._lang&&e._lang._abbr&&(e=e._lang._abbr),ye(e)},t.isMoment=function(e){return e instanceof K||null!=e&&e.hasOwnProperty("_isAMomentObject")},t.isDuration=function(e){return e instanceof Z},i=F.length-1;i>=0;--i)se(F[i]);function Me(e,i){t.fn[e]=t.fn[e+"s"]=function(e){var n=this._isUTC?"UTC":"";return null!=e?(this._d["set"+n+i](e),t.updateOffset(this),this):this._d["get"+n+i]()}}for(t.normalizeUnits=function(e){return re(e)},t.invalid=function(e){var i=t.utc(NaN);return null!=e?J(i._pf,e):i._pf.userInvalidated=!0,i},t.parseZone=function(e){return t(e).parseZone()},J(t.fn=K.prototype,{clone:function(){return t(this)},valueOf:function(){return+this._d+6e4*(this._offset||0)},unix:function(){return Math.floor(+this/1e3)},toString:function(){return this.clone().lang("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},toDate:function(){return this._offset?new Date(+this):this._d},toISOString:function(){var e=t(this).utc();return 0<e.year()&&e.year()<=9999?ge(e,"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]"):ge(e,"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]")},toArray:function(){var e=this;return[e.year(),e.month(),e.date(),e.hours(),e.minutes(),e.seconds(),e.milliseconds()]},isValid:function(){return he(this)},isDSTShifted:function(){return!!this._a&&(this.isValid()&&oe(this._a,(this._isUTC?t.utc(this._a):t(this._a)).toArray())>0)},parsingFlags:function(){return J({},this._pf)},invalidAt:function(){return this._pf.overflow},utc:function(){return this.zone(0)},local:function(){return this.zone(0),this._isUTC=!1,this},format:function(e){var i=ge(this,e||t.defaultFormat);return this.lang().postformat(i)},add:function(e,i){return ie(this,"string"==typeof e?t.duration(+i,e):t.duration(e,i),1),this},subtract:function(e,i){return ie(this,"string"==typeof e?t.duration(+i,e):t.duration(e,i),-1),this},diff:function(e,i,n){var o,r,a=fe(e,this),s=6e4*(this.zone()-a.zone());return"year"===(i=re(i))||"month"===i?(o=432e5*(this.daysInMonth()+a.daysInMonth()),r=12*(this.year()-a.year())+(this.month()-a.month()),r+=(this-t(this).startOf("month")-(a-t(a).startOf("month")))/o,r-=6e4*(this.zone()-t(this).startOf("month").zone()-(a.zone()-t(a).startOf("month").zone()))/o,"year"===i&&(r/=12)):(o=this-a,r="second"===i?o/1e3:"minute"===i?o/6e4:"hour"===i?o/36e5:"day"===i?(o-s)/864e5:"week"===i?(o-s)/6048e5:o),n?r:ee(r)},from:function(e,i){return t.duration(this.diff(e)).lang(this.lang()._abbr).humanize(!i)},fromNow:function(e){return this.from(t(),e)},calendar:function(){var e=fe(t(),this).startOf("day"),i=this.diff(e,"days",!0),n=i<-6?"sameElse":i<-1?"lastWeek":i<0?"lastDay":i<1?"sameDay":i<2?"nextDay":i<7?"nextWeek":"sameElse";return this.format(this.lang().calendar(n,this))},isLeapYear:function(){return ce(this.year())},isDST:function(){return this.zone()<this.clone().month(0).zone()||this.zone()<this.clone().month(5).zone()},day:function(e){var t=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=e?(e=Ie(e,this.lang()),this.add({d:e-t})):t},month:function(e){var i,n=this._isUTC?"UTC":"";return null!=e?"string"==typeof e&&"number"!=typeof(e=this.lang().monthsParse(e))?this:(i=this.date(),this.date(1),this._d["set"+n+"Month"](e),this.date(Math.min(i,this.daysInMonth())),t.updateOffset(this),this):this._d["get"+n+"Month"]()},startOf:function(e){switch(e=re(e)){case"year":this.month(0);case"month":this.date(1);case"week":case"isoWeek":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return"week"===e?this.weekday(0):"isoWeek"===e&&this.isoWeekday(1),this},endOf:function(e){return e=re(e),this.startOf(e).add("isoWeek"===e?"week":e,1).subtract("ms",1)},isAfter:function(e,i){return i=void 0!==i?i:"millisecond",+this.clone().startOf(i)>+t(e).startOf(i)},isBefore:function(e,i){return i=void 0!==i?i:"millisecond",+this.clone().startOf(i)<+t(e).startOf(i)},isSame:function(e,t){return t=t||"ms",+this.clone().startOf(t)==+fe(e,this).startOf(t)},min:function(e){return(e=t.apply(null,arguments))<this?this:e},max:function(e){return(e=t.apply(null,arguments))>this?this:e},zone:function(e){var i=this._offset||0;return null==e?this._isUTC?i:this._d.getTimezoneOffset():("string"==typeof e&&(e=be(e)),Math.abs(e)<16&&(e*=60),this._offset=e,this._isUTC=!0,i!==e&&ie(this,t.duration(i-e,"m"),1,!0),this)},zoneAbbr:function(){return this._isUTC?"UTC":""},zoneName:function(){return this._isUTC?"Coordinated Universal Time":""},parseZone:function(){return this._tzm?this.zone(this._tzm):"string"==typeof this._i&&this.zone(this._i),this},hasAlignedHourOffset:function(e){return e=e?t(e).zone():0,(this.zone()-e)%60==0},daysInMonth:function(){return ue(this.year(),this.month())},dayOfYear:function(e){var i=o((t(this).startOf("day")-t(this).startOf("year"))/864e5)+1;return null==e?i:this.add("d",e-i)},quarter:function(){return Math.ceil((this.month()+1)/3)},weekYear:function(e){var t=Te(this,this.lang()._week.dow,this.lang()._week.doy).year;return null==e?t:this.add("y",e-t)},isoWeekYear:function(e){var t=Te(this,1,4).year;return null==e?t:this.add("y",e-t)},week:function(e){var t=this.lang().week(this);return null==e?t:this.add("d",7*(e-t))},isoWeek:function(e){var t=Te(this,1,4).week;return null==e?t:this.add("d",7*(e-t))},weekday:function(e){var t=(this.day()+7-this.lang()._week.dow)%7;return null==e?t:this.add("d",e-t)},isoWeekday:function(e){return null==e?this.day()||7:this.day(this.day()%7?e:e-7)},get:function(e){return this[e=re(e)]()},set:function(e,t){return"function"==typeof this[e=re(e)]&&this[e](t),this},lang:function(t){return t===e?this._lang:(this._lang=ye(t),this)}}),i=0;i<O.length;i++)Me(O[i].toLowerCase().replace(/s$/,""),O[i]);function xe(e){t.duration.fn[e]=function(){return this._data[e]}}function Se(e,i){t.duration.fn["as"+e]=function(){return+this/i}}for(i in Me("year","FullYear"),t.fn.days=t.fn.day,t.fn.months=t.fn.month,t.fn.weeks=t.fn.week,t.fn.isoWeeks=t.fn.isoWeek,t.fn.toJSON=t.fn.toISOString,J(t.duration.fn=Z.prototype,{_bubble:function(){var e,t,i,n,o=this._milliseconds,r=this._days,a=this._months,s=this._data;s.milliseconds=o%1e3,e=ee(o/1e3),s.seconds=e%60,t=ee(e/60),s.minutes=t%60,i=ee(t/60),s.hours=i%24,r+=ee(i/24),s.days=r%30,a+=ee(r/30),s.months=a%12,n=ee(a/12),s.years=n},weeks:function(){return ee(this.days()/7)},valueOf:function(){return this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*de(this._months/12)},humanize:function(e){var t,i,n,r,a,s,d,u,l,c=+this,p=(t=c,i=!e,n=this.lang(),r=o(Math.abs(t)/1e3),a=o(r/60),s=o(a/60),d=o(s/24),u=o(d/365),(l=r<45&&["s",r]||1===a&&["m"]||a<45&&["mm",a]||1===s&&["h"]||s<22&&["hh",s]||1===d&&["d"]||d<=25&&["dd",d]||d<=45&&["M"]||d<345&&["MM",o(d/30)]||1===u&&["y"]||["yy",u])[2]=i,l[3]=t>0,l[4]=n,function(e,t,i,n,o){return o.relativeTime(t||1,!!i,e,n)}.apply({},l));return e&&(p=this.lang().pastFuture(c,p)),this.lang().postformat(p)},add:function(e,i){var n=t.duration(e,i);return this._milliseconds+=n._milliseconds,this._days+=n._days,this._months+=n._months,this._bubble(),this},subtract:function(e,i){var n=t.duration(e,i);return this._milliseconds-=n._milliseconds,this._days-=n._days,this._months-=n._months,this._bubble(),this},get:function(e){return this[(e=re(e)).toLowerCase()+"s"]()},as:function(e){return this["as"+(e=re(e)).charAt(0).toUpperCase()+e.slice(1)+"s"]()},lang:t.fn.lang,toIsoString:function(){var e=Math.abs(this.years()),t=Math.abs(this.months()),i=Math.abs(this.days()),n=Math.abs(this.hours()),o=Math.abs(this.minutes()),r=Math.abs(this.seconds()+this.milliseconds()/1e3);return this.asSeconds()?(this.asSeconds()<0?"-":"")+"P"+(e?e+"Y":"")+(t?t+"M":"")+(i?i+"D":"")+(n||o||r?"T":"")+(n?n+"H":"")+(o?o+"M":"")+(r?r+"S":""):"P0D"}}),P)P.hasOwnProperty(i)&&(Se(i,P[i]),xe(i.toLowerCase()));function Ne(e){var i=!1,o=t;"undefined"==typeof ender&&(e?(n.moment=function(){return!i&&console&&console.warn&&(i=!0,console.warn("Accessing Moment through the global scope is deprecated, and will be removed in an upcoming release.")),o.apply(null,arguments)},J(n.moment,o)):n.moment=t)}Se("Weeks",6048e5),t.duration.fn.asMonths=function(){return(+this-31536e6*this.years())/2592e6+12*this.years()},t.lang("en",{ordinal:function(e){var t=e%10;return e+(1===de(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th")}}),m?(module.exports=t,Ne(!0)):"function"==typeof define&&define.amd?define("moment",function(i,n,o){return o.config&&o.config()&&!0!==o.config().noGlobal&&Ne(o.config().noGlobal===e),t}):Ne()}).call(this),function(e){"function"==typeof define&&define.amd?define(["moment"],e):"object"==typeof exports?module.exports=e(require("../moment")):e(window.moment)}(function(e){function t(e,t,i){var n,o;return"m"===i?t?"минута":"минуту":e+" "+(n=+e,o={mm:"минута_минуты_минут",hh:"час_часа_часов",dd:"день_дня_дней",MM:"месяц_месяца_месяцев",yy:"год_года_лет"}[i].split("_"),n%10==1&&n%100!=11?o[0]:n%10>=2&&n%10<=4&&(n%100<10||n%100>=20)?o[1]:o[2])}return e.lang("ru",{months:function(e,t){return{nominative:"январь_февраль_март_апрель_май_июнь_июль_август_сентябрь_октябрь_ноябрь_декабрь".split("_"),accusative:"января_февраля_марта_апреля_мая_июня_июля_августа_сентября_октября_ноября_декабря".split("_")}[/D[oD]?(\[[^\[\]]*\]|\s+)+MMMM?/.test(t)?"accusative":"nominative"][e.month()]},monthsShort:function(e,t){return{nominative:"янв_фев_мар_апр_май_июнь_июль_авг_сен_окт_ноя_дек".split("_"),accusative:"янв_фев_мар_апр_мая_июня_июля_авг_сен_окт_ноя_дек".split("_")}[/D[oD]?(\[[^\[\]]*\]|\s+)+MMMM?/.test(t)?"accusative":"nominative"][e.month()]},weekdays:function(e,t){return{nominative:"воскресенье_понедельник_вторник_среда_четверг_пятница_суббота".split("_"),accusative:"воскресенье_понедельник_вторник_среду_четверг_пятницу_субботу".split("_")}[/\[ ?[Вв] ?(?:прошлую|следующую)? ?\] ?dddd/.test(t)?"accusative":"nominative"][e.day()]},weekdaysShort:"вс_пн_вт_ср_чт_пт_сб".split("_"),weekdaysMin:"вс_пн_вт_ср_чт_пт_сб".split("_"),monthsParse:[/^янв/i,/^фев/i,/^мар/i,/^апр/i,/^ма[й|я]/i,/^июн/i,/^июл/i,/^авг/i,/^сен/i,/^окт/i,/^ноя/i,/^дек/i],longDateFormat:{LT:"HH:mm",L:"DD.MM.YYYY",LL:"D MMMM YYYY г.",LLL:"D MMMM YYYY г., LT",LLLL:"dddd, D MMMM YYYY г., LT"},calendar:{sameDay:"[Сегодня в] LT",nextDay:"[Завтра в] LT",lastDay:"[Вчера в] LT",nextWeek:function(){return 2===this.day()?"[Во] dddd [в] LT":"[В] dddd [в] LT"},lastWeek:function(){switch(this.day()){case 0:return"[В прошлое] dddd [в] LT";case 1:case 2:case 4:return"[В прошлый] dddd [в] LT";case 3:case 5:case 6:return"[В прошлую] dddd [в] LT"}},sameElse:"L"},relativeTime:{future:"через %s",past:"%s назад",s:"несколько секунд",m:t,mm:t,h:"час",hh:t,d:"день",dd:t,M:"месяц",MM:t,y:"год",yy:t},meridiem:function(e,t,i){return e<4?"ночи":e<12?"утра":e<17?"дня":"вечера"},ordinal:function(e,t){switch(t){case"M":case"d":case"DDD":return e+"-й";case"D":return e+"-го";case"w":case"W":return e+"-я";default:return e}},week:{dow:1,doy:7}})});var uAdmin=function(){var onLoadEventHandlers={};function uAdmin(){return null==uAdmin.prototype.instance&&(uAdmin.prototype.instance=new uAdmin.prototype.get),register(arguments),uAdmin.prototype.instance}function register(){var e,t,i,n=function(e,t){for(var i in e.reg)return e.reg[t]?e.reg[t]:n(e.reg[i],t);return!1},o=arguments[0];if(!o.length)return!1;if("object"==typeof o[0]){if("[object Array]"===Object.prototype.toString.call(o[0]))return!1;for(var r in o[0])register([r,o[0][r],o[1]||null]);return!0}if("string"!=typeof o[0])return!1;if(void 0===o[1])return!1;if(e=o[0],t=o[1],(i=o[2]||null)||(i=uAdmin),"string"==typeof i&&(i=n(uAdmin,i)),"function"!=typeof i)return!1;var a=!1;(e=e.split(".")).length>1&&(a=!0),e=e.pop();var s=function(){i.reg[e]=t,a&&(i.reg[e].isclass=!0)};return i.reg||(i.reg=s),s(),!0}uAdmin.prototype.get=function(){return this},uAdmin.prototype.get.prototype=uAdmin.prototype,uAdmin.prototype.init=function(){uAdmin.load(uAdmin),delete uAdmin.reg,uAdmin.csrf&&jQuery(document).ajaxSend(function(e,t,i){if(i.data instanceof FormData)i.data.append("csrf",uAdmin.csrf);else{if(!i||!i.type||"string"!=typeof i.data&&void 0!==i.data)return!0;switch(i.type){case"POST":void 0===i.data&&(i.data=""),i.data+=i.data.length?"&csrf="+uAdmin.csrf:"csrf="+uAdmin.csrf;break;case"GET":i.url+=~i.url.indexOf("?")?"&csrf="+uAdmin.csrf:"?csrf="+uAdmin.csrf}}});for(var e=document.getElementsByTagName("img"),t=0;t<e.length;t++)"photo"==e[t].getAttribute("umi:field-name")&&(e[t].width&&(e[t].style.maxWidth=e[t].width+"px"),e[t].height&&(e[t].style.maxHeight=e[t].height+"px"))},"undefined"==typeof JSON&&(JSON={parse:function(str){try{if(str.match(/^{/g)){var val=eval("("+str+")");if("[object Object]"==Object.prototype.toString.call(val))return val}throw new SyntaxError("JSON.parse: unexpected end of data")}catch(e){throw new SyntaxError("JSON.parse: unexpected end of data")}}}),uAdmin.prototype.isCustomFunction=function(e){return"object"==typeof cmsCustoms&&null!==cmsCustoms&&e&&"function"==typeof cmsCustoms[e]},uAdmin.onLoad=function(e,t){return"function"==typeof t&&(e in onLoadEventHandlers==!1&&(onLoadEventHandlers[e]=[]),onLoadEventHandlers[e].push(t),t in onLoadEventHandlers[e])},uAdmin.load=function(e){for(var t in e.reg){if(e.reg[t].reg&&uAdmin.load(e.reg[t]),e.reg[t].isclass){var i=function(e,t){for(var i in t)e.prototype[i]=t[i];return new e};e==uAdmin?e[t]=new e.reg[t](i):e.prototype[t]=new e.reg[t](i)}else e==uAdmin?e[t]=e.reg[t]:e.prototype[t]=e.reg[t];var n=onLoadEventHandlers[t];if(null!=n&&n.length>0)for(var o=0;o<n.length;o++)"function"==typeof n[o]&&n[o]()}};var pageData={module:null};if(window.pageData)pageData=window.pageData;else if(!~location.pathname.indexOf("/do/")){var data=jQuery.ajax({url:location.pathname+".json"+location.search,dataType:"json",async:!1});pageData=JSON.parse(data.responseText)}return uAdmin("data",pageData),uAdmin}();function defineDeprecatedWysiwygFunctions(e){e.prototype.inline=function(){jQuery('<script src="/js/cms/wysiwyg/inline/inlineWYSIWYG.js" type="text/javascript" charset="utf-8"><\/script>').appendTo("head")},e.prototype.inline.init=function(e){return new inlineWYSIWYG(e)},e.prototype.getTinymceUmiruDestroyHolderContent=function(e){return jQuery("iframe",e)[0].contentDocument.body.innerHTML},e.prototype.getRepositionToolbarWidth=function(){return 1025},e.prototype.tinymce=function(){window.tinyMCEPreInit={suffix:"",base:"/js/cms/wysiwyg/tinymce/jscripts/tiny_mce"},jQuery('<script src="/js/cms/wysiwyg/tinymce/jscripts/tiny_mce/tiny_mce.js" type="text/javascript" charset="utf-8"><\/script>').appendTo("head"),jQuery('<script src="/js/cms/wysiwyg/tinymce/jscripts/tiny_mce/tinymce_custom.js" type="text/javascript" charset="utf-8"><\/script>').appendTo("head")},e.prototype.tinymce.init=function(e){var t={},i="textarea.wysiwyg",n={};uAdmin.eip&&uAdmin.eip.editor&&(uAdmin.eip.onTinymceInitEditorTune.call(this,n),t={id:"mceEditor-"+(new Date).getTime(),destroy:function(){tinyMCE.execCommand("mceToggleEditor",!1,t.id)}},e.id=t.id,i="#"+t.id),n.language=uAdmin.data["interface-lang"]||uAdmin.data.lang,n=jQuery.extend(this.settings,n),n=jQuery.extend(n,window.mceCustomSettings);var o=e&&e.settings||{};return n=jQuery.extend(n,o),tinyMCE.init(n),e&&"string"==typeof e.selector&&(i=e.selector),jQuery(i).each(function(e,t){tinyMCE.execCommand("mceToggleEditor",!1,t.id)}),t},e.prototype.tinymce.settings={mode:"none",theme:"umi",width:"100%",language:"string"==typeof window.interfaceLang?interfaceLang:"ru",plugins:"safari,spellchecker,pagebreak,style,layer,table,save,advhr,advimage,advlink,emotions,iespell,inlinepopups,insertdatetime,preview,media,searchreplace,print,contextmenu,paste,directionality,fullscreen,noneditable,visualchars,nonbreaking,xhtmlxtras,template",inlinepopups_skin:"butterfly",toolbar_standart:"fontsettings,tablesettings,|,cut,copy,paste,|,pastetext,pasteword,|,selectall,cleanup,|,undo,redo,|,link,unlink,anchor,image,media,|,charmap,code",toolbar_tables:"table,delete_table,|,col_after,col_before,row_after,row_before,|,delete_col,delete_row,|,split_cells,merge_cells,|,row_props,cell_props",toolbar_fonts:"formatselect,fontselect,fontsizeselect,|,bold,italic,underline,|,justifyleft,justifycenter,justifyright,justifyfull,|,bullist,numlist,outdent,indent,|,forecolor,backcolor,|,sub,sup",theme_umi_toolbar_location:"top",theme_umi_toolbar_align:"left",theme_umi_statusbar_location:"bottom",theme_umi_resize_horizontal:!1,theme_umi_resizing:!0,convert_urls:!1,relative_urls:!1,file_browser_callback:function(e,t,i,n){if("file"==i){var o="/styles/common/js/cms/wysiwyg/tinymce/jscripts/tiny_mce/themes/umi/treelink.html"+(window.lang_id?"?lang_id="+window.lang_id:"");return tinyMCE.activeEditor.windowManager.open({url:o,width:525,height:308,inline:!0,scrollbars:!1,resizable:!1,maximizable:!1,close_previous:!1},{window:n,input:e,editor_id:tinyMCE.selectedInstance.editorId}),!1}var r=n.document.getElementById(e),a={},s=[];if(!r)return!1;switch(r.value.length&&(a.folder=r.value.substr(0,r.value.lastIndexOf("/")),a.file=r.value),s.push("id="+e),i){case"image":s.push("image=1");break;case"media":s.push("media=1")}return jQuery.ajax({url:"/admin/filemanager/get_filemanager_info/",data:a,dataType:"json",success:function(e){"flash"==e.filemanager?r.value.length&&(s.push("folder=."+a.folder),s.push("file="+r.value)):(s.push("folder_hash="+e.folder_hash),s.push("file_hash="+e.file_hash),s.push("lang="+e.lang));var t={flash:{height:460,url:"/styles/common/other/filebrowser/umifilebrowser.html?"+s.join("&")},elfinder:{height:600,url:"/styles/common/other/elfinder/umifilebrowser.html?"+s.join("&")}};if(jQuery.openPopupLayer({name:"Filemanager",title:getLabel("js-file-manager"),width:1200,height:t[e.filemanager].height,url:t[e.filemanager].url}),"elfinder"==e.filemanager){var i='<div id="watermark_wrapper"><label for="add_watermark">';i+=getLabel("js-water-mark"),i+='</label><input type="checkbox" name="add_watermark" id="add_watermark"/>',i+='<label for="remember_last_folder">',i+=getLabel("js-remember-last-dir"),i+='</label><input type="checkbox" name="remember_last_folder" id="remember_last_folder"',getCookie("remember_last_folder",!0)>0&&(i+='checked="checked"'),i+="/></div>",window.parent.jQuery("#popupLayer_Filemanager .popupBody").append(i)}return!1}}),!1},extended_valid_elements:"script[type=text/javascript|src|languge|lang],map[*],area[*],umi:*[*],input[*],noindex[*],nofollow[*],iframe[frameborder|src|width|height|name|align]",content_css:"/css/cms/style.css"},e.prototype.tinymce_umiru=function(){window.tinyMCEPreInit={suffix:"_src",base:"/js/cms/wysiwyg/tinymce/jscripts/tiny_mce"},window.tinymce||jQuery('<script src="/js/cms/wysiwyg/tinymce/jscripts/tiny_mce/tiny_mce_src.js" type="text/javascript" charset="utf-8"><\/script>').appendTo("head"),jQuery('<script src="/js/cms/wysiwyg/tinymce/jscripts/tiny_mce/tinymce_src_custom.js" type="text/javascript" charset="utf-8"><\/script>').appendTo("head")},e.prototype.tinymce_umiru.init=function(e){var t,i="textarea.wysiwyg",n={};return uAdmin.eip&&uAdmin.eip.editor&&(uAdmin.eip.onTinymceInitEditorTune.call(this,n),t={id:"mceEditor-"+(new Date).getTime(),destroy:function(){var e,i=jQuery("#"+t.id),n=jQuery("#"+t.id+"_parent");e=uAdmin.wysiwyg.getTinymceUmiruDestroyHolderContent(n),i.html(e),n.remove(),i.css("display",""),i[0].id=""}},e.id=t.id,i="#"+t.id),n.language=uAdmin.data["interface-lang"]||uAdmin.data.lang,n=jQuery.extend(this.settings,n),window.mceUmiRUCustomSettings&&(n=jQuery.extend(n,window.mceUmiRUCustomSettings)),tinyMCE.init(n),jQuery(i).each(function(e,t){tinyMCE.execCommand("mceAddControl",!1,t.id)}),t},e.prototype.tinymce_umiru.settings={mode:"none",theme:"umiru",language:"string"==typeof window.interfaceLang?interfaceLang:"ru",width:"100%",suffix:"_src",body_class:"text",theme_umi_resizing_use_cookie:!1,init_instance_callback:"uAdmin.wysiwyg.initInstance",theme_umi_path:!1,constrain_menus:!1,extended_valid_elements:"script[src|*],style[*],map[*],area[*],umi:*[*],input[*],noindex[*],nofollow[*],iframe[frameborder|src|width|height|name|align],div[*],span[*],a[*]",plugins:"safari,spellchecker,pagebreak,style,layer,table,save,advhr,umiimage,advimage,advlink,emotions,iespell,inlinepopups,insertdatetime,preview,media,searchreplace,print,contextmenu,paste,directionality,fullscreen,noneditable,visualchars,nonbreaking,xhtmlxtras,template",inlinepopups_skin:"butterfly",setup:function(e){function t(e,i){jQuery(e.getContainer()).children("table.mceLayout").eq(0).css("height","auto");var n=jQuery(e.getContentAreaContainer()).children("iframe")[0],o=n.contentWindow.document.body;iHeight=Math.max(jQuery(o).parent().outerHeight(),jQuery(o).outerHeight()),n.style.height=iHeight+"px",$("img",e.getBody()).on("load",function(){t(e,i)})}e.onChange.add(t),e.onKeyDown.add(t),e.onLoadContent.add(function(e,t){"&nbsp;"!=t.content&&" "!=t.content||e.setContent(""),e.focus();var i=e.dom.select("body"),n=function e(t){if(3==t.nodeType)return t;for(var i=$(t).contents(),n=0;n<i.length;n++){var o=e(i[n]);if(o)return o}return!1}(i[0]);n=n?n.parentNode:e.dom.select("body *").length>0?e.dom.select("body *")[0]:i[0];var o=e.selection.getRng();if(o&&void 0!==o.selectNode){var r=e.getDoc().createTextNode(".");n.insertBefore(r,n.firstChild),o.selectNode(r),o.setStartBefore(r),o.setStartAfter(r),e.selection.setRng(o),n.removeChild(r);var a=$("#"+e.editorContainer+" .toolbarHolder"),s=$("body").width();a.css("position","fixed"),a.css("top",40),s>1110?a.css("left",(s-1110)/2):a.css("left",(s-800)/2)}})},toolbar_standart:"umiimage,tablesettings,|,pastetext,pasteword,|,cleanup,|,link,unlink,|,charmap,code",toolbar_tables:"table,delete_table,|,col_after,col_before,row_after,row_before,|,delete_col,delete_row,|,split_cells,merge_cells,|,row_props,cell_props",toolbar_fonts:"formatselect,fontselect,fontsizeselect,|,bold,italic,underline,|,justifyleft,justifycenter,justifyright,justifyfull,|,bullist,numlist,outdent,indent,|,forecolor,backcolor,|,sub,sup",theme_umi_toolbar_location:"top",theme_umi_toolbar_align:"left",theme_umi_statusbar_location:"bottom",theme_umi_resize_horizontal:!1,theme_umi_resizing:!1,convert_urls:!1,relative_urls:!1,file_browser_callback:"uAdmin.wysiwyg.umiFileBrowserCallback",template_external_list_url:"js/template_list.js",external_link_list_url:"",external_image_list_url:"",media_external_list_url:""},e.prototype.tinymce4=function(){window.tinyMCEPreInit={suffix:".min",base:"/js/cms/wysiwyg/tinymce4"},jQuery('<script src="/js/cms/wysiwyg/tinymce4/tinymce_custom.js" type="text/javascript" charset="utf-8"><\/script>').appendTo("head"),window.customLinkTinymce4?window.customLinkTinymce4():window.tinymce||jQuery('<script src="/js/cms/wysiwyg/tinymce4/tinymce.min.js" type="text/javascript" charset="utf-8"><\/script>').appendTo("head");var e=jQuery("<div/>").addClass("toolbarHolder").css({position:"fixed",top:"40px",display:"none"}).appendTo("body"),t=function(t){if(t&&t instanceof tinymce.Editor!=!1||(t=tinymce&&tinymce.activeEditor),!t)return!1;var i=jQuery(document).width(),n=Math.min(.9*i,uAdmin.wysiwyg.getRepositionToolbarWidth()),o=(i-n)/2,r=jQuery(t.theme.panel.getEl());e.width(n).offset({left:o}).draggable().css("cursor","move"),r.find(".mce-toolbar").css("display","inline-block").parent().css("white-space","normal"),jQuery.draggable&&r.draggable()};jQuery(document).add(window).on("resize",function(e){tinymce&&tinymce.activeEditor&&t(tinymce.activeEditor)}),tinymce.on("AddEditor",function(e){e.editor.on("ShowPanel",function(e){t(e.target),window.setTimeout(function(){jQuery(".toolbarHolder").show()},0)})})},e.prototype.tinymce4.init=function(e){if(window.tinymce4InitAbort&&window.tinymce4InitAbort())return null;var t,i="textarea.wysiwyg",n={};return uAdmin.eip&&uAdmin.eip.editor&&(t={id:"mceEditor-"+(new Date).getTime(),destroy:function(){tinymce&&tinymce.activeEditor&&tinymce.activeEditor.destroy()}},e.id=t.id,i="#"+t.id,n.fixed_toolbar_container=".toolbarHolder",tinymce.on("AddEditor",function(e){e.editor.on("init",function(e){this.fire("focus")})})),n.language=uAdmin.data["interface-lang"]||uAdmin.data.lang,n=jQuery.extend(this.settings,n),window.mceCustomSettings&&(n=jQuery.extend(n,window.mceCustomSettings)),window.mce4CustomSettings&&(n=jQuery.extend(n,window.mce4CustomSettings)),n.selector=i,tinymce.init(n),t},e.prototype.tinymce4.settings={inline:!0,theme:"modern",skin:"darkgray",language:"string"==typeof window.interfaceLang?interfaceLang:"ru",suffix:".min",schema:"html4",paste_as_text:!0,convert_urls:!1,toolbar_items_size:"small",extended_valid_elements:"script[src|*],style[*],map[*],area[*],umi:*[*],input[*],noindex[*],nofollow[*],iframe[frameborder|src|width|height|name|align],div[*],span[*],a[*]",plugins:"umiimage,spellchecker,pagebreak,layer,table,save,hr,image,link,emoticons,insertdatetime,preview,media,searchreplace,print,contextmenu,paste,directionality,fullscreen,noneditable,visualchars,nonbreaking,template,anchor,charmap,code,textcolor",inlinepopups_skin:"butterfly",toolbar1:"image table | paste pastetext | removeformat | link unlink | charmap code",toolbar2:"formatselect fontselect fontsizeselect",toolbar3:"bold italic underline",toolbar4:"alignleft aligncenter alignright alignjustify",toolbar5:"bullist numlist outdent indent",toolbar6:"forecolor backcolor",toolbar7:"subscript superscript",block_formats:getLabel("js-wysiwyg-paragraph")+"=p;Address=address;Pre=pre;Header 1=h1;Header 2=h2;Header 3=h3;Header 4=h4;Header 5=h5;Header 6=h6",menubar:!1,statusbar:!1,resize:!1,object_resizing:!1,convert_urls:!1,relative_urls:!1,file_browser_callback:function(){uAdmin.wysiwyg.umiFileBrowserCallback.apply(uAdmin.wysiwyg,arguments)},template_external_list_url:"js/template_list.js",external_link_list_url:"",external_image_list_url:"",media_external_list_url:""},e.prototype.initInstance=function(e){jQuery("div.toolbarHolder").draggable();var t=jQuery(e.getElement()),i=jQuery(e.getDoc()).find("body").eq(0),n=["font-family","font-size","font-weight","font-style","color","text-transform","text-decoration","letter-spacing","word-spacing","line-height","text-align","vertical-align","direction","background-color","background-image","background-repeat","background-position","background-attachment","opacity","top","right","bottom","left","padding-top","padding-right","padding-bottom","padding-left","overflow-x","overflow-y","white-space","clip","list-style-image","list-style-position","list-style-type","marker-offset"];for(var o in n)i.css(n[o],t.css(n[o]));var r=function(){var e=-1;if("Microsoft Internet Explorer"==navigator.appName){var t=navigator.userAgent;null!=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})").exec(t)&&(e=parseFloat(RegExp.$1))}return e}();r>-1&&r<=8&&i.css("background-color",""),i.css("height","auto");var a=["margin-top","margin-right","margin-bottom","margin-left"];for(var s in jQuery("#"+e.editorContainer).css("display","block"),a)jQuery("#"+e.editorContainer).css(a[s],t.css(a[s]));e.formatter.register({fontsize:{inline:"span",styles:{fontSize:"%value","line-height":"1.3em"}}}),tinymce.util.Cookie.set("tinymcePasteText","1",new Date((new Date).getFullYear()+1,12,31))},e.prototype.umiflashFileManager=function(e,t,i,n,o,r,a){var s=n.document.getElementById(e);if(!s)return!1;var d=[];switch(d.push("id="+e),i){case"image":d.push("image=1");break;case"media":d.push("media=1")}if(s.value.length){var u=s.value.substr(0,s.value.lastIndexOf("/"));d.push("folder=."+u),d.push("file="+s.value)}return $.openPopupLayer({name:"Filemanager",title:getLabel("js-file-manager"),width:1200,height:600,url:"/styles/common/other/filebrowser/umifilebrowser.html?"+d.join("&")}),!1}}function RGBColor(e){this.ok=!1,"#"==e.charAt(0)&&(e=e.substr(1,6)),e=(e=e.replace(/ /g,"")).toLowerCase();var t={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",feldspar:"d19275",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslateblue:"8470ff",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",violetred:"d02090",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32"};for(var i in t)e==i&&(e=t[i]);for(var n=[{re:/^rgb\((\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\)$/,example:["rgb(123, 234, 45)","rgb(255,234,245)"],process:function(e){return[parseInt(e[1]),parseInt(e[2]),parseInt(e[3])]}},{re:/^(\w{2})(\w{2})(\w{2})$/,example:["#00ff00","336699"],process:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]}},{re:/^(\w{1})(\w{1})(\w{1})$/,example:["#fb0","f0f"],process:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)]}}],o=0;o<n.length;o++){var r=n[o].re,a=n[o].process,s=r.exec(e);s&&(channels=a(s),this.r=channels[0],this.g=channels[1],this.b=channels[2],this.ok=!0)}this.r=this.r<0||isNaN(this.r)?0:this.r>255?255:this.r,this.g=this.g<0||isNaN(this.g)?0:this.g>255?255:this.g,this.b=this.b<0||isNaN(this.b)?0:this.b>255?255:this.b,this.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},this.toHash=function(){return{red:this.r,green:this.g,blue:this.b}},this.inverse=function(){this.r=255-this.r,this.g=255-this.g,this.b=255-this.b},this.toHex=function(){var e=this.r.toString(16),t=this.g.toString(16),i=this.b.toString(16);return 1==e.length&&(e="0"+e),1==t.length&&(t="0"+t),1==i.length&&(i="0"+i),"#"+e+t+i}}function relationControl(e,t,n,o){var r=this,a=e,s=t||e,d=!0,u=null,l=null,c=null,p=null,h=null,m=null,f=null,y=null,g=null,v=0,_=0,b=o||"/admin/data/guide_items_all/";this.addObjectToGuide=function(e,t,i){var n="object"==typeof l?l.value:e,o=parseInt(a)>0?parseInt(a):parseInt(t),r={url:"",data:null},d={id:0,name:""},c=document.getElementById("relationButton"+s),p=null,m=null;"string"!=typeof n||n.length<=0||o<=0||(r.url="/admin/udata://data/addObjectToGuide/.json",r.data={param0:n,param1:o},c.setAttribute("disabled",""),jQuery.ajax({url:r.url,dataType:"json",data:r.data,type:"post",success:function(e){if(void 0!==e.data&&void 0!==e.data.object){if(d.id=parseInt(e.data.object.id),isNaN(d.id)||d.id<=0)return;d.name=e.data.object.name,"function"==typeof i&&i(d.name,d.id),c.removeAttribute("disabled"),h&&(p=jQuery("option:selected",u),m=jQuery("option:last",u),p=p.detach(),jQuery(m).replaceWith(p))}},error:function(){c.removeAttribute("disabled")}}))},this.rescan=function(){(l=document.getElementById("relationInput"+s))&&(l.onkeyup=function(e){13==(e?e.keyCode:event.keyCode)&&c?r.addItem():r.doSearch()})},this.getValue=function(){for(var e=jQuery("option:selected",jQuery(u)),t={},i=0;i<e.length;i++)t[e[i].value]=jQuery(e[i]).text();return t},this.loadItems=function(e){jQuery.ajax({url:b+a+".xml?limit&search[]="+encodeURIComponent(e),type:"get",complete:function(e,t){r.updateItems(e)}})},this.loadItemsAll=function(){jQuery.ajax({url:b+a+".xml?allow-empty",type:"get",complete:function(e,t){r.updateItemsAll(e)}})},this.updateItemsAll=function(e){if(e.responseXML.getElementsByTagName("empty").length){if(l){l.onkeyup=function(e){switch(e?e.keyCode:event.keyCode){case 38:y.length&&(g>0||null==g)&&j(null===g?y.length-1:g-1);break;case 40:y.length&&(g<y.length-1||null==g)&&j(null===g?0:g+1);break;case 13:E(),k();break;case 27:k();break;default:clearTimeout(f),f=setTimeout(function(){r.doSearchAjax()},500)}},l.onblur=function(){m&&(v<parseInt(m.style.left)||v>parseInt(m.style.left)+parseInt(m.offsetWidth)||_<parseInt(m.style.top)||_>parseInt(m.style.top)+parseInt(m.offsetHeight))&&k()};var t=e.responseXML.getElementsByTagName("empty")[0].getAttribute("total");h||((h=new Option(" ","")).innerHTML=getLabel("js-relation-total")+t+". "+getLabel("js-relation-use_search"),u.insertBefore(h,u.firstChild))}}else{var i=e.responseXML.getElementsByTagName("object"),o=[],a=0;for(a=0;a<u.options.length;a++)u.options[a].selected&&o.push(u.options[a].value);for(jQuery("option",u).each(function(){this.selected&&0!==this.value.length||jQuery(this).remove()}),n&&$(u).prepend("<option value=''> </option>"),a=0;a<i.length;a++){var s=i[a].getAttribute("id"),d=!1;for(var c in o)if(o[c]==s){d=!0,delete o[c];break}if(!d){var p=i[a].getAttribute("name"),b=new Option(p,s);b.innerHTML=p,u.appendChild(b)}}if(jQuery.browser.msie){var w=u.style.display;u.style.display="none",u.style.display=w}}},this.updateItems=function(e){if(g=null,(y=e.responseXML.getElementsByTagName("object")).length){var t=null;if(!m){(m=document.createElement("div")).className="relationAutosuggest";var n=jQuery(l).offset();m.style.position="absolute",m.style.zIndex=1050,m.style.width=l.clientWidth+"px",m.style.top=n.top+l.offsetHeight+"px",m.style.left=n.left+"px",t=document.createElement("ul"),m.appendChild(t),document.body.appendChild(m)}for(m.style.display="",jQuery(document).on("mousemove",w),t=m.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(i=0;i<y.length;i++){var o=y[i].getAttribute("name"),r=document.createElement("li");r.innerHTML=o,r.onmouseover=function(){j(this.suggestIndex)},r.onmouseout=function(){this.className=""},r.onclick=function(){E(),k()},r.suggestIndex=i,t.appendChild(r)}}};var w=function(e){return e?(v=e.pageX,_=e.pageY):(v=event.clientX+document.body.scrollLeft,_=event.clientY+document.body.scrollTop),!0};this.addItem=function(e,t){(e&&e.length||l&&l.value.length)&&(T(),I(),u.multiple||!p||e||t?((p=new Option(e||l.value,t||l.value)).innerHTML=(t?"":"&rarr;&nbsp;&nbsp;")+(e||l.value),u.options.length?u.insertBefore(p,u.firstChild):u.appendChild(p)):(p.innerHTML=(t?"":"&rarr;&nbsp;&nbsp;")+l.value,p.value=t||l.value,u.selectedIndex=0),l.value="",p.selected=!0,jQuery.browser.msie&&setTimeout(function(){p.selected=!1,p.selected=!0},20))};var j=function(e){if("none"!=m.style.display){var t=m.firstChild,i=t.childNodes.item(g);i&&(i.className=""),t.childNodes.item(e).className="active",g=e}},E=function(){if(m&&"none"!=m.style.display&&null!==g){for(var e=y[g].getAttribute("name"),t=y[g].getAttribute("id"),i=!1,n=0;n<u.options.length;n++)if(u.options[n].value==t){i=!0,u.options[n].selected=!0;break}i||r.addItem(e,t)}else l.value.length&&c&&r.addItem()},k=function(){m&&"none"!=m.style.display&&(m.style.display="none",jQuery(document).off("mousemove",w))};this.doSearch=function(){var e=l.value.toLowerCase();if(T(),""!=e)for(var t=0;t<u.options.length;t++){var i=u.options[t].text,n=i.replace(/^.\s\s/,"");if(i.substring(0,e.length).toLowerCase()===e||n.substring(0,e.length).toLowerCase()===e){if(!u.multiple)return void(u.selectedIndex=t);"optgroup"!=u.firstChild.nodeName.toLowerCase()&&(A(),searchGroup=u.firstChild,itemsGroup=u.lastChild);var o=u.options[t];if(o.parentNode==searchGroup)continue;if(o.oldPrevSibling=o.previousSibling,itemsGroup.removeChild(o),searchGroup.appendChild(o),5==searchGroup.childNodes.length)return}}else u.multiple&&I()},this.doSearchAjax=function(){l.value&&this.loadItems(l.value)};var A=function(){var e=document.createElement("optgroup");e.label="Search results";var t=document.createElement("optgroup");for(t.label="------------------------------------------------";u.firstChild;){var i=u.firstChild;u.removeChild(i),t.appendChild(i)}u.appendChild(e),u.appendChild(t)},I=function(){if(u.firstChild&&"optgroup"==u.firstChild.nodeName.toLowerCase()){u.removeChild(u.firstChild);for(var e=u.firstChild;e.firstChild;){var t=e.firstChild;e.removeChild(t),u.appendChild(t)}u.removeChild(e)}},T=function(){if(u.firstChild&&"optgroup"==u.firstChild.nodeName.toLowerCase())for(var e=u.firstChild,t=u.lastChild;e.firstChild;){var i=e.firstChild;e.removeChild(i),void 0===i.oldPrevSibling&&null!=i.oldPrevSibling||(i.oldPrevSibling&&i.oldPrevSibling.nextSibling?t.insertBefore(i,i.oldPrevSibling.nextSibling):null===i.oldPrevSibling?t.insertBefore(i,t.firstChild):t.appendChild(i),i.oldPrevSibling=void 0)}};!function(){if(u=document.getElementById("relationSelect"+s),l=document.getElementById("relationInput"+s),c=document.getElementById("relationButton"+s),u){jQuery("option",u).each(function(){this.selected||0===this.value.length||(d=!1)}),c&&(c.onclick=function(){r.addObjectToGuide(null,null,function(e,t){r.addItem(e,t)})}),l&&(l.onkeyup=function(e){if(13==(e?e.keyCode:event.keyCode)&&c)return r.addItem(),!1;r.doSearch()},l.onkeydown=function(e){if(13==(e?e.keyCode:event.keyCode))return!1});var e=function(){d&&(r.loadItemsAll(),d=!1)};u.onmouseover=e,u.onfocus=e;for(var t=0;t<u.childNodes.length;t++)1!=u.childNodes[t].nodeType&&(u.removeChild(u.childNodes[t]),t=0);n&&0==jQuery("option[value='']",u).length&&jQuery(u).prepend("<option value=''></option>")}else alert("Select input for field #"+s+" not found")}()}function symlinkControl(e,t,i,n,o,r){o=o instanceof Array?o:[o];var a=this,s=e,d=i instanceof Array?i:[i],u=d?"&hierarchy_types="+d.join("-"):"",l=o instanceof Array?"&hierarchy_types="+o.join(","):"",c=t||null,p=null,h=null,m=null,f=null,y=null,g=null,v=null,_=0,b=0;let w=0;n||(n={});var j=n.iconsPath||"/styles/skins/modern/design/img/tree/",E=n.fadeColorStart||[255,0,0],k=n.fadeColorEnd||[255,255,255],A=n.inputName||"symlinkInput"+s,I=n.noImages||!1,T=n.treeURL||"/styles/common/js/tree.html",Q=n.rootId,C=n.popupTitle||getLabel("js-cms-eip-symlink-choose-element"),M=void 0===n.showSuggestType||n.showSuggestType,x=void 0===n.cutSuggestNames||n.cutSuggestNames,S=parseInt(n.suggestDivWidth),N={},L=r?"&callback=symlinkControlsList."+s+".onlyOne":"";this.loadItems=function(e){jQuery.ajax({url:"/admin/content/load_tree_node.xml?limit&domain_id[]="+(window.domain_id?window.domain_id:"1")+u+(window.lang_id?"&lang_id="+window.lang_id:"")+(Q?"&rel="+Q:"")+"&search-all-text[]="+encodeURIComponent(e),type:"get",complete:function(e,t){a.updateItems(e)}})},this.onlyOne=function(e,t,i,n){jQuery.closePopupLayer("Sitetree"),confirm(getLabel("js-island-change-symlink-warning"))&&(jQuery("a.button",f).trigger("click"),a.addItem(e,t,n,i),jQuery('form input[name="save-mode"]:first').trigger("click"))},this.updateItems=function(e){var t,i=jQuery("html.u-eip").length>0;if(v=null,(t=e.responseXML.getElementsByTagName("page")).length){g=t;for(var n=[],o=0;o<g.length;o++)N[g[o].getAttribute("id")]||(n[n.length]=g[o]);g=n;var r=null;if(!y){(y=document.createElement("div")).className="symlinkAutosuggest";var a=jQuery(h).offset();y.style.position="absolute",y.style.zIndex=1100,y.style.width=h.clientWidth+"px",isNaN(S)||(y.style.width=S+"px"),y.style.top=a.top+h.offsetHeight+"px",y.style.left=a.left+"px",i&&(y.style.backgroundColor="white",y.style.border="1px solid #ccc"),r=document.createElement("ul"),y.appendChild(r),document.body.appendChild(y)}for(Y(),jQuery(document).on("mousemove",P),r=y.firstChild;r.firstChild;)r.removeChild(r.firstChild);for(o=0;o<g.length;o++)if(!N[g[o].getAttribute("id")]){var s=W(g[o].getElementsByTagName("name")[0]),d=W(g[o].getElementsByTagName("basetype")[0]),u=g[o].getAttribute("link"),l=document.createElement("li"),c=document.createElement("span"),p=document.createElement("a");l.title=s,x&&s.length>20&&(s=s.substr(0,20)+"..."),u.length>55&&(u=u.substr(0,55)+"..."),l.appendChild(document.createTextNode(s)),M&&l.appendChild(c),c.appendChild(document.createTextNode(" ("+d+")")),i?(c.style.display="block",l.className="symlink-item-delete",l.style.padding="3px"):(l.appendChild(document.createElement("br")),l.appendChild(p),p.appendChild(document.createTextNode(u)),p.href=u,p.target="_blank"),l.onmouseover=function(){D(this.suggestIndex)},l.onclick=function(){q(),O()},l.suggestIndex=o,r.appendChild(l)}}},this.doSearch=function(){var e=h.value;a.loadItems(e)};var D=function(e){var t=jQuery("html.u-eip").length>0;if("none"!=y.style.display){var i=y.firstChild,n=i.childNodes.item(v);n&&(t?n.style.backgroundColor="":n.className=""),t?i.childNodes.item(e).style.backgroundColor="#ceeaf6":i.childNodes.item(e).className="active",v=e}},q=function(){if(y&&"none"!=y.style.display&&null!==v){var e=g[v].getAttribute("id"),t=W(g[v].getElementsByTagName("name")[0]),i=g[v].getAttribute("link"),n=g[v].getElementsByTagName("basetype")[0],o="",r=(o=n.getAttribute("module"))?o:"",s=(o=n.getAttribute("method"))?o:"";a.addItem(e,t,[r,s],i)}};this.appendStub=function(){let e=document.createElement("input");e.type="hidden",e.name=A,e.name=A.replace(/\[]$/,""),a.stub=e,a.container.parentNode.insertBefore(e,p)},this.delStub=function(){a.stub&&a.stub.remove()},this.addItem=function(e,t,i,n){if(this.delPlaceHolder(),void 0===N[e]){var o=jQuery("html.u-eip").length>0,r=document.createElement("li"),a=document.createElement("span"),s=document.createElement("a"),d=document.createElement("a"),u=document.createElement("input"),l=this;if(u.type="hidden",u.name=A,u.value=e,d.input=u,s.href=n,w++,l.delStub(),I)d.appendChild(document.createTextNode("[x]"));else{var c=document.createElement("img");c.src=j+"symlink_delete.png",c.alt="delete",o&&(c.className="symlink-item-delete"),d.appendChild(c)}if(d.href="javascript:void(0);",o?d.style.marginRight="5px":d.className="button",d.onclick=function(){this.input.parentNode.removeChild(this.input),f.removeChild(this.parentNode),l.addPlaceHolder(),delete N[e],0===--w&&l.appendStub()},a.dataset.basetype=i[0]+" "+i[1],o&&(a.style.marginLeft="5px"),a.appendChild(document.createTextNode(t)),s.appendChild(document.createTextNode(n)),!I){var h=document.createElement("img");h.src=j+"ico_"+i[0]+"_"+i[1]+".png",r.appendChild(h)}r.appendChild(a);a.style.maxWidth=f.parentNode.offsetWidth-70+"px",r.appendChild(d),o?delete s:r.appendChild(s),f.appendChild(r),p.parentNode.insertBefore(u,p),r.style.backgroundColor=makeHexRgb(E),r.startColor=E,r.endColor=k,r.pname=t,r.fade=B,setTimeout(function(){r.fade()},2e3),N[e]=!0,jQuery("#eip_page").length&&(frameElement.height=jQuery("#eip_page").height()>500?500:jQuery("#eip_page").height())}},this.delPlaceHolder=function(){jQuery(".eip-placeholder",f).length>=1&&jQuery(".eip-placeholder",f).remove()},this.addPlaceHolder=function(e){var t=document.createElement("li"),i=e||getLabel("js-cms-eip-symlink-no-elements");t.className="eip-placeholder",t.appendChild(document.createTextNode(i)),jQuery("li",f).length<1&&f.appendChild(t)};var B=function(){if(null==this.fadeColor&&(this.fadeColor=[],this.fadeColor[0]=this.startColor[0],this.fadeColor[1]=this.startColor[1],this.fadeColor[2]=this.startColor[2]),Math.round(this.fadeColor[0]+this.fadeColor[1]+this.fadeColor[2])!=Math.round(this.endColor[0]+this.endColor[1]+this.endColor[2])){this.fadeColor[0]+=(this.endColor[0]-this.startColor[0])/50,this.fadeColor[1]+=(this.endColor[1]-this.startColor[1])/50,this.fadeColor[2]+=(this.endColor[2]-this.startColor[2])/50,this.style.backgroundColor=makeHexRgb(this.fadeColor);var e=this;setTimeout(function(){e.fade()},20)}},Y=function(){if(y){var e=jQuery(h).offset();y.style.width=h.clientWidth,y.style.top=e.top+h.offsetHeight,y.style.left=e.left,y.style.display=""}},O=function(){y&&"none"!=y.style.display&&(y.style.display="none",jQuery(document).off("mousemove",P))},P=function(e){return e?(_=e.pageX,b=e.pageY):(_=event.clientX+document.body.scrollLeft,b=event.clientY+document.body.scrollTop),!0},W=function(e){return e.firstChild&&3==e.firstChild.nodeType?e.firstChild.nodeValue:e.nodeValue};!function(){if(window.symlinkControlsList||(window.symlinkControlsList={}),window.symlinkControlsList[s]=a,p=document.getElementById("symlinkInput"+s)){f=document.createElement("ul"),p.appendChild(f);var e=document.createElement("div");p.appendChild(e),(h=document.createElement("input")).setAttribute("placeholder",getLabel("js-cms-eip-symlink-search")),e.className="pick-element",e.appendChild(h),h.style.width=e.parentNode.offsetWidth-46+"px",h.style.minWidth=e.parentNode.offsetWidth-46+"px",m=I?document.createElement("input"):document.createElement("img"),e.appendChild(m),h.type="text",I?(m.type="button",m.value="╘"):(m.src="/styles/skins/modern/design/img/tree.png",m.height="18"),m.className="treeButton",m.onclick=function(){jQuery.openPopupLayer({name:"Sitetree",title:C,width:620,height:335,url:T+"?id="+s+(c?"&module="+c:"")+l+(window.lang_id?"&lang_id="+window.lang_id:"")+(Q?"&root_id="+Q:"")+L})},f.className="pageslist",h.onkeypress=function(e){if(13==(e?e.keyCode:window.event.keyCode))return!1},h.onkeyup=function(e){switch(e?e.keyCode:window.event.keyCode){case 38:g.length&&(v>0||null==v)&&D(null===v?g.length-1:v-1);break;case 40:g.length&&(v<g.length-1||null==v)&&D(null===v?0:v+1);break;case 13:return q(),O(),!1;case 27:O();break;default:a.doSearch()}},h.onblur=function(){y&&(_<parseInt(y.style.left)||_>parseInt(y.style.left)+parseInt(y.offsetWidth)||b<parseInt(y.style.top)||b>parseInt(y.style.top)+parseInt(y.offsetHeight))&&O()}}else alert("Symlink container #"+s+" not found")}()}jQuery(function(){var e=uAdmin();e.init(),e.isCustomFunction("uAdminInit")&&cmsCustoms.uAdminInit()}),uAdmin(".panel",function(e){function t(){var e=this;if($("html").addClass("u-eip"),this.panelHolder=this.addPanelHolder(),this.quickpanel=this.addQuickpanel(),this.showHideBtn=this.addShowHideBtn(),this.drawControls(),$(document).on("click",function(t){$(t.target).parents("#u-quickpanel").length||e.changeAct()}),!$.cookie("eip-panel-state-first")){this.quickpanel.css({overflow:"hidden",height:"0"}),this.showHideBtn.addClass("collapse"),this.quickpanel.delay(500).animate({height:"38px"},500,function(){$(this).css("overflow","visible"),e.showHideBtn.removeClass("collapse")}),this.quickpanel.fadeTo(300,.3),this.quickpanel.fadeTo(300,1),$.cookie("eip-panel-state","",{path:"/",expires:0});var t=new Date;t.setTime(t.getTime()+2592e6),$.cookie("eip-panel-state-first","Y",{path:"/",expires:t})}var i=e.getUrlPrefix()+"/admin/content/frontendPanel/.json?links";i+="&ts="+Math.round(1e3*Math.random()),$.ajax({url:i,dataType:"json",success:this.onLoadData})}return t.prototype.getUrlPrefix=function(){return uAdmin.lang_prefix?"/"+uAdmin.lang_prefix:""},t.prototype.drawControls=function(){this.exitButton=this.addExitButton(),this.helpButton=this.addHelpButton(),this.butterfly=this.addButtrfly(),this.eipHolder=this.addEipHolder(),this.editMenu=this.addEditMenu(),this.lastDoc=this.addLastDoc(),this.changelogDd=this.addChangelogDd(),this.note=this.addNote(),this.metaHolder=this.addMetaHolder()},t.prototype.addPanelHolder=function(){return $('<div id="u-panel-holder" />').appendTo("body")},t.prototype.addQuickpanel=function(){return this.panelHolder.length?$('<div id="u-quickpanel" />').appendTo(this.panelHolder):null},t.prototype.addShowHideBtn=function(){if(!this.panelHolder.length)return null;var e=this;return $('<div id="u-show_hide_btn" />').appendTo(this.panelHolder).on("click",function(){e.swap(this)})},t.prototype.addExitButton=function(){if(!this.quickpanel.length)return null;var e=this;return $('\n\t\t\t<div id="exit" title="'+getLabel("js-panel-exit")+'">&#160;</div>\n\t\t').appendTo(this.quickpanel).on("click",function(){return window.location=e.getUrlPrefix()+"/users/logout/",!1})},t.prototype.addHelpButton=function(){return this.quickpanel.length?$('\n\t\t\t<div id="help" title="'+getLabel("js-panel-documentation")+'">&#160;</div>\n\t\t').appendTo(this.quickpanel).on("click",function(){return window.open("http://help.docs.umi-cms.ru"),!1}):null},t.prototype.addButtrfly=function(){return this.quickpanel.length?$('\n\t\t\t<div id="butterfly">\n\t\t\t\t<span class="in_ico_bg">&#160;</span>'+getLabel("js-panel-modules")+'\n\t\t\t\t<div class="bg">\n\t\t\t\t\t<ul id="u-mods-cont-left"></ul>\n\t\t\t\t\t<ul id="u-mods-cont-right"></ul>\n\t\t\t\t\t<div class="clear separate"></div>\n\t\t\t\t\t<ul id="u-mods-utils"></ul>\n\t\t\t\t\t<ul id="u-mods-admin"></ul>\n\t\t\t\t\t<div class="clear"></div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t').appendTo(this.quickpanel):null},t.prototype.addEipHolder=function(){return this.quickpanel.length?$("<div />").attr({id:"eip_holder"}).appendTo(this.quickpanel):null},t.prototype.addMetaHolder=function(){return this.quickpanel.length?$("<div />").attr({id:"meta_holder"}).appendTo(this.quickpanel):null},t.prototype.addEditMenu=function(){return this.quickpanel.length?$('\n\t\t\t<div id="edit_menu" title="'+getLabel("js-panel-edit-menu")+'">\n\t\t\t\t<span class="in_ico_bg">&#160;</span>\n\t\t\t\t<div>\n\t\t\t\t\t<ul id="u-docs-edit"></ul>\n\t\t\t\t\t<span class="clear"></span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t').appendTo(this.quickpanel):null},t.prototype.addLastDoc=function(){if(!this.quickpanel.length)return null;var e=this;return $('\n\t\t\t<div id="last_doc">\n\t\t\t\t<span class="in_ico_bg"></span>\n\t\t\t\t'+getLabel("js-panel-last-documents")+'\n\t\t\t\t<div>\n\t\t\t\t\t<ul id="u-docs-recent"></ul>\n\t\t\t\t\t<span class="clear"></span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t').appendTo(this.quickpanel).on("click",function(){e.changeAct(this)})},t.prototype.addChangelogDd=function(){if(!this.quickpanel.length)return null;var e=this;return $('\n\t\t\t<div id="changelog_dd" style="display:none;">\n\t\t\t\t<span class="in_ico_bg">&#160;</span>\n\t\t\t\t'+getLabel("js-panel-history-changes")+'\n\t\t\t\t<div>\n\t\t\t\t\t<ul id="u-changelog"></ul>\n\t\t\t\t\t<span class="clear"></span>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t').appendTo(this.quickpanel).on("click",function(){e.changeAct(this)})},t.prototype.addNote=function(){return this.quickpanel.length?$('\n\t\t\t<div id="note">\n\t\t\t\t<span class="in_ico_bg">&#160;</span>\n\t\t\t\t'+getLabel("js-panel-note")+"\n\t\t\t</div>\n\t\t").appendTo(this.quickpanel):null},t.prototype.addSeoButton=function(){if(!this.quickpanel.length)return null;var e=this;return $('\n\t\t\t<div id="seo">\t\t\t\t<span class="in_ico_bg">&#160;</span>\n\t\t\t\t'+getLabel("module-seo")+"\n\t\t\t</div>\n\t\t").appendTo(this.quickpanel).on("click",function(){window.location=e.getUrlPrefix()+"/admin/seo/"})},t.prototype.onLoadData=function(e){var t,i,n=uAdmin.panel;if(!n)return!1;for(t in $('<link type="text/css" rel="stylesheet" href="/styles/common/js/jquery/jquery.jgrowl.css">').appendTo("head"),e.documents.recent.page)t=e.documents.recent.page[t],$("ul#u-docs-recent",n.lastDoc).append('<li><a href="'+t.link+'">'+t.name+"</a></li>");var o=0;for(t in e.documents.editable.page)if("object"==typeof(t=e.documents.editable.page[t])){for(i in e.modules.module)(i=e.modules.module[i]).name,t.basetype.module;$("ul#u-docs-edit",n.quickpanel||null).append('<li><a href="'+n.getUrlPrefix()+t["edit-link"]+'">'+t.name+"</a></li>"),o++}for(i in o&&n.editMenu?n.editMenu.on("click",function(){n.changeAct(this)}):n.editMenu&&n.editMenu.hide(0),o=0,e.modules.module){var r;switch((i=e.modules.module[i]).type){case"system":r="ul#u-mods-utils";break;case"util":r="ul#u-mods-admin";break;default:r=++o%2?"ul#u-mods-cont-left":"ul#u-mods-cont-right"}$(r,n.butterfly||null).append('<li><a href="'+n.getUrlPrefix()+"/admin/"+i.name+'/">'+i.label+"</a></li>")}if(o&&n.butterfly&&n.butterfly.on("click",function(){n.changeAct(this)}).addClass("butterfly_hover"),void 0!==e.changelog&&n.changelogDd){for(var a in e.changelog.revision){var s=(a=e.changelog.revision[a]).date.std+(a.author.name?" - "+a.author.name:"")+("active"==a.active?"&nbsp;&nbsp;&nbsp;&larr;":""),d=a.link+"?force-redirect="+window.location.pathname;$("#u-changelog",n.changelogDd).append('<li><a href="'+d+'">'+s+"</a></li>")}n.changelogDd.css("display","")}else n.changelogDd&&n.changelogDd.css("display","none");void 0!==e.tickets&&"object"==typeof uAdmin.tickets?uAdmin.tickets.draw(e):n.note&&n.note.remove()},t.prototype.swap=function(e){return"0px"==$("#u-quickpanel").css("height")?this.expand(e):(uAdmin.eip.meta.enabled&&$("#u-quickpanel #meta").trigger("click"),this.collapse(e))},t.prototype.expand=function(e){var t=$("#u-quickpanel");t.css("overflow","visible"),t.animate({height:"38px"},700),$(e).removeClass("collapse"),$.cookie("eip-panel-state","",{path:"/",expires:0})},t.prototype.collapse=function(e){var t=$("#u-quickpanel");t.css("overflow","hidden"),t.animate({height:"0"},700),$(e).addClass("collapse");var i=new Date;i.setTime(i.getTime()+2592e6),$.cookie("eip-panel-state","collapsed",{path:"/",expires:i})},t.prototype.loadRes=function(e,t,i){var n;switch(e){case"js":case"text/javascript":(n=document.createElement("script")).src=t,n.charset="utf-8";break;case"css":case"text/css":(n=document.createElement("link")).href=t,n.rel="stylesheet";break;default:return}document.body.parentNode.firstChild.appendChild(n),"function"==typeof i&&$(document).one("ready",i)},t.prototype.changeAct=function(e){var t=uAdmin.eip&&uAdmin.eip.enabled?"[id != 'edit'][id != 'ieditor-switcher']":"",i=$("#save_edit");if(e)if($(e).hasClass("act"))$("#u-quickpanel .act div:first").hide(),$("#u-quickpanel .act"+t).removeClass("act"),"edit"==e.id&&i.css("display","none");else{var n=!1;$("#u-quickpanel .act").length&&($("#u-quickpanel .act div:first").hide(),$("#u-quickpanel .act"+t).removeClass("act"),"edit"!=e.id||t||i.css("display","none")),$.browser.opera&&(n=$(e).width()),$(e).addClass("act"),n&&$(e).width(n),$("#u-quickpanel .act div:first").show(),"edit"==e.id&&i.css("display","block")}else $("#u-quickpanel .act div:first").hide(),$("#u-quickpanel .act"+t).removeClass("act");"meta"!=$(e).attr("id")&&uAdmin.eip&&uAdmin.eip.meta.enabled&&$("#u-quickpanel #meta").addClass("act")},t.prototype.editInAdmin=function(e){"enable"==e&&$(document).on("keypress",this.editInAdmin.bindEvents),"disable"==e&&$(document).off("keypress",this.editInAdmin.bindEvents)},t.prototype.editInAdmin.bindEvents=function(e){if(e.shiftKey)switch(e.charCode||e.keyCode){case 68:case 100:case 1042:case 1074:$("#u-quickpanel #edit_menu").each(function(e,t){uAdmin.panel.changeAct(t)})}},e(t,this)}),uAdmin(".tickets",function(e){function t(){this.defaultColor="#FFFFE1",this.colorProperty="ticketsColor",this.buttonSelector="#u-quickpanel #note, #quickpanel #note";var e=function(e){jQuery.jGrowl(e,{header:"UMI.CMS",life:5e3})},t=function(e){var t=this;t.params=e,e.message&&t.createMessage(),t.update()};t.prototype.rollbackParams=function(){this.params.oldWidth&&(this.params.width=this.params.oldWidth),this.params.oldHeight&&(this.params.height=this.params.oldHeight),this.params.oldX&&(this.params.x=this.params.oldX),this.params.oldY&&(this.params.y=this.params.oldY),this.params.oldMessage&&(this.params.message.text=this.params.oldMessage)},t.prototype.resetSelection=function(){if(document.selection&&document.selection.empty)document.selection.empty();else if(window.getSelection){var e=window.getSelection();e&&e.removeAllRanges&&e.removeAllRanges()}},t.prototype.createMessage=function(){var e=this;e.messageNode=jQuery('<div class="u-ticket-comment"><div></div><textarea></textarea><a></a></div>').appendTo("body"),e.messageNode.css("background-color",e.params.message.color),e.messageNode.draggable({scroll:!1,containment:document.body,stop:function(t,i){e.params.oldX=e.params.x,e.params.oldY=e.params.y,e.params.x=i.position.left,e.params.y=i.position.top,e.save()}}),e.params.message&&(jQuery("div",e.messageNode).html("<span>"+e.params.message.authorName+" ("+e.params.message.authorLogin+")</span>"),jQuery("textarea",e.messageNode).prop("value",e.params.message.text)),e.messageNode.resizable({minWidth:jQuery("div:first-child span",e.messageNode).outerWidth()+"px",minHeight:"100px",containment:document.body,start:function(){jQuery(e.messageNode).css("cursor","default")},stop:function(t,i){e.params.oldWidth=e.params.width,e.params.oldHeight=e.params.height,e.params.width=i.size.width,e.params.height=i.size.height,e.save(),jQuery(e.messageNode).css("cursor","move")}}),jQuery("a",e.messageNode).html(getLabel("js-ticket-delete")),jQuery("textarea",e.messageNode).on("change",function(){e.save()}),jQuery("textarea",e.messageNode).on("focus",function(){e.params.oldMessage=jQuery(this).prop("value")}),jQuery("a",e.messageNode).on("click",function(){e.del()})},t.prototype.del=function(){var t=this;if(t.params.id){var i="/tickets/manage/delete/"+t.params.id+"/";jQuery.ajax({url:i,type:"get",success:function(i){i&&"string"==typeof i.error?e(i.error):n(t.node,t.messageNode)}})}else n(t.node,t.messageNode);function n(e,t){e&&"function"==typeof e.remove&&e.remove(),t&&"function"==typeof t.remove&&t.remove()}},t.prototype.save=function(){var t=this,i="/tickets/manage/"+(t.params.id?"modify":"create")+"/"+t.params.id+"/";i+="?ts="+Math.round(1e3*Math.random()),jQuery.ajax({type:"POST",url:i,dataType:"json",data:{x:t.params.x,y:t.params.y,width:t.params.width,height:t.params.height,message:jQuery("textarea",t.messageNode).prop("value"),color:t.params.message.color||uAdmin.tickets.defaultColor,referer:window.location.href.split("#")[0]},success:function(i){if(i&&"string"==typeof i.error)return e(i.error),t.rollbackParams(),void t.update();t.params.id=i.id}})},t.prototype.update=function(){this.params.width=this.params.width||this.messageNode.outerWidth(),this.params.height=this.params.height||this.messageNode.outerHeight(),this.messageNode&&(jQuery("textarea",this.messageNode).prop("value",this.params.message.text),this.messageNode.css({top:this.params.y,left:this.params.x,width:this.params.width,height:this.params.height}))},this.ticket=t}return t.prototype.initNewTicket=function(){if(this.changeState(jQuery(this.buttonSelector).get(0)),uAdmin.tickets.created||(alert(getLabel("js-panel-note-add")),uAdmin.tickets.created=!0),uAdmin.tickets.isInit)return!1;uAdmin.tickets.isInit=!0;var e=this,t=uAdmin.tickets.user.fname,i=null==uAdmin.tickets.user.lname?"":" "+uAdmin.tickets.user.lname;jQuery(document).one("mousedown",function(n){new uAdmin.tickets.ticket({x:n.pageX,y:n.pageY,message:{authorName:t+i,authorLogin:uAdmin.tickets.user.login,color:uAdmin.tickets.user[e.colorProperty],text:getLabel("js-ticket-empty")}}),uAdmin.tickets.isInit=!1,e.changeState(jQuery(e.buttonSelector).get(0))})},t.prototype.changeState=function(e){var t=jQuery(e);if("object"==typeof uAdmin.panel)uAdmin.panel.changeAct(e);else if(jQuery("#quickpanel").length>0){t.hasClass("act")?t.removeClass("act"):t.addClass("act")}},t.prototype.swapVisible=function(){this.disabled?this.enable():this.disable()},t.prototype.disable=function(){jQuery("div.u-ticket, div.u-ticket-comment, "+this.buttonSelector).hide(),jQuery(document).off("keydown",this.bindEvents),jQuery(this.buttonSelector).off("click",this.bindEvents),this.disabled=!0},t.prototype.enable=function(){jQuery("div.u-ticket, div.u-ticket-comment, "+this.buttonSelector).show(),jQuery(document).on("keydown",this.bindEvents),jQuery(this.buttonSelector).on("click",this.bindEvents),this.disabled=!1},t.prototype.bindEvents=function(e){e.delegateTarget!==document&&e.preventDefault(),(e.shiftKey&&(67==e.keyCode||99==e.keyCode)&&"INPUT"!=e.target.nodeName&&"TEXTAREA"!=e.target.nodeName||"click"==e.type&&"note"==document.getElementById("note").id)&&uAdmin.tickets.initNewTicket()},t.prototype.draw=function(e){for(var t in uAdmin.tickets.user=e.user,e.tickets.ticket){var i=(t=e.tickets.ticket[t]).position,n=t.author,o=n.fname,r=null==n.lname?"":" "+n.lname;new this.ticket({id:t.id,x:i.x,y:i.y,width:i.width,height:i.height,message:{authorName:o+r,authorLogin:n.login,color:n[this.colorProperty]||this.defaultColor,text:t.message}}).update()}},t.prototype.disabled=!0,t.prototype.isInit=!1,e(t,this)}),uAdmin(".eip",function(e){function t(){this.isMac=-1!=navigator.userAgent.indexOf("Mac OS"),this.drawControls(),uAdmin.data&&uAdmin.data.pageId?this.metaInit():uAdmin.onLoad("data",function(){uAdmin.eip.metaInit()}),this.bindEditorEvents(),!uAdmin.tickets&&uAdmin.panel?uAdmin.onLoad("tickets",this.activateByCookie):uAdmin.tickets&&!uAdmin.panel?uAdmin.onLoad("panel",this.activateByCookie):uAdmin.onLoad("eip",this.activateByCookie),this.init(),this.bindGlobalEvents()}return t.prototype.init=function(){this.deleteButtonsTimeout=null,this.initEditBoxes()},t.prototype.initEditBoxes=function(){var e=this;jQuery(document).on("mouseover",".u-eip-edit-box",function(){e.editBoxMouseoverHandler(this)}),jQuery(document).on("mouseout",".u-eip-edit-box-hover",function(){e.editBoxMouseoutHandler(this)})},t.prototype.editBoxMouseoverHandler=function(e){var t=jQuery(e).addClass("u-eip-edit-box-hover"),i=this.searchAttr(e);t.attr("umi:delete")&&i.id?this.addDeleteButton(e,i):this.dropDeleteButtons(),e.onclick=function(t){return e.onclick=function(){return!0},window.event?window.event.ctrlKey:t.ctrlKey}},t.prototype.editBoxMouseoutHandler=function(e){var t=jQuery(e).removeClass("u-eip-edit-box-hover");t.attr("umi:delete")&&(this.deleteButtonsTimeout=setTimeout(this.dropDeleteButtons,500)),t.on("click",function(){return!0})},t.prototype.addDeleteButton=function(e,t){var i=this;this.deleteButtonsTimeout&&clearTimeout(this.deleteButtonsTimeout),this.dropDeleteButtons();var n=document.createElement("div");return jQuery(n).attr("class","eip-del-button").css({"z-index":"565"}),jQuery(n).attr("class","eip-del-button"),jQuery(n).text(getLabel("js-ieditor-module-delete-title")),jQuery(n).prepend('<img src="/styles/skins/_eip/images/del_button.svg" alt="×">'),document.body.appendChild(n),i.placeWith(e,n,"right","middle"),jQuery(n).on("mouseover",function(){i.deleteButtonsTimeout&&clearTimeout(i.deleteButtonsTimeout)}).on("mouseout",function(){i.deleteButtonsTimeout=setTimeout(i.dropDeleteButtons,500)}).on("click",function(){t.delete=!0,i.queue.add(t),uAdmin.eip.normalizeBoxes()}),n},t.prototype.dropDeleteButtons=function(){jQuery(".eip-del-button").remove()},t.prototype.bindGlobalEvents=function(){this.bindKeyboardShortcut(),window.onresize=function(){uAdmin.eip.normalizeBoxes()}},t.prototype.bindKeyboardShortcut=function(){jQuery(document).on("keydown",function(e){113==e.keyCode&&uAdmin.eip.swapEditor()})},t.prototype.activateByCookie=function(){jQuery.cookie("eip-editor-state")?uAdmin.eip.swapEditor():(uAdmin.tickets.enable(),uAdmin.panel.editInAdmin("enable"))},t.prototype.drawControls=function(){this.editorToggleButton=this.addEditorToggleButton(),this.editorControlsHolder=this.addEditorControlsHolder(),this.saveButton=this.addSaveButton(),this.undoButton=this.addUndoButton(),this.redoButton=this.addRedoButton()},t.prototype.addEditorControlsHolder=function(){return jQuery('\n\t\t\t<div id="save_edit"></div>\n\t\t').appendTo(uAdmin.panel.eipHolder)},t.prototype.addSaveButton=function(){var e=this;return this.editorControlsHolder?jQuery('\n\t\t\t<div id="save" title="'+getLabel("js-panel-save")+" ("+(this.isMac?"Cmd":"Ctrl")+'+S)">&#160;</div>\n\t\t').appendTo(this.editorControlsHolder).on("click",function(){return e.queue.save(),!1}):null},t.prototype.addUndoButton=function(){var e=this;return this.editorControlsHolder?jQuery('\n\t\t\t<div id="edit_back" title="'+getLabel("js-panel-cancel")+" ("+(this.isMac?"Cmd":"Ctrl")+'+Z)">&#160;</div>\n\t\t').appendTo(this.editorControlsHolder).on("click",function(){return e.queue.back(),!1}):null},t.prototype.addRedoButton=function(){var e=this;return this.editorControlsHolder?jQuery('\n\t\t\t<div id="edit_next" title="'+getLabel("js-panel-repeat")+" ("+(this.isMac?"Cmd+Shift+Z":"Ctrl+Y")+')">&#160;</div>\n\t\t').appendTo(this.editorControlsHolder).on("click",function(){return e.queue.forward(),!1}):null},t.prototype.addEditorToggleButton=function(){var e=this,t=jQuery('\n\t\t\t\t<div id="edit">\n\t\t\t\t\t<span class="in_ico_bg">&#160;</span>\n\t\t\t\t\t<span class="edit-button-label"></span> (F2)\t\t\t\t</div>\n\t\t\t');return t.appendTo(uAdmin.panel.eipHolder).on("click",function(){return e.swapEditor(),!1}),t.setLabelText=function(e){e&&t.find(".edit-button-label").text(e)},t.setLabelText(getLabel("js-panel-edit")),t},t.prototype.metaInit=function(){var e=this;function t(e){return(e||"").replace(/"/g,"&quot;")}this.meta.element_id=uAdmin.data.pageId,this.meta.old={alt_name:t(uAdmin.data.page["alt-name"]),title:t(uAdmin.data.title),keywords:t(uAdmin.data.meta.keywords),descriptions:t(uAdmin.data.meta.description)},this.meta.new={},this.metaToggleButton=this.addMetaToggleButton(),this.metaPanel=this.addMetaPanel(),this.metaSaveButton=this.getMetaSaveButton(),this.metaPanel.find('input[type!="submit"]').on("blur",function(t){var i=this.name.replace(/^meta_/g,"");e.meta.new[i]=this.value}).on("keyup mousedown blur",function(){var e=this.value.length;if(e>255)this.value=this.value.substring(0,255);else{var t=this.id+"-count";jQuery("#"+t).html(e)}}).trigger("keyup")},t.prototype.showBlockInfo=function(){},t.prototype.addMetaToggleButton=function(){var e=jQuery('\n\t\t\t<div id="meta">\n\t\t\t\t<span class="in_ico_bg">&#160;</span>\n\t\t\t\t'+getLabel("js-panel-meta")+"\n\t\t\t</div>\n\t\t").appendTo(uAdmin.panel.metaHolder);return this.addMetaToggleButtonClickHandler(e)?e:(e.on("click",function(){return uAdmin.panel.changeAct(this),uAdmin.eip.metaPanel.toggle(),uAdmin.eip.meta.enabled=uAdmin.eip.metaPanel.is(":visible"),!1}),e)},t.prototype.addMetaToggleButtonClickHandler=function(e){return!1},t.prototype.addMetaPanel=function(){if(!uAdmin.panel.panelHolder)return null;return jQuery('\n\t\t\t\t<div id="u-quickpanel-meta">\n\t\t\t\t\t<table>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td width="100px">'+getLabel("js-panel-meta-altname")+': </td>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<input type="text" name="alt_name" id="u-quickpanel-metaaltname" value="'+this.meta.old.alt_name+'"/>\n\t\t\t\t\t\t\t\t<div class="meta_count" id="u-quickpanel-metaaltname-count"></div>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td width="100px">'+getLabel("js-panel-meta-title")+': </td>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<input type="text" name="title" id="u-quickpanel-metatitle" value="'+this.meta.old.title+'"/>\n\t\t\t\t\t\t\t\t<div class="meta_count" id="u-quickpanel-metatitle-count"></div>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td>'+getLabel("js-panel-meta-keywords")+': </td>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<input type="text" name="meta_keywords" id="u-quickpanel-metakeywords" value="'+this.meta.old.keywords+'"/>\n\t\t\t\t\t\t\t\t<div class="meta_count" id="u-quickpanel-metakeywords-count"></div>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td>'+getLabel("js-panel-meta-descriptions")+':</td>\n\t\t\t\t\t\t\t<td>\n\t\t\t\t\t\t\t\t<input type="text" name="meta_descriptions" id="u-quickpanel-metadescription" value="'+this.meta.old.descriptions+'"/>\n\t\t\t\t\t\t\t\t<div class="meta_count" id="u-quickpanel-metadescription-count"></div>\n\t\t\t\t\t\t\t\t<div class="meta_buttons">\n\t\t\t\t\t\t\t\t\t<input type="submit" id="save_meta_button" value="'+getLabel("js-panel-save")+'">\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</table>\n\t\t\t\t</div>\n\t\t\t').appendTo(uAdmin.panel.panelHolder)},t.prototype.getMetaSaveButton=function(){if(!this.metaPanel)return null;var e=this;return this.metaPanel.find("#save_meta_button").on("click",function(){return e.metaSave(),!1})},t.prototype.metaSave=function(){var e,t={},i=this,n=0,o=0;for(e in i.meta.new)i.meta.new[e]!=i.meta.old[e]&&(t["field-name"]="keywords"==e||"descriptions"==e?"meta_"+e:e,t["element-id"]=i.meta.element_id,t.value=i.meta.new[e],n++,jQuery.post("/admin/content/editValue/save.json",t,function(t){t.error?i.message(t.error):(o++,i.meta.old[e]=t.property.value,o==n&&(i.message(getLabel("js-panel-message-changes-saved")),uAdmin.eip.metaToggleButton.trigger("click"),i.onMetaSaved()))},"json")),delete i.meta.new[e]},t.prototype.onMetaSaved=function(){},t.prototype.bindEditorEvents=function(){this.bind("Enable",this.enableEventHandler),this.bind("Disable",this.disableEventHandler),this.bind("Repaint",this.repaintEventHandler),this.bind("Save",this.saveEventHandler)},t.prototype.enableEventHandler=function(e){"after"==e&&uAdmin.panel.changeAct(uAdmin.eip.editorToggleButton.get(0))},t.prototype.disableEventHandler=function(e){"after"==e&&uAdmin.panel.changeAct(uAdmin.eip.editorToggleButton.get(0))},t.prototype.repaintEventHandler=function(e){},t.prototype.saveEventHandler=function(e){},t.prototype.swapEditor=function(){this.onSwapEditor(),this.enabled?(this.disable(),this.editorToggleButton.setLabelText(getLabel("js-panel-edit")),jQuery("#on_edit_in_place").html(getLabel("js-on-eip")),uAdmin.tickets.enable(),uAdmin.panel.editInAdmin("enable"),this.onSwapEnabledEditor()):(this.enable(),this.editorToggleButton.setLabelText(getLabel("js-panel-view")),jQuery("#on_edit_in_place").html(getLabel("js-off-eip")),uAdmin.tickets.disable(),uAdmin.panel.editInAdmin("disable"),this.onSwapDisabledEditor()),this.bindEvents()},t.prototype.onSwapEditor=function(){},t.prototype.onSwapEnabledEditor=function(){},t.prototype.onSwapDisabledEditor=function(){},t.prototype.enable=function(){var e=this;e.onEnable("before"),e.finishLast(),e.inspectDocument(),e.highlight(),e.normalizeBoxes(),jQuery(window).on("load",function(){setTimeout(function(){e.normalizeBoxes()},250)}),e.enabled=!0,e.queue.current>=0&&e.queue.setSaveStatus(!0);var t=new Date;t.setTime(t.getTime()+2592e5),jQuery.cookie("eip-editor-state","enabled",{path:"/",expires:t}),e.message(getLabel("js-panel-message-edit-on")),jQuery(document).on("keydown",e.bindHotkeys),e.onEnable("after")},t.prototype.disable=function(){this.onDisable("before"),this.finishLast(),this.unhighlight(),this.enabled=!1,jQuery.cookie("eip-editor-state","",{path:"/",expires:0}),this.queue.setSaveStatus(!1),this.message(getLabel("js-panel-message-edit-off")),this.queue.current>=0&&this.onDisableWithQueueSave(),jQuery(document).off("keydown",this.bindHotkeys),this.onDisable("after")},t.prototype.onDisableWithQueueSave=function(){jQuery.openPopupLayer({name:"save",width:200,height:80,data:'\n            \t\t\t\t\t\t<div class="eip_win_head popupHeader">\n            \t\t\t\t\t\t\t<div class="eip_win_close popupClose">&#160;</div>\n            \t\t\t\t\t\t</div>\n                                    <div class="eip_win_body popupBody">\n                                    <div class="popupText">'+getLabel("js-panel-message-save-confirm")+'</div>\n                                    <div class="eip_buttons">\n                                        <input type="button" class                                        ="primary ok" id="saveProgressBtn" value="OK" />\n                                        <input type="button" id="closeProgressBtn"class                                        ="primary back" id="" value="Отмена"/>\n                                        <div style="clear: both;"></div>\n                                    </div>\n            \t\t\t\t\t'}),jQuery("#saveProgressBtn").on("click",function(){jQuery.closePopupLayer("save"),uAdmin.eip.queue.save()}),jQuery("#closeProgressBtn").on("click",function(){jQuery.closePopupLayer("save")})},t.prototype.bind=function(e,t){var i="function"==typeof this["on"+e]?this["on"+e]:function(){};this["on"+e]=function(e,n){i(e,n),t(e,n)}},t.prototype.trigger=function(e,t,i){"function"==typeof this["on"+e]&&this["on"+e](t,i)},t.prototype.bindHotkeys=function(e){var t=uAdmin.eip.queue;if(-1!=navigator.userAgent.indexOf("Mac OS")){if(e.metaKey){switch(e.keyCode){case 83:t.save();break;case 90:e.shiftKey?t.forward():t.back();break;default:return!0}return!1}}else if(e.ctrlKey){switch(e.keyCode){case 83:t.save();break;case 90:t.back();break;case 89:t.forward();break;default:return!0}return!1}return!0},t.prototype.finishLast=function(){this.previousEditBox&&(this.previousEditBox.finish(!0),this.previousEditBox=null)},t.prototype.normalizeBoxes=function(){var e=this;jQuery(e.listNodes).each(function(t,i){if(i.boxNode){var n=e.nodePositionInfo(i);jQuery(i.boxNode).css({width:n.width,height:n.height,left:n.x,top:n.y});var o=i.addButtonNode,r="bottom",a="left";if(o){var s;if(s=jQuery(i).attr("umi:button-position")){var d=s.split(/ /);2==d.length&&(r=d[0],a=d[1])}e.placeWith(i,o,r,a)}}}),e.onRepaint("after")},t.prototype.bindEvents=function(){var e=this,t=jQuery(".u-eip-edit-box");jQuery(document).off("click drop dragexit dragover",".u-eip-edit-box"),t.off("click"),t.off("drop"),t.off("dragexit"),t.off("dragover");var i="click";(navigator.userAgent.toLowerCase().indexOf("firefox")||navigator.userAgent.toLowerCase().indexOf("chrome"))&&(i+=" drop",jQuery(document).on("dragexit",".u-eip-edit-box",function(e){e.stopPropagation(),e.preventDefault()}),jQuery(document).on("dragover",".u-eip-edit-box",function(e){e.stopPropagation(),e.preventDefault()})),jQuery(document).on(i,".u-eip-edit-box",function(t){var i=t.target;if(t.ctrlKey||-1!=navigator.userAgent.indexOf("Mac OS")&&t.metaKey)return"A"==this.tagName&&(location.href=this.href),!0;var n="function"==typeof i.onclick?i.onclick:function(){},o=function(){return!1};i.onclick=o,setTimeout(function(){i&&n!=o&&(i.onclick=n)},100);for(var r=0;r<25;r++){if(!i)return!1;if("TABLE"!=i.tagName&&jQuery(i).attr("umi:field-name"))break;i=i.parentNode}return!!i&&(t.stopPropagation(),t.stopImmediatePropagation(),t.preventDefault(),e.edit(i,t&&t.originalEvent&&t.originalEvent.dataTransfer?t.originalEvent.dataTransfer.files:null),t.stopPropagation(),t.stopImmediatePropagation(),t.preventDefault(),!1)}),window.onbeforeunload=function(){if(uAdmin.eip.queue.current>=0||uAdmin.eip.queue.save.count>0)return getLabel("js-panel-message-save-before-exit")}},t.prototype.inspectDocument=function(){var e=this;e.editNodes=[],e.listNodes=[],e.getRegions().each(function(t,i){"none"!=jQuery(i).css("display")&&e.inspectNode(i)})},t.prototype.inspectNode=function(e){"TABLE"!=e.tagName&&(jQuery(e).attr("umi:field-name")&&this.editNodes.push(e),jQuery(e).attr("umi:module")&&this.listNodes.push(e),jQuery.browser.msie&&jQuery(e).parents("a:first").each(function(){var e=this.href;jQuery(this).on("click",function(t){t.ctrlKey&&(window.location.href=e)}),this.removeAttribute("href")}))},t.prototype.getRegions=function(){return jQuery("*[umi\\:field-name], *[umi\\:module]")},t.prototype.isParentOf=function(e,t){return!(!t||!e)&&(t==e||!!e.parentNode&&this.isParentOf(e.parentNode,t))},t.prototype.highlight=function(e,t){var i=this;i.highlighted&&i.unhighlight(),i.highlighted=!0,jQuery(i.editNodes).each(function(t,n){0==i.isParentOf(n,e)&&i.highlightNode(n)}),t||jQuery(i.listNodes).each(function(t,n){0==i.isParentOf(n,e)&&i.highlightListNode(n)}),i.onRepaint("after"),i.markInversedBoxes()},t.prototype.unhighlight=function(){var e=jQuery(".u-eip-edit-box");e.each(function(e,t){var i=(t=jQuery(t)).attr("umi:empty");i&&"IMG"!=t.attr("tagName")&&t.html()==i&&t.html(""),t.attr("title","")}),e.removeClass("u-eip-edit-box u-eip-edit-box-hover u-eip-modified u-eip-deleted u-eip-edit-box-inversed"),e.off("click"),e.off("mouseover"),e.off("mouseout"),e.off("mousedown"),e.off("mouseup"),jQuery(".u-eip-add-box, .u-eip-add-button, .u-eip-del-button").remove(),jQuery(".u-eip-sortable").sortable("destroy"),jQuery(".u-eip-sortable").removeClass("u-eip-sortable")},t.prototype.highlightNode=function(e){if(jQuery(e).attr("umi:field-name")){var t=this.searchAttr(e);if(t){var i=this.htmlTrim(jQuery(e).attr("umi:empty"));if(i&&""==this.htmlTrim(jQuery(e).html())&&"IMG"!=jQuery(e).attr("tagName")){try{jQuery(e).html(i)}catch(e){}jQuery(e).addClass("u-eip-empty-field")}if(jQuery(e).addClass("u-eip-edit-box"),this.queue.search(t)&&jQuery(e).addClass("u-eip-modified"),"A"==e.tagName||"A"==e.parentNode.tagName||jQuery("a",e).length>0){var n=getLabel("js-panel-link-to-go");-1!=navigator.userAgent.indexOf("Mac OS")&&(n=n.replace(/Ctrl/g,"Cmd")),jQuery(e).attr("title",n),jQuery(e).on("dblclick",function(){return!1})}else jQuery(e).attr("title","");this.markInversedBoxes(jQuery(e))}}},t.prototype.searchAttr=function(e,t,i){if(!e)return!1;var n;if(i=i||20,this.getAttrSearchReturnCondition(i,e.tagName))return!1;if(!this.searchAttr.info.node&&jQuery(e).attr("umi:field-name")){this.searchAttr.info.node=e;var o=jQuery(e).attr("umi:field-name");if(!o&&"function"!=typeof t)return this.message("You should specify umi:field-name attribute"),!1;this.searchAttr.info.field_name||(this.searchAttr.info.field_name=o)}var r=jQuery(e);if("function"!=typeof t||t(e)){if(r.attr("umi:element-id"))return this.searchAttr.info.id=r.attr("umi:element-id"),this.searchAttr.info.type="element",n=this.searchAttr.info,this.searchAttr.info={},n;if(r.attr("umi:object-id"))return this.searchAttr.info.id=r.attr("umi:object-id"),this.searchAttr.info.type="object",n=this.searchAttr.info,this.searchAttr.info={},n}return e.parentNode?this.searchAttr(e.parentNode,t,--i):(this.message("You should specify umi:element-id or umi:object attribute"),!1)},t.prototype.getAttrSearchReturnCondition=function(e,t){return jQuery.inArray(t,["BODY","TABLE"])>=0},t.prototype.searchAttr.info={},t.prototype.searchRow=function(e,t){return t?"BODY"!=e.tagName&&"TABLE"!=e.tagName&&(jQuery(e.parentNode).attr("umi:region")?e.parentNode:this.searchRow(e.parentNode,!0)):jQuery("*[umi\\:region]",e).filter(function(){var e='[umi\\:element-id^="new"], [umi\\:object-id^="new"]';return!jQuery(this).find(e).length&&!jQuery(this).is(e)}).get(0)},t.prototype.searchRowId=function(e){return jQuery(e).attr("umi:element-id")||(jQuery("*[umi\\:element-id]",e).length?jQuery("*[umi\\:element-id]",e).get(0).attr("umi:element-id"):null)},t.prototype.inlineAddPage=function(e){var t=this,i=t.searchRow(e);if(!i)return t.message("Error, umi:region=row is not defined"),!1;var n={element:(e=jQuery(e)).attr("umi:element-id"),object:e.attr("umi:object-id")},o=e.attr("umi:type-id"),r=!1;if(jQuery(".u-eip-deleted").each(function(e,i){t.searchAttr(i).id!=(n.element||n.object)||(r=!0)}),r)return t.message(getLabel("js-panel-message-cant-add")),!1;if(!o&&n.element)if(n.element.match(/^new/g)){o=t.queue.search({id:n.element}).type_id}else{var a=jQuery.ajax({url:"/admin/content/getTypeAdding/"+n.element+"/.json",async:!1,dataType:"json"});o=(a=JSON.parse(a.responseText)).result}if(!o)return t.message("Error, umi:type-id is not defined"),!1;var s="lastlist"==e.attr("umi:method")||"prepend"==jQuery(e).attr("umi:add-prepend"),d=jQuery(i).clone(),u=s?d.prependTo(i.parentNode):d.appendTo(i.parentNode);u.removeClass("blank_item");var l=function(e){var t,i;if(jQuery(e).attr("umi:field-name"))return e;if(e.children)for(i=0;i<e.children.length;i++)if(t=l(e.children[i]))return t;return!1};if(!(d=l(u.get(0))))return t.message("Error, umi:field-name is not defined"),!1;var c=t.searchAttr(d);c.id="new_"+(new Date).getTime(),c.type_id=o,c.add=!0,c.node=u.get(0),n.object&&(c.parent=n.object,c.type="object"),n.element&&(c.parent=n.element,c.type="element"),delete c.field_name,""==jQuery(i).attr("umi:"+c.type+"-id")&&(jQuery(i).remove(),jQuery(u).attr("umi:"+c.type+"-id",c.id),jQuery("*",u).each(function(e,t){t.children.length||(t.style.display="")}));var p=jQuery.ajax({url:"/admin/content/getTypeFields/"+o+"/.json",async:!1,dataType:"json"});p=JSON.parse(p.responseText);var h=[];for(var m in p)parseInt(m)==m&&h.push(p[m]);h.push("name");var f=function(e){var i="umi:"+c.type+"-id";if("TABLE"!=jQuery(e).attr("tagName")){if(jQuery(e).attr("umi:field-name")){if(-1==jQuery.inArray(jQuery(e).attr("umi:field-name"),h))return!1;var n=jQuery(e).attr("umi:empty");t.onClearTags(e),jQuery(e).is("img")&&n?jQuery(e).attr("src",n):jQuery(e).html(n||""),jQuery(e).addClass("u-eip-empty-field"),t.editNodes[t.editNodes.length]=e}jQuery(e).attr(i)&&(jQuery(e).attr("umi:clone-source-id",jQuery(e).attr(i)),jQuery(e).attr(i,c.id))}},y=jQuery('*[umi\\:region="row"]',u).get(0);return jQuery('*[umi\\:region="row"]',u).remove(),f(u),u.addClass("u-eip-newitem"),jQuery("*",u).each(function(e,i){t.inspectNode(i),t.highlightListNode(i),jQuery(i).attr("umi:region")&&(jQuery(i).html(y),jQuery("*",i).each(function(e,t){(t=jQuery(t)).children().length||(t.text(""),t.css("display","none")),t.attr("href")&&t.attr("href",""),t.attr("umi:"+c.type+"-id")&&t.attr("umi:"+c.type+"-id","")})),f(i)}),t.onAfterInlineAdd(u),t.queue.add(c),t.normalizeBoxes(),!0},t.prototype.onClearTags=function(e){},t.prototype.onAfterInlineAdd=function(e){},t.prototype.onSuccessAddNewPage=function(e){if(this.onSuccessAddNewPageBegin(e),!e||e.forceReload)return document.location.reload(),!1;var t=jQuery("[umi\\:element-id="+e.parentId+"][umi\\:region=list]");if(!t.length)return!1;var i=this;t.each(function(){i.appendNewPageToDOM(e,jQuery(this))}),jQuery.closePopupLayer(null,{})},t.prototype.replaceNewPageAttributes=function(e,t){e.removeClass("current blank_item"),e.is("[umi\\:url-attribute]")?e.attr(e.attr("umi:url-attribute"),t.url):e.is("a")&&e.attr("href",t.url),e.is("[umi\\:element-id]")&&e.attr("umi:element-id",t.elementId),e.is("[umi\\:field-name=name]")&&e.text(t.title);var i=this;e.children().each(function(){i.replaceNewPageAttributes(jQuery(this),t)})},t.prototype.appendNewPageToDOM=function(e,t){var i=t.find("[umi\\:region=row]").first().clone();this.replaceNewPageAttributes(i,e),i.appendTo(t)},t.prototype.onSuccessAddNewPageBegin=function(e){},t.prototype.htmlTrim=function(e){return(e=(e||"").trim()).replace(/<br ?\/?>/g,"").replace(/(<p>)|(<\/p>)/g,"")},t.prototype.markInversedBoxes=function(e){setTimeout(function(){e||(e=jQuery(".u-eip-edit-box")),e.each(function(e,t){var i=new RGBColor(jQuery(t).css("color")).toHash();(i.red/255+i.green/255+i.blue/224)/3>=.9&&jQuery(t).addClass("u-eip-edit-box-inversed")})},500)},t.prototype.highlightListNode=function(e){if(!jQuery(e).attr("umi:module"))return!1;var t=document.createElement("div");document.body.appendChild(t),e.boxNode=t;var i=this.nodePositionInfo(e);return!(!i.x&&!i.y)&&(jQuery(t).attr("class","u-eip-add-box"),jQuery(t).css({position:"absolute",width:i.width,height:i.height,left:i.x,top:i.y}),"none"!=jQuery(e).attr("umi:add-method")&&this.addAddButton(e,t),"sortable"==jQuery(e).attr("umi:sortable")&&this.setNodeSortable(e,t),t)},t.prototype.addAddButton=function(e,t){var i=this.getEipAddButtonTagName(),n=document.createElement(i);e.addButtonNode=n,jQuery(n).attr({class:"u-eip-add-button"}).html(getLabel("js-panel-add")).prepend('<img src="/styles/skins/_eip/images/add_button.svg" alt="+">'),this.onSetAddButtonText(e,n),jQuery(n).on("mouseenter mouseleave",function(){jQuery(this).addClass("u-eip-add-button-hover")},function(){jQuery(this).removeClass("u-eip-add-button-hover")}),this.onSetAddButtonHoverEvents(e,n);var o,r="bottom",a="left";if(o=jQuery(e).attr("umi:button-position")){var s=o.split(/ /);2==s.length&&(r=s[0],a=s[1])}this.placeWith(e,n,r,a);var d=this;jQuery(n).on("mouseup",function(){d.onAddButtonMouseup(e)}).on("mouseover",function(){d.onAddButtonMouseover(t)}).on("mouseout",function(){d.onAddButtonMouseout(t)}),document.body.appendChild(n)},t.prototype.onSetAddButtonText=function(e,t){},t.prototype.onSetAddButtonHoverEvents=function(e,t){},t.prototype.onAddButtonMouseup=function(e){var t=this,i=jQuery(e).attr("umi:region"),n=t.searchRow(e),o=jQuery(e).attr("umi:element-id"),r=jQuery(e).attr("umi:module"),a=jQuery(e).attr("umi:method"),s=jQuery(e).attr("umi:add-method"),d=jQuery(e).attr("umi:type-id");if(n&&"list"==i&&"popup"!=s)t.inlineAddPage(e),t.onListAddButtonMouseUp(jQuery(e));else{if(t.queue.current>=0)return void t.message(getLabel("js-panel-message-save-first"));var u="/admin/content/eip_add_page/choose/"+parseInt(o)+"/"+r+"/"+a+"/",l=uAdmin.csrf?"?csrf="+uAdmin.csrf:"",c=d?"&type-id="+d:"";jQuery.ajax({url:u+".json"+l,dataType:"json",success:function(i){i.data.error?uAdmin.eip.message(i.data.error):(jQuery.openPopupLayer({name:"CreatePage",title:getLabel("js-eip-create-page"),url:u+l+c}),t.onListAddButtonMouseUp(jQuery(e)))},error:function(){uAdmin.eip.message(getLabel("error-require-more-permissions"))}})}},t.prototype.onListAddButtonMouseUp=function(e){},t.prototype.onAddButtonMouseupPopupOpened=function(){},t.prototype.onAddButtonMouseover=function(e){jQuery(e).addClass("u-eip-add-box-hover")},t.prototype.onAddButtonMouseout=function(e){jQuery(e).removeClass("u-eip-add-box-hover")},t.prototype.setNodeSortable=function(e,t){var i=this;jQuery(e).addClass("u-eip-sortable");var n,o=null,r=null,a=[];jQuery("*").each(function(t,i){if("TABLE"!=i.tagName&&"sortable"==jQuery(i).attr("umi:sortable")){var n=!1;if(jQuery(i).parents().each(function(t,i){i==e&&(n=!0)}),!n){var o=!1;jQuery("*",i).each(function(t,i){i==e&&(o=!0)}),o||a.push(i)}}}),jQuery(e).sortable({items:'> [umi\\:region="row"]',tolerance:"pointer",cursor:"move",dropOnEmpty:!0,revert:!0,forcePlaceholderSize:!0,placeholder:"u-eip-sortable-placeholder",update:function(t,a){if(n=a.item[0],!(jQuery(n).hasClass("u-eip-newitem")||window.cloudController&&window.cloudController.onController)){var s=jQuery.ajax({url:"/admin/content/eip_move_page/"+jQuery(n).attr("umi:element-id")+"/.json?check",async:!1,dataType:"json",type:"GET"}),d=JSON.parse(s.responseText);if(d.error)return jQuery(e).sortable("cancel"),uAdmin.eip.message(d.error),!1}var u=n.nextSibling;do{if(!u)break;if(1==u.nodeType&&i.searchRowId(u))break}while(u=u.nextSibling);o=u,r=n.parentNode;var l=i.searchAttr(n.parentNode,function(e){return"sortable"==jQuery(e).attr("umi:sortable")}),c=parseInt(l?l.id:null);l.node=n,l.move=!0,l.moved=i.searchRowId(n),l.next=u,l.old_next=o,l.parent_id=c,l.parent=n.parentNode,l.old_parent=r,delete l.field_name,o=null,r=null,i.normalizeBoxes(),i.queue.add(l)}})},t.prototype.nodePositionInfo=function(e){return{width:(e=jQuery(e)).innerWidth(),height:e.innerHeight(),x:e.offset().left,y:e.offset().top}},t.prototype.placeWith=function(e,t,i,n){if(e&&t){var o,r,a=this.nodePositionInfo(e),s=jQuery(t);switch(i){case"top":r=a.y-parseInt(s.css("height"));break;case"right":o=a.x+a.width;break;case"left":o=a.x-s.width();break;default:r=a.y+a.height}if("top"==i||"bottom"==i)switch(n){case"right":o=a.x+a.width-s.width();break;case"middle":case"center":o=a.width-parseInt(s.css("width"))>0?a.x+Math.ceil((a.width-s.width())/2):a.x;break;default:o=a.x,o+=parseInt(jQuery(e).css("padding-left"))}else switch(n){case"top":r=a.y;break;case"bottom":r=a.y+a.height-parseInt(s.css("height"));break;default:r=a.height-parseInt(s.css("height"))>0?a.y+Math.ceil((a.height-parseInt(s.css("height")))/2):a.y}var d=s.width()+o,u=jQuery(window);d>u.width()&&(o=u.width()-s.width()-30);try{s.css({position:"absolute",left:o+"px",top:r+"px"})}catch(e){}}},t.prototype.applyStyles=function(e,t,i){var n,o=["font-size","font-family","font-name","margin-left","margin-right","margin-top","margin-bottom","font-weight"];for(n in e=jQuery(e),t=jQuery(t),o){var r=o[n];t.css(r,e.css(r))}!1!==i&&(t.width(e.outerWidth()),t.height(e.outerHeight()))},t.prototype.message=function(e){jQuery.jGrowl("<p>"+e+"</p>",{header:"UMI.CMS",life:1e4})},t.prototype.edit=function(e,t){if(jQuery(e).hasClass("u-eip-deleted")||jQuery(e).parents().hasClass("u-eip-deleted"))return this.message(getLabel("js-panel-message-cant-edit")),!1;this.finishLast(),jQuery(".eip-del-button").remove(),this.previousEditBox=this.editor.get(e,t),this.previousEditBox&&jQuery(".u-eip-add-button, .u-eip-add-box").css("display","none"),jQuery(e).removeClass("u-eip-edit-box u-eip-edit-box-hover u-eip-modified u-eip-deleted u-eip-empty-field u-eip-edit-box-inversed"),this.previousEditBox&&jQuery(e).addClass("u-eip-editing");var i=this.htmlTrim(jQuery(e).attr("umi:empty"));return i&&this.htmlTrim(jQuery(e).html())==i&&(jQuery(e).html("&nbsp;"),jQuery(e).removeClass("u-eip-empty-field")),!0},t.prototype.queue=[],t.prototype.queue.add=function(e){if(-1==this.current&&this.setSaveStatus(!0),this.current<this.length-1){for(var t=this.length-1;t>this.current;t--)this.pop();this.current=this.length}else++this.current;return this.push(e),this.step(),e.add&&(uAdmin.eip.message(getLabel("js-panel-message-add-after-save")),jQuery(e.node).css("display","")),e.move&&jQuery(e.node.parentNode).addClass("u-eip-modified"),e.delete&&(uAdmin.eip.message(getLabel("js-panel-message-delete-after-save")),jQuery(e.node).addClass("u-eip-deleted")),jQuery(e.node).addClass("u-eip-modified"),this.length},t.prototype.queue.get=function(e){return parseInt(e)||(e=this.current),this[e]||null},t.prototype.queue._saveStatus=!1,t.prototype.queue.setSaveStatus=function(e){var t=uAdmin.eip;e?(jQuery("#save").addClass("save_me"),t.editorToggleButton.setLabelText(getLabel("js-panel-edit-save"))):(jQuery("#save").removeClass("save_me"),t.editorToggleButton.setLabelText(t.enabled?getLabel("js-panel-view"):getLabel("js-panel-edit"))),uAdmin.eip.queue._saveStatus=e},t.prototype.queue.getSaveStatus=function(e){return uAdmin.eip.queue._saveStatus},t.prototype.queue.search=function(e){for(var t=this.current;t>=0;){if(this[t].id==e.id&&(this[t].field_name==e.field_name||this[t].add&&e.add||this[t].move&&e.move||this[t].delete&&e.delete||this[t].custom&&e.custom))return this[t];--t}return!1},t.prototype.queue.back=function(e){for(e=parseInt(e)||1;e--;)this[this.current]&&this.cancel();uAdmin.eip.normalizeBoxes(),this.step()},t.prototype.queue.forward=function(e){for(e=parseInt(e)||1;e--;)this[this.current+1]&&this.apply();uAdmin.eip.normalizeBoxes(),this.step()},t.prototype.queue.apply=function(){uAdmin.eip.finishLast(),++this.current;var e=this.get();if(e.add||e.move||e.delete||e.custom||uAdmin.eip.editor.replace(e,e.new_value,e.old_value))switch(!0){case e.add:uAdmin.eip.message(getLabel("js-panel-message-add-after-save")),jQuery(e.node).css("display","");break;case e.delete:uAdmin.eip.message(getLabel("js-panel-message-delete-after-save")),jQuery(e.node).addClass("u-eip-deleted");break;case e.move:e.next?jQuery(e.node).insertBefore(e.next):jQuery(e.node).appendTo(e.parent),jQuery(e.node).addClass("u-eip-modified"),jQuery(e.parent).addClass("u-eip-modified");break;case e.custom:e.target&&e.target.forward&&e.target.forward();break;default:jQuery(e.node).addClass("u-eip-modified")}else--this.current;0==this.current&&this.setSaveStatus(!0)},t.prototype.queue.cancel=function(){uAdmin.eip.finishLast();var e=this.get(),t=!1;switch(!0){case e.add:--this.current,jQuery(e.node).css("display","none");break;case e.delete:--this.current,jQuery(e.node).removeClass("u-eip-deleted");break;case e.move:--this.current,e.old_next?jQuery(e.node).insertBefore(e.old_next):jQuery(e.node).appendTo(e.old_parent),jQuery(e.node).removeClass("u-eip-modified"),this.search(e)||jQuery(e.parent).removeClass("u-eip-modified");break;case e.custom:--this.current,e.target&&e.target.back&&e.target.back();break;default:(t=uAdmin.eip.editor.replace(e,e.old_value,e.new_value))&&(--this.current,jQuery(e.node).addClass("u-eip-modified"))}(e.add||e.move||e.delete||e.custom||t)&&(this.search(e)||jQuery(e.node).removeClass("u-eip-modified"),-1==this.current&&(this.setSaveStatus(!1),uAdmin.eip.message(getLabel("js-panel-message-changes-revert"))))},t.prototype.queue.step=function(){jQuery("#u-quickpanel #save_edit #edit_back").attr("class",-1==this.current?"":"ac"),jQuery("#u-quickpanel #save_edit #edit_next").attr("class",this.length-this.current==1?"":"ac")},t.prototype.onEipSaveQueue=function(e){},t.prototype.onEipSaveQueueWithEdit=function(e){},t.prototype.queue.save=function(e){if(uAdmin.eip.finishLast(),-1==this.current&&!e)return!1;var t=this,i=!1,n={},o=jQuery("div.popupText span",t.progress);switch(uAdmin.eip.onEipSaveQueue(this),e){case"add":for(d in t.save.add){i=t.save.add[d],delete t.save.add[d];break}if(i){for(d in t.save.added)i.parent==d&&(i.parent=t.save.added[d]);var r="/admin/content/eip_quick_add/"+i.parent+".json?type-id="+i.type_id;"data"!=jQuery(i.node).parent().attr("umi:module")&&(r+="&force-hierarchy=1");var a=function(e){if(!uAdmin.eip.performSaveError.call(t,e,i)){var n=parseInt(e.data["element-id"]),r=parseInt(e.data["object-id"]);t.save.added[i.id]=n||r,jQuery(i.node).removeClass("u-eip-newitem u-eip-modified"),jQuery(i.node).attr("umi:"+i.type+"-id",n||r),jQuery("*[umi\\:"+i.type+'-id="'+i.id+'"]',i.node).attr("umi:"+i.type+"-id",n||r);var a=jQuery(i.node),s=n||r,d=i.parent,u=a.parents("[umi\\:region=list]").first(),l="prepend"==u.attr("umi:add-prepend"),c=function(e,t,i){i=!!i,e.attr("umi:element-id")&&e.attr("umi:element-id",t.attr("umi:element-id")||s),e.attr("umi:object-id")&&e.attr("umi:object-id",t.attr("umi:object-id")||s),e.is("img")?e.attr("src",t.attr("src")):(i&&e.is("a")&&e.attr("href",t.attr("href")),e.is("[umi\\:field-name]")&&(t.attr("umi:empty")&&e.attr("umi:empty",t.attr("umi:empty")),e.attr("umi:empty")?e.addClass("u-eip-empty-field"):e.removeClass("u-eip-empty-field"),e.text(t.text()||t.attr("umi:empty")||"")))},p=u.attr("umi:type-id");jQuery("[umi\\:"+i.type+"-id="+d+"][umi\\:region=list]").filter(function(){return 0==jQuery(this).find("[umi\\:"+i.type+"-id="+s+"]").length}).filter(function(){var e=!1,t=jQuery(this).attr("umi:type-id");return(t||p)&&t!=p||(e=!0),e}).each(function(){var e=jQuery(this),t=e.children("[umi\\:region=row]:first").clone().removeClass("blank_item current"),i=uAdmin.eip.addPrevOnStack(a.find("*")).filter("[umi\\:url-attribute]").first();if(i.length){var n=i.attr("umi:url-attribute"),o=uAdmin.eip.addPrevOnStack(t.find("*"));0==o.filter("[umi\\:url-attribute]").attr(n,i.attr(n)).length&&o.filter("a").attr("href",i.attr(n)),c(t,a)}else c(t,a,!0);a.find("[umi\\:field-name]").each(function(){var e=jQuery(this),i=e.attr("umi:field-name");t.find("[umi\\:field-name="+i+"]").each(function(){c(jQuery(this),e)})}),l?t.prependTo(e):t.appendTo(e),e.find("[umi\\:field-name]").each(function(){uAdmin.eip.highlightNode(this)})}),i=!1,uAdmin.eip.normalizeBoxes(),o.text(parseInt(o.text())+1),--t.save.count,t.save("add")}};"GET"===uAdmin.eip.getSaveAjaxMethod()?jQuery.get(r,a,"json"):jQuery.post(r,a,"json")}else t.save("move");break;case"move":for(d in t.save.move){i=t.save.move[d],delete t.save.move[d];break}if(i){for(d in i.next=null==i.next?"":uAdmin.eip.searchRowId(i.next),t.save.added)i.parent_id==d&&(i.parent_id=t.save.added[d]),i.moved==d&&(i.moved=t.save.added[d]),i.next==d&&(i.next=t.save.added[d]);jQuery.post("/admin/content/eip_move_page/"+i.moved+"/"+i.next+".json",{"parent-id":i.parent_id},function(e){e.error?uAdmin.eip.message(e.error):(jQuery(i.node).removeClass("u-eip-modified"),jQuery(i.node).parent().removeClass("u-eip-modified"),jQuery("[umi\\:region=list]").filter("[umi\\:element-id="+i.parent_id+"], [umi\\:object-id="+i.parent_id+"]").filter(function(){return this!=i.parent}).each(function(){var e=jQuery(i.node).index(),t=jQuery(this).find("[umi\\:region=row][umi\\:"+i.type+"-id="+i.moved+"]"),n=jQuery(this).children().eq(e);t.index()>e?t.insertBefore(n):t.index()<e&&t.insertAfter(n)}),uAdmin.eip.normalizeBoxes(),uAdmin.eip.enabled&&uAdmin.eip.highlight(i.moved),uAdmin.eip.message(getLabel("js-panel-message-page-moved")),--t.save.count,o.text(parseInt(o.text())+1),t.save("move"))},"json")}else t.save("edit");break;case"edit":for(d in t.save.edit){i=t.save.edit[d],delete t.save.edit[d];break}if(i){for(d in t.save.added)i.id==d&&(i.id=t.save.added[d]);if(uAdmin.eip.onEipSaveQueueWithEdit(i),uAdmin.eip.editor.equals(i.new_value,i.old_value))jQuery(i.node).removeClass("u-eip-modified"),i=!1,uAdmin.eip.normalizeBoxes(),o.text(parseInt(o.text())+1),--t.save.count,t.save("edit");else{var s,d;switch((n={})[i.type+"-id"]=i.id,n.qt=(new Date).getTime(),n["field-name"]=i.field_name,typeof i.new_value){case"object":if(i.new_value.src)s=i.new_value.src;else for(d in s=[],i.new_value)s.push(d);break;case"string":jQuery.browser.mozilla&&i.new_value.match(/="\.\.\//g)&&(i.new_value=i.new_value.replace(/="[\.\.\/]+/g,'="/')),s=i.new_value.replace(/\sumi:[-a-z]+="[^"]*"/g,"");break;default:s=i.new_value}n.value=s,jQuery.post("/admin/content/editValue/save.json",n,function(e){if(e.error)uAdmin.eip.message(e.error);else{var n=e.property["new-link"],r=e.property["old-link"],a=jQuery(i.node).parents("[umi\\:element-id], [umi\\:object-id]").first(),s=a.is("[umi\\:object-id]")?"object":"element",d=a.attr("umi:"+s+"-id"),u=jQuery("[umi\\:"+s+"-id="+d+"]");if(u.length||(u=jQuery(i.node).parent()),r&&n){var l=0;u.each(function(){jQuery(this).find("[umi\\:url-attribute]").each(function(){jQuery(this).attr(jQuery(this).attr("umi:url-attribute"),n).on("click mousedown mouseup",function(){return!0}),l++})}),l||u.find("a").each(function(e,t){jQuery(this).attr("href",n).on("click mousedown mouseup",function(){return!0})})}jQuery("[umi\\:"+i.type+"-id='"+i.id+"']").find("[umi\\:field-name="+e.property.name+"]").add("[umi\\:"+i.type+"-id='"+i.id+"'][umi\\:field-name="+e.property.name+"]").not("[umi\\:"+i.type+"-id][umi\\:"+i.type+"-id!='"+i.id+"']").each(function(){var t=jQuery(this);if(t.is("img")){var n=null===e.property.value?"":e.property.value.src;t.attr("src",n)}else t.html(i.node.innerHTML);t.parents(".not_hidden").removeClass("not_hidden")}),jQuery(i.node).removeClass("u-eip-modified"),i=!1,uAdmin.eip.normalizeBoxes(),o.text(parseInt(o.text())+1),--t.save.count,t.save("edit")}},"json")}}else t.save("custom");break;case"custom":for(d in t.save.custom){i=t.save.custom[d],delete t.save.custom[d];break}i?(i.target&&i.target.save&&"function"==typeof i.target.save&&i.target.save(),o.text(parseInt(o.text())+1),--t.save.count,t.save("custom")):t.save("del");break;case"del":for(d in t.save.del){i=t.save.del[d],delete t.save.del[d];break}if(i){for(d in t.save.added)i.id==d&&(i.id=t.save.added[d]);(n={})[i.type+"-id"]=i.id,n.qt=(new Date).getTime(),jQuery.ajax({type:"POST",url:"/admin/content/eip_del_page.json",data:n,dataType:"json",success:function(e){if(e.error)uAdmin.eip.message(e.error);else{var n=uAdmin.eip.searchRow(i.node,!0);n&&"list"!=jQuery(n).attr("umi:region")?jQuery(n).remove():jQuery(i.node).remove(),jQuery("[umi\\:element-id="+i.id+"], [umi\\:object-id="+i.id+"]").remove(),uAdmin.eip.normalizeBoxes(),i=!1,uAdmin.eip.normalizeBoxes(),o.text(parseInt(o.text())+1),--t.save.count,t.save("del")}},error:function(e){var t=getLabel("js-label-request-error");403===e.status&&e.responseJSON&&e.responseJSON.data&&e.responseJSON.data.error&&(t=e.responseJSON.data.error),uAdmin.eip.message(t)}})}else{t.save.add={},t.save.added={},t.save.move={},t.save.edit={},t.save.del={},t.save.custom={},t.setSaveStatus(!1),this.step();var u=uAdmin.eip.getDeleteMessageOfEipSave(0===parseInt(o.text()));uAdmin.eip.message(u),jQuery("input:button",t.progress).removeClass("hidden"),uAdmin.eip.onSave("after")}break;default:for(uAdmin.eip.onSave("before");0<=this.current;)t[0].add?(t.save.add[t[0].id]=t[0],++t.save.count):this[0].move?(t.save.move[t[0].moved]&&(delete t.save.move[t[0].moved],--t.save.count),t.save.move[t[0].moved]=t[0],++t.save.count):this[0].delete?(t.save.del[t[0].id]=t[0],++t.save.count):this[0].custom?(t.save.custom[t[0].id]=t[0],++t.save.count):t.save.edit[t[0].id+"_"+t[0].field_name]?t.save.edit[t[0].id+"_"+t[0].field_name].new_value=t[0].new_value:(t.save.edit[t[0].id+"_"+t[0].field_name]=t[0],++t.save.count),t.shift(),--t.current;t.progress=jQuery.openPopupLayer({name:"SaveProgress",width:400,height:"auto",data:'\n\t\t\t\t\t\t<div class="eip_win_head popupHeader">\n\t\t\t\t\t\t\t<div class="eip_win_close popupClose hidden">&#160;</div>\n\t\t\t\t\t\t\t<div class="eip_win_title">'+getLabel("js-cms-eip-edit_in_place-save_processing")+'</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<div class="eip_win_body popupBody">\n\t\t\t\t\t\t\t<div class="popupText">'+getLabel("js-cms-eip-edit_in_place-saved_count_modify",t.save.count)+'</div>\n\t\t\t\t\t\t\t<div class="eip_buttons">\n\t\t\t\t\t\t\t\t<input type="button" class="primary ok hidden" value="OK" />\n\t\t\t\t\t\t\t\t<div style="clear: both;"></div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t'}).find("#popupLayer_SaveProgress"),jQuery("input:button",t.progress).on("click",function(){jQuery.closePopupLayer("SaveProgress"),uAdmin.eip.onSaveFinish()}),t.save("add")}return!1},t.prototype.getSaveAjaxMethod=function(){return"GET"},t.prototype.performSaveError=function(e,t){return!(!e||!e.error)&&(uAdmin.eip.message(e.error),!0)},t.prototype.removeAddFail=function(e){},t.prototype.getDeleteMessageOfEipSave=function(e){return getLabel("js-panel-message-changes-saved")},t.prototype.isImageEditorReinitEnabled=function(e){return!0},t.prototype.onEditModuleActivate=function(){},t.prototype.onSaveFinish=function(){},t.prototype.getEipAddButtonTagName=function(){return"a"},t.prototype.isRelationDrawApplyDimentions=function(){return null},t.prototype.addPrevOnStack=function(e){return e.addBack()},t.prototype.isBindFinishEventCustomReturn=function(e){return!1},t.prototype.getRelationSearchFieldWidth=function(e){return 0},t.prototype.isCleanupHtmlOnWysiwygCtrlShift=function(){return!0},t.prototype.getMSIEStubImgCondition=function(){return!0},t.prototype.onTinymceInitEditorTune=function(e){},t.prototype.showWizard=function(){},t.prototype.isEditedImageTypeSlider=function(e){return e&&e.iImageType&&e.iImageType==e.IMAGE_TYPE_SLIDER},t.prototype.getSliderEditPopupLayerUrl=function(e){var t={slider_id:$(e.jqImgNode[0]).attr("umi:slider-id"),token:uAdmin.csrf,prefix:uAdmin.lang_prefix};return"/styles/common/other/slidereditor/slideEditor.html?"+$.param(t)},t.prototype.queue.save.add={},t.prototype.queue.save.added={},t.prototype.queue.save.move={},t.prototype.queue.save.edit={},t.prototype.queue.save.del={},t.prototype.queue.save.custom={},t.prototype.queue.save.count=0,t.prototype.queue.current=-1,t.prototype.enabled=!1,t.prototype.previousEditBox=null,t.prototype.editNodes=[],t.prototype.listNodes=[],t.prototype.meta={},e(t,this)}),uAdmin(".ieditor",function(e){var t={backend_request_url:"/udata://content/ieditor/",backend_request_method:"POST",image_data_url:"/admin/content/getImageData.json",image_data_request_method:"POST",coockie_name:"eip_ieditor_state",preloader_src:"/styles/skins/_eip/images/loader.gif",preloader_holder_css_class:"eip-ieditor-preloader",collection:{editor_id_attribute:"data-ieditor-id"},editor:{menu_wrapper_css_class:"eip-ieditor-menu-wrapper",img_wrapper_css_class:"eip-ieditor-img-wrapper",animation_speed:100},layout:{extended:{css_class:"eip-ieditor-layout-extended",right_margin:"5px",bottom_margin:"5px"},simple:{css_class:"eip-ieditor-layout-simple",right_margin:"5px",bottom_margin:"5px"},bubble:{css_class:"eip-ieditor-layout-bubble",arrow_css_class:"eip-ieditor-layout-bubble-arrow",bottom_margin:-50,bottom_margin_delta:0},big_img_min_width:300,big_img_min_height:350,small_img_max_width:150,small_img_max_height:150},module:{module_css_class:"eip-ieditor-module",icon_holder_css_class:"eip-ieditor-module-icon",title_holder_css_class:"eip-ieditor-module-title",upload_module:{url:"/udata/content/ieditor/upload.json",iframe_name:"eip-ieditor-upload-iframe",file_input_name:"eip-ieditor-upload-fileinput[]",css_class:"eip-ieditor-module-upload"},filemanager_module:{css_class:"eip-ieditor-module-filemanager"},popup_module:{css_class:"eip-ieditor-module-popup",fancybox_css_class:"fancybox-group",wrapper_css_class:"eip-ieditor-module-popup-wrapper",thumb_width:100},delete_module:{css_class:"eip-ieditor-module-delete"},apply_module:{css_class:"eip-ieditor-module-apply"},cancel_module:{css_class:"eip-ieditor-module-cancel"}},img_area_select:{css_class:"eip-ieditor-imgareaselect-wrapper",plugin_options:{parent:null,hide:!0,handles:!0,instance:!0,keys:!0,movable:!0,persistent:!0,resizeMargin:10,zIndex:100001}},filemanager:{url:"/styles/common/other/elfinder/umifilebrowser.html?lang=ru",window_width:1200,window_height:600},browser_modules:{msie:[f,m,y,v,_,g],mozilla:[f,m,y,h,v,_,g],opera:[f,m,y,h,v,_,g],webkit:[f,m,y,h,v,_,g]}};uAdmin.inherit=function(e,t){var i=function(){};i.prototype=t.prototype,e.prototype=new i,e.prototype.constructor=e,e.superclass=t.prototype};var i=function(){if(!uAdmin||!uAdmin.eip)throw"Edit-in-place is not initialized";this.COOKIE_NAME=t.coockie_name,this.COOKIE_ENABLED_VALUE="enabled",this.COOKIE_DISABLED_VALUE="disabled",this.jqToggleButton=null,this.bEnabled=!0,this.skipDeactivateClick=!1;var e=this;uAdmin.eip.bind("Enable",function(t){"after"==t&&e.addPanelButton()}),uAdmin.eip.bind("Disable",function(t){"after"==t&&(e.removePanelButton(),e.disable())}),uAdmin.eip.bind("ActiveEditorCommit",function(e){"before"==e&&"wysiwyg"==uAdmin.eip.editor.info.field_type&&uAdmin.eip.editor.info.old_value&&uAdmin.eip.editor.info.new_value?(uAdmin.eip.editor.info.old_value=uAdmin.eip.editor.info.old_value.replace(/\sdata-ieditor-id=["']{1}[0-9\._]+["']{1}/gi,""),uAdmin.eip.editor.info.new_value=uAdmin.eip.editor.info.new_value.replace(/\sdata-ieditor-id=["']{1}[0-9\._]+["']{1}/gi,""),uAdmin.eip.editor.info.old_value=uAdmin.eip.editor.info.old_value.replace(/(src=".*)\?[0-9]+/gi,"$1"),uAdmin.eip.editor.info.new_value=uAdmin.eip.editor.info.new_value.replace(/(src=".*)\?[0-9]+/gi,"$1")):uAdmin.eip.normalizeBoxes()}),uAdmin.eip.bind("AddPhotoToAlbum",function(e,t){if("after"==e&&t&&t.newNode&&t.newNode.length){var i=o.getInstance().EDITOR_ID_ATTRIBUTE,n=t.newNode.find("img["+i+"]");if(uAdmin.eip.addPrevOnStack(n).removeAttr(i),!uAdmin.ieditor.isEnabled())return;var r=t.newNode.find("img")[0],a=jQuery(r),s=o.getInstance().initEditor(r);s instanceof u&&a.on("load",function(){s.init(a,a.attr(i))})}}),uAdmin.onLoad("wysiwyg",function(){tinymce.on("AddEditor",function(e){e.editor.on("SetAttrib",function(e){jQuery(e.attrElm).on("load",function(e){if(uAdmin.ieditor.isEnabled()){var t=o.getInstance().initEditor(this);t.getEditState()||(t.destroy(!0),t.init(jQuery(this),jQuery(this).attr(o.getInstance().EDITOR_ID_ATTRIBUTE)),window.setTimeout(function(){tinymce.activeEditor.selection.collapse()},0))}})}),e.editor.on("init",function(e){var t=this.dom.select("img:not(.mce-object)");uAdmin.ieditor.isEnabled()&&t&&t.length&&uAdmin.ieditor.enable(t)});var t=e.editor.windowManager.open;e.editor.windowManager.open=function(){uAdmin.ieditor.disable();var e=t.apply(this,arguments);return e.on("close",function(){setTimeout(function(){uAdmin.ieditor.enable()},500)}),e}})}),jQuery("body").on("click",function(e){if(!jQuery(e.target).closest("."+t.collection.editor_id_attribute+", ."+t.img_area_select.css_class).length&&!jQuery(e.target).is(".mce-resizehandle, img")){var i=o.getInstance().getActiveEditor();if(i instanceof u!=!1&&!uAdmin.ieditor.skipDeactivateClick){var n=i.getEnabledModule();n.cancel(),n.deactivate(),i.hide(),i.switchOn(),i.redrawMenu(),i.drawDeleteButton()}}}),uAdmin.eip.enabled&&this.addPanelButton()};i.prototype.isEnabled=function(){return this.bEnabled},i.prototype.getNodes=i.getNodes=function(e){return jqNodes=jQuery("img[umi\\:field-name], .mceEditor img, [umi\\:field-type='wysiwyg'] img, img[umi\\:slider-id]"),e?jqNodes:jqNodes.toArray()},i.prototype.enable=function(e){if(uAdmin.eip.enabled){e||(e=this.getNodes());for(var t=o.getInstance(),i=t.getActiveEditor(),n=0;n<e.length;n++)t.getEditorByNode(e[n])?i&&i.jqImgNode[0]===e[n]||(t.getEditorByNode(e[n]).destroy(),t.initEditor(e[n])):t.initEditor(e[n]);this.removeEipDeleteButtons(),this.bEnabled=!0,this.jqToggleButton.addClass("act")}},i.prototype.disable=function(){if(this.isEnabled()){var e=o.getInstance().getActiveEditor();e instanceof u&&e.getEnabledModule()&&e.getEnabledModule().cancel(),o.getInstance().removeAllEditors(),o.getInstance().turnOffEditMode(),this.addEipDeleteButtons(),this.bEnabled=!1,this.jqToggleButton.removeClass("act")}},i.prototype.reinit=function(){o.getInstance().reinitActiveEditors()},i.prototype.setSettings=function(e){var i=function(e,t){for(var n in e)e.hasOwnProperty(n)&&t.hasOwnProperty(n)&&("object"==typeof e[n]&&e[n]instanceof Object?i(e[n],t[n]):t[n]=e[n])};i(e,t),o.getInstance().reinitActiveEditors()},i.prototype.getEditorsCollection=function(){return o.getInstance()},i.prototype.removeEipDeleteButtons=function(){if(this.jqEipDeleteButtonsNodes=this.getNodes(!0),this.jqEipDeleteButtonsNodes.length){var e=this.jqEipDeleteButtonsNodes.parents("[umi\\:delete]").filter(function(e,t){return!!jQuery(this).parents("[umi\\:module='photoalbum']").length});this.jqEipDeleteButtonsNodes=this.jqEipDeleteButtonsNodes.filter("[umi\\:delete]").add(e),this.jqEipDeleteButtonsNodes.removeAttr("umi:delete"),uAdmin.eip.dropDeleteButtons()}},i.prototype.addEipDeleteButtons=function(){this.jqEipDeleteButtonsNodes&&this.jqEipDeleteButtonsNodes.length&&(this.jqEipDeleteButtonsNodes.attr("umi:delete","delete"),uAdmin.eip.dropDeleteButtons())},i.prototype.addPanelButton=function(){var e=this;this.jqToggleButton=jQuery("<div/>"),this.jqToggleButton.attr("id","ieditor-switcher").text(getLabel("js-ieditor-switcher")).appendTo(uAdmin.panel.quickpanel).on("click",function(){e.isEnabled()?e.disable():e.enable(),e.saveStateToCookie()}),jQuery('<span class="in_ico_bg">').prependTo(this.jqToggleButton),this.applyStateFromCookie()},i.prototype.removePanelButton=function(){this.jqToggleButton&&this.jqToggleButton.length&&this.jqToggleButton.remove()},i.prototype.applyStateFromCookie=function(){jQuery.cookie&&(jQuery.cookie(this.COOKIE_NAME)==this.COOKIE_ENABLED_VALUE?this.enable():jQuery.cookie(this.COOKIE_NAME)==this.COOKIE_DISABLED_VALUE?this.disable():this.enable())},i.prototype.saveStateToCookie=function(){if(jQuery.cookie){var e=this.isEnabled()?this.COOKIE_ENABLED_VALUE:this.COOKIE_DISABLED_VALUE,t=new Date;t.setTime(t.getTime()+2592e5),jQuery.cookie(this.COOKIE_NAME,e,{path:"/",expires:t})}};var n=function(){this.oEventHandlers={}};n.prototype.bindEvent=function(e,t){return"function"==typeof t&&(this.oEventHandlers[e]||(this.oEventHandlers[e]=[]),this.oEventHandlers[e].push({context:this,handler:t}),!0)},n.prototype.triggerEvent=function(e,t){var i=this._getHandlersForObjectEvent(e,this);if(!i||!i.length)return!1;for(var n=0;n<i.length;n++)i[n].apply(this,t);return!0},n.prototype._getHandlersForObjectEvent=function(e,t){var i=this.oEventHandlers[e];if(!i)return[];var n=[];for(var o in i)i.hasOwnProperty(o)&&i[o].context===t&&"function"==typeof i[o].handler&&n.push(i[o].handler);return n};var o=function(){this.settings=t,this.EDITOR_ID_ATTRIBUTE=t.collection.editor_id_attribute,this.BIG_IMG_MIN_WIDTH=t.collection.big_img_min_width,this.BIG_IMG_MIN_HEIGHT=t.collection.big_img_min_height,this.SMALL_IMG_MAX_WIDTH=t.collection.small_img_max_width,this.SMALL_IMG_MAX_HEIGHT=t.collection.small_img_max_height,this._arEditors={},this.oActiveEditor=null,this.bEditMode=!1,jQuery("body").on("mouseenter","img",function(e){if(!uAdmin.eip.enabled||!uAdmin.ieditor.isEnabled())return!1;if(o.getInstance().isInEditState())return!1;var t=jQuery(this),i=o.getInstance().EDITOR_ID_ATTRIBUTE;if(!t.attr(i))return!1;var n=o.getInstance().initEditor(this);return n.init(t,t.attr(i)),n.show(),window.setTimeout(function(){n.isImageInFocus()||n.hide(function(){n.destroy(!0)})},100),!0}).on("mousemove",function(e){window.mouseX=e.pageX||e.clientX+jQuery(document).scrollLeft(),window.mouseY=e.pageY||e.clientY+jQuery(document).scrollTop()})};o._instance=null,o.getInstance=function(){return o._instance||(o._instance=new o),o._instance},o.cleanupHtml=function(e){return new u.cleanupHtml(e)},o.prototype.initEditor=function(e){if(o.getInstance().isInEditState())return new c;if(this.getEditorByNode(e))return this.getEditorByNode(e);var t=jQuery(e),i=this.getUniqueId();t.attr(this.EDITOR_ID_ATTRIBUTE,i);var n=new l;return this._arEditors[i]=n,n},o.prototype.reinitActiveEditors=function(){var e=[];for(var t in this._arEditors)this._arEditors.hasOwnProperty(t)&&this._arEditors[t]instanceof u!=!1&&e.push(this._arEditors[t].jqImgNode[0]);for(this.removeAllEditors(),t=0;t<e.length;t++)this.initEditor(e[t])},o.prototype.updateEditorsByNodes=function(e){jQuery("img",e).filter(function(){return!!jQuery(this).attr(o.getInstance().EDITOR_ID_ATTRIBUTE)}).each(function(e,t){o.getInstance().initEditor(t).reinit()})},o.prototype.repositionActiveEditors=function(){for(var e in this._arEditors)this._arEditors.hasOwnProperty(e)&&this._arEditors[e]instanceof u!=!1&&(this._arEditors[e].jqImgNode&&this._arEditors[e].jqImgNode.length&&this._arEditors[e].jqImgNode.is(":visible")?this._arEditors[e].reinit():this._arEditors[e].destroy())},o.prototype.getEditorByNode=function(e){return this._arEditors[jQuery(e).attr(this.EDITOR_ID_ATTRIBUTE)]},o.prototype.getEditorByEditorId=function(e){return this._arEditors[e]},o.prototype.getAllEditors=function(){return this._arEditors},o.prototype.findEditors=function(e){var t=jQuery("img["+this.EDITOR_ID_ATTRIBUTE+"]",e),i=[],n=this;return t.each(function(e,t){i.push(n.getEditorByNode(t))}),i},o.prototype.removeAllEditors=function(){for(var e in this._arEditors)this._arEditors.hasOwnProperty(e)&&this.removeEditor(e);this.oActiveEditor=null,this._arEditors={}},o.prototype.removeEditor=function(e){this._arEditors[e].destroy(),delete this._arEditors[e]},o.prototype.removeEmptyEditors=function(){var e=this.getAllEditors();for(var t in e)if(e.hasOwnProperty(t)){var i=e[t];i instanceof u!=!1&&i.getEditorId()&&(i.jqImgNode&&i.jqImgNode.length&&i.jqImgNode.is(":visible")||this.removeEditor(i.getEditorId()))}},o.prototype.getUniqueId=function(){var e="";do{e=(new Date).getTime()+"_"+Math.random()}while(e in this._arEditors);return e},o.prototype.setActiveEditor=function(e){return this.oActiveEditor&&this.oActiveEditor.deactivateEnabledModule?!!this.oActiveEditor.deactivateEnabledModule(!0)&&(this.oActiveEditor=e,!0):(this.oActiveEditor=e,!0)},o.prototype.getActiveEditor=function(){return this.oActiveEditor},o.prototype.deactivateActiveEditor=function(){return this.setActiveEditor(null)},o.prototype.turnOnEditMode=function(){this.bEditMode=!0},o.prototype.turnOffEditMode=function(){this.bEditMode=!1},o.prototype.isInEditState=function(){return this.bEditMode},o.prototype.each=function(e){if("function"==typeof e)for(var t=0;t<this._arEditors;t++){var i=this._arEditors[t];i instanceof u!=!1&&e.call(i,t,i)}};var r=function(e){r.superclass.constructor.call(this),this.CSS_CLASS_NAME="",this.ANIMATIONS_SPEED=t.editor.animation_speed,this.oEditor=e};uAdmin.inherit(r,n),r.prototype.init=function(){this.oEditor.jqMenuWrapper.addClass(this.CSS_CLASS_NAME),this.reposition()},r.prototype.remove=function(){this.oEditor.jqMenuWrapper.removeClass(this.CSS_CLASS_NAME),this.resetPosition(),this.oEditor.layout=null},r.prototype.reposition=function(){},r.prototype.resetPosition=function(){var e=this.oEditor.jqMenuWrapper[0];e.style.top="",e.style.bottom="",e.style.left="",e.style.right=""},r.prototype.show=function(){var e=this;this.oEditor.jqMenuWrapper.stop(!0,!0).fadeIn(this.ANIMATIONS_SPEED,function(){e.oEditor.triggerEvent("onShow")})},r.prototype.hide=function(e){var t=this;this.oEditor.jqMenuWrapper.add().stop(!0,!0).fadeOut(this.ANIMATIONS_SPEED,function(){"function"==typeof e&&e(),t.oEditor.triggerEvent("onHide")})};var a=function(e){a.superclass.constructor.call(this,e),this.CSS_CLASS_NAME=t.layout.extended.css_class,this.init()};uAdmin.inherit(a,r),a.prototype.reposition=function(){this.oEditor.jqMenuWrapper.css({right:t.layout.extended.right_margin,bottom:t.layout.extended.bottom_margin})};var s=function(e){s.superclass.constructor.call(this,e),this.CSS_CLASS_NAME=t.layout.simple.css_class,this.init()};uAdmin.inherit(s,r),s.prototype.reposition=function(){this.oEditor.jqMenuWrapper.css({right:t.layout.simple.right_margin,bottom:t.layout.simple.bottom_margin})};var d=function(e){d.superclass.constructor.call(this,e),this.CSS_CLASS_NAME=t.layout.bubble.css_class,this.BUBBLE_ARROW_CSS_CLASS=t.layout.bubble.arrow_css_class,this.init()};uAdmin.inherit(d,r),d.prototype.init=function(){d.superclass.init.call(this),this.oEditor.jqMenuWrapper.prepend("<div class='"+this.BUBBLE_ARROW_CSS_CLASS+"'/>")},d.prototype.remove=function(){this.oEditor.jqMenuWrapper.find("."+this.BUBBLE_ARROW_CSS_CLASS).remove(),d.superclass.remove.call(this)},d.prototype.reposition=function(){var e=this.oEditor.jqMenuWrapper.clone().css("left",-1e4).appendTo("body").show(),i=(this.oEditor.jqImgWrapper.outerWidth()-e.outerWidth())/2;e.remove(),this.oEditor.jqMenuWrapper.css({left:i+"px",bottom:t.layout.bubble.bottom_margin-t.layout.bubble.bottom_margin_delta+"px"})},d.prototype.show=function(){var e=this;this.oEditor.jqMenuWrapper.stop(!0,!0).fadeIn(this.ANIMATIONS_SPEED).animate({bottom:t.layout.bubble.bottom_margin+"px"},this.ANIMATIONS_SPEED,function(){e.oEditor.triggerEvent("onShow")})},d.prototype.hide=function(e){var i=this;this.oEditor.jqMenuWrapper.stop(!0,!0).animate({bottom:t.layout.bubble.bottom_margin-t.layout.bubble.bottom_margin_delta+"px"},this.ANIMATIONS_SPEED).fadeOut(this.ANIMATIONS_SPEED,function(){"function"==typeof e&&e(),i.oEditor.triggerEvent("onHide")})};var u=function(){u.superclass.constructor.call(this),this.MENU_WRAPPER_CLASS_NAME=t.editor.menu_wrapper_css_class,this.IMG_WRAPPER_CLASS_NAME=t.editor.img_wrapper_css_class,this.ANIMATIONS_SPEED=t.editor.animation_speed,this.IMAGE_TYPE_UNKNOWN=0,this.IMAGE_TYPE_EIP=1,this.IMAGE_TYPE_WYSIWYG=2,this.IMAGE_TYPE_PHOTOALBUM=3,this.IMAGE_TYPE_SLIDER=4,this._imageUrl="",this.sEditorId="",this.layout="",this.jqImgNode=null,this.jqMenuWrapper=null,this.jqDeleteButton=null,this.jqCloseButton=null,this.jqImgWrapper=null,this.jqPreloader=null,this.iImageType=this.IMAGE_TYPE_UNKNOWN,this.bEditStateEnabled=!1,this.arModulesSet=[],this.arDefaultModules=[h,f,m,y],this.arActiveModules=[],this.oEnabledModule=null,this.oEventHandlers={}};uAdmin.inherit(u,n),u.prototype.init=function(e,t){var i=this;if(!e){if(!this.jqImgNode||!this.jqImgNode.length)return!1;e=this.jqImgNode}!t&&e&&e.length&&(t=e.attr(o.getInstance().EDITOR_ID_ATTRIBUTE)),this.sEditorId=t||e.attr(o.getInstance().EDITOR_ID_ATTRIBUTE),e.parents(".mceEditor").length||e.parents("[umi\\:field-type='wysiwyg']").length||e.parents(".mce-content-body").length?this.iImageType=this.IMAGE_TYPE_WYSIWYG:e.parents("[umi\\:module='photoalbum']").length?this.iImageType=this.IMAGE_TYPE_PHOTOALBUM:e.is("[umi\\:field-name]")?this.iImageType=this.IMAGE_TYPE_EIP:e.is("[umi\\:slider-id]")&&(this.iImageType=this.IMAGE_TYPE_SLIDER),this.jqImgNode=e,this.jqImgWrapper=jQuery("<div/>").addClass(this.IMG_WRAPPER_CLASS_NAME),this.hideTimer=null,this.jqImgWrapper.attr(o.getInstance().EDITOR_ID_ATTRIBUTE,this.sEditorId).on("click",function(e){return!jQuery(e.target).parents("."+i.MENU_WRAPPER_CLASS_NAME).length&&(i.jqImgNode.trigger("click"),!1)}).on("contextmenu",function(e){return!tinymce||!tinymce.activeEditor||(e.preventDefault(),e.target=i.jqImgNode[0],e.originalEvent.target=i.jqImgNode[0],e.currentTarget=i.jqImgNode[0],e.delegateTarget=i.jqImgNode[0],tinymce.activeEditor.selection.select(i.jqImgNode[0]),tinymce.activeEditor.dom.fire(i.jqImgNode[0],"contextmenu",e),!1)}).appendTo("body"),this.applyImageSizes(),this.drawMenu(),this.switchOn(),this.jqImgNode.on("mousemove mouseover mouseout mouseenter mouseleave",function(e){return e.stopPropagation(),e.stopImmediatePropagation(),e.preventDefault(),!1}),this.triggerEvent("onInit")},u.prototype.reinit=function(){var e=o.getInstance().EDITOR_ID_ATTRIBUTE;this.jqImgNode=jQuery("img["+e+"='"+this.sEditorId+"']"),this.jqImgWrapper=jQuery("."+this.IMG_WRAPPER_CLASS_NAME).filter("["+e+"='"+this.sEditorId+"']").first(),this.jqImgWrapper.length&&(this.jqMenuWrapper=this.jqImgWrapper.find("."+this.MENU_WRAPPER_CLASS_NAME).first(),this.jqImgNode.length&&(this.applyImageSizes(),this.layout.reposition(),this.jqImgWrapper.offset(this.jqImgNode.offset())))},u.prototype.initLayout=function(){this.layout instanceof r&&this.layout.remove();var e=this.jqImgNode.width(),i=this.jqImgNode.height();e>=t.layout.big_img_min_width&&i>=t.layout.big_img_min_height?this.layout=new a(this):e<=t.layout.small_img_max_width||i<=t.layout.small_img_max_height?this.layout=new d(this):this.layout=new s(this)},u.prototype.drawMenu=function(e){this.jqMenuWrapper=jQuery("<div/>").addClass(this.MENU_WRAPPER_CLASS_NAME),this.initLayout(),this.drawModules(e),this.isStub()&&this.iImageType!==this.IMAGE_TYPE_PHOTOALBUM||this.drawDeleteButton(),this.reposition(),this.jqMenuWrapper.appendTo(this.jqImgWrapper)},u.prototype.applyImageBoxSizes=function(e){e&&e.length||(e=this.jqImgNode);var t=function(t){return e.css(t)};this.jqImgWrapper.css({width:t("width"),height:t("height"),paddingTop:t("paddingTop"),paddingRight:t("paddingRight"),paddingBottom:t("paddingBottom"),paddingLeft:t("paddingLeft"),borderTop:t("borderTop"),borderRight:t("borderRight"),borderBottom:t("borderBottom"),borderLeft:t("borderLeft"),marginTop:t("marginTop"),marginRight:t("marginRight"),marginBottom:t("marginBottom"),marginLeft:t("marginLeft")})},u.prototype.applyImageSizes=function(e){e&&e.length||(e=this.jqImgNode),this.applyImageBoxSizes(e),this.jqImgWrapper.offset(e.offset())},u.prototype.lockImageSize=function(){this.jqImgNode.css({maxWidth:this.jqImgNode.parent().width(),maxHeight:this.jqImgNode.parent().height()})},u.prototype.redrawMenu=function(e){for(var t in this.arActiveModules){var i=this.arActiveModules[t];i instanceof p&&i.remove()}this.jqMenuWrapper.children().remove(),this.removeCloseButton(),this.drawModules(e),this.initLayout()},u.prototype.drawModules=function(e){if(this.isPopupThumb()&&(e=[y]),this.resetModules(),e)for(var t in e)this.addModule(e[t]);else this.setDefaultModules();this.isStub();for(var t in this.arActiveModules=[],this.arModulesSet)if(this.arModulesSet.hasOwnProperty(t)&&(!jQuery.browser.msie||this.arModulesSet[t]!=h)){var i=new this.arModulesSet[t](this);this.arActiveModules.push(i),this.jqMenuWrapper.append(i.getView(!0))}},u.prototype.drawDeleteButton=function(e){if(this.iImageType==this.IMAGE_TYPE_SLIDER)return!1;this.jqDeleteButton&&this.jqDeleteButton.length&&this.jqDeleteButton.remove();var t=g;return!!this.checkModule(t)&&(t=new t(this),this.jqDeleteButton=t.getView(!0),this.jqDeleteButton.addClass(this.layout.CSS_CLASS_NAME),this.jqImgWrapper.append(this.jqDeleteButton),e&&this.jqDeleteButton.show(),!0)},u.prototype.removeDeleteButton=function(){if(this.iImageType==this.IMAGE_TYPE_SLIDER)return!1;this.jqDeleteButton&&this.jqDeleteButton.length&&this.jqDeleteButton.remove()&&(this.jqDeleteButton=null)},u.prototype.addCloseButton=function(e){this.jqCloseButton&&this.jqCloseButton.length||(this.jqCloseButton=jQuery("<span/>").html("&times;"),this.jqCloseButton.css({position:"absolute",top:0,right:0,cursor:"pointer",color:"white",fontSize:"15px",lineHeight:"10px",fontWeight:"bold",padding:"3px"}).on("click",function(t){"function"==typeof e&&e(t)}).appendTo(this.jqMenuWrapper))},u.prototype.removeCloseButton=function(){this.jqCloseButton&&this.jqCloseButton.length&&this.jqCloseButton.remove()&&(this.jqCloseButton=null)},u.prototype.showPreloader=function(){this.jqPreloader&&this.jqPreloader.length&&this.hidePreloader(),this.jqPreloader=jQuery("<div/>").addClass(t.preloader_holder_css_class).append("<img src='"+t.preloader_src+"'>").appendTo(this.jqImgWrapper),this.jqImgWrapper.data("incrementedZIndex")||(this.jqImgWrapper.data("incrementedZIndex",!0),this.jqImgWrapper.css("zIndex",10*parseInt(this.jqImgWrapper.css("zIndex"))||999999)),this.switchOff()},u.prototype.hidePreloader=function(){this.jqPreloader&&this.jqPreloader.length&&this.jqPreloader.remove()&&(this.jqPreloader=null),this.jqImgWrapper.data("incrementedZIndex")&&(this.jqImgWrapper.removeData(),this.jqImgWrapper.css("zIndex",Math.floor(parseInt(this.jqImgWrapper.css("zIndex"))/10)||99999))},u.prototype.reposition=function(){this.layout.reposition()},u.prototype.destroy=function(e){this.reinit(),this.jqImgWrapper.remove(),this.jqImgNode.off("mousemove mouseover mouseout mouseenter mouseleave"),e||this.jqImgNode.removeAttr(o.getInstance().EDITOR_ID_ATTRIBUTE),this.triggerEvent("onDestroy")},u.prototype.show=function(){this.jqDeleteButton&&this.jqDeleteButton.length&&this.jqDeleteButton.show(),this.layout.show()},u.prototype.hide=function(e){this.jqDeleteButton&&this.jqDeleteButton.length&&this.jqDeleteButton.hide(),this.layout.hide(e)},u.prototype.switchOn=function(e){var t=this;this.jqImgWrapper.css("zIndex",parseInt(this.jqImgWrapper.css("zIndex"))||99999).on("mouseenter",function(){t.hideTimer&&(clearTimeout(t.hideTimer),t.hideTimer=null),t.show(),t.jqDeleteButton&&t.jqDeleteButton.length&&t.jqDeleteButton.stop(!0,!0).show(t.ANIMATIONS_SPEED)}).on("mouseleave",function(){t.hideTimer=window.setTimeout(function(){t.hideTimer=null,t.jqDeleteButton&&t.jqDeleteButton.length&&t.jqDeleteButton.stop(!0,!0).hide(t.ANIMATIONS_SPEED),t.hide(function(){!0!==e&&t.destroy(!0)})},200)})},u.prototype.switchOff=function(e){this.jqImgWrapper.off("mouseenter mouseleave"),e&&(this.hide(),this.jqDeleteButton.hide())},u.prototype.checkModule=function(e){var i=!1;for(var n in t.browser_modules)if(t.browser_modules.hasOwnProperty(n)&&jQuery.browser[n])for(var o=0;o<t.browser_modules[n].length;o++)if(t.browser_modules[n][o]===e){i=!0;break}return"function"==typeof e&&!!e.isImageEditorModule&&i},u.prototype.addModule=function(e){this.checkModule(e)&&(this.arModulesSet.push(e),this.triggerEvent("onAddModule",[e]))},u.prototype.resetModules=function(){this.arModulesSet=[]},u.prototype.setDefaultModules=function(){for(var e in this.resetModules(),this.arDefaultModules)this.addModule(this.arDefaultModules[e])},u.prototype.isThumb=function(){return!!this.jqImgNode.attr("src").match(/\/thumbs\//gi)||!!this.jqImgNode.attr("src").match(/\/autothumbs\//gi)},u.prototype.isPopupThumb=function(){return!!this.jqImgNode.parents("."+y.WRAPPER_CSS_CLASS).length},u.prototype.isStub=function(){var e="true"===this.jqImgNode.attr("umi:is-stub"),t=uAdmin.eip.getMSIEStubImgCondition()&&this.jqImgNode[0]&&this.jqImgNode[0].complete&&!this.jqImgNode[0].naturalWidth&&!this.jqImgNode[0].naturalHeight;return e||t},u.prototype.getImageUrl=function(){if(!this._imageUrl)if(this.iImageType===this.IMAGE_TYPE_WYSIWYG)this._imageUrl=this.jqImgNode.attr("src");else{var e=uAdmin.eip.searchAttr(this.jqImgNode),t=jQuery.ajax({async:!1,url:"/udata/content/getImageUrl/"+e.id+"/"+e.field_name+"/.json",type:"GET"}),i=JSON.parse(t.responseText);this._imageUrl=i.result}return this._imageUrl},u.prototype.getCurrentImageUrl=function(){return this.isThumb()?this.getImageUrl():this.jqImgNode.attr("src")},u.prototype.getEipInfo=function(e){return e=e||this.jqImgNode[0],uAdmin.eip.searchAttr(e)},u.prototype.getEipNode=function(){var e=this.getEipInfo();return e&&e.node?e.node:null},u.prototype.getEditorId=function(){return this.sEditorId},u.prototype.checkImageIsEmpty=function(){return this.jqImgNode.attr("src")==this.jqImgNode.attr("umi:empty")},u.prototype.setEnabledModule=function(e){return!(!e||!e.deactivate)&&(this.oEnabledModule=e,o.getInstance().setActiveEditor(this),!0)},u.prototype.getEnabledModule=function(){return this.oEnabledModule},u.prototype.deactivateEnabledModule=function(e){return this.oEnabledModule&&this.oEnabledModule.deactivate&&e?(this.oEnabledModule.cancel(),!!this.oEnabledModule.deactivate()&&(this.oEnabledModule=null,!0)):(this.oEnabledModule=null,!0)},u.prototype.cleanupHtml=function(e){return e.replace(/\sdata-ieditor-id=["']{1}[0-9\._]+["']{1}/gi,"")},u.prototype.isImageInFocus=function(){var e=this.jqImgNode.offset().top,t=this.jqImgNode.offset().top+this.jqImgNode.height(),i=this.jqImgNode.offset().left,n=this.jqImgNode.offset().left+this.jqImgNode.width();return window.mouseX>i&&window.mouseX<n&&window.mouseY>e&&window.mouseY<t},u.prototype.getQueueValue=function(e){if(this.iImageType===this.IMAGE_TYPE_WYSIWYG){var t=this.getEipNode();return t?t.innerHTML:void 0}return void 0!==e?e:this.jqImgNode.attr("src")};var l=function(){l.superclass.constructor.call(this)};uAdmin.inherit(l,u);var c=function(){};c.prototype.show=function(){},c.prototype.hide=function(){},c.prototype.reposition=function(){},c.prototype.initLayout=function(){},c.prototype.init=function(){},c.prototype.reinit=function(){},c.prototype.destroy=function(){},c.prototype.switchOn=function(){},c.prototype.switchOff=function(){};var p=function(){p.superclass.constructor.call(this),this.MODULE_CSS_CLASS=t.module.module_css_class,this.MODULE_ICON_HOLDER_CSS_CLASS=t.module.icon_holder_css_class,this.MODULE_TITLE_HOLDER_CSS_CLASS=t.module.title_holder_css_class,this.BACKEND_REQUEST_URL=t.backend_request_url,this.BACKEND_REQUEST_METHOD=t.backend_request_method,this.title="",this.cssClass="",this.jqElement=null,this.oEditor=null};function h(e){h.superclass.constructor.call(this),this.UPLOAD_URL=t.module.upload_module.url,this.IFRAME_NAME=t.module.upload_module.iframe_name,this.FILE_INPUT_NAME=t.module.upload_module.file_input_name,this.title=getLabel("js-ieditor-module-upload-title"),e.iImageType==e.IMAGE_TYPE_SLIDER?this.cssClass="eip-ieditor-empty":this.cssClass=t.module.upload_module.css_class,this.jqFileInput=null,this.jqForm=null,this.jqIframe=null,this.init(e)}function m(e){m.superclass.constructor.call(this),this.title=getLabel("js-ieditor-module-slider-title"),uAdmin.eip.isEditedImageTypeSlider(e)?this.cssClass="eip-ieditor-module-slider":this.cssClass="eip-ieditor-empty",this.init(e)}function f(e){f.superclass.constructor.call(this),this.title=getLabel("js-ieditor-module-filemanager-title"),e.iImageType==e.IMAGE_TYPE_SLIDER?this.cssClass="eip-ieditor-empty":this.cssClass=t.module.filemanager_module.css_class,this.init(e)}function y(e){y.superclass.constructor.call(this),this.title=getLabel("js-ieditor-module-popup-title"),e.iImageType==e.IMAGE_TYPE_WYSIWYG?this.cssClass=t.module.popup_module.css_class:this.cssClass="eip-ieditor-empty",this.jqWrapper=null,this.bEnabled=!1,this.init(e)}function g(e){g.superclass.constructor.call(this),this.title=getLabel("js-ieditor-module-delete-title"),this.cssClass=t.module.delete_module.css_class,this.init(e)}function v(e){_.superclass.constructor.call(this),this.title=getLabel("js-ieditor-module-apply-title"),this.cssClass=t.module.apply_module.css_class,this.oActiveModule=e.getEnabledModule(),this.init(e)}function _(e){_.superclass.constructor.call(this),this.title=getLabel("js-ieditor-module-cancel-title"),this.cssClass=t.module.cancel_module.css_class,this.oActiveModule=e.getEnabledModule(),this.init(e)}return uAdmin.inherit(p,n),p.prototype.init=function(e){this.oEditor=e,this.jqElement=jQuery("<div/>"),this.jqElement.addClass(this.cssClass),this.jqElement.addClass(this.MODULE_CSS_CLASS),this.jqElement.append(jQuery("<span/>")),jQuery("<span/>").addClass(this.MODULE_TITLE_HOLDER_CSS_CLASS).appendTo(this.jqElement),this.setIcon(this.MODULE_ICON_HOLDER_CSS_CLASS),this.setTitle(this.title),this.bindEvents(),this.triggerEvent("onInit")},p.prototype.setIcon=function(e){var t=this.jqElement.find("span").first();t.get(0).className="",t.addClass(e)},p.prototype.setTitle=function(e){e||(e=this.title),this.title=e,this.jqElement.find("span").first().attr("title",e),this.jqElement.find("span").last().text(e)},p.prototype.bindEvents=function(){var e=this;this.jqElement.on("click",function(t){return t.stopPropagation(),t.stopImmediatePropagation(),t.preventDefault(),e.activate(),!1})},p.prototype.getView=function(e){return!0===e?this.jqElement:this.jqElement[0].outerHTML},p.prototype.activate=function(){o.getInstance().deactivateActiveEditor(),this.oEditor.setEnabledModule(this),this.triggerEvent("onActivate")},p.prototype.deactivate=function(){return this.triggerEvent("onDeactivate"),!0},p.prototype.save=function(){this.triggerEvent("onSave")},p.prototype.cancel=function(){this.triggerEvent("onCancel")},p.prototype.remove=function(){this.jqElement.remove(),this.triggerEvent("onRemove")},p.prototype.process=function(e,t){if(!e)return{result:!1,error:getLabel("js-ieditor-invalid-action")};this.oEditor.showPreloader(),t||(t={}),t.image_url=this.oEditor.jqImgNode.attr("src"),t.empty_url=this.oEditor.jqImgNode.attr("umi:empty"),t.action=e;var i=uAdmin.eip.searchAttr(this.oEditor.jqImgNode[0]);i&&(t.element_id=i.id,t.field_name=i.field_name);var n=jQuery.ajax({async:!1,url:this.BACKEND_REQUEST_URL+e+"/.json",type:this.BACKEND_REQUEST_METHOD,data:t}),o=JSON.parse(n.responseText);return this.processResult(o),o},p.prototype.processResult=function(e){e?e.error&&"string"==typeof e.error?(uAdmin.eip.message(e.error),this.oEditor.hidePreloader()):e.error&&e.error.message?(uAdmin.eip.message(e.error.message),this.oEditor.hidePreloader()):e.result&&e.result.length?this.setNewImage(e.result):(uAdmin.eip.message(getLabel("js-ieditor-request-failed")),this.oEditor.hidePreloader()):(uAdmin.eip.message(getLabel("js-ieditor-request-failed")),this.oEditor.hidePreloader())},p.prototype.addToEipQueue=function(e,t,i){var n=this.oEditor.getEipInfo(i);return!(!n||!n.node)&&(this.oEditor.iImageType==this.oEditor.IMAGE_TYPE_WYSIWYG?(n.old_value=t||n.node.innerHTML,n.new_value=e||n.node.innerHTML.replace(this.oEditor.jqImgNode.attr("src"),e),n.field_type="wysiwyg"):(n.old_value={src:t||this.oEditor.getCurrentImageUrl()},n.new_value={src:e},n.field_type="img_file"),uAdmin.eip.queue.add(n),!0)},p.prototype.getWysiwygContent=function(e){return(e=e||this.oEditor.getEipNode())&&e?tinymce&&tinymce.activeEditor?tinymce.activeEditor.getContent():e.innerHTML:null},p.prototype.setNewImage=function(e,t){var i=this,n=e||"";!1!==t&&(this.oEditor.showPreloader(),n+="?"+(new Date).getTime()),this.oEditor.iImageType==this.oEditor.IMAGE_TYPE_WYSIWYG?(y&&y.changeImage&&y.changeImage(this.oEditor,!e),e?(this.oEditor.jqImgNode.attr("src",n),this.oEditor.jqImgNode.attr("data-mce-src")&&this.oEditor.jqImgNode.attr("data-mce-src",n)):(this.oEditor.jqImgNode.remove(),this.oEditor.jqImgWrapper.remove())):this.oEditor.jqImgNode.attr({src:n,"umi:is-stub":!1}),this.oEditor.jqImgNode.on("load",function(){i.oEditor.hidePreloader(),i.oEditor.jqImgNode&&i.oEditor.jqImgNode.removeAttr("width").removeAttr("height").css({width:"",height:""}),i.oEditor.reinit(),window.setTimeout(function(){uAdmin.eip.normalizeBoxes()},0)}),this.oEditor.triggerEvent("onImageChange",{target:this,sNewSrc:e,sNewSrcNoCache:n})},p.prototype.getImageFromFilemanager=function(e){if("function"!=typeof e)return!1;$element=this.oEditor.jqImgNode;let i=$element.attr("umi:element-id"),n=$element.attr("umi:object-id"),o=$element.attr("umi:field-name"),r=$element.attr("umi:folder-hash"),a=$element.attr("umi:file-hash"),s=[];return s.push("pageId="+(i||"")),s.push("objectId="+(n||"")),s.push("fieldName="+(o||"")),s.push("folder_hash="+(r||"")),s.push("file_hash="+(a||"")),jQuery.openPopupLayer({name:"Filemanager",title:getLabel("js-file-manager"),width:t.filemanager.window_width,height:t.filemanager.window_height,url:t.filemanager.url+"&"+s.join("&"),afterClose:function(t){t&&e(t)},success:function(){var e='<div id="watermark_wrapper"><label for="add_watermark">';e+=window.parent.getLabel("js-water-mark"),e+='</label><input type="checkbox" name="add_watermark" id="add_watermark"/>',e+='<label for="remember_last_folder">',e+=window.parent.getLabel("js-remember-last-dir"),e+='</label><input type="checkbox" name="remember_last_folder" id="remember_last_folder"',jQuery.cookie("remember_last_folder")&&(e+='checked="checked"'),e+="/></div>",window.parent.jQuery("#popupLayer_Filemanager .popupBody").append(e)}}),!0},uAdmin.inherit(h,p),h.isImageEditorModule=!0,h.prototype.init=function(e){var t=this;h.superclass.init.call(this,e),this.jqElement.css({overflow:"hidden",position:"relative"}),this.jqFileInput=jQuery("<input/>").attr({type:"file",name:this.FILE_INPUT_NAME,title:this.title}).css({opacity:0,cursor:"pointer"}).on("click",function(e){e.stopPropagation(),e.stopImmediatePropagation(),t.activate()}),this.jqForm=jQuery("<form/>").attr({method:"post",action:this.UPLOAD_URL,target:this.IFRAME_NAME,enctype:"multipart/form-data"}).css({padding:0,margin:0,border:"none",position:"absolute",top:0,right:0}).appendTo(this.jqElement).append(this.jqFileInput),this.jqForm.append('<input type="hidden" name="action" value="upload">')},h.prototype.activate=function(){h.superclass.activate.call(this),this.oEditor.switchOff();var e=this;jQuery("iframe[name="+this.IFRAME_NAME+"]").remove(),this.jqIframe=jQuery("<iframe/>").attr({name:this.IFRAME_NAME}).css({display:"none"}).appendTo("body").on("load",function(){if(e.bImageChanged){e.oEditor.hidePreloader(),e.oEditor.switchOn();var t=jQuery(this).contents().find("body").text();if(t){var i=e.oEditor.getQueueValue();e.setNewImage(t),e.addToEipQueue(e.oEditor.getQueueValue(t),i)}else uAdmin.eip.message(getLabel("js-ieditor-request-failed"));e.cleanup()}}),this.jqFileInput.on("change",function(){e.oEditor.showPreloader(),e.bImageChanged=!0,e.jqForm.trigger("submit")}),window.setTimeout(function(){e.oEditor.switchOn(!0),jQuery.browser.webkit&&e.oEditor.hide()},1e3)},h.prototype.cleanup=function(){this.oEditor.switchOff(),this.oEditor.switchOn(),this.jqIframe.remove()},uAdmin.inherit(m,p),m.isImageEditorModule=!0,m.prototype.activate=function(){m.superclass.activate.call(this),$.openPopupLayer({name:"SliderEditor",title:getLabel("js-ieditor-module-slider-popup-title"),url:uAdmin.eip.getSliderEditPopupLayerUrl(this.oEditor),width:710,height:700,success:function(){$("#popupLayer_SliderEditor .popupBody").css({padding:"0"}),$("#popupLayer_SliderEditor iframe.umiPopupFrame").css({width:"100%"})}})},uAdmin.inherit(f,p),f.isImageEditorModule=!0,f.prototype.activate=function(){f.superclass.activate.call(this),this.oEditor.switchOff();let e=this;this.getImageFromFilemanager(function(t){let i=e.oEditor.getQueueValue();if(t[0]){let n;try{n=decodeURI(t[0].url)}catch(e){n=t[0].url}e.setNewImage(n),e.addToEipQueue(e.oEditor.getQueueValue(n),i)}}),window.setTimeout(function(){e.oEditor.switchOn(),jQuery.browser.webkit&&e.oEditor.hide()},500)},uAdmin.inherit(y,p),y.isImageEditorModule=!0,y.FANCYBOX_CSS_CLASS=t.module.popup_module.fancybox_css_class,y.WRAPPER_CSS_CLASS=t.module.popup_module.wrapper_css_class,y.THUMB_WIDTH=t.module.popup_module.thumb_width,y.prototype.init=function(e){y.superclass.init.call(this,e),this.jqWrapper=this.oEditor.jqImgNode.parents("."+y.WRAPPER_CSS_CLASS),this.jqWrapper.length?(this.bEnabled=!0,this.setTitle(getLabel("js-ieditor-module-popup-title-active"))):(this.bEnabled=!1,this.setTitle(getLabel("js-ieditor-module-popup-title")),this.jqWrapper=jQuery("<a/>").addClass(y.FANCYBOX_CSS_CLASS).addClass(y.WRAPPER_CSS_CLASS).attr("href",this.oEditor.jqImgNode.attr("src")))},y.prototype.activate=function(){y.superclass.activate.call(this),this.bEnabled?this.turnOff():this.turnOn(),this.oEditor.reinit(),this.oEditor.initLayout(),uAdmin.ieditor.disable(),uAdmin.ieditor.enable()},y.prototype.turnOn=function(){var e=this.oEditor.getEipNode(),t="",i="";e&&(t=this.oEditor.cleanupHtml(e.innerHTML));var n=this.oEditor.jqImgNode.width()/this.oEditor.jqImgNode.height();this.oEditor.jqImgNode.width(y.THUMB_WIDTH).height(Math.round(y.THUMB_WIDTH/n)).attr({width:y.THUMB_WIDTH,height:Math.round(y.THUMB_WIDTH/n)}).wrap(this.jqWrapper).removeAttr("data-mce-style"),e&&(i=this.oEditor.cleanupHtml(e.innerHTML)),tinymce&&tinymce.activeEditor&&tinymce.activeEditor.on("remove",function(){window.setTimeout(fancybox_init,100)}),uAdmin.eip.bind("Disable",function(e){"after"==e&&window.setTimeout(fancybox_init,500)}),this.addToEipQueue(i,t),uAdmin.eip.message(getLabel("js-ieditor-module-popup-title-msg")),uAdmin.eip.normalizeBoxes(),this.bEnabled=!0},y.prototype.turnOff=function(){var e=this.oEditor.getEipNode(),t="",i="";e&&(t=this.oEditor.cleanupHtml(e.innerHTML)),this.jqWrapper=this.oEditor.jqImgNode.parents("."+y.WRAPPER_CSS_CLASS),this.oEditor.jqImgNode.insertAfter(this.jqWrapper),this.jqWrapper.remove(),this.oEditor.jqImgNode[0].style.width="",this.oEditor.jqImgNode[0].style.height="",this.oEditor.jqImgNode.removeAttr("data-mce-style width height"),e&&(i=this.oEditor.cleanupHtml(e.innerHTML)),this.addToEipQueue(i,t),uAdmin.eip.message(getLabel("js-ieditor-module-popup-title-active-msg")),uAdmin.eip.normalizeBoxes(),this.bEnabled=!1},y.changeImage=function(e,t){if(e instanceof u!=!1){var i=new y(e);i.init(e),i.bEnabled&&(t?i.jqWrapper.remove():(i.turnOff(),i.turnOn())),i=null}},uAdmin.inherit(g,p),g.isImageEditorModule=!0,g.prototype.init=function(e){g.superclass.init.call(this,e),this.jqElement.find("."+this.MODULE_ICON_HOLDER_CSS_CLASS).append('<img src="/styles/skins/_eip/images/del_button.svg" alt="×">')},g.prototype.activate=function(){switch(g.superclass.activate.call(this),this.oEditor.iImageType){case this.oEditor.IMAGE_TYPE_EIP:case this.oEditor.IMAGE_TYPE_PHOTOALBUM:var e=this.oEditor.jqImgNode.attr("umi:empty"),t=this.oEditor.jqImgNode.attr("src");this.setNewImage(e,!1),this.oEditor.jqImgNode.attr("umi:is-stub",!0),this.oEditor.redrawMenu(),this.addToEipQueue(e,t);break;case this.oEditor.IMAGE_TYPE_WYSIWYG:var i,n=this.oEditor.getEipNode(),r=this.getWysiwygContent(n);this.setNewImage(""),i=this.getWysiwygContent(n),this.addToEipQueue(i,r,n)}o.getInstance().removeEmptyEditors(),uAdmin.eip.normalizeBoxes(),this.triggerEvent("onActivate")},uAdmin.inherit(v,p),v.isImageEditorModule=!0,v.prototype.activate=function(){this.oActiveModule instanceof p&&(this.oActiveModule.save(),this.oEditor.reinit())},uAdmin.inherit(_,p),_.isImageEditorModule=!0,_.prototype.activate=function(){this.oActiveModule instanceof p&&this.oActiveModule.cancel()},e(i,this)}),uAdmin(".editor",function(e){function t(){}return t.prototype.get=function(e,t){var i=uAdmin.eip.searchAttr(e);return!!i&&(this.info=i,this.files=t,this.load())},t.prototype.load=function(){var e,t,i,n,o,r=uAdmin.eip.queue.search(this.info);if(r){if(r.add){if("name"==this.info.field_name)this.info.field_type="string";else if(jQuery(this.info.node).attr("umi:field-type"))this.info.field_type=jQuery(this.info.node).attr("umi:field-type");else for(n in e=jQuery.ajax({url:"/utype/"+r.type_id+".json",async:!1,dataType:"json"}),(e=JSON.parse(e.responseText)).type.fieldgroups.group){for(o in(n=e.type.fieldgroups.group[n]).field)if((o=n.field[o]).name==this.info.field_name){this.info.field_type=o.type["data-type"];break}if(this.info.field_type)break}return this.info.old_value=jQuery(this.info.node).attr("umi:empty"),this.draw(this.info.field_type)}return this.info.old_value=r.new_value,this.info.field_type=r.field_type,this.info.params=r.params,this.info.node=r.node,"relation"==this.info.field_type&&(this.info.guide_id=r.guide_id,this.info.multiple=r.multiple,this.info.public=r.public),this.draw(r.field_type)}var a=jQuery(this.info.node),s=a.attr("umi:field-type");if(s&&"relation"!=s&&"symlink"!=s)return this.info.field_type=s,"IMG"==this.info.node.tagName?this.info.old_value={src:a.attr("src")}:this.info.old_value=a.attr("umi:empty")&&a.attr("umi:empty")==a.html()?"":a.html(),this.draw(this.info.field_type);t={};var d=jQuery(this.info.node).attr("umi:"+this.info.type+"-id");if(d&&!d.match(/^new/)||(d=jQuery(this.info.node).attr("umi:clone-source-id")||jQuery(this.info.node).parents("[umi\\:"+this.info.type+"-id]").first().attr("umi:clone-source-id")||this.info.id),t[this.info.type+"-id"]=d,t["field-name"]=this.info.field_name,t.qt=(new Date).getTime(),jQuery.ajax({async:!1,type:"POST",url:"/admin/content/editValue/load.json",dataType:"json",data:t}).done(function(t){e=t}),e.error)return uAdmin.eip.message(e.error),!1;if(e.user&&"guest"==e.user.type)return uAdmin.eip.message(getLabel("error-auth-required")),uAdmin.eip.closeMessages(),uAdmin.session.sessionCloseMessage(!0),!1;switch(this.info.old_value={},e.property.type&&a.attr("umi:field-type",e.property.type),e.property.type){case"relation":for(i in e.property.item)this.info.old_value[e.property.item[i].id]=e.property.item[i].name;this.info.guide_id=e.property["guide-id"],this.info.multiple="multiple"==e.property.multiple,this.info.public="public"==e.property.public;break;case"symlink":for(i in e.property.page)this.info.old_value[e.property.page[i].id]={name:e.property.page[i].name,type:{module:e.property.page[i].basetype.module,method:e.property.page[i].basetype.method}};break;default:this.info.old_value=e.property.value}if(jQuery(this.info.node).attr("umi:clone-source-id")||jQuery(this.info.node).parents("[umi\\:clone-source-id]").length){-1!==["img_file","swf_file","file","video_file"].indexOf(e.property.type)?this.info.old_value={src:""}:-1!==["string","text","wysiwyg","int","date","boolean","password","float","formula","price","counter"].indexOf(e.property.type)?this.info.old_value="":this.info.old_value=[]}return this.info.field_type=e.property.type,this.draw(e.property.type)},t.prototype.bindFinishEvent=function(){var e,t,i,n,o,r,a,s=this;jQuery(document).on("click",function(d){if(e=jQuery(d.target),t=e.parents(),i=uAdmin.eip.addPrevOnStack(t),uAdmin.eip.enabled&&"true"!==e.attr("contentEditable")&&!(jQuery.inArray(e.attr("class"),["eip-ui-element","ui-datepicker","symlink-item-delete"])>=0)){if(i.hasClass("eip_win")||i.hasClass("eip-ieditor-img-wrapper")||i.hasClass("eip-ieditor-imgareaselect-wrapper"))return!0;if(i.filter("#mce-modal-block").length||i.filter("#popupLayerScreenLocker").length||i.filter("#jGrowl").length)return!0;if(!e.parents(".eip-ui-element, .ui-datepicker, .ui-datepicker-title, .ui-datepicker-header, .ui-datepicker-calendar").length){if(uAdmin.eip.isBindFinishEventCustomReturn(e))return!0;for(a=0;a<t.length;a++)if(n=t[a],o=jQuery(n),r=uAdmin.eip.addPrevOnStack(o.parents()),"TABLE"!==n.tagName){if("BODY"===n.tagName)break;if("symlink-item-delete"===o.attr("class"))return;if("true"===o.attr("contentEditable"))return;if(o.hasClass("mceMenu")||o.hasClass("mceEditor"))return!0;if(r.hasClass("mceColorSplitMenu")||r.hasClass("mceMenuItem")||r.hasClass("mce-panel")||r.hasClass("eip-ieditor-imgareaselect-wrapper"))return!0}s.finish(!0)}}})},t.prototype.draw=function(e){return"function"==typeof this.draw[e]?this.draw[e](this):(uAdmin.eip.message('Unknown field type "'+e+'"'),!1)},t.prototype.draw.boolean=function(e){t.prototype.YES_TEXT=getLabel("js-cms-eip-editor-yes"),t.prototype.NO_TEXT=getLabel("js-cms-eip-editor-no");var i=uAdmin.eip.nodePositionInfo(e.info.node);if("boolean"!=typeof e.info.old_value){var n=e.info.old_value;switch(n="string"==typeof n?n.trim():n){case t.prototype.NO_TEXT:case"0":e.info.old_value=!1;break;case t.prototype.YES_TEXT:case"1":e.info.old_value=!0;break;default:e.info.old_value=!!e.info.old_value}}if("INPUT"==e.info.node.tagName&&"checkbox"==e.info.node.type)return setTimeout(function(){e.info.new_value=!e.info.old_value,e.info.node.checked=e.info.new_value,e.commit(),e.cleanup()},300),e;var o=document.createElement("input");return o.type="checkbox",document.body.appendChild(o),jQuery(window).on("resize.ns"+e.info.guide_id,function(){var t=uAdmin.eip.nodePositionInfo(e.info.node);jQuery(o).css({left:t.x,top:t.y})}),e.finish=function(i){i&&(e.info.new_value=o.checked,jQuery(e.info.node).text(e.info.new_value?t.prototype.YES_TEXT:t.prototype.NO_TEXT),e.commit()),jQuery(o).remove(),jQuery(window).off("resize.ns"+e.info.guide_id),e.info.node.style.visibility="visible",e.cleanup()},o.checked=!!e.info.old_value,jQuery(o).attr("class","eip-ui-element eip-ui-boolean"),jQuery(o).css({position:"absolute",left:i.x,top:i.y,"z-index":1100}),uAdmin.eip.applyStyles(e.info.node,o),e.info.node.style.visibility="hidden",jQuery(o).on("click",function(){e.finish(!0)}),e},t.prototype.draw.int=function(e){return e.draw.text(e)},t.prototype.draw.float=function(e){return e.draw.text(e)},t.prototype.draw.counter=function(e){return e.draw.text(e)},t.prototype.draw.price=function(e){return e.draw.text(e)},t.prototype.draw.string=function(e){return e.draw.text(e)},t.prototype.draw.tags=function(e){return e.draw.text(e)},t.prototype.draw.color=function(e){var t=jQuery(e.info.node);t.html(""),t.addClass("u-eip-editing");var i=jQuery('<input type="text" class="color_value">').appendTo(t),n=e.info.old_value;i.val(n),"undefined"==typeof colorControl&&jQuery('<script src="/styles/common/js/color.control.js" type="text/javascript" charset="utf-8"><\/script>').appendTo("head");new colorControl(t);function o(){var n=i.val();e.info.new_value=n,t.html(n),e.commit(),t.addClass("u-eip-edit-box"),t.removeClass("u-eip-editing"),t.data("colorpicker",null),jQuery(".u-eip-add-button").css("display","flex"),uAdmin.eip.normalizeBoxes()}return jQuery(document).on("mousedown.color",function(){jQuery(document).off("mousedown.color");var e=t.find(event.target).length>0,i=event.target==t.get(0),n=jQuery("color-picker"),r=n.find(event.target).length>0,a=event.target==n.get(0);e||i||r||a||o()}),t.on("hidePicker",function(){o()}),e},t.prototype.draw.text=function(e,t){var i=jQuery(e.info.node),n=i.html();e.info.old_value||(e.info.old_value=""),t&&""!==e.info.old_value&&(e.info.old_value=e.info.old_value.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"')),"wysiwyg"==e.info.field_type&&uAdmin.wysiwyg.settings.inline||(i[0].innerHTML=e.info.old_value||"&nbsp;",i.attr("contentEditable",!0)),i.trigger("blur").trigger("focus"),e.finish=function(o){if(e.finish=function(){},jQuery(document).off("keyup"),jQuery(document).off("click"),i.attr("contentEditable",!1),jQuery(".u-eip-sortable").sortable("enable"),o){if(!t&&"wysiwyg"!=e.info.field_type){var r=i.html();r.match(/\s<br>$/g)&&(r=r.replace(/<br>$/g,""));var a=r;r=(r=(r=(r=(r=r.replace(/<!--[\w\W\n]*?-->/gim,"")).replace(/<style[^>]*>[\w\W\n]*?<\/style>/gim,"")).replace(/<([^>]+)>/gm,"")).replace(/(\t|\n)/gi," ")).replace(/[\s]{2,}/gi," "),jQuery.browser.safari&&(r=r.replace(/\bVersion:\d+\.\d+\s+StartHTML:\d+\s+EndHTML:\d+\s+StartFragment:\d+\s+EndFragment:\d+\s*\b/gi,"")),r!=a&&i.html(r)}switch(e.info.new_value=i.html()," "!=e.info.new_value&&"&nbsp;"!=e.info.new_value&&"<p>&nbsp;</p>"!=e.info.new_value||(e.info.new_value="",i.html(e.info.new_value)),"wysiwyg"!=e.info.field_type&&"text"!=e.info.field_type?(e.info.new_value=e.info.new_value.trim(),"<br>"==e.info.new_value.substr(-4,4)&&(e.info.new_value=e.info.new_value.substr(0,e.info.new_value.length-4))):e.info.new_value=e.info.new_value.replace(/%[A-z0-9_]+(?:%20)+[A-z0-9_]+%28[A-z0-9%]*%29%/gi,unescape),e.info.field_type){case"int":case"float":case"price":case"counter":e.info.new_value=parseFloat(e.info.new_value)}e.commit()}else i.html(n);e.cleanup()},e.bindFinishEvent();var o=i.width(),r=i.height(),a=null;jQuery(".u-eip-sortable").sortable("disable"),i.trigger("focus");var s=null;return jQuery(document).on("keyup",function(e){o==i.width()&&r==i.height()||(o=i.width(),r=i.height(),a&&clearTimeout(a),a=setTimeout(function(){uAdmin.eip.normalizeBoxes(),a=null},1e3)),46==e.keyCode&&s==i.html().length&&1==s&&i.html("")}).on("keydown",function(t){return 46==t.keyCode&&(s=i.html().length),13==t.keyCode&&"wysiwyg"!=e.info.field_type&&"text"!=e.info.field_type?(e.finish(!0),!1):27!=t.keyCode||(e.finish(!1),!1)}),e},t.prototype.draw.wysiwyg=function(e){var t=jQuery(e.info.node),i=!1,n=!1,o=!1,r=!1;e.draw.text(e,!0),jQuery(document).on("keyup",function(e){if(86==e.keyCode||i||45==e.keyCode&&n){if(!(tinymce&&tinymce.settings&&tinymce.settings.inline)&&uAdmin.eip.isCleanupHtmlOnWysiwygCtrlShift()){var a=function(e){return e=(e=e.replace(/<![\s\S]*?--[ \t\n\r]*>/gi," ")).replace(/<!--.*?-->/gi," "),jQuery.browser.mozilla&&(e=e.replace(/<\/?(style|font|title).*[^>]*>/gi,"")),e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=e.replace(/<\/?(title|style|font|meta)\s*[^>]*>/gi,"")).replace(/\s*mso-[^:]+:[^;""]+;?/gi,"")).replace(/<\/?o:[^>]*\/?>/gi,"")).replace(/ style=['"]?[^'"]*['"]?/gi,"")).replace(/ class=['"]?[^'">]*['"]?/gi,"")).replace(/<span\s*[^>]*>\s*&nbsp;\s*<\/span>/gi," ")).replace(/<span\s*[^>]*>/gi,"")).replace(/<\/span\s*[^>]*>/gi,"")).replace(/<\/(b|i|s|u|strong|center)>[\t\n]*<\1[^>]*>/gi,"")).replace(/<\/(b|i|s|u|strong|center)>\s*<\1[^>]*>/gi," ")).replace(/<(b|i|s|u|strong|center)[^>]*>[\s\t\n\xC2\xA0]*<\/\1>/gi,"")).replace(/(\t|\n)/gi," ")).replace(/[\s]{2,}/gi," "),jQuery.browser.safari&&(e=e.replace(/\bVersion:\d+\.\d+\s+StartHTML:\d+\s+EndHTML:\d+\s+StartFragment:\d+\s+EndFragment:\d+\s*\b/gi,"")),e}(t.html());a!=t.html()&&t.html(a)}i&&!e.ctrlKey&&(i=!1),n&&!e.shiftKey&&(n=!1)}switch(e.keyCode){case 16:r||(n=!1);break;case 17:o||(i=!1);break;case 45:r=!1;break;case 86:o=!1}}).on("keydown",function(e){switch(e.keyCode){case 16:n=!0;break;case 17:i=!0;break;case 45:r=!0;break;case 86:o=!0}});var a=uAdmin.wysiwyg.init(e.info.node),s=e.finish;return e.finish=function(e){a&&a.destroy(),s(e),uAdmin.eip.bindEvents()},e},t.prototype.draw.file=function(e,t){var i,n,o,r="./images/cms/data/",a="";if(e.finish=function(i){i&&("IMG"==e.info.node.tagName?e.info.node.src=e.info.new_value.src:t?e.info.node.style.backgroundImage="url("+e.info.new_value.src+")":e.info.node.innerText=e.info.new_value.src.substr(e.info.new_value.src.lastIndexOf("/")+1),e.commit(),uAdmin&&uAdmin.eip&&uAdmin.eip.reinitEmptyLists&&uAdmin.eip.reinitEmptyLists()),e.cleanup()},e.info.old_value&&(null==e.info.old_value.src&&(e.info.old_value={src:e.info.old_value}),a=e.info.old_value.src.split(/\//g).pop(),r="."+e.info.old_value.src.substr(0,e.info.old_value.src.length-a.length-1)),e.files&&e.files.length)(i=e.files[0]).folder=r,e.info.old_value&&(i.file=e.info.old_value.src),t&&(i.image=1),n=jQuery.ajax({url:"/admin/filemanager/uploadfile/&csrf="+uAdmin.csrf,async:!1,data:i,type:"POST",dataType:"json"}),(n=JSON.parse(n.responseText)).file.path?(e.new_value=n.file.path,e.finish(!0)):e.finish();else{o={folder:r,file:e.info.old_value?e.info.old_value.src:""},n=jQuery.ajax({url:"/admin/filemanager/get_filemanager_info/",async:!1,data:o,type:"POST",dataType:"json"}),n=JSON.parse(n.responseText);var s="folder="+r;e.info.old_value&&(s+="&file="+e.info.old_value.src),t&&(s+="&image=1");var d={flash:{height:460,url:"/styles/common/other/filebrowser/umifilebrowser.html?"+s},elfinder:{height:600,url:"/styles/common/other/elfinder/umifilebrowser.html?"+s+"&lang="+n.lang+"&file_hash="+n.file_hash+"&folder_hash="+n.folder_hash}};if(jQuery.openPopupLayer({name:"Filemanager",title:getLabel("js-file-manager"),width:1200,height:d[n.filemanager].height,url:d[n.filemanager].url,afterClose:function(t){t?("object"==typeof t&&(t=t[0]),e.info.new_value=t?{src:t.toString()}:"",e.finish(!0)):e.finish()}}),"elfinder"==n.filemanager){var u='<div id="watermark_wrapper"><label for="add_watermark">';u+=getLabel("js-water-mark"),u+='</label><input type="checkbox" name="add_watermark" id="add_watermark"/>',u+='<label for="remember_last_folder">',u+=getLabel("js-remember-last-dir"),u+='</label><input type="checkbox" name="remember_last_folder" id="remember_last_folder"',jQuery.cookie("remember_last_folder")&&(u+='checked="checked"'),u+="/></div>",jQuery("#popupLayer_Filemanager .popupBody").append(u)}}return e},t.prototype.draw.img_file=function(e){return e.draw.file(e,!0)},t.prototype.draw.video_file=function(e){return e.draw.file(e)},t.prototype.draw.date=function(e){var t;e.info.old_value!=jQuery(e.info.node).attr("umi:empty")&&(t=e.info.old_value),(t=moment(t,["DD-MM-YYYY hh:mm","DD-MM-YYYY","YYYY-MM-DD hh:mm","YYYY-MM-DD"])).isValid()||(t=moment()),e.info.old_value=t.format("DD-MM-YYYY"),e.draw.text(e);var i=uAdmin.eip.nodePositionInfo(e.info.node),n=jQuery("#u-datepicker-input");return n.length||((n=document.createElement("input")).id="u-datepicker-input",document.body.appendChild(n)),jQuery(window).on("resize.ns"+e.info.guide_id,function(){var t=uAdmin.eip.nodePositionInfo(e.info.node);jQuery(".ui-datepicker-trigger").css({left:t.x+t.width+5,top:t.y}),jQuery(n).css({left:t.x+t.width+5,top:t.y})}),e.finish=function(t){jQuery(window).off("resize.ns"+e.info.guide_id),jQuery(n).datepicker("destroy"),jQuery(".ui-datepicker-trigger").remove(),e.info.new_value||(e.info.new_value=jQuery(e.info.node).html()),e.cleanup(),e.commit()},jQuery(n).css({position:"absolute",left:i.x+i.width+5,top:i.y,width:"1",height:"1",visibility:"hidden","font-size":"62.5%","z-index":555}),jQuery(n).datepicker(jQuery.extend({},jQuery.datepicker.regional[uAdmin.data.lang],{showOn:"button",buttonImage:"/styles/common/other/calendar/icons_calendar_eip.png",buttonImageOnly:!0,dateFormat:"dd-mm-yy",defaultDate:t.toDate(),onSelect:function(t){e.info.new_value=t,jQuery(e.info.node).html(t),jQuery(e.info.node).trigger("focus")}})),jQuery(e.info.node).html(e.info.old_value),uAdmin.eip.placeWith(e.info.node,jQuery(".ui-datepicker-trigger"),"right","middle"),e.info.id||(e.info.old_value=""),jQuery(".ui-datepicker-trigger").css({left:i.x+i.width+5,top:i.y}),e},t.prototype.draw.relation=function(e){jQuery(document).one("mouseup",function(){setTimeout(function(){e.bindFinishEvent()},100)}),setTimeout(function(){jQuery(document).off("mouseup"),e.bindFinishEvent()},1e3);var t=uAdmin.eip.nodePositionInfo(e.info.node),i=document.createElement("select"),n=document.createElement("input");if(document.body.appendChild(i),e.info.guide_id&&e.info.public){var o=document.createElement("input");o.type="button",o.value=" ",o.id="relationButton"+e.info.guide_id,o.className="relationAddButton",document.body.appendChild(o)}for(var r in jQuery(i).attr("class","eip-ui-element"),jQuery(i).css({position:"absolute",left:t.x,top:t.y,"z-index":1100}),uAdmin.eip.applyStyles(e.info.node,i,uAdmin.eip.isRelationDrawApplyDimentions()),jQuery(e.info.node).css("visibility","hidden"),e.info.multiple&&(jQuery(i).attr("multiple","multiple"),jQuery(i).attr("size",3)),e.info.old_value){var a=document.createElement("option");jQuery(a).attr("value",r),jQuery(a).attr("selected","selected"),jQuery(a).html(e.info.old_value[r]),i.appendChild(a)}jQuery(i).trigger("focus"),jQuery(i).attr("name","rel_input"),jQuery(i).attr("id","relationSelect"+e.info.guide_id),document.body.appendChild(n),uAdmin.eip.applyStyles(e.info.node,n),jQuery(n).attr({id:"relationInput"+e.info.guide_id,class:"eip-ui-element",name:"rel_input_new"}),void 0===relationControl&&jQuery('<script src="/styles/common/js/relation.control.js" type="text/javascript" charset="utf-8"><\/script>').appendTo("head");var s=new relationControl(e.info.guide_id,null,!0,"/admin/data/guide_items_all/");if(jQuery(window).on("resize.ns"+e.info.guide_id,function(){var t=uAdmin.eip.nodePositionInfo(e.info.node);jQuery(i).css({left:t.x,top:t.y}),jQuery(n).css({left:t.x,top:t.y+jQuery(i).height()+5}),jQuery(o).css({left:t.x+jQuery(n).width()+5,top:t.y+jQuery(i).height()+Math.round((jQuery(n).height()-jQuery(o).height())/2)})}),e.finish=function(){var t=[];for(var r in e.info.new_value=s.getValue(),e.commit(),e.info.new_value)t.push(e.info.new_value[r]);e.info.node.innerHTML=t.join(", "),e.info.node.style.visibility="visible",jQuery(i).resizable();try{jQuery(i).resizable("destroy")}catch(e){jQuery(i).resizable({disabled:!0})}jQuery(i).remove(),jQuery(n).remove(),jQuery(o).remove(),jQuery("#u-ep-search-trigger").remove(),jQuery(window).off("resize.ns"+e.info.guide_id),e.cleanup()},s.loadItemsAll(),e.info.multiple){var d=jQuery(i).height();d<150&&(d=75,jQuery(i).css("height",d)),jQuery(i).resizable({minWidth:jQuery(i).width(),maxWidth:jQuery(i).width(),minHeight:d,maxHeight:350}),jQuery(".ui-wrapper").css("z-index","1100")}var u=jQuery(i).width(),l=jQuery(n).width(),c=uAdmin.eip.getRelationSearchFieldWidth(i);return c&&(l=u=c),jQuery(n).css({position:"absolute",width:u,left:t.x,top:t.y+jQuery(i).height()+5,"z-index":1111}),jQuery(o).css({position:"absolute",left:t.x+l+5,top:t.y+jQuery(i).height()+Math.round((jQuery(n).height()-jQuery(o).height())/2),"z-index":1112}),e},t.prototype.draw.symlink=function(e){jQuery(document).one("mouseup",function(){setTimeout(function(){e.bindFinishEvent()},100)}),setTimeout(function(){jQuery(document).off("mouseup"),e.bindFinishEvent()},1e3);var t=jQuery(e.info.node).attr("umi:type")?jQuery(e.info.node).attr("umi:type").split("::"):[],i=uAdmin.eip.nodePositionInfo(e.info.node),n=jQuery('<div><div id="symlinkInput'+e.info.id+'" /></div>').attr({class:"eip-ui-element"}).css({position:"absolute",left:i.x,top:i.y,"z-index":1100}).appendTo("body"),o=jQuery(e.info.node).outerWidth(),r=o>150?o:150;jQuery("#symlinkInput"+e.info.id).width(r),void 0===symlinkControl&&jQuery('<script src="/styles/common/js/symlink.control.js" type="text/javascript" charset="utf-8"><\/script>').appendTo("head");var a=new symlinkControl(e.info.id,t[0]||null,t,{inputName:e.info.field_name+"[]",fadeColorStart:[255,255,225],fadeColorEnd:[255,255,255]});for(var s in jQuery.isEmptyObject(e.info.old_value)&&a.addPlaceHolder(),e.info.old_value)0===t.length&&(t=[e.info.old_value[s].type.module,e.info.old_value[s].type.method]),a.addItem(s,e.info.old_value[s].name,t,"");return jQuery(e.info.node).css("visibility","hidden"),jQuery(window).on("resize.ns"+e.info.guide_id,function(){var t=uAdmin.eip.nodePositionInfo(e.info.node);jQuery(n).css({left:t.x,top:t.y})}),e.finish=function(){var t=jQuery('input[name="'+e.info.field_name+'[]"]'),i=[];for(jQuery(e.info.node).css("visibility","visible"),e.info.new_value={},s=0;s<t.length;s++)if(t[s].value){var o=jQuery("ul li span",n)[s-1],r=jQuery(o).data("basetype").split(" ");e.info.new_value[t[s].value]={name:jQuery("ul li span",n)[s-1].innerHTML,type:{module:r[0],method:r[1]}},i.push(e.info.new_value[t[s].value].name)}e.info.node.innerHTML=i.join(", "),e.commit(),n.resizable();try{n.resizable("destroy")}catch(e){n.resizable({disabled:!0})}n.remove(),jQuery("div.symlinkAutosuggest").remove(),jQuery("#u-ep-search-trigger").remove(),jQuery(window).off("resize.ns"+e.info.guide_id),e.cleanup()},a.loadItems(),e},t.prototype.replace=function(e,t,i){return!!e&&this.replace[e.field_type](e,t,i)},t.prototype.replace.img_file=function(e,t,i){var n,o,r,a,s=!1,d=jQuery(e.node),u=function(e,t){return e==t};if("IMG"==e.node.tagName){if(u(d.attr("src"),i.src||""))e.node.src=t.src||"",s=!0;else if((a=e.node.src).indexOf("/images/cms/thumbs/")>=0||a.indexOf("autothumbs.php")>=0){var l=d.width(),c=d.height(),p=e.node.src;-1!=p.indexOf(l)&&-1==p.indexOf(c)&&(c="auto"),-1==p.indexOf(l)&&-1!=p.indexOf(c)&&(l="auto"),e.node.src=function(e,t,i){var n=(e=e.toString()).split(/\./g);if(n.length<2)return!1;var o=n[n.length-1].toString(),r=(n=n[n.length-2].toString().split(/\//g))[n.length-1].toString();return"/autothumbs.php?img="+e.substr(0,e.length-r.length-o.length-1)+r+"_"+t+"_"+i+"."+o}(t.src,l,c),s=!0}d.one("load",function(){uAdmin.eip.normalizeBoxes()})}var h=e.node.style.backgroundImage.replace(/"/g,"");if("url("!=h.substr(0,4)){if(!s&&d.attr("childNodes"))for(n=d.attr("childNodes"),r=0;r<n.length;r++)(o=n.item(r))&&jQuery(o).attr("tagName")&&replaceImage(jQuery(o),t.src,i.src);return s}h=h.substring(4,h.length-1);var m=window.location.protocol+"//"+window.location.host;if(h.substr(0,m.length)==m&&(h=h.substr(m.length)),!h)return s;if(u(h,i.src)&&(e.node.style.backgroundImage="url("+t.src+")",s=!0),!s&&d.attr("childNodes"))for(n=d.attr("childNodes"),r=0;r<n.length;r++)(o=n.item(r))&&jQuery(o).attr("tagName")&&replaceImage(jQuery(o),t.src,i.src);return s},t.prototype.replace.video_file=function(e,t,i){var n;return(n="UmiVideoPlayer",-1!=navigator.appName.indexOf("Microsoft")?window[n]:document[n]).setVideoFile(t),!0},t.prototype.replace.boolean=function(e,t,i){return"INPUT"==e.node.tagName&&"checkbox"==e.node.type?e.node.checked=!!t:jQuery(e.node).html(t?getLabel("js-cms-eip-editor-yes"):getLabel("js-cms-eip-editor-no")),!0},t.prototype.replace.relation=function(e,t,i){var n,o=[];for(n in t)o.push(t[n]);return jQuery(e.node).html(o.join(", ")),!0},t.prototype.replace.symlink=function(e,t,i){var n,o="";for(n in t)o+="<span>"+t[n]+"</span><br />";return jQuery(e.node).html(o),!0},t.prototype.replace.int=function(e,t,i){return this.text(e,t,i)},t.prototype.replace.float=function(e,t,i){return this.text(e,t,i)},t.prototype.replace.counter=function(e,t,i){return this.text(e,t,i)},t.prototype.replace.price=function(e,t,i){return this.text(e,t,i)},t.prototype.replace.string=function(e,t,i){return jQuery(e.node).html(t)},t.prototype.replace.tags=function(e,t,i){return this.text(e,t,i)},t.prototype.replace.text=function(e,t,i){return jQuery(e.node).html(t)},t.prototype.replace.wysiwyg=function(e,t,i){return jQuery(e.node).html(t||"&nbsp;")},t.prototype.replace.file=function(e,t,i){return this.text(e,t,i)},t.prototype.replace.date=function(e,t,i){return this.text(e,t,i)},t.prototype.commit=function(){uAdmin.eip.trigger("ActiveEditorCommit","before");var e=this.info.new_value,t=this.info.old_value;this.info.field_type.match(/file/)&&(e=this.info.new_value.src,t=this.info.old_value?this.info.old_value.src:""),this.equals(e,t)?uAdmin.eip.queue.search(this.info)&&jQuery(this.info.node).addClass("u-eip-modified"):(jQuery(this.info.node).addClass("u-eip-modified"),uAdmin.eip.queue.add(this.info)),uAdmin.eip.trigger("ActiveEditorCommit","after")},t.prototype.cleanup=function(){uAdmin.eip.bindEvents(),this.finish=function(){this.cleanup()},uAdmin.eip.highlightNode(this.info.node),jQuery(".u-eip-add-button").css("display","flex"),uAdmin.eip.normalizeBoxes(),this.info.node.blur(),jQuery(this.info.node).removeClass("u-eip-editing")},t.prototype.finish=function(){this.cleanup()},t.prototype.equals=function(){var e,t=!1,i=arguments,n=Object.prototype.toString,o={length:0};switch(!0){case 2!==i.length:case typeof i[0]!=typeof i[1]:case n.call(i[0])!==n.call(i[1]):break;default:switch(typeof i[0]){case"undefined":break;case"object":if("[object Array]"==n.call(i[0])){if(t=i[0].length===i[1].length){for(e=0;e<i[0].length;e++)o[i[0][e]]=e,++o.length;for(e=0;e<i[1].length;e++)delete o[i[0][e]]&&--o.length;0===o.length&&(t=!0)}}else{for(e in i[0])o[e]=e,++o.length;for(e in i[1])delete o[e]&&--o.length;if(0===o.length&&(t=!0),t)for(e in i[0])if(!(t=this.equals(i[0][e],i[1][e])))break}break;default:t=i[0]===i[1]}}return t},e(t,this)},"eip"),uAdmin(".wysiwyg",function(extend){function WYSIWYG(){this.settings=jQuery.extend(this[this.type].settings,this.settings),this[this.type](),this.init=this[this.type].init}return WYSIWYG.prototype.init=function(){return!1},WYSIWYG.prototype.settings=function(){return!1},WYSIWYG.prototype.tinymce47=function(){window.tinyMCEPreInit={suffix:".min",base:"/styles/common/js/node_modules/tinymce"},window.tinymce||$('<script src="/styles/common/js/node_modules/tinymce/tinymce.min.js" charset="utf-8"><\/script>').appendTo("head"),window.mceCustomSettings||$('<script src="/styles/common/js/cms/wysiwyg/tinymce47/tinymce_custom.js" charset="utf-8"><\/script>').appendTo("head")},WYSIWYG.prototype.tinymce47.init=function(e){if(!tinyMCE)throw"tinyMCE is not defined";e=e||{};var t={},i="textarea.wysiwyg";uAdmin.eip&&uAdmin.eip.editor&&(i="#"+(t={id:"mceEditor-"+(new Date).getTime(),destroy:function(){tinymce&&tinymce.activeEditor&&tinymce.activeEditor.destroy()}}).id,e.id=t.id,e.inline=!0,tinymce.on("AddEditor",function(e){e.editor.on("init",function(){this.fire("focus")})}));var n={language:uAdmin.data["interface-lang"]||uAdmin.data.lang,language_url:"/styles/common/js/cms/wysiwyg/tinymce47/langs/ru.js",external_plugins:{codemirror:"/styles/common/js/cms/wysiwyg/tinymce47/plugins/codemirror/plugin.min.js"}};return $.extend(n,this.settings,window.mceCustomSettings,e.settings||{}),tinyMCE.init(n),"string"==typeof e.selector&&(i=e.selector),jQuery(i).each(function(e,t){tinyMCE.execCommand("mceToggleEditor",!1,t.id)}),t},WYSIWYG.prototype.tinymce47.settings={branding:!1,theme:"modern",skin:"lightgray",paste_as_text:!0,extended_valid_elements:"script[src|*],style[*],map[*],area[*],umi:*[*],input[*],noindex[*],nofollow[*],iframe[frameborder|src|width|height|name|align],div[*],span[*],a[*],-p[*]",plugins:["anchor","advlist","charmap","codemirror","contextmenu","fullscreen","image","link","lists","media","paste","searchreplace","table","textcolor","visualchars"],image_advtab:!0,image_caption:!0,toolbar:"paste pastetext undo redo removeformat link unlink anchor image media table charmap code blockquote formatselect fontselect fontsizeselect bold italic strikethrough underline alignleft aligncenter alignright alignjustify bullist numlist outdent indent forecolor backcolor subscript superscript",menubar:!1,resize:!0,min_height:300,codemirror:{indentOnInit:!0,path:"codemirror",width:1e3,height:500,config:{lineNumbers:!0,lineWrapping:!0,autofocus:!0}},convert_urls:!1,relative_urls:!1,file_browser_callback:function(){uAdmin.wysiwyg.umiFileBrowserCallback.apply(uAdmin.wysiwyg,arguments)},urlconverter_callback:function(e){var t=e.match(/^%content%20get_page_url\((\d+)\)%$/);return null===t?e:"%content get_page_url("+t[1]+")%"},valid_children:"+a[div|p|span],+div[li]"},WYSIWYG.prototype.umiFileBrowserCallback=function(fieldName,url,type,win){switch(type){case"file":return uAdmin.wysiwyg.umiTreeLink(fieldName,url,type,win);case"image":case"media":var input=win.document.getElementById(fieldName);if(!input)return!1;var folder="",file="";input.value.length&&(folder=input.value.substr(0,input.value.lastIndexOf("/")),file=input.value),jQuery.ajax({url:"/admin/filemanager/get_filemanager_info/",data:"folder="+folder+"&file="+file,dataType:"json",complete:function(data){data=JSON.parse(data.responseText);var folderHash=data.folder_hash,fileHash=data.file_hash,lang=data.lang,fileManager=data.filemanager;if("elfinder"===fileManager)return uAdmin.wysiwyg.umielfinderFileManager(fieldName,url,type,win,lang,folderHash,fileHash);var functionName="uAdmin.wysiwyg.umi"+fileManager+"FileManager";eval(functionName+"(fieldName, url, type, win, lang, folderHash, fileHash)")}});break;default:throw"Invalid type"}return!1},WYSIWYG.prototype.umielfinderFileManager=function(e,t,i,n,o,r,a){var s=[];switch(s.push("id="+e),i){case"image":s.push("image=1");break;case"media":s.push("media=1")}let d=0,u=0,l="",c=$(n.document.getElementById(tinyMCE.EditorManager.activeEditor.id));if(c.is("textarea")){d=n.page_id,u=n.object_id;let e=/data\[(\d{1,6})\]\[(.+?)\]/.exec(c.attr("name"));e&&(l=u==e[1]?e[2]:l)}else u=(d=c.attr("umi:element-id"))==n.pageData.pageId?n.pageData.objectId:"",l=c.attr("umi:field-name");s.push("pageId="+(d||"")),s.push("objectId="+u),s.push("fieldName="+(l||"")),s.push("folder_hash="+r),s.push("file_hash="+a),s.push("lang="+o),$.openPopupLayer(jQuery.extend({name:"Filemanager",title:getLabel("js-file-manager"),width:1200,height:600,url:"/styles/common/other/elfinder/umifilebrowser.html?"+s.join("&")},uAdmin.wysiwyg.getOpenPopupLayerExtParams(e,n)));var p="#popupLayer_Filemanager .popupBody",h=uAdmin.wysiwyg.getFilemanagerFooter("elfinder");return tinymce&&tinymce.activeEditor&&tinymce.activeEditor.settings.inline?jQuery(p).append(h):window.parent.jQuery(p).append(h),!1},WYSIWYG.prototype.getOpenPopupLayerExtParams=function(e,t){return{}},WYSIWYG.prototype.umiTreeLink=function(e,t,i,n){var o,r,a;if(window.pageData)o=window.pageData.domain,r=window.pageData.domain_id,a=window.pageData.lang_id;else{if(!uAdmin||!uAdmin.data)throw"Page data is not defined";o=uAdmin.data["domain-floated"],r=uAdmin.data["domain-id"],a=uAdmin.data["lang-id"]}var s="?from=tinymce&domain="+o+"&domain_id="+r+"&lang_id="+a,d="/styles/common/js/tree.html"+s,u=320;return 3==tinyMCE.majorVersion&&(d="/js/cms/wysiwyg/tinymce/jscripts/tiny_mce/themes/umi/treelink.html"+s,u=308),tinyMCE.activeEditor.windowManager.open({url:d,title:getLabel("js-choose-page"),width:525,height:u,inline:!0,scrollbars:!1,resizable:!1,maximizable:!1,close_previous:!1},{window:n,input:e,editor_id:tinyMCE.activeEditor.id}),!1},WYSIWYG.prototype.getFilemanagerFooter=function(e){var t="";return"elfinder"===e&&(getCookie=$.cookie||getCookie,t='<div id="watermark_wrapper"><label for="add_watermark">',t+=getLabel("js-water-mark"),t+='</label><input type="checkbox" name="add_watermark" id="add_watermark"/>',t+='<label for="remember_last_folder">',t+=getLabel("js-remember-last-dir"),t+='</label><input type="checkbox" name="remember_last_folder" id="remember_last_folder"',getCookie("remember_last_folder")&&(t+='checked="checked"'),t+="/></div>"),t},defineDeprecatedWysiwygFunctions(WYSIWYG),extend(WYSIWYG,this)}),uAdmin.onLoad("wysiwyg",function(){uAdmin.wysiwyg.curr_mouse_position={top:0,left:0},$("body").on("click",function(e){uAdmin.wysiwyg.curr_mouse_position={top:e.pageY-window.pageYOffset,left:e.pageX-window.pageXOffset}})}),uAdmin(".session",function(e){function t(){var e=this;e.access=!!e.access,e.lifetime=parseInt(e.lifetime)||10,e.pingInterval=Math.min(60*e.lifetime/2,300),e.awayTimeout=0,e.lastPingedTime=new Date,e.currentMessage=null,this.lastActionTime=new Date,jQuery(document).on("click keydown mousedown",null,function(t){e.eventHandler(t)}),setTimeout(function(){jQuery("iframe").each(function(){try{var t=this.contentWindow||this.contentDocument;t.document&&jQuery(t.document).on("click keydown mousedown",function(t){e.eventHandler(t)})}catch(e){}})},5e3),e.pingIntervalHandler=setInterval(function(){e.pingHandler()},1e3*e.pingInterval)}return t.prototype.sessionAjax=function(e,t){jQuery.get("/session.php",e,function(e){"function"==typeof t&&t(e)})},t.prototype.login=function(e,t,i){this.sessionAjax({"u-login":e,"u-password":t,a:"ping"},function(e){"function"==typeof i&&i("-1"!=e)})},t.prototype.check=function(){var e=this;this.sessionAjax(null,function(t){e.checkHandler(t)})},t.prototype.ping=function(e){var t=this;(new Date).getTime()-t.lastPingedTime.getTime()<5e3&&!e||(t.lastPingedTime=new Date,t.sessionAjax({a:"ping"},function(e){t.checkHandler(e)}))},t.prototype.checkHandler=function(e){switch(e){case"-1":case"0":this.showCloseMessage(!0);break;default:if(this.awayTimeout=parseInt(e,10),this.awayTimeout<=this.pingInterval+10)this.showWarningMessage();else{if(!this.pingIntervalHandler){var t=this;this.pingIntervalHandler=setInterval(function(){t.pingHandler()},1e3*this.pingInterval)}this.closeMessage()}}},t.prototype.isUserActive=function(){return!!getCookie("umi-auth-token")||((new Date).getTime()-this.lastActionTime.getTime())/1e3<this.pingInterval},t.prototype.eventHandler=function(e){switch(this.lastActionTime=new Date,this.currentMessage){case"warning":this.closeMessage(),this.ping(!0);case"close":if(this.jgrowl&&$.contains(this.jgrowl[0],e.target))return;this.ping()}},t.prototype.pingHandler=function(){this.isUserActive()?this.ping():this.check()},t.prototype.showWarningMessage=function(e){var t=this;e&&(clearInterval(t.timer),t.timer=null),t.currentMessage="warning",t.timer||(t.timer=setInterval(function(){if(t.awayTimeout>0){var e=t.awayTimeout,i=e%60;i<10&&(i="0"+i);var n=parseInt(e/60)+":"+i,o=parseInt((60*t.lifetime-t.awayTimeout)/60);t.message(getLabel("js-session-is-away")+" "+o+" "+getLabel("js-minutes")+". "+getLabel("js-session-warning")+"<br/>"+n),t.awayTimeout--}else t.closeMessage(),t.check()},1e3))},t.prototype.showCloseMessage=function(e){var t=this;if(e&&(clearInterval(t.timer),t.timer=null),"close"!=t.currentMessage){t.currentMessage="close",t.pingIntervalHandler&&(clearInterval(t.pingIntervalHandler),t.pingIntervalHandler=0);var i=jQuery("<div><br />"+getLabel("js-session-was-away")+" "+t.lifetime+" "+getLabel("js-minutes")+", "+getLabel("js-session-close")+"<br/><br/></div>"),n=jQuery('\n\t\t\t<form>\n\t\t\t\t<table cellspacing="5" width="100%">\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>'+getLabel("js-label-login")+': </td>\n\t\t\t\t\t\t<td><input type="text" name="session_contorl_login" /></td>\n\t\t\t\t\t</tr>\n\t\t\t\t\t<tr>\n\t\t\t\t\t\t<td>'+getLabel("js-label-password")+':</td>\n\t\t\t\t\t\t<td><input type="password" name="session_contorl_passsword" /></td>\n\t\t\t\t\t</tr>\n\t\t\t\t</table>\n\t\t\t\t<br/>\n\t\t\t\t<input type="submit" value="'+getLabel("js-label-login-do")+'">\n\t\t\t</form>\n\t\t').appendTo(i);t.access&&jQuery("<br/> <br/><a href='/admin/config/main/' target='_blank'>"+getLabel("js-session-lifetime-configure")+"</a>").appendTo(n),n.on("submit",function(){var e=(this.session_contorl_login.value||"").trim(),i=(this.session_contorl_passsword.value||"").trim();return e&&i?t.login(e,i,function(e){e?(jQuery.getJSON("/admin/config/main/.json",{},function(e){uAdmin.csrf&&uAdmin.csrf!=e.csrf?uAdmin.csrf=e.csrf:csrfProtection&&csrfProtection.getToken()!=e.csrf&&csrfProtection.changeToken(e.csrf)}),t.closeMessage(),t.pingIntervalHandler=setInterval(function(){t.pingHandler()},1e3*t.pingInterval),jQuery.jGrowl(getLabel("js-session-restored"),{header:"UMI.CMS",life:5e3})):jQuery.jGrowl(getLabel("js-label-text-error"),{header:"UMI.CMS",life:5e3})}):jQuery.jGrowl(getLabel("js-label-text-error"),{header:"UMI.CMS",life:5e3}),!1}),t.message(i)}},t.prototype.message=function(e){var t=this;if("string"==typeof e&&(e="<br/><p> "+e+" </p>"),!t.jgrowl)return t.jgrowl=-1,void jQuery.jGrowl(e,{header:"UMI.CMS",dont_close:!0,beforeOpen:function(e){t.jgrowl=jQuery(e)},close:function(){t.closeMessage(),t.ping(!0)}});if(-1!=t.jgrowl){var i=t.jgrowl.find(".jGrowl-message");"string"==typeof e?i.html(e):(i.html(""),i.append(e))}},t.prototype.closeMessage=function(){this.currentMessage=null,this.timer&&(clearInterval(this.timer),this.timer=null),this.jgrowl&&-1!=this.jgrowl&&(this.jgrowl.mouseout(),this.jgrowl.remove(),this.jgrowl=null)},t.prototype.destroy=function(){return this.pingIntervalHandler&&(clearInterval(this.pingIntervalHandler),this.pingIntervalHandler=0),this.timer&&(clearInterval(this.timer),this.timer=null),!0},e(t,this)});var hex=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function makeHexRgb(e){for(var t="",i=0;i<3;i++)t=t+hex[Math.floor(e[i]/16)]+hex[Math.floor(e[i]%16)];return"#"+t}