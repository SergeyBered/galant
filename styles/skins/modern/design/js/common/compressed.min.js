var rus2eng={"А":"A","Б":"B","В":"V","Г":"G","Д":"D","Е":"E","Ё":"YO","Ж":"ZH","З":"Z","И":"I","Й":"J","К":"K","Л":"L","М":"M","Н":"N","О":"O","П":"P","Р":"R","С":"S","Т":"T","У":"U","Ф":"F","Х":"H","Ц":"C","Ч":"CH","Ш":"SH","Щ":"W","Ъ":"","Ы":"Y","Ь":"","Э":"E","Ю":"YU","Я":"YA","а":"a","б":"b","в":"v","г":"g","д":"d","е":"e","ё":"yo","ж":"zh","з":"z","и":"i","й":"j","к":"k","л":"l","м":"m","н":"n","о":"o","п":"p","р":"r","с":"s","т":"t","у":"u","ф":"f","х":"h","ц":"c","ч":"ch","ш":"sh","щ":"w","ъ":"","ы":"y","ь":"","э":"e","ю":"yu","я":"ya"},eng2rus={"А":"A",YA:"Я"},rus2engRE=/(?:[А-Яа-я])/g,eng2rusRE=/(?:YA|A)/g;function trCallbackRu(e){return rus2eng[e]}function trCallbackEn(e){return eng2rus[e]}function transliterateRu(e){return e.replace(rus2engRE,trCallbackRu)}function transliterateEn(e){return e}function base64encode(e){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),n=new Array,a=0;for(a=0;a<e.length;a++){var o=e.charCodeAt(a);o>127&&(o="АБВГДЕЖЗИЙКЛМНОПРСТУФХЦЧШЩЪЫЬЭЮЯабвгдежзийклмнопрстуфхцчшщъыьэюя".indexOf(e.charAt(a))+163)<163||n.push(o)}var i=new Array,l=n.length-n.length%3,r=0;for(a=0;a<l;a+=3)r=(n[a]<<16)+(n[a+1]<<8)+n[a+2],i.push(t[r>>18&63]+t[r>>12&63]+t[r>>6&63]+t[63&r]);switch(n.length-l){case 1:r=n[l]<<4,i.push(t[r>>6&63]+t[63&r]+"==");break;case 2:r=(n[l]<<10)+(n[l+1]<<2),i.push(t[r>>12&63]+t[r>>6&63]+t[63&r]+"=")}return i.join("")}var parsedCookies=null;function setCookie(e,t,n){var a="";if(n){var o=new Date;o.setTime(o.getTime()+n),a="; expires="+o.toGMTString()}null===t&&(a="; expires=Thu, 01-Jan-1970 00:00:01 GMT"),document.cookie=e+"="+t+a+"; path=/",parsedCookies&&(null!=t?parsedCookies[e]=t:delete parsedCookies[e])}function getCookie(e,t){if(void 0===t&&(t=!1),!parsedCookies||t){parsedCookies={};for(var n=document.cookie.split(";"),a=0;a<n.length;a++){var o=n[a].split("=");parsedCookies[o[0].replace(/^\s/,"")]=o[1]}}return parsedCookies[e]||null}function deleteCookie(e){setCookie(e,"",{expires:-1})}function symlinkControl(e,t,n,a,o,i){o=o instanceof Array?o:[o];var l=this,r=e,s=n instanceof Array?n:[n],c=s?"&hierarchy_types="+s.join("-"):"",d=o instanceof Array?"&hierarchy_types="+o.join(","):"",u=t||null,p=null,f=null,m=null,g=null,h=null,b=null,y=null,v=0,_=0;let j=0;a||(a={});var T=a.iconsPath||"/styles/skins/modern/design/img/tree/",C=a.fadeColorStart||[255,0,0],L=a.fadeColorEnd||[255,255,255],w=a.inputName||"symlinkInput"+r,k=a.noImages||!1,x=a.treeURL||"/styles/common/js/tree.html",B=a.rootId,S=a.popupTitle||getLabel("js-cms-eip-symlink-choose-element"),R=void 0===a.showSuggestType||a.showSuggestType,E=void 0===a.cutSuggestNames||a.cutSuggestNames,N=parseInt(a.suggestDivWidth),D="string"==typeof a.idPrefix?a.idPrefix:"symlinkInput",M=a.inputWidth||null,I={},A=i?"&callback=symlinkControlsList."+r+".onlyOne":"";this.loadItems=function(e){jQuery.ajax({url:"/admin/content/load_tree_node.xml?per_page_limit=15&domain_id[]="+(window.domain_id?window.domain_id:"1")+c+(window.lang_id?"&lang_id="+window.lang_id:"")+(B?"&rel="+B:"")+"&search-all-text[]="+encodeURIComponent(e),type:"get",complete:function(e,t){l.updateItems(e)}})},this.onlyOne=function(e,t,n,a){jQuery.closePopupLayer("Sitetree"),confirm(getLabel("js-symlink-only-one-warning"))&&(jQuery("a.button",g).trigger("click"),l.addItem(e,t,a,n),jQuery('form input[name="save-mode"]:first').trigger("click"))},this.updateItems=function(e){var t,n=jQuery("html.u-eip").length>0;if(y=null,(t=e.responseXML.getElementsByTagName("page")).length){b=t;for(var a=[],o=0;o<b.length;o++)I[b[o].getAttribute("id")]||(a[a.length]=b[o]);b=a;var i=null;if(!h){(h=document.createElement("div")).className="symlinkAutosuggest";var l=jQuery(f).offset();h.style.position="absolute",h.style.zIndex=1100,h.style.width=f.clientWidth+"px",isNaN(N)||(h.style.width=N+"px"),h.style.top=l.top+f.offsetHeight+"px",h.style.left=l.left+"px",n&&(h.style.backgroundColor="white",h.style.border="1px solid #ccc"),i=document.createElement("ul"),h.appendChild(i),document.body.appendChild(h)}for(U(),jQuery(document).on("mousemove",$),i=h.firstChild;i.firstChild;)i.removeChild(i.firstChild);for(o=0;o<b.length;o++)if(!I[b[o].getAttribute("id")]){var r=F(b[o].getElementsByTagName("name")[0]),s=F(b[o].getElementsByTagName("basetype")[0]),c=b[o].getAttribute("link"),d=document.createElement("li"),u=document.createElement("span"),p=document.createElement("a");d.title=r,E&&r.length>20&&(r=r.substr(0,20)+"..."),c.length>55&&(c=c.substr(0,55)+"..."),d.appendChild(document.createTextNode(r)),R&&d.appendChild(u),u.appendChild(document.createTextNode(" ("+s+")")),n?(u.style.display="block",d.className="symlink-item-delete",d.style.padding="3px"):(d.appendChild(document.createElement("br")),d.appendChild(p),p.appendChild(document.createTextNode(c)),p.href=c,p.target="_blank"),d.onmouseover=function(){q(this.suggestIndex)},d.onclick=function(){O(),Q()},d.suggestIndex=o,i.appendChild(d)}}},this.doSearch=function(){var e=f.value;e.length>0&&l.loadItems(e)};var q=function(e){var t=jQuery("html.u-eip").length>0;if("none"!=h.style.display){var n=h.firstChild,a=n.childNodes.item(y);a&&(t?a.style.backgroundColor="":a.className=""),t?n.childNodes.item(e).style.backgroundColor="#ceeaf6":n.childNodes.item(e).className="active",y=e}},O=function(){if(h&&"none"!=h.style.display&&null!==y){var e=b[y].getAttribute("id"),t=F(b[y].getElementsByTagName("name")[0]),n=b[y].getAttribute("link"),a=b[y].getElementsByTagName("basetype")[0],o="",i=(o=a.getAttribute("module"))?o:"",r=(o=a.getAttribute("method"))?o:"";l.addItem(e,t,[i,r],n)}};this.appendStub=function(){let e=document.createElement("input");e.type="hidden",e.name=w,e.name=w.replace(/\[]$/,""),l.stub=e,l.container.parentNode.insertBefore(e,p)},this.delStub=function(){l.stub&&l.stub.remove()},this.addItem=function(e,t,n,a){if(this.delPlaceHolder(),void 0===I[e]){var o=jQuery("html.u-eip").length>0,i=document.createElement("li"),l=document.createElement("span"),r=document.createElement("a"),s=document.createElement("a"),c=document.createElement("input"),d=this;if(c.type="hidden",c.name=w,c.value=e,s.input=c,r.href=a,j++,d.delStub(),k)s.appendChild(document.createTextNode("[x]"));else{var u=document.createElement("i");u.alt="delete",u.className="small-ico i-remove",o&&u.classList.add("symlink-item-delete"),s.appendChild(u)}if(s.href="javascript:void(0);",o?s.style.marginRight="5px":s.className="button",s.onclick=function(){this.input.parentNode.removeChild(this.input),g.removeChild(this.parentNode),d.addPlaceHolder(),delete I[e],0===--j&&d.appendStub()},l.dataset.basetype=n[0]+" "+n[1],o&&(l.style.marginLeft="5px"),l.appendChild(document.createTextNode(t)),r.appendChild(document.createTextNode(a)),!k){var f=document.createElement("img");f.src=T+"ico_"+n[0]+"_"+n[1]+".png",i.appendChild(f)}i.appendChild(l);l.style.maxWidth=g.parentNode.offsetWidth-70+"px",i.appendChild(s),o?delete r:i.appendChild(r),g.appendChild(i),p.parentNode.insertBefore(c,p),i.style.backgroundColor=makeHexRgb(C),i.startColor=C,i.endColor=L,i.pname=t,i.fade=P,setTimeout(function(){i.fade()},2e3),I[e]=!0,jQuery("#eip_page").length&&(frameElement.height=jQuery("#eip_page").height()>500?500:jQuery("#eip_page").height())}},this.delPlaceHolder=function(){jQuery(".eip-placeholder",g).length>=1&&jQuery(".eip-placeholder",g).remove()},this.addPlaceHolder=function(e){var t=document.createElement("li"),n=e||getLabel("js-cms-eip-symlink-no-elements");t.className="eip-placeholder",t.appendChild(document.createTextNode(n)),jQuery("li",g).length<1&&g.appendChild(t)};var P=function(){if(null==this.fadeColor&&(this.fadeColor=[],this.fadeColor[0]=this.startColor[0],this.fadeColor[1]=this.startColor[1],this.fadeColor[2]=this.startColor[2]),Math.round(this.fadeColor[0]+this.fadeColor[1]+this.fadeColor[2])!=Math.round(this.endColor[0]+this.endColor[1]+this.endColor[2])){this.fadeColor[0]+=(this.endColor[0]-this.startColor[0])/50,this.fadeColor[1]+=(this.endColor[1]-this.startColor[1])/50,this.fadeColor[2]+=(this.endColor[2]-this.startColor[2])/50,this.style.backgroundColor=makeHexRgb(this.fadeColor);var e=this;setTimeout(function(){e.fade()},20)}},U=function(){if(h){var e=jQuery(f).offset();h.style.width=f.clientWidth,h.style.top=e.top+f.offsetHeight,h.style.left=e.left,h.style.display=""}},Q=function(){h&&"none"!=h.style.display&&(h.style.display="none",jQuery(document).off("mousemove",$))},$=function(e){return e?(v=e.pageX,_=e.pageY):(v=event.clientX+document.body.scrollLeft,_=event.clientY+document.body.scrollTop),!0},F=function(e){return(e.firstChild&&3==e.firstChild.nodeType?e.firstChild.nodeValue:e.nodeValue)||""};!function(){window.symlinkControlsList||(window.symlinkControlsList={}),window.symlinkControlsList[r]=l;var e=D+r;if(l.container=p=document.getElementById(e),p){g=document.createElement("ul"),p.appendChild(g);var t=document.createElement("div");p.appendChild(t);var n=document.createElement("div");n.classList.add("layout-col-control"),(f=document.createElement("input")).setAttribute("placeholder",getLabel("js-cms-eip-symlink-search")),t.className="pick-element layout-row-icon",n.appendChild(f),t.appendChild(n),f.classList.add("default"),M&&(f.style.width=M,f.style.minWidth="auto");var a=document.createElement("div");a.classList.add("layout-col-icon"),(m=k?document.createElement("input"):document.createElement("img")).classList.add("icon-action"),a.appendChild(m),t.appendChild(a),f.type="text",k?(m.type="button",m.value="╘"):(m.src="/styles/skins/modern/design/img/tree.png",m.height="18"),m.className="treeButton icon-action",m.onclick=function(){jQuery.openPopupLayer({name:"Sitetree",title:S,width:"100%",height:335,url:x+"?id="+r+(u?"&module="+u:"")+"&name=Sitetree"+d+(window.lang_id?"&lang_id="+window.lang_id:"")+(B?"&root_id="+B:"")+A})},g.className="pageslist",f.onkeypress=function(e){if(13==(e?e.keyCode:window.event.keyCode))return!1},f.onkeyup=function(e){switch(e?e.keyCode:window.event.keyCode){case 38:b.length&&(y>0||null==y)&&q(null===y?b.length-1:y-1);break;case 40:b.length&&(y<b.length-1||null==y)&&q(null===y?0:y+1);break;case 13:return O(),Q(),!1;case 27:Q();break;default:l.doSearch()}},f.onblur=function(){h&&(v<parseInt(h.style.left)||v>parseInt(h.style.left)+parseInt(h.offsetWidth)||_<parseInt(h.style.top)||_>parseInt(h.style.top)+parseInt(h.offsetHeight))&&Q()}}else alert("Container #"+e+" not found")}()}var hex=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function makeHexRgb(e){for(var t="",n=0;n<3;n++)t=t+hex[Math.floor(e[n]/16)]+hex[Math.floor(e[n]%16)];return"#"+t}function permissionsControl(e){var t=this,n=document.getElementById(e),a=null,o=null,i={},l=0,r=null,s=null,c=null,d=null,u=0,p=0,f=[getLabel("js-permissions-view"),getLabel("js-permissions-edit"),getLabel("js-permissions-create"),getLabel("js-permissions-delete"),getLabel("js-permissions-move")];this.add=function(e,t,n,o){var s={};if(s.id=e,s.name=t,s.level=n,"system-guest"==e)l=n,t=getLabel("js-all");else if(n==l&&!o)return;if("system-supervisor"!=e&&"users-users-15"!=e){i[e]=s;var c=document.createElement("tr"),d=document.createElement("td");document.createElement("img").src="/styles/skins/modern/design/img/perm_user.png",d.appendChild(document.createTextNode(t)),c.appendChild(d);for(var u=[1,2,4,8,16],p=["perms_read","perms_edit","perms_create","perms_delete","perms_move"],m=0;m<u.length;m++){var g=document.createElement("div");g.className="checkbox";var h=document.createElement("input");h.type="checkbox",h.name=p[m]+"["+e+"]",h.value=u[m],h.title=f[m],g.appendChild(h),(d=document.createElement("td")).appendChild(g),d.className="permissionType",c.appendChild(d),n&u[m]&&(g.classList.add("checked"),h.checked=!0)}"system-guest"==e&&r?a.replaceChild(c,r):a.appendChild(c),$(c).find(".checkbox").on("click",function(){$(this).toggleClass("checked")}),"system-guest"==e&&(r=c)}},this.loadItems=function(e){jQuery.ajax({url:"/admin/users/getPermissionsOwners/4.xml?limit&search-all-text[]="+encodeURIComponent(e),method:"get",complete:function(e){t.updateItems(e)}})},this.updateItems=function(e){d=null;var t=[];if((c=e.responseXML.getElementsByTagName("owner")).length){for(var n=0;n<c.length;n++){var a=parseInt(c[n].getAttribute("id"));null==i[a]&&(t[t.length]=c[n])}if((c=t).length){var l=null;if(!s){(s=document.createElement("div")).className="symlinkAutosuggest";var r=jQuery(o).offset();s.style.position="absolute",s.style.zIndex=1050,s.style.width=o.clientWidth+"px",s.style.top=r.top+o.offsetHeight+"px",s.style.left=r.left+"px",l=document.createElement("ul"),s.appendChild(l),document.body.appendChild(s)}for(y(),jQuery(document).on("mousemove",_),l=s.firstChild;l.firstChild;)l.removeChild(l.firstChild);var u=0;for(n=0;n<c.length;n++){var p=c[n].getAttribute("name"),f=document.createElement("li"),h=document.createElement("img");if(h.src="/styles/skins/modern/design/img/perm_"+c[n].getAttribute("type")+".png",f.appendChild(h),f.appendChild(document.createTextNode(p)),"group"==c[n].getAttribute("type")){f.appendChild(document.createElement("br"));var b=document.createElement("span");f.appendChild(b);for(var j=c[n].getElementsByTagName("user"),T="",C=0;C<j.length;C++)T=T+(C?", ":"")+j[C].getAttribute("name");b.appendChild(document.createTextNode(T))}f.onmouseover=function(){m(this.suggestIndex)},f.onmouseout=function(){this.className=""},f.onclick=function(){g(),v(),o.value=""},f.suggestIndex=u,l.appendChild(f),u++}}}},this.doSearch=function(){var e=o.value;t.loadItems(e)};var m=function(e){if("none"!=s.style.display){var t=s.firstChild,n=t.childNodes.item(d);n&&(n.className=""),t.childNodes.item(e).className="active",d=e}},g=function(){if(s&&"none"!==s.style.display&&null!==d){var e=c[d].getAttribute("id"),n=c[d].getAttribute("name");"user"!==c[d].getAttribute("type")?t.add(e,n,l,!0):jQuery.ajax({url:"/admin/users/getUserPermissions/"+e+"/"+window.page_id+"/.xml",method:"get",complete:function(a){var o=a.responseXML.getElementsByTagName("data");if(0!==o.length){var i=(o=o[0]).getElementsByTagName("user"),r=l;i.length&&(r=parseInt(jQuery(i[0]).text())),t.add(e,n,r,!0)}}})}},h=function(){s&&(u<parseInt(s.style.left)||u>parseInt(s.style.left)+parseInt(s.offsetWidth)||p<parseInt(s.style.top)||p>parseInt(s.style.top)+parseInt(s.offsetHeight))&&v()},b=function(e){switch(e?e.keyCode:window.event.keyCode){case 38:c.length&&(d>0||null==d)&&m(null===d?c.length-1:d-1);break;case 40:c.length&&(d<c.length-1||null==d)&&m(null===d?0:d+1);break;case 13:return g(),v(),!1;case 27:v();break;default:t.doSearch()}},y=function(){if(s){var e=jQuery(o).offset();s.style.width=o.clientWidth,s.style.top=e.top+o.offsetHeight,s.style.left=e.left,s.style.display=""}},v=function(){s&&"none"!=s.style.display&&(s.style.display="none",jQuery(document).off("mousemove",_))},_=function(e){return e?(u=e.pageX,p=e.pageY):(u=event.clientX+document.body.scrollLeft,p=event.clientY+document.body.scrollTop),!0};!function(){var e=document.createElement("table"),i=document.createElement("tr"),l=document.createElement("th");l.style.width="100%",l.appendChild(document.createTextNode(" ")),i.appendChild(l);for(var r=["i-see","i-edit","i-add","i-remove","i-copy-other"],s=0;s<f.length;s++){l=document.createElement("th");var c=document.createElement("i");c.className="small-ico "+r[s],c.alt=c.title=f[s],l.appendChild(c),l.className="permissionType",i.appendChild(l)}e.className="permissionTable btable btable-striped";var d=document.createElement("tr"),u=document.createElement("td");u.colspan=6,u.setAttribute("colspan","6"),u.className="addOwner",d.appendChild(u),(o=document.createElement("input")).className="default",o.placeholder=getLabel("js-user-search-placeholder"),o.style.width="50%",u.appendChild(o),o.onkeypress=function(e){if(13==(e?e.keyCode:window.event.keyCode))return!1},o.onkeyup=b,o.onblur=h,a=document.createElement("tbody");var p=document.createElement("thead");p.appendChild(i);var m=document.createElement("tfoot");m.appendChild(d),e.appendChild(p),e.appendChild(a),e.appendChild(m),n.appendChild(e),t.add("system-guest","",0)}()}var askSupport=function(){$.get("/styles/skins/modern/design/js/common/html/supportRequestPopup.html",function(n){e(n),t()});var e=function(e){openDialog("",getLabel("js-ask-support"),{stdButtons:!1,html:e,width:700,openCallback:function(){$("#stop_btn").on("click",function(){closeDialog()})},confirmCallback:function(){}})},t=function(){$.ajax({type:"POST",url:"/udata/system/checkLicenseKey/",dataType:"xml",success:function(e){$("#form_body").html(""),$("#loading").html("");var t="",a=e.getElementsByTagName("error");a.length&&($("#ask_support_form").remove(),t=a[0].firstChild.nodeValue);var o=e.getElementsByTagName("notes");o.length&&(t+=o[0].firstChild.nodeValue),$("#license_message").html(t);var i=e.getElementsByTagName("form");if(i.length){var l=e.getElementsByTagName("user");$("#form_body").html('<form id="support_request" action="" method="post" enctype="multipart/form-data">'+i[0].firstChild.nodeValue+"</form>"),$('input[name="data[fio_frm]"]').val(l[0].getAttribute("name")),$("#email_frm").val(l[0].getAttribute("email")),$("#server_credentials").val(localStorage.getItem("serverCredentials"));var r=$('input[name="data[cms_domain]"]').parent();$('input[name="data[cms_domain]"]').remove();var s=document.createElement("select");s.name="data[cms_domain]";for(var c=e.getElementsByTagName("domains"),d=0;d<c[0].getElementsByTagName("domain").length;d++){var u=c[0].getElementsByTagName("domain");u=u[d];var p=document.createElement("option");p.value=u.getAttribute("host"),u.getAttribute("host")==l[0].getAttribute("domain")&&(p.selected=!0),p.appendChild(document.createTextNode(u.getAttribute("host"))),s.appendChild(p)}r.append(s),$("#attach_file").parent("div"),$(".button_1").remove(),$("#checkLicenseKey").attr("style",""),$("#show_info").attr("style","display:inline-block;"),$("#show_info").on("click",function(){$("#info_support").slideToggle("slow")}),$.centerPopupLayer();var f=$("#license_wrapper");$("#support_request > div",f).addClass("col-md-6").last().removeClass("col-md-6").addClass("col-md-12"),$("input[type=text]",f).addClass("default"),$(".asterisk",f).parent(":contains(обязательные)").remove(),$("select",f).selectize(),$("#server_credentials").on("focusout",function(){localStorage.setItem("serverCredentials",$(this).val())}),$("#checkLicenseKey").on("click",n)}},error:function(e,t,n){window.session&&window.session.stopAutoActions()}})},n=function(){$.ajax({type:"POST",url:"/udata/system/sendSupportRequest/",data:new FormData($("#support_request")[0]),cache:!1,contentType:!1,processData:!1,success:function(e){var t;$("#loading").html("");var n=e.getElementsByTagName("error");n.length&&(t='<span style="color:red;">'+n[0].firstChild.nodeValue+"</span>");var a=e.getElementsByTagName("success");a.length&&(t=a[0].firstChild.nodeValue,$("#ask_support_form").remove(),$("#checkLicenseKey").remove()),$("#license_message").html(t),$.centerPopupLayer()}})}};function colorControl(e,t){var n={colorBox:'<span class="color-box"><i></i></span>',container:e,assets:{js:"/styles/common/js/jquery/colorpicker/js/bootstrap-colorpicker.js",jsMin:"/styles/common/js/jquery/colorpicker/js/bootstrap-colorpicker.min.js",css:"/styles/common/js/jquery/colorpicker/css/bootstrap-colorpicker.min.css"}},a={options:{defaultValues:{component:".color-box",customClass:"color-picker"},user:(t=t||{}).pickerOptions||{}}};function o(e,t){jQuery('<script src="'+e+'" type="text/javascript" charset="utf-8"><\/script>').appendTo("head"),jQuery('<link href="'+t+'" rel="stylesheet" charset="utf-8"><\/script>').appendTo("head")}jQuery.extend(a.options.user,a.options.defaultValues),jQuery.extend(t,n),jQuery(t.colorBox).insertAfter(jQuery("input",e)),"function"!=typeof jQuery.colorpicker&&(t.debug?o(t.assets.js,t.assets.css):o(t.assets.jsMin,t.assets.css)),jQuery(t.container).colorpicker(a.options.user)}let DefaultModule;var CatalogModule;DefaultModule=function($){"use strict";const REQUEST_PREFIX="/admin/",ERROR_REQUEST_MESSAGE=getLabel("js-label-request-error");let getRequestUrl=function(e,t,n){return n=n||"",DefaultModule.getRequestUrlPrefix()+e+"/"+t+"/.json"+n},sendAjaxRequest=function(e,t,n){n=n||showMessage,e.data||(e.data={}),e.data.csrf=getCSRFToken();let a=$.ajax(e);a.done(function(e){return isRequestResultContainsErrorMessage(e)?n(e.data.error):isRequestResultContainsException(e)?n(e.message):void t(e)}),a.fail(function(e){let t=ERROR_REQUEST_MESSAGE;403===e.status&&e.responseJSON&&e.responseJSON.data&&e.responseJSON.data.error&&(t=e.responseJSON.data.error),n(t)})},getCSRFToken=function(){return csrfProtection.token},isRequestResultContainsErrorMessage=function(e){return!_.isUndefined(e.data)&&!_.isUndefined(e.data.error)},isRequestResultContainsException=function(e){return!_.isUndefined(e.code)&&!_.isUndefined(e.trace)&&!_.isUndefined(e.message)},showMessage=function(e,t){t=t||{header:"UMI.CMS",life:1e4},$.jGrowl(e,t)},getDomainId=function(){let e=dc_application.getQueryBuilder().Domains;return"object"==typeof e?e[0]:e},getLanguageId=function(){let e=dc_application.getQueryBuilder().Langs;return"object"==typeof e?e[0]:e},extractRowList=function(e){return _.omit(e.data,["action","offset","per_page_limit","total","type"])},extractIdList=function(e){let t=this.extractRowList(e),n=[];for(let e in t)n.push(t[e].id);return n},showTreeControl=function(e,t){window.saveTreeElementToContainer=function(n){"function"==typeof t?t(n):$(e).val("%content get_page_url("+n+")%"),jQuery.closePopupLayer("tree")},jQuery.openPopupLayer({name:"tree",title:getLabel("js-label-select-page"),width:"auto",height:340,url:"/styles/common/js/tree.html?callback=saveTreeElementToContainer"})},getRequestUrlPrefix=function(){return window.pre_lang+REQUEST_PREFIX},getRequestLanguageCodeName=function(){return window.pre_lang?window.pre_lang:"ru"},showImageBrowser=function(inputSelector,callback){let $imageContainer=$(inputSelector),infoRequest={};if($imageContainer.val()){let e=$imageContainer.val();infoRequest.file=e,infoRequest.folder=e.substr(0,e.lastIndexOf("/"))}else infoRequest.folder="./images/cms/data/";jQuery.ajax({url:DefaultModule.getRequestUrlPrefix()+"/filemanager/get_filemanager_info/",data:infoRequest,dataType:"json",type:"GET",complete:function(data){let response=eval("("+data.responseText+")");if("object"!=typeof response)return DefaultModule.showMessage(getLabel("js-error-cannot-show-file-browser"));let folderHash="string"==typeof response.folder_hash?response.folder_hash:"",fileHash="string"==typeof response.file_hash?response.file_hash:"",lang="string"==typeof response.lang?response.lang:DefaultModule.getRequestLanguageCodeName(),fileBrowser="string"==typeof response.filemanager?response.filemanager:"elfinder",filesRequest=[];filesRequest.push("image=1"),filesRequest.push("multiple=0"),filesRequest.push("imagesOnly=1"),filesRequest.push("noTumbs=1"),filesRequest.push("lang="+lang),filesRequest.push("folder_hash="+folderHash),filesRequest.push("file_hash="+fileHash),jQuery.openPopupLayer({name:"Filemanager",title:window.parent.getLabel("js-file-manager"),width:1200,height:600,url:"/styles/common/other/elfinder/umifilebrowser.html?"+filesRequest.join("&"),afterClose:function(e){return!("object"!=typeof e||!e[0]||!e[0].url)&&("function"==typeof callback?(callback(e[0].url),!0):($imageContainer.attr("src",e[0].url),!0))},success:function(){if(uAdmin.wysiwyg){let e=uAdmin.wysiwyg.getFilemanagerFooter(fileBrowser);jQuery("#popupLayer_Filemanager").append(e)}}})}})},getRequestObjextUrl=function(e,t,n){return DefaultModule.getRequestUrlPrefix()+e+"/"+t+"/"+n+"/"};var getSelectedEntity=function(){return dc_application.toolbar.selectedItems[0]};let getSelectedEntityValue=function(e){var t=DefaultModule.getSelectedEntity();return"object"==typeof t?t.attributes[e]:""};return{getRequestUrl:getRequestUrl,sendAjaxRequest:sendAjaxRequest,showMessage:showMessage,getDomainId:getDomainId,getLanguageId:getLanguageId,extractRowList:extractRowList,extractIdList:extractIdList,showTreeControl:showTreeControl,getRequestLanguageCodeName:getRequestLanguageCodeName,getRequestUrlPrefix:getRequestUrlPrefix,showImageBrowser:showImageBrowser,getRequestObjextUrl:getRequestObjextUrl,getSelectedEntity:getSelectedEntity,getSelectedEntityValue:getSelectedEntityValue}}(jQuery),CatalogModule=function(e,t){"use strict";var n=function(t,n,a,o,i){var l,r=t,s=(i=i||"").split("::").join("-"),c={idPrefix:"",treeURL:"/styles/skins/modern/design/js/common/parents.html",inputWidth:"100%",popupTitle:getLabel("js-choose-category")};l=e.extend(o,c),r.symlinkControl=new symlinkControl(n,a,s,l,i),r.id=n,r.container=r.symlinkControl.container,r.itemsContainer=e(".items-list",r.container).get(0),e("li i",r.itemsContainer).each(function(){var t=e(this),n=t.parent();u(t,n.attr("umi:id"),n)})},a=function(){return uAdmin.data&&uAdmin.data.page?uAdmin.data.page.id:window.page_id},o=function(e){var t,n=e.parents.item,a=document.createElement("span");for(var o in a.className="paths",n)n.hasOwnProperty(o)&&(t=n[o],a.appendChild(i(t)));return a.appendChild(l(e)),a},i=function(t){var n=document.createElement("a");return n.href="/admin/"+t.module+"/"+t.method+"/",n.className="tree_link",n.target="_blank",n.title=t.url,n.appendChild(document.createTextNode(t.name)),e(n).on("click",function(){return treeLink(t.settingsKey,t.treeLink)}),n},l=function(e){var t=document.createElement("span");return t.title=e.url,t.appendChild(document.createTextNode(e.name)),t},r=function(n,o,i,l){var r,s=i||a(),c=null!==Control.HandleItem?Control.HandleItem.control.selectedList:[];(o="function"==typeof o?o:function(){},s&&n&&s!=n)&&(r={element:s,rel:n,return_copies:!0,to_end:l?1:0},t.keys(c).length>0&&(r.selected_list=[],t.each(c,function(e){r.selected_list.push(e.id)})),e.ajax({url:"/admin/content/tree_move_element.json",type:"get",dataType:"json",data:r,success:function(e){o(e)}}))};function s(e,t,a,o){n(this,e,t,a,o)}function c(e,t,a,o){n(this,e,t,a,o)}s.prototype.moveItem=function(t,n){var a=this;r(t,function(t){if(t.data&&t.data.page){var n=t.data.page.copies.copy[0],i=o(n),l=e("li",a.itemsContainer).eq(0);l.html(""),l.append(i)}},null,n?1:0)},s.prototype.getId=c.prototype.getId=function(){return this.id},c.prototype.addCopy=function(t){var n=a(),i=this;n&&t&&n!=t&&e.ajax({url:"/admin/content/tree_copy_element.json",type:"get",dataType:"json",data:{element:n,rel:t,copyAll:1,return_copies:1,clone_mode:0},success:function(t){if(t.data&&t.data.page){var n=t.data.page.copies.copy[0],a=o(n),l=e(document.createElement("i"));l.attr("class","small-ico i-remove virtual-copy-delete");var r=e(document.createElement("li"));r.attr("umi:id",n.id),u(l,n.id,r),n.basetype&&(r.attr("umi:module",n.basetype.module),r.attr("umi:method",n.basetype.method)),r.append(l),r.append(a),e(i.itemsContainer).append(r)}}})};var d=[];function u(t,n,a){t.on("click",function(){e.ajax({url:"/admin/content/tree_delete_element.xml?csrf="+csrfProtection.getToken(),type:"get",dataType:"xml",data:{element:n,childs:1,allow:!0},context:this,success:function(){a.remove()}})})}var p=function(){var e={type:"POST",url:DefaultModule.getRequestUrl("catalog","addTradeOffer"),dataType:"json",data:{object_id:f(),field_name:m()}};DefaultModule.sendAjaxRequest(e,function(){dc_application.refresh()},!1)},f=function(){return window.object_id},m=function(){return dc_application.config.attributes.param},g=function(){var e=dc_application,t={type:"POST",url:DefaultModule.getRequestUrl("catalog","copyTradeOffer"),dataType:"json",data:{offer_id:e.getFirstSelectedId(),object_id:f(),field_name:m()}};DefaultModule.sendAjaxRequest(t,function(){e.refresh()},!1)},h=function(){var e=dc_application,t={type:"POST",url:DefaultModule.getRequestUrl("catalog","deleteTradeOfferList"),dataType:"json",data:{offer_id_list:e.getSelectedIdList()}};DefaultModule.sendAjaxRequest(t,function(){e.refresh()},!1)},b=function(){var e=dc_application,t={type:"POST",url:DefaultModule.getRequestUrl("catalog","changeTradeOfferListActivity"),dataType:"json",data:{offer_id_list:e.getSelectedIdList(),is_active:Number(!e.getFirstSelectedRow().attributes.is_active)}};DefaultModule.sendAjaxRequest(t,function(){e.refresh()},!1)},y=function(){var e={type:"POST",url:DefaultModule.getRequestUrl("catalog","addTradeOfferPriceType"),dataType:"json"};DefaultModule.sendAjaxRequest(e,function(){dc_application.refresh()},!1)},v=function(){var e=dc_application,t={type:"POST",url:DefaultModule.getRequestUrl("catalog","deleteTradeOfferPriceTypeList"),dataType:"json",data:{price_type_id_list:e.getSelectedIdList()}};DefaultModule.sendAjaxRequest(t,function(){dc_application.refresh()},!1)};return{ElementMovingControl:s,CopyCreatingControl:c,getControl:function(e){return d[e]},addControl:function(e){return d[e.getId()]=e},openCategoriesWindow:function(e){var t=getLabel("js-choose-category");jQuery.openPopupLayer({name:"SiteTree",title:t,width:"100%",height:335,url:"/styles/skins/modern/design/js/common/parents.html?id="+e.id+"&module=catalog&name=SiteTree&hierarchy_types=catalog-category"+(window.lang_id?"&lang_id="+window.lang_id:"")+"&mode=tree"})},moveItem:r,getTradeOfferListToolBarFunctions:function(){return{add:{name:"add",className:"i-add",hint:getLabel("js-add"),init:function(e){var t=dc_application,n=t.getToolBar();if(t.hasSelectedRows())return n.disableButtons(e);n.enableButtons(e)},release:function(){return p(),!1}},copy:{name:"copy",className:"i-copy",hint:getLabel("js-copy"),init:function(e){var t=dc_application,n=t.getToolBar();if(!t.isOneRowSelected())return n.disableButtons(e);n.enableButtons(e)},release:function(){return g(),!1}},activate:{name:"activate",className:"i-vision",hint:getLabel("js-activate"),init:function(e){var t=dc_application,n=t.getToolBar();if(!t.hasSelectedRows())return n.disableButtons(e);var a="i-vision",o=getLabel("js-activate");t.getFirstSelectedRow().attributes.is_active&&(a="i-hidden",o=getLabel("js-deactivate")),e.className=a,e.hint=o,n.renderButton(e),n.enableButtons(e)},release:function(){return b(),!1}},remove:{name:"delete",className:"i-remove",hint:getLabel("js-remove"),init:function(e){var t=dc_application,n=t.getToolBar();if(!t.hasSelectedRows())return n.disableButtons(e);n.enableButtons(e)},release:function(){return h(),!1}}}},getTradeOfferListToolBarMenu:function(){return["add","copy","activate","remove"]},getDragAndDropValidator:function(e,t,n){return"child"!==n&&n},getTradeOfferPriceTypeListToolBarFunction:function(){return{add:{name:"add",className:"i-add",hint:getLabel("js-add"),init:function(e){var t=dc_application,n=t.getToolBar();if(t.hasSelectedRows())return n.disableButtons(e);n.enableButtons(e)},release:function(){return y(),!1}},remove:{name:"delete",className:"i-remove",hint:getLabel("js-remove"),init:function(e){var t=dc_application,n=dc_application.getToolBar();if(!t.hasSelectedRows())return n.disableButtons(e);n.enableButtons(e)},release:function(){return v(),!1}}}},getTradeOfferPriceTypeListToolBarMenu:function(){return["add","remove"]}}}(jQuery,_);var SeoModule=function(e,t){"use strict";var n=getLabel("js-label-step-linksGrabber"),a=getLabel("js-label-step-linksChecker"),o=getLabel("js-label-request-error");e(function(){l(),i()});var i=function(){e("#findBadLinks").on("click",r)},l=function(){e("div.seo_chart canvas").each(function(){new Chart(this.getContext("2d"),window[this.id+"config"])})},r=function(){S();var e=s();d(e,k,B)},s=function(e){var n=c();if(t.isUndefined(e))return n.shift();var a=n.indexOf(e);return n[a+1]},c=function(){return[n,a]},d=function(e,t,n){var a={type:"POST",url:"/admin/seo/"+M(e)+"/.json",dataType:"json",data:{csrf:$()}};q(a,t,n)},u=function(){return dc_application.unPackId(p().attributes.id)},p=function(){return dc_application.toolbar.selectedItems[0]},f=function(){return 1===dc_application.toolbar.selectedItemsCount},m=function(e){var t=p();return"object"==typeof t?t.attributes[e]:""},g=function(t,n,a){openDialog(t,n,{width:390,cancelButton:!0,confirmText:getLabel("js-label-yes"),cancelText:getLabel("js-label-no"),confirmCallback:function(t){e.get("/styles/skins/modern/design/js/common/html/TemplateUpdateSitemap.html",function(e){openDialog("",n,{stdButtons:!1,html:e,width:390,openCallback:function(e){h(e)}}),v=!1,_(a),closeDialog(t)})}})},h=function(e){b("div[data-i18n-value]",e,function(e,t){e.text(t)}),b("input[data-i18n-value]",e,function(e,t){e.val(t)})},b=function(t,n,a){e(t,n).each(function(){var t=e(this),n=t.data("i18n-value"),o=getLabel(n);a(t,o)})},y=function(t){e("#export_log").append(t+"<br />"),e(".progress",".exchange_container").detach(),e("#process-header").detach(),e("#exchange-container").detach(),e.get("/styles/skins/modern/design/js/common/html/TemplateOkButton.html",function(t){e(".eip_buttons").html(t),e(".eip_buttons #ok_btn").val(getLabel("js-sitemap-ok")),e("#ok_btn").one("click",function(){closeDialog()})}),window.session&&window.session.stopAutoActions()},v=!1,_=function(t){var n=dc_application.getFirstSelectedId();e("#stop_btn").one("click",function(){return v=!0,closeDialog(),!1}),window.session&&window.session.startAutoActions(),e.ajax({type:"GET",url:"/admin/seo/"+t+"/"+n+".xml?r="+Math.random(),dataType:"xml",success:function(n){var a=n.getElementsByTagName("data");if(!a.length)return y(getLabel("js-sitemap-ajax-error")),!1;var o=a[0],i=o.getAttribute("complete")||!1;if(!1===i){var l=o.getElementsByTagName("error")[0]||!1,r="";return r=!1!==l?l.textContent:getLabel("js-sitemap-ajax-error"),y(r),!1}1==i?(window.session&&window.session.stopAutoActions(),function(){var t=e(".exchange_container");e("#process-header",t).text(getLabel("js-sitemap-updating-complete")),e(".eip_buttons #stop_btn").val(getLabel("js-sitemap-ok"));var n=e(".progress-bar",t);n.attr("aria-valuenow",0),n.css("width",0)}()):v||_(t)},error:function(e,t,n,a){window.session&&window.session.stopAutoActions(),y(getLabel("js-sitemap-ajax-error"))}})},j=function(){e.get("/styles/skins/modern/design/js/common/html/TemplateRobotsEditForm.html",function(e){openDialog("",getLabel("js-label-button-edit-robots"),{html:e,width:500,cancelButton:!0,confirmText:getLabel("js-label-save-robots-txt"),cancelText:getLabel("js-cancel"),customClass:"modalUp",confirmCallback:function(e,t){var n=w(t);T(n),closeDialog(e)},openCallback:function(e){C(e)}})})},T=function(e){var t=dc_application;e.domain_id=t.getFirstSelectedId();var n={type:"POST",url:DefaultModule.getRequestUrl("seo","editRobotsTxt"),dataType:"json",data:e};DefaultModule.sendAjaxRequest(n,function(){t.refresh()},!1)},C=function(t){e("div[data-i18n-value]",t).each(function(){var t=e(this),n=t.data("i18n-value");t.text(getLabel(n))}),L(t)},L=function(t){var n={},a=dc_application;n.domain_id=a.getFirstSelectedId();var o={type:"POST",url:DefaultModule.getRequestUrl("seo","getRobotsTxt"),dataType:"json",data:n};DefaultModule.sendAjaxRequest(o,function(n){n.data.robots_txt&&e("#text-robots-txt",t).val(n.data.robots_txt)},!1)},w=function(t){return{robots_txt:e("#text-robots-txt",t).val()}},k=function(e){if(!!(t.isUndefined(e.isComplete)||t.isUndefined(e.step)||t.isUndefined(e.info)))return B(o);var n=k,a=B;if(!e.isComplete)return R(e.info),d(e.step,n,a);var i=s(e.step);if(!t.isUndefined(i))return d(i,n,a);x()},x=function(){var t=getLabel("js-label-bad-links-search-complete");R(t),N(),E(getLabel("js-label-close")),e("#cancel-button").on("click",function(){window.location.reload()})},B=function(e){D(),Q(e)},S=function(){var n={width:400,html:t.template(e("#bad-links-search-template").html())({id:"badLinksSearchInfo",message:getLabel("js-label-bad-links-search-start-message")}),confirmButton:!1,cancelButton:!0,cancelText:getLabel("js-label-interrupt"),cancelCallback:D,closeCallback:D};openDialog("",getLabel("js-label-bad-links-search"),n)},R=function(t){e("#badLinksSearchInfo").html(t)},E=function(t){e("#cancel-button").val(t)},N=function(){e(".loading-wrapper").hide()},D=function(){closeDialog()},M=function(e){switch(e){case n:return"indexLinks";case a:return"checkLinks"}throw new Error(getLabel("js-error-label-unknown-search-step-name"))},I=function(n){var a={width:650,html:t.template(e("#bad-link-sources-template").html())({header:getLabel("js-label-header-sources"),sources:n}),confirmText:getLabel("js-confirm"),closeButton:!1};openDialog("",getLabel("js-label-title-sources"),a)},A=function(e,t){var n={type:"GET",url:"/admin/seo/getLinkSources/.json",dataType:"json",data:{param0:e,csrf:$()}};q(n,t,U)},q=function(t,n,a){var i=e.ajax(t);i.done(function(e){return O(e)?a(e.data.error):P(e)?a(e.message):void n(e)}),i.fail(function(){var e=o;403===i.status&&i.responseJSON&&i.responseJSON.data&&i.responseJSON.data.error&&(e=i.responseJSON.data.error),a(e)})},O=function(e){return!t.isUndefined(e.data)&&!t.isUndefined(e.data.error)},P=function(e){return!t.isUndefined(e.code)&&!t.isUndefined(e.trace)&&!t.isUndefined(e.message)},U=function(e){return Q(e)},Q=function(t){e.jGrowl(t)},$=function(){return csrfProtection.token};return{showBadLinkSources:function(e){A(e,I)},findBadLinks:r,getSiteListToolBarFunctions:function(){return{view:{name:"view",className:"i-vision",hint:getLabel("js-label-yandex-button-view"),init:function(e){if(!f())return dc_application.toolbar.disableButtons(e);"OK"===m("status_code")?dc_application.toolbar.enableButtons(e):dc_application.toolbar.disableButtons(e)},release:function(){var e;return e=u(),document.location.href="/admin/seo/getSiteInfo/"+e+"/",!1}},add:{name:"add",className:"i-add",hint:getLabel("js-label-yandex-button-add"),init:function(e){if(!f())return dc_application.toolbar.disableButtons(e);"NOT_ADDED"===m("status_code")?dc_application.toolbar.enableButtons(e):dc_application.toolbar.disableButtons(e)},release:function(){var e,t;return e=u(),t={type:"POST",url:"/admin/seo/addSite/.json",dataType:"json",data:{csrf:$(),domain_id:e}},q(t,function(){dc_application.refresh()},Q),!1}},verify:{name:"verify",className:"i-edit",hint:getLabel("js-label-yandex-button-verify"),init:function(e){if(!f())return dc_application.toolbar.disableButtons(e);var t=m("verify_code"),n=m("status_code");"VERIFIED"===t||"IN_PROGRESS"===t||"NOT_ADDED"===n?dc_application.toolbar.disableButtons(e):dc_application.toolbar.enableButtons(e)},release:function(){var e,t;return e=u(),t={type:"POST",url:"/admin/seo/verifySite/.json",dataType:"json",data:{csrf:$(),site_id:e}},q(t,function(){dc_application.refresh()},Q),!1}},add_site_map:{name:"add_site_map",className:"i-create",hint:getLabel("js-label-yandex-button-add_site_map"),init:function(e){if(!f())return dc_application.toolbar.disableButtons(e);var t=m("is_site_map_added"),n=m("verify_code"),a=m("status_code");t||"VERIFIED"!==n||"OK"!==a?dc_application.toolbar.disableButtons(e):dc_application.toolbar.enableButtons(e)},release:function(){var e,t;return e=u(),t={type:"POST",url:"/admin/seo/addSiteMap/.json",dataType:"json",data:{csrf:$(),site_id:e}},q(t,function(){dc_application.refresh()},Q),!1}},remove:{name:"delete",className:"i-remove",hint:getLabel("js-label-yandex-button-delete"),init:function(e){if(!f())return dc_application.toolbar.disableButtons(e);"NOT_ADDED"===m("status_code")?dc_application.toolbar.disableButtons(e):dc_application.toolbar.enableButtons(e)},release:function(){var e,t;return e=u(),t={type:"POST",url:"/admin/seo/deleteSite/.json",dataType:"json",data:{csrf:$(),site_id:e}},q(t,function(){dc_application.refresh()},Q),!1}},refresh:{name:"refresh",className:"i-restore",hint:getLabel("js-label-yandex-button-refresh"),init:function(e){dc_application.toolbar.enableButtons(e)},release:function(){return dc_application.refresh(),!1}}}},getSiteListToolBarMenu:function(){return["view","add","verify","add_site_map","remove","refresh"]},getSiteListPageLimitList:function(){return[]},getSiteMapToolBarFunctions:function(){return{updateSiteMap:{name:"updateSiteMap",className:"i-site-map-update",hint:getLabel("js-label-button-refresh-sitemap"),init:function(e){return dc_application.toggleToolBarButton(e,function(e){return e.isOneRowSelected()})},release:function(){return g(getLabel("js-update-sitemap-submit"),getLabel("js-update-sitemap"),"updateSiteMap"),!1}},updateSiteMapImages:{name:"updateSiteMapImages",className:"i-site-map-image-update",hint:getLabel("js-label-button-refresh-sitemap-images"),init:function(e){return dc_application.toggleToolBarButton(e,function(e){return e.isOneRowSelected()})},release:function(){return g(getLabel("js-update-sitemap-images-submit"),getLabel("js-update-sitemap-images"),"updateSiteMapImages"),!1}}}},getSiteMapToolBarMenu:function(){return["updateSiteMap","updateSiteMapImages"]},getRobotsToolBarFunctions:function(){return{editRobots:{name:"editRobots",className:"i-edit",hint:getLabel("js-label-button-edit-robots"),init:function(e){return dc_application.toggleToolBarButton(e,function(e){return e.isOneRowSelected()})},release:function(){return j(),!1}}}},getRobotsToolBarMenu:function(){return["editRobots"]}}}(jQuery,_),StatModule=function(e,t){"use strict";var n=getLabel("js-label-request-error");e(function(){a()});var a=function(){o().on("submit",i)},o=function(){return e("#statdate_settings")},i=function(e){e.preventDefault();var t=r().val(),n=s().val(),a=/\d{4}-\d{2}-\d{2}\s?\d{0,2}\:?\d{0,2}\:?\d{0,2}\:?$/;if(a.test(t)&&a.test(n)){var o=l(t),i=l(n);window.location.href=c(o,i)}else alert(getLabel("js-error-label-incorrect-date-period"))},l=function(e){return e.replace(/\s\d{1,2}:\d{1,2}(:\d{1,2})?$/,"")},r=function(){return e('input[name = "fromDate"]')},s=function(){return e('input[name = "toDate"]')},c=function(e,t){return function(e){return e.replace(/(\d{4}\-\d{2}\-\d{2}\/){2}$/,"")}(window.location.href)+e+"/"+t+"/"},d=function(){return dc_application.unPackId(u().attributes.id)},u=function(){return dc_application.toolbar.selectedItems[0]},p=function(e){var t=u();return"object"==typeof t?t.attributes[e]:""},f=function(){return 1===dc_application.toolbar.selectedItemsCount},m=function(e){y("/admin/stat/getCounterStat/"+e+"/traffic/attendance/")},g=function(e){var t={type:"POST",url:"/admin/stat/addCounter/.json",dataType:"json",data:{csrf:C(),domain_id:e}};v(t,function(){dc_application.refresh()},T)},h=function(e){var t={type:"POST",url:"/admin/stat/deleteCounter/.json",dataType:"json",data:{csrf:C(),counter_id:e}};v(t,function(){dc_application.refresh()},T)},b=function(e){var t={type:"GET",url:"/admin/stat/saveCounterCode/.json",dataType:"json",data:{csrf:C(),counter_id:e}};v(t,function(t){if(t.data&&t.data.success)return y("/admin/stat/downloadCounterCode/"+e);dc_application.refresh()},T)},y=function(e){document.location.href=e},v=function(t,a,o){var i=e.ajax(t);i.done(function(e){return _(e)?o(e.data.error):j(e)?o(e.message):void a(e)}),i.fail(function(){var e=n;403===i.status&&i.responseJSON&&i.responseJSON.data&&i.responseJSON.data.error&&(e=i.responseJSON.data.error),o(e)})},_=function(e){return!t.isUndefined(e.data)&&!t.isUndefined(e.data.error)},j=function(e){return!t.isUndefined(e.code)&&!t.isUndefined(e.trace)&&!t.isUndefined(e.message)},T=function(t){e.jGrowl(t)},C=function(){return csrfProtection.token};return{getCounterListToolBarFunctions:function(){return{add:{name:"add",className:"i-add",hint:getLabel("js-label-yandex-metric-button-add"),init:function(e){if(!f())return dc_application.toolbar.disableButtons(e);"CS_AVAILABLE"===p("status_code")?dc_application.toolbar.enableButtons(e):dc_application.toolbar.disableButtons(e)},release:function(){return g(d()),!1}},view:{name:"view",className:"i-vision",hint:getLabel("js-label-yandex-metric-button-view"),init:function(e){if(!f())return dc_application.toolbar.disableButtons(e);"CS_OK"===p("status_code")?dc_application.toolbar.enableButtons(e):dc_application.toolbar.disableButtons(e)},release:function(){return m(d()),!1}},code:{name:"code",className:"i-see",hint:getLabel("js-label-yandex-metric-button-code"),init:function(e){if(!f())return dc_application.toolbar.disableButtons(e);"CS_AVAILABLE"!==p("status_code")?dc_application.toolbar.enableButtons(e):dc_application.toolbar.disableButtons(e)},release:function(){return b(d()),!1}},remove:{name:"delete",className:"i-remove",hint:getLabel("js-label-yandex-metric-button-delete"),init:function(e){if(!f())return dc_application.toolbar.disableButtons(e);"CS_AVAILABLE"!==p("status_code")?dc_application.toolbar.enableButtons(e):dc_application.toolbar.disableButtons(e)},release:function(){return h(d()),!1}},refresh:{name:"refresh",className:"i-restore",hint:getLabel("js-label-yandex-metric-button-refresh"),init:function(e){dc_application.toolbar.enableButtons(e)},release:function(){return dc_application.refresh(),!1}}}},getCounterListToolBarMenu:function(){return["add","view","code","remove","refresh"]},getCounterListPageLimitList:function(){return[]}}}(jQuery,_);let TemplatesModule;TemplatesModule=function(e,t){"use strict";const n="umiTemplates";let a=function(){e.get("/styles/skins/modern/design/js/common/html/TemplateCreateForm.html",function(e){openDialog("",getLabel("js-label-template-creating"),{html:e,width:360,cancelButton:!0,confirmText:getLabel("js-add"),cancelText:getLabel("js-cancel"),customClass:"modalUp",confirmCallback:function(e,t){let n=o(t);i(n)&&(r(n),closeDialog(e))},openCallback:function(e){l(e)}})})},o=function(t){return{"data[name]":e("#new-template-name",t).val(),"data[fileName]":e("#new-template-file-name",t).val(),"data[directory]":e("#new-template-directory",t).val(),"data[type]":e('select[name = "type"] option[selected]',t).val(),"data[isDefault]":e("div.checkbox input",t).is(":checked")?1:0}},i=function(e){let t=[];if(""===e["data[name]"].toString()&&t.push(getLabel("js-error-label-empty-template-name")),e["data[fileName]"].toString().match(/([a-zA-Z0-9-_]+\.(phtml|xsl|tpl)$)/)||t.push(getLabel("js-error-label-invalid-template-file-name")),e["data[directory]"].toString().match(/^([a-zA-Z0-9-_\/]+)/)||t.push(getLabel("js-error-label-invalid-template-directory")),0===t.length)return!0;let n=t.join("<br>");return DefaultModule.showMessage(n),!1},l=function(t){e("div[data-i18n-value]",t).each(function(){let t=e(this),n=t.data("i18n-value");t.text(getLabel(n))}),e("label.checkbox-wrapper span[data-i18n-value]",t).each(function(){let t=e(this),n=t.data("i18n-value");t.text(getLabel(n))}),e("input[data-i18n-placeholder]",t).each(function(){let t=e(this),n=t.data("i18n-placeholder");t.attr("placeholder",getLabel(n))}),e('select[name = "type"]',t).selectize(),e('input[name = "isDefault"]',t).on("click",function(t){let n=e(t.target);n.toggleClass("checked"),n.parent().toggleClass("checked")})},r=function(e){e["data[domain_id]"]=DefaultModule.getDomainId(),e["data[language_id]"]=DefaultModule.getLanguageId();let t=dc_application,a={type:"POST",url:DefaultModule.getRequestUrl(n,"createTemplate"),dataType:"json",data:e};DefaultModule.sendAjaxRequest(a,function(){t.refresh()},!1)},s=function(){openDialog("",getLabel("js-label-template-confirm-delete"),{html:getLabel("js-label-template-confirmation-delete"),confirmText:getLabel("js-del-do"),cancelButton:!0,cancelText:getLabel("js-cancel"),confirmCallback:function(e){c(),closeDialog(e)}})},c=function(){let e=dc_application,t={type:"POST",url:DefaultModule.getRequestUrl(n,"deleteTemplateList"),dataType:"json",data:{id_list:e.getSelectedIdList()}};DefaultModule.sendAjaxRequest(t,function(){e.refresh()},!1)},d=function(e,t,n){h(e,function(a){let o=DefaultModule.extractIdList(a);if(0===o.length)return dc_application.refresh(),closeDialog(n);y(t,o,function(){d(e,t,n)})})},u=function(t){e.get("/styles/skins/modern/design/js/common/html/ProgressBar.html",function(e){openDialog("",t,{html:e,width:400,cancelButton:!1,stdButtons:!1,closeButton:!1,customClass:"modalUp"})})},p=function(e){dc_application.toggleToolBarButton(e,function(e){return e.hasSelectedRows()&&!j(e.getSelectedRowList())})},f=function(e){g(function(t){let n=DefaultModule.extractRowList(t);m(n,e)})},m=function(t,n){e.get("/styles/skins/modern/design/js/common/html/TemplateSelectForm.html",function(e){openDialog("",getLabel("js-label-template-change-for-pages"),{html:e,width:360,cancelButton:!0,confirmText:getLabel("js-choose"),cancelText:getLabel("js-cancel"),customClass:"modalUp",confirmCallback:n,openCallback:function(e){v(e,t)}})})},g=function(e){let t={type:"GET",url:DefaultModule.getRequestUrl(n,"getRelatedPageTree"),dataType:"json",data:{per_page_limit:"mode=all",p:"0",domain_id:DefaultModule.getDomainId()}};DefaultModule.sendAjaxRequest(t,function(t){e(t)},!1)},h=function(e,t){let a={type:"GET",url:DefaultModule.getRequestUrl(n,"getRelatedPageTree"),dataType:"json",data:{rel:[e],domain_id:DefaultModule.getDomainId()}};DefaultModule.sendAjaxRequest(a,function(e){t(e)},!1)},b=function(t){return e('select[name = "id"] option[selected]',t).val()},y=function(e,t,a){let o=[];for(let e=0;e<t.length;e++)o.push({id:t[e]});let i={type:"POST",url:DefaultModule.getRequestUrl(n,"changeTemplateForPageList"),dataType:"json",data:{rel:{id:e},selected_list:o}};DefaultModule.sendAjaxRequest(i,a,!1)},v=function(n,a){let o=t.template(e("#template-option",n).html())({label:getLabel("js-label-select-template-from-list"),templateList:a});e("div.group-block",n).html(o),e("select",n).selectize()},_=function(e){dc_application.toggleToolBarButton(e,function(e){return e.hasSelectedRows()&&!T(e.getSelectedRowList())&&e.isOneRowSelected()})},j=function(e){return e.some(C)},T=function(e){return e.some(function(e){return!C(e)})},C=function(e){return(e.attributes||e.model.attributes).module_id===n},L=function(e){DefaultModule.showMessage(e),closeDialog(),dc_application.refresh()},w=function(){u(getLabel("js-label-backup-creating-processing"));let e={type:"POST",url:DefaultModule.getRequestUrl(n,"createBackup"),dataType:"json"};DefaultModule.sendAjaxRequest(e,function(){closeDialog(),dc_application.refresh()},L)},k=function(){location.href=DefaultModule.getRequestUrl(n,"downloadBackup","?fileName="+dc_application.getFirstSelectedId())},x=function(){u(getLabel("js-label-backup-restoring-processing"));let e=dc_application,t={type:"POST",url:DefaultModule.getRequestUrl(n,"restoreFromBackup"),dataType:"json",data:{fileName:e.getFirstSelectedId()}};DefaultModule.sendAjaxRequest(t,function(){closeDialog(),e.refresh()},L)},B=function(){openDialog("",getLabel("js-label-template-confirm-delete"),{html:getLabel("js-label-backup-delete-confirm"),confirmText:getLabel("js-del-do"),cancelButton:!0,cancelText:getLabel("js-cancel"),confirmCallback:function(e){S(),closeDialog(e)}})},S=function(){let e=dc_application,t={type:"POST",url:DefaultModule.getRequestUrl(n,"deleteBackupList"),dataType:"json",data:{fileNameList:e.getSelectedIdList()}};DefaultModule.sendAjaxRequest(t,function(){e.refresh()},L)};return{getTemplatesListToolBarFunctions:function(){return{add:{name:"add",className:"i-add",hint:getLabel("js-add"),init:function(e){return dc_application.toggleToolBarButton(e,function(e){return!e.hasSelectedRows()})},release:function(){return a(),!1}},remove:{name:"delete",className:"i-remove",hint:getLabel("js-remove"),init:function(e){return dc_application.toggleToolBarButton(e,function(e){return e.hasSelectedRows()})},release:function(){return s(),!1}}}},getTemplatesListToolBarMenu:function(){return["add","remove"]},getRelatedPageTreeToolBarFunctions:function(){return{bindTemplate:{name:"bindTemplate",className:"i-bind",hint:getLabel("js-label-bind-template"),init:p,release:function(){return f(function(e,t){let n=b(t),a=dc_application,o=a.getSelectedIdList();y(n,o,function(){a.refresh()}),closeDialog(e)}),!1}},bindTemplateForAll:{name:"bindTemplateForAll",className:"i-mass-bind",hint:getLabel("js-label-mass-bind-template"),init:_,release:function(){return f(function(e,t){let n=dc_application.getFirstSelectedId(),a=b(t);if(closeDialog(e),n===a)return DefaultModule.showMessage(getLabel("js-label-error-old-and-new-templates-equal"));u(getLabel("js-label-template-change-for-all-pages")),d(n,a,"")}),!1}}}},getRelatedPageTreeToolBarMenu:function(){return["bindTemplate","bindTemplateForAll"]},getRelatedPageTreeDragAndDropValidator:function(e,t,n){return!(j(t)||!C(e))&&"child"},getTemplateBackupsToolBarFunctions:function(){return{create:{name:"create",className:"i-create-backup",hint:getLabel("js-label-create-backup"),init:function(e){dc_application.toggleToolBarButton(e,function(e){return!e.hasSelectedRows()})},release:function(){return w(),!1}},download:{name:"download",className:"i-download-backup",hint:getLabel("js-label-download-backup"),init:function(e){dc_application.toggleToolBarButton(e,function(e){return e.isOneRowSelected()})},release:function(){return k(),!1}},restore:{name:"restore",className:"i-restore-backup",hint:getLabel("js-label-restore-backup"),init:function(e){dc_application.toggleToolBarButton(e,function(e){return e.isOneRowSelected()})},release:function(){return x(),!1}},remove:{name:"delete",className:"i-delete-backup",hint:getLabel("js-label-delete-backup"),init:function(e){dc_application.toggleToolBarButton(e,function(e){return e.hasSelectedRows()})},release:function(){return B(),!1}}}},getTemplateBackupsToolBarMenu:function(){return["create","download","restore","remove"]}}}(jQuery,_);var ExchangeModule=function(e,t){"use strict";let n=function(e){DefaultModule.showMessage(e),closeDialog(),dc_application.refresh()},a=function(){location.href=DefaultModule.getRequestUrl("exchange","downloadLogFile","?fileName="+dc_application.getFirstSelectedId())},o=function(){openDialog("",getLabel("js-label-template-confirm-delete"),{html:getLabel("js-label-log-file-delete-confirm"),confirmText:getLabel("js-del-do"),cancelButton:!0,cancelText:getLabel("js-cancel"),confirmCallback:function(e){i(),closeDialog(e)}})},i=function(){let e=dc_application,t={type:"POST",url:DefaultModule.getRequestUrl("exchange","deleteLogFileList"),dataType:"json",data:{fileNameList:e.getSelectedIdList(),domain_id:[DefaultModule.getDomainId()]}};DefaultModule.sendAjaxRequest(t,function(){e.refresh()},n)},l=function(){let e=DefaultModule.getSelectedEntityValue("script_id");location.href=DefaultModule.getRequestObjextUrl("exchange","edit",e)};return{getLogListToolBarFunctions:function(){return{download:{name:"download",className:"i-download-backup",hint:getLabel("js-label-download-log-file"),init:function(e){dc_application.toggleToolBarButton(e,function(e){return e.isOneRowSelected()})},release:function(){return a(),!1}},remove:{name:"delete",className:"i-delete-backup",hint:getLabel("js-label-delete-log-file"),init:function(e){dc_application.toggleToolBarButton(e,function(e){return e.hasSelectedRows()})},release:function(){return o(),!1}},open:{name:"open",className:"i-see",hint:getLabel("js-label-open-import"),init:function(e){dc_application.toggleToolBarButton(e,function(e){let t=Number(DefaultModule.getSelectedEntityValue("script_id"));return e.isOneRowSelected()&&t})},release:function(){return l(),!1}}}},getLogListToolBarMenu:function(){return["download","remove","open"]},getIdentifiersToolBarMenu:function(){return window.location.href.match(/Identifiers\/\?page=(\d*)/)?["goToModule"]:[]},getIdentifiersToolBarFunctions:function(){let e=window.location.href.replace(/(\?page=.*)/,"");return{goToModule:{name:"goToModule",className:"i-rollback",hint:getLabel("js-label-open-full-identifiers-list"),href:e,init:function(e){dc_application.getToolBar().enableButtons(e)}}}}}}(jQuery,_);