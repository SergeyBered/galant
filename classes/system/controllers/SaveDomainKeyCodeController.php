<?php
 namespace UmiCms\Classes\System\Controllers;use \iRegedit as iRegistry;use UmiCms\Utils\DomainKeyCode\iSaver;use UmiCms\Classes\System\Utils\DOM\Document\iFactory as iDOMDocumentFactory;class SaveDomainKeyCodeController extends AbstractController implements iSaveDomainKeyCodeController {private $registry;private $saver;private $domDocumentFactory;public function setRegistry(iRegistry $va9205dcfd4a6f7c2cbe8be01566ff84a) {$this->registry = $va9205dcfd4a6f7c2cbe8be01566ff84a;return $this;}public function setSaver(iSaver $v21d8a920661b9c05b9959cbf0254d5fe) {$this->saver = $v21d8a920661b9c05b9959cbf0254d5fe;return $this;}public function setDomDocumentFactory(iDOMDocumentFactory $vfc9e2d0d5c0256454b185d0788b6ca5a) {$this->domDocumentFactory = $vfc9e2d0d5c0256454b185d0788b6ca5a;return $this;}public function execute() {if ($this->registry->checkSelfKeycode()) {$this->finish();}$vb5eda0a74558a342cf659187f06f746f = $this->request->Get();$vb96beb1fb95f7fa45257bb48942aef8a = $vb5eda0a74558a342cf659187f06f746f->get('keycode');$vfeae321bc552141731853ddb1978a3b6 = $vb5eda0a74558a342cf659187f06f746f->get('domain_keycode');$v97e32a574aa9ef24f76a81fc43aba6ce = $vb5eda0a74558a342cf659187f06f746f->get('license_codename');if (($vfeae321bc552141731853ddb1978a3b6 === null || $v97e32a574aa9ef24f76a81fc43aba6ce === null) && $vb96beb1fb95f7fa45257bb48942aef8a !== null) {$this->saveLicenseToServer($vb96beb1fb95f7fa45257bb48942aef8a);}$this->saveLicenseToClient($vfeae321bc552141731853ddb1978a3b6, $v97e32a574aa9ef24f76a81fc43aba6ce);}private function saveLicenseToServer($vb96beb1fb95f7fa45257bb48942aef8a) {try {$v6972a16f940453221a748b7fd2fc7f92 = $this->saver->saveToServer($vb96beb1fb95f7fa45257bb48942aef8a);$vfdc3bdefb79cec8eb8211d2499e04704 = $this->domDocumentFactory->create();$vfdc3bdefb79cec8eb8211d2499e04704->loadXML($v6972a16f940453221a748b7fd2fc7f92->saveXML());$this->response->printXml($vfdc3bdefb79cec8eb8211d2499e04704);}catch (\Exception $v42552b1f133f9f8eb406d4f306ea9fd1) {\umiExceptionHandler::report($v42552b1f133f9f8eb406d4f306ea9fd1);$this->buffer->stop();}}private function saveLicenseToClient($vb96beb1fb95f7fa45257bb48942aef8a, $v97e32a574aa9ef24f76a81fc43aba6ce) {try {$this->saver->saveToCms($vb96beb1fb95f7fa45257bb48942aef8a, $v97e32a574aa9ef24f76a81fc43aba6ce);$this->finish();}catch (\Exception $v42552b1f133f9f8eb406d4f306ea9fd1) {\umiExceptionHandler::report($v42552b1f133f9f8eb406d4f306ea9fd1);$this->buffer->stop();}}private function finish() {$this->buffer->contentType('application/javascript');$this->buffer->charset('utf-8');$this->buffer->setHeader('X-Robots-Tag', 'none');$this->buffer->push('/** ok */');$this->buffer->end();}}