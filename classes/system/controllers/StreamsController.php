<?php
 namespace UmiCms\Classes\System\Controllers;use UmiCms\Classes\System\MiddleWares;use UmiCms\System\Streams\iFacade as iStreamsFacade;use UmiCms\Classes\System\Translators\iFacade as iTranslator;class StreamsController extends AbstractController implements iStreamsController {private $streams;private $translator;use MiddleWares\tAuth;use MiddleWares\tUmiManager;public function setStreams(iStreamsFacade $v2f6f4768f1c2d7c8f1f54823723f1a70) {$this->streams = $v2f6f4768f1c2d7c8f1f54823723f1a70;return $this;}public function setTranslator(iTranslator $v607f2f3099f2a347b327caa70e0be4b2) {$this->translator = $v607f2f3099f2a347b327caa70e0be4b2;return $this;}public function execute() {parent::execute();if (!isset($this->parameters['stream'])) {throw new \ErrorException('Incorrect router parameters given, stream expected');}define('STAT_DISABLE', true);define('VIA_HTTP_SCHEME', true);$vf7b44cfafd5c52223d5498196c8a2e7b = $this->parameters['stream'];$this->request->Get()->set('scheme', $vf7b44cfafd5c52223d5498196c8a2e7b);$this->loginByEnvironment();$this->validateUmiManagerRequest();try {$this->buffer->contentType($this->getContentType($vf7b44cfafd5c52223d5498196c8a2e7b));$this->buffer->charset('utf-8');$this->buffer->setHeader('X-Robots-Tag', 'none');$this->buffer->option('generation-time', !$this->request->isJson());$result = $this->streams->execute($vf7b44cfafd5c52223d5498196c8a2e7b);$this->buffer->push($result);$this->buffer->end();}catch (\Exception $v42552b1f133f9f8eb406d4f306ea9fd1) {$v8d777f385d3dfec8815d20f7496026dc = $this->getErrorData($vf7b44cfafd5c52223d5498196c8a2e7b, $v42552b1f133f9f8eb406d4f306ea9fd1);if ($v8d777f385d3dfec8815d20f7496026dc instanceof \DOMDocument) {$this->response->printXml($v8d777f385d3dfec8815d20f7496026dc);}else {$this->response->printJson($v8d777f385d3dfec8815d20f7496026dc);}}}private function getContentType($vf7b44cfafd5c52223d5498196c8a2e7b) {if ($vf7b44cfafd5c52223d5498196c8a2e7b == 'ulang') {return 'text/plain';}return $this->request->isJson() ? 'application/json' : 'text/xml';}private function getErrorData($vf7b44cfafd5c52223d5498196c8a2e7b, \Exception $v42552b1f133f9f8eb406d4f306ea9fd1) {$vf7b44cfafd5c52223d5498196c8a2e7b = $vf7b44cfafd5c52223d5498196c8a2e7b ?: 'unknown';$v8d777f385d3dfec8815d20f7496026dc = [    $vf7b44cfafd5c52223d5498196c8a2e7b => [     'error' => $v42552b1f133f9f8eb406d4f306ea9fd1->getMessage()    ]   ];if ($this->request->isJson()) {return $v8d777f385d3dfec8815d20f7496026dc;}return $this->translator->translateToDomDocument($v8d777f385d3dfec8815d20f7496026dc[$vf7b44cfafd5c52223d5498196c8a2e7b], $vf7b44cfafd5c52223d5498196c8a2e7b);}}