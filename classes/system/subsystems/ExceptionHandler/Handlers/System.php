<?php
 namespace UmiCms\Classes\System\Exception\Handler;use UmiCms\System\Response\iFacade as iResponseFacade;class System extends Base {const ERROR_MESSAGE = <<<ERROR
Произошла критическая ошибка. Скорее всего, потребуется участие разработчиков.  
Подробности по ссылке <a title="" target="_blank" href="https://errors.umi-cms.ru/17000/">17000</a>
ERROR;  protected $config;private $responseFacade;public function __construct(\mainConfiguration $v2245023265ae4cf87d02c8b6ba991139, iResponseFacade $v01b8880744c647f4b449511ffe824d43) {$this->config = $v2245023265ae4cf87d02c8b6ba991139;$this->responseFacade = $v01b8880744c647f4b449511ffe824d43;}public function handler($v42552b1f133f9f8eb406d4f306ea9fd1) {$v78ab8aaf44527469511c73b28db47fed = $this->config->get('debug', 'show-backtrace');if (!$v78ab8aaf44527469511c73b28db47fed && $v42552b1f133f9f8eb406d4f306ea9fd1 instanceof \databaseException) {$v42552b1f133f9f8eb406d4f306ea9fd1 = new \Exception(     self::ERROR_MESSAGE,     17000,     $v42552b1f133f9f8eb406d4f306ea9fd1    );}$v7f2db423a49b305459147332fb01cf87 = $this->responseFacade->getCurrentBuffer();$v7f2db423a49b305459147332fb01cf87->status(500);$this->printTemplate($v42552b1f133f9f8eb406d4f306ea9fd1);$this->report($v42552b1f133f9f8eb406d4f306ea9fd1);$v7f2db423a49b305459147332fb01cf87->stop();}public function report($v42552b1f133f9f8eb406d4f306ea9fd1) {return $this->createCrashReport($v42552b1f133f9f8eb406d4f306ea9fd1->getMessage(), $v42552b1f133f9f8eb406d4f306ea9fd1->getTraceAsString());}public function createCrashReport($v78e731027d8fd50ed642340b7c9a63b3, $v04a75036e9d520bb983c5ed03b8d0182) {$v0b385c8d43e6b02e3394085f06ee22e6 = $this->config->get('debug', 'log-exceptions');if (!$v0b385c8d43e6b02e3394085f06ee22e6) {return false;}$v63a04a2f17915ed7c241c38ff2a29f4d = ERRORS_LOGS_PATH . '/exceptions/';if (!is_dir($v63a04a2f17915ed7c241c38ff2a29f4d)) {mkdir($v63a04a2f17915ed7c241c38ff2a29f4d, 0777, true);}try {$v6db435f352d7ea4a67807a3feb447bf7 = new \umiLogger($v63a04a2f17915ed7c241c38ff2a29f4d);$v6db435f352d7ea4a67807a3feb447bf7->pushGlobalEnvironment();$v6db435f352d7ea4a67807a3feb447bf7->push($v78e731027d8fd50ed642340b7c9a63b3);$v6db435f352d7ea4a67807a3feb447bf7->push($v04a75036e9d520bb983c5ed03b8d0182);$v6db435f352d7ea4a67807a3feb447bf7->save();return true;}catch (\Exception $ve1671797c52e15f763380b45e841ec32) {return false;}}}