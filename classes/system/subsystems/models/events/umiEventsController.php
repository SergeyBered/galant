<?php
 use UmiCms\Service;use UmiCms\System\Events\iHandler;use UmiCms\System\Events\Handler\iModule;class umiEventsController implements iUmiEventsController, iSingleton {protected static $handlerList = [];private static $oInstance;private $isModulesEventHandlersLoaded = false;public static function getInstance($v6f66e878c62db60568a3487869695820 = null) {if (self::$oInstance == null) {self::$oInstance = new umiEventsController();}return self::$oInstance;}public function callEvent(iUmiEventPoint $v4119639092e62c55ea8be348e4d9260d, array $va40ba79f71dfdb9032426845f587e833 = [], array $v7c24c2df3affd61a699fa63ef4e40b3d = []) {$v53cc4db543d7a569e51c1d76ac6f278e = $v4119639092e62c55ea8be348e4d9260d->getEventId();$v2165e4fa5bddb65a31f6a0c495c2fa37 = ['executed' => [], 'failed' => [], 'suppressed' => []];$vd3639800dbba9dda87122764de3f1836 = [    'modules' => $va40ba79f71dfdb9032426845f587e833,    'methods' => $v7c24c2df3affd61a699fa63ef4e40b3d,   ];foreach ($this->searchEventListeners($v53cc4db543d7a569e51c1d76ac6f278e) as $vc1cbfe271a40788a00e8bf8574d94d4b) {if (!$vc1cbfe271a40788a00e8bf8574d94d4b->isAllowed($vd3639800dbba9dda87122764de3f1836)) {continue;}try {$this->executeCallback($vc1cbfe271a40788a00e8bf8574d94d4b, $v4119639092e62c55ea8be348e4d9260d);$v2165e4fa5bddb65a31f6a0c495c2fa37['executed'][] = $vc1cbfe271a40788a00e8bf8574d94d4b;}catch (baseException $ve1671797c52e15f763380b45e841ec32) {$v2165e4fa5bddb65a31f6a0c495c2fa37['failed'][] = $vc1cbfe271a40788a00e8bf8574d94d4b;if ($vc1cbfe271a40788a00e8bf8574d94d4b->getIsCritical()) {throw $ve1671797c52e15f763380b45e841ec32;}continue;}catch (breakException $ve1671797c52e15f763380b45e841ec32) {$v2165e4fa5bddb65a31f6a0c495c2fa37['suppressed'][] = $vc1cbfe271a40788a00e8bf8574d94d4b;break;}}return $v2165e4fa5bddb65a31f6a0c495c2fa37;}public static function registerEventListener(iHandler $vc1cbfe271a40788a00e8bf8574d94d4b) {self::$handlerList[] = $vc1cbfe271a40788a00e8bf8574d94d4b;}protected function __construct() {}protected function loadEventListeners() {$v20cf12be6809c539cfed17c272627718 = Service::Registry()->getList('//modules');foreach ($v20cf12be6809c539cfed17c272627718 as $v47c80780ab608cc046f2a6e6f071feb6) {$v22884db148f0ffb0d830ba431102b0b5 = $v47c80780ab608cc046f2a6e6f071feb6[0];$this->loadModuleEventListeners($v22884db148f0ffb0d830ba431102b0b5);}$this->isModulesEventHandlersLoaded = true;}protected function loadModuleEventListeners($v22884db148f0ffb0d830ba431102b0b5) {$vd6fe1d0be6347b8ef2427fa629c04485 = SYS_MODULES_PATH . "{$v22884db148f0ffb0d830ba431102b0b5}/events.php";$v90dd1a83e6586773daf09035d1b9bf40 = SYS_MODULES_PATH . "{$v22884db148f0ffb0d830ba431102b0b5}/custom_events.php";$v6829cdfdefd69b947abedd8fa2c4bcc7 = cmsController::getInstance()->getResourcesDirectory();if ($v6829cdfdefd69b947abedd8fa2c4bcc7) {$this->tryLoadEvents($v6829cdfdefd69b947abedd8fa2c4bcc7 . "/classes/modules/{$v22884db148f0ffb0d830ba431102b0b5}/events.php");$this->tryLoadEvents($v6829cdfdefd69b947abedd8fa2c4bcc7 . "/classes/components/{$v22884db148f0ffb0d830ba431102b0b5}/events.php");}$vc91e6e80deac06534fba478f9a7daf4d = SYS_MODULES_PATH . "{$v22884db148f0ffb0d830ba431102b0b5}/ext/events_*.php";$vef36273b1a6b54195bf260c283a4ef6f = glob($vc91e6e80deac06534fba478f9a7daf4d);if (is_array($vef36273b1a6b54195bf260c283a4ef6f)) {foreach (glob($vc91e6e80deac06534fba478f9a7daf4d) as $v435ed7e9f07f740abf511a62c00eef6e) {if (file_exists($v435ed7e9f07f740abf511a62c00eef6e)) {$this->tryLoadEvents($v435ed7e9f07f740abf511a62c00eef6e);}}}$this->tryLoadEvents($v90dd1a83e6586773daf09035d1b9bf40);$this->tryLoadEvents($vd6fe1d0be6347b8ef2427fa629c04485);}protected function tryLoadEvents($vd6fe1d0be6347b8ef2427fa629c04485) {if (file_exists($vd6fe1d0be6347b8ef2427fa629c04485)) {require_once $vd6fe1d0be6347b8ef2427fa629c04485;return true;}return false;}protected function searchEventListeners($v53cc4db543d7a569e51c1d76ac6f278e) {static $v0fea6a13c52b4d4725368f24b045ca84 = [];if (isset($v0fea6a13c52b4d4725368f24b045ca84[$v53cc4db543d7a569e51c1d76ac6f278e])) {return $v0fea6a13c52b4d4725368f24b045ca84[$v53cc4db543d7a569e51c1d76ac6f278e];}$result = [];if ($this->isModulesEventHandlersLoaded === false) {$this->loadEventListeners();}foreach (self::$handlerList as $vc1cbfe271a40788a00e8bf8574d94d4b) {if ($vc1cbfe271a40788a00e8bf8574d94d4b->getEventId() == $v53cc4db543d7a569e51c1d76ac6f278e) {$result[] = $vc1cbfe271a40788a00e8bf8574d94d4b;}}$v3d801aa532c1cec3ee82d87a99fdf63f = [];foreach ($result as $vc1cbfe271a40788a00e8bf8574d94d4b) {$v3d801aa532c1cec3ee82d87a99fdf63f[$vc1cbfe271a40788a00e8bf8574d94d4b->getPriority()][] = $vc1cbfe271a40788a00e8bf8574d94d4b;}$result = [];ksort($v3d801aa532c1cec3ee82d87a99fdf63f);foreach ($v3d801aa532c1cec3ee82d87a99fdf63f as $v6a3d252c501d3bde07ddc1f57a683937) {foreach ($v6a3d252c501d3bde07ddc1f57a683937 as $vc1cbfe271a40788a00e8bf8574d94d4b) {$result[] = $vc1cbfe271a40788a00e8bf8574d94d4b;}}return $v0fea6a13c52b4d4725368f24b045ca84[$v53cc4db543d7a569e51c1d76ac6f278e] = $result;}protected function executeCallback(iHandler $vc1cbfe271a40788a00e8bf8574d94d4b, iUmiEventPoint $v4119639092e62c55ea8be348e4d9260d) {Service::EventHandlerExecutorFactory()    ->createForHandler($vc1cbfe271a40788a00e8bf8574d94d4b)    ->execute($v4119639092e62c55ea8be348e4d9260d);}}