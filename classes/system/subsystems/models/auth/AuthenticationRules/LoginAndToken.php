<?php
 namespace UmiCms\System\Auth\AuthenticationRules;use UmiCms\Service;use UmiCms\System\Selector\iFactory as SelectorFactory;use UmiCms\System\Protection\iHashComparator;use UmiCms\System\Auth\PasswordHash\iAlgorithm;use UmiCms\System\Auth\PasswordHash\WrongAlgorithmException;class LoginAndToken extends Rule {private $login;private $token;public function __construct($vd56b699830e77ba53855679cb1d252da, $v94a08da1fecbb6e8b46990538c7b50b2,     SelectorFactory $vdff401a605e5f6984373466cddee7287,     iHashComparator $v9cb170b1e9321537ce4ae3eaa340f9d4,    iAlgorithm $ved469618898d75b149e5c7c4b6a1c415) {$this->login = (string) $vd56b699830e77ba53855679cb1d252da;$this->token = (string) $v94a08da1fecbb6e8b46990538c7b50b2;$this->selectorFactory = $vdff401a605e5f6984373466cddee7287;$this->hashComparator = $v9cb170b1e9321537ce4ae3eaa340f9d4;$this->hashAlgorithm = $ved469618898d75b149e5c7c4b6a1c415;}public function validate() {$vd56b699830e77ba53855679cb1d252da = $this->getLogin();try {$v7e5aadfde0b0d3a8a9e841ac0d976572 = $this->getQueryBuilder();$v7e5aadfde0b0d3a8a9e841ac0d976572->option('return')->value(['id', 'auth_token']);$v7e5aadfde0b0d3a8a9e841ac0d976572->where('login')->equals($vd56b699830e77ba53855679cb1d252da);$v7e5aadfde0b0d3a8a9e841ac0d976572->where('is_activated')->equals(true);$v7e5aadfde0b0d3a8a9e841ac0d976572->limit(0, 1);$v606f4a5eb3f20967cef8d0890d6391a9 = $v7e5aadfde0b0d3a8a9e841ac0d976572->result();}catch (\Exception $ve1671797c52e15f763380b45e841ec32) {return false;}if (count($v606f4a5eb3f20967cef8d0890d6391a9) === 0) {return false;}$v2190787029a8efc2f48ee060e899c988 = (string) $v606f4a5eb3f20967cef8d0890d6391a9[0]['auth_token'];$ved469618898d75b149e5c7c4b6a1c415 = $this->getHashAlgorithm();$v9311d29b3ebf1f2c5215b510dc0d9d78 = Service::Request()->remoteAddress();$vfa71f997fa1a947459dc5495fdb40b0f = Service::Request()->userAgent();$v94a08da1fecbb6e8b46990538c7b50b2 = $ved469618898d75b149e5c7c4b6a1c415::hash($this->getToken() . $v9311d29b3ebf1f2c5215b510dc0d9d78 . $vfa71f997fa1a947459dc5495fdb40b0f);$v9cb170b1e9321537ce4ae3eaa340f9d4 = $this->getHashComparator();if (!$v9cb170b1e9321537ce4ae3eaa340f9d4->equals($v2190787029a8efc2f48ee060e899c988, $v94a08da1fecbb6e8b46990538c7b50b2)) {return false;}return (int) $v606f4a5eb3f20967cef8d0890d6391a9[0]['id'];}private function getLogin() {return $this->login;}private function getToken() {return $this->token;}private function getHashAlgorithm() {return $this->hashAlgorithm;}}