<?php
 namespace UmiCms\System\Orm\Entity;use UmiCms\System\Orm\iEntity;use UmiCms\System\Orm\Entity\Map\Filter;use UmiCms\System\Orm\Entity\Factory\tInjector as tFactoryInjector;use UmiCms\System\Orm\Entity\Builder\tInjector as tBuilderInjector;use UmiCms\System\Orm\Entity\Collection\tInjector as tCollectionInjector;use UmiCms\System\Orm\Entity\Repository\tInjector as tRepositoryInjector;use UmiCms\System\Orm\Entity\Relation\Accessor\tInjector as tRelationAccessorInjector;use UmiCms\System\Orm\Entity\Attribute\Accessor\tInjector as tAttributeAccessorInjector;abstract class Facade implements iFacade {use tFactoryInjector;use tBuilderInjector;use tCollectionInjector;use tRepositoryInjector;use tRelationAccessorInjector;use tAttributeAccessorInjector;public function __construct(   iCollection $vdb6d9b451b818ccc9a449383f2f0c450,   iRepository $vb3f2035551f6e48c67489ace9f588f94,   iFactory $v9549dd6065d019211460c59a86dd6536,   iAccessor $v4209ae65645472477d5389fe6ba7c0fa,   iAccessor $v33be3a3c75ce4db80ebf75afaca4e008,   iBuilder $vc87a8ca60f0891b79d192fa86f019916  ) {$this->setCollection($vdb6d9b451b818ccc9a449383f2f0c450)    ->setRepository($vb3f2035551f6e48c67489ace9f588f94)    ->setFactory($v9549dd6065d019211460c59a86dd6536)    ->setAttributeAccessor($v4209ae65645472477d5389fe6ba7c0fa)    ->setRelationAccessor($v33be3a3c75ce4db80ebf75afaca4e008)    ->setBuilder($vc87a8ca60f0891b79d192fa86f019916);}public function get($vb80bb7740288fda1f201890375a60c8f) {$vdb6d9b451b818ccc9a449383f2f0c450 = $this->getCollection();$vf5e638cc78dd325906c1298a0c21fb6b = $vdb6d9b451b818ccc9a449383f2f0c450->get($vb80bb7740288fda1f201890375a60c8f);if ($this->isValidEntity($vf5e638cc78dd325906c1298a0c21fb6b)) {return $vf5e638cc78dd325906c1298a0c21fb6b;}$vf5e638cc78dd325906c1298a0c21fb6b = $this->getRepository()    ->get($vb80bb7740288fda1f201890375a60c8f);if (!$this->isValidEntity($vf5e638cc78dd325906c1298a0c21fb6b)) {return null;}$vdb6d9b451b818ccc9a449383f2f0c450->push($vf5e638cc78dd325906c1298a0c21fb6b);return $vf5e638cc78dd325906c1298a0c21fb6b;}public function getAll() {$vb3f2035551f6e48c67489ace9f588f94 = $this->getRepository();$vdb6d9b451b818ccc9a449383f2f0c450 = $this->getCollection();if ($vb3f2035551f6e48c67489ace9f588f94->getHistory()->isGetAllLogged()) {return $vdb6d9b451b818ccc9a449383f2f0c450;}$v8e4a156539e5e358472044b3e46a1fa1 = $vb3f2035551f6e48c67489ace9f588f94->getAll();return $vdb6d9b451b818ccc9a449383f2f0c450->pushList($v8e4a156539e5e358472044b3e46a1fa1);}public function getListSliceByEqualityMap(array $v5802a0c16daf57810f3df4f0233e541f, int $v7a86c157ee9713c34fbd7a1ee40f0c5a, int $vaa9f73eea60a006820d0f8768bc8a3fc) : array {if (empty($v5802a0c16daf57810f3df4f0233e541f)) {return [];}$vb3f2035551f6e48c67489ace9f588f94 = $this->getRepository();$vdb6d9b451b818ccc9a449383f2f0c450 = $this->getCollection();if ($vb3f2035551f6e48c67489ace9f588f94->getHistory()->isEqualityMapLogged($v5802a0c16daf57810f3df4f0233e541f)) {return $vdb6d9b451b818ccc9a449383f2f0c450->copy()     ->filterByEqualityMap($v5802a0c16daf57810f3df4f0233e541f)     ->slice($v7a86c157ee9713c34fbd7a1ee40f0c5a, $vaa9f73eea60a006820d0f8768bc8a3fc)     ->getList();}$v8e4a156539e5e358472044b3e46a1fa1 = $vb3f2035551f6e48c67489ace9f588f94->getListSliceByEqualityMap($v5802a0c16daf57810f3df4f0233e541f, $v7a86c157ee9713c34fbd7a1ee40f0c5a, $vaa9f73eea60a006820d0f8768bc8a3fc);$vdb6d9b451b818ccc9a449383f2f0c450->pushList($v8e4a156539e5e358472044b3e46a1fa1);return $v8e4a156539e5e358472044b3e46a1fa1;}public function getListSliceByFilterMap(array $v1d78dc8ed51214e518b5114fe24490ae, int $v7a86c157ee9713c34fbd7a1ee40f0c5a, int $vaa9f73eea60a006820d0f8768bc8a3fc) : array {if (empty($v1d78dc8ed51214e518b5114fe24490ae)) {return [];}$v8e4a156539e5e358472044b3e46a1fa1 = $this->getRepository()    ->getListSliceByFilterMap($v1d78dc8ed51214e518b5114fe24490ae, $v7a86c157ee9713c34fbd7a1ee40f0c5a, $vaa9f73eea60a006820d0f8768bc8a3fc);$this->getCollection()    ->pushList($v8e4a156539e5e358472044b3e46a1fa1);return $v8e4a156539e5e358472044b3e46a1fa1;}public function getSortedListSliceByFilterMap(array $vd37ea62bef927cc3e22f4ca5a69e4967, int $v7a86c157ee9713c34fbd7a1ee40f0c5a, int $vaa9f73eea60a006820d0f8768bc8a3fc, array $vf7fcd64f6639af3548b3b9c8fdfd2c99) : array {if (empty($vd37ea62bef927cc3e22f4ca5a69e4967)) {return [];}if (empty($vf7fcd64f6639af3548b3b9c8fdfd2c99)) {return $this->getListSliceByFilterMap($vd37ea62bef927cc3e22f4ca5a69e4967, $v7a86c157ee9713c34fbd7a1ee40f0c5a, $vaa9f73eea60a006820d0f8768bc8a3fc);}$v8e4a156539e5e358472044b3e46a1fa1 = $this->getRepository()    ->getSortedListSliceByFilterMap($vd37ea62bef927cc3e22f4ca5a69e4967, $v7a86c157ee9713c34fbd7a1ee40f0c5a, $vaa9f73eea60a006820d0f8768bc8a3fc, $vf7fcd64f6639af3548b3b9c8fdfd2c99);$this->getCollection()    ->pushList($v8e4a156539e5e358472044b3e46a1fa1);return $v8e4a156539e5e358472044b3e46a1fa1;}public function getListByEqualityMap(array $v5802a0c16daf57810f3df4f0233e541f) : array {if (empty($v5802a0c16daf57810f3df4f0233e541f)) {return [];}$vb3f2035551f6e48c67489ace9f588f94 = $this->getRepository();$vdb6d9b451b818ccc9a449383f2f0c450 = $this->getCollection();if ($vb3f2035551f6e48c67489ace9f588f94->getHistory()->isEqualityMapLogged($v5802a0c16daf57810f3df4f0233e541f)) {return $vdb6d9b451b818ccc9a449383f2f0c450->copy()     ->filterByEqualityMap($v5802a0c16daf57810f3df4f0233e541f)     ->getList();}$v8e4a156539e5e358472044b3e46a1fa1 = $vb3f2035551f6e48c67489ace9f588f94->getListByEqualityMap($v5802a0c16daf57810f3df4f0233e541f);$vdb6d9b451b818ccc9a449383f2f0c450->pushList($v8e4a156539e5e358472044b3e46a1fa1);return $v8e4a156539e5e358472044b3e46a1fa1;}public function getCountByEqualityMap(array $v5802a0c16daf57810f3df4f0233e541f) : int {if (empty($v5802a0c16daf57810f3df4f0233e541f)) {return 0;}$vb3f2035551f6e48c67489ace9f588f94 = $this->getRepository();$vdb6d9b451b818ccc9a449383f2f0c450 = $this->getCollection();if ($vb3f2035551f6e48c67489ace9f588f94->getHistory()->isEqualityMapLogged($v5802a0c16daf57810f3df4f0233e541f)) {return $vdb6d9b451b818ccc9a449383f2f0c450->copy()     ->filterByEqualityMap($v5802a0c16daf57810f3df4f0233e541f)     ->getCount();}return $vb3f2035551f6e48c67489ace9f588f94->getCountByEqualityMap($v5802a0c16daf57810f3df4f0233e541f);}public function getCountByFilterMap(array $v1d78dc8ed51214e518b5114fe24490ae) : int {if (empty($v1d78dc8ed51214e518b5114fe24490ae)) {return 0;}return $this->getRepository()    ->getCountByFilterMap($v1d78dc8ed51214e518b5114fe24490ae);}public function getList(array $v5a2576254d428ddc22a03fac145c8749) {return $this->getListByValueList(iMapper::ID, $v5a2576254d428ddc22a03fac145c8749);}public function extractAttributeList(iEntity $vf5e638cc78dd325906c1298a0c21fb6b) {return $this->getAttributeAccessor()    ->accessOneToAll($vf5e638cc78dd325906c1298a0c21fb6b);}public function extractRelationList(iEntity $vf5e638cc78dd325906c1298a0c21fb6b) {return $this->getRelationAccessor()    ->accessOneToAll($vf5e638cc78dd325906c1298a0c21fb6b);}public function extractPropertyList(iEntity $vf5e638cc78dd325906c1298a0c21fb6b) {return array_merge($this->extractAttributeList($vf5e638cc78dd325906c1298a0c21fb6b), $this->extractRelationList($vf5e638cc78dd325906c1298a0c21fb6b));}public function loadRelations(iCollection $vdb6d9b451b818ccc9a449383f2f0c450, array $ve6498ce498a90ba6ffb84132a321ea00 = []) {$v8f860260e98c7b73cb53d4d3eba7f7f8 = $this->getRelationAccessor()    ->getPropertyList();$vac8dbb9cfdb08937307d9872a3ed7ecd = array_diff($v8f860260e98c7b73cb53d4d3eba7f7f8, $ve6498ce498a90ba6ffb84132a321ea00);$this->getBuilder()    ->buildRelationListForCollection($vdb6d9b451b818ccc9a449383f2f0c450, $vac8dbb9cfdb08937307d9872a3ed7ecd);return $this;}public function importToEntity(iEntity $vf5e638cc78dd325906c1298a0c21fb6b, array $v6dd047148d685270458ecc44ee128a4d) {$this->getBuilder()    ->buildAttributesList($vf5e638cc78dd325906c1298a0c21fb6b, $v6dd047148d685270458ecc44ee128a4d);$this->save($vf5e638cc78dd325906c1298a0c21fb6b);return $this;}public function copy(iEntity $v36cd38f49b9afa08222c0dc9ebfe35eb) {$v6dd047148d685270458ecc44ee128a4d = $this->extractAttributeList($v36cd38f49b9afa08222c0dc9ebfe35eb);unset($v6dd047148d685270458ecc44ee128a4d[iMapper::ID]);return $this->create($v6dd047148d685270458ecc44ee128a4d);}public function getCollectionBy($vb068931cc450442b63f5b3d276ea4297, $v2063c1608d6e0baf80249c42e2be5804) {$vdb6d9b451b818ccc9a449383f2f0c450 = clone $this->getCollection();$vdb6d9b451b818ccc9a449383f2f0c450->pushList($this->getListBy($vb068931cc450442b63f5b3d276ea4297, $v2063c1608d6e0baf80249c42e2be5804));return $vdb6d9b451b818ccc9a449383f2f0c450;}public function getCollectionByValueList($vb068931cc450442b63f5b3d276ea4297, array $v993fcb1e163e40a45771f626d3ea0f0f) {$vdb6d9b451b818ccc9a449383f2f0c450 = clone $this->getCollection();$vdb6d9b451b818ccc9a449383f2f0c450->pushList($this->getListByValueList($vb068931cc450442b63f5b3d276ea4297, $v993fcb1e163e40a45771f626d3ea0f0f));return $vdb6d9b451b818ccc9a449383f2f0c450;}public function getCollectionByIdList(array $v5a2576254d428ddc22a03fac145c8749) {return $this->getCollectionByValueList(iMapper::ID, $v5a2576254d428ddc22a03fac145c8749);}public function mapCollection(array $v8e4a156539e5e358472044b3e46a1fa1) {$vdb6d9b451b818ccc9a449383f2f0c450 = clone $this->getCollection();foreach ($v8e4a156539e5e358472044b3e46a1fa1 as $vf5e638cc78dd325906c1298a0c21fb6b) {if ($this->isValidEntity($vf5e638cc78dd325906c1298a0c21fb6b)) {$vdb6d9b451b818ccc9a449383f2f0c450->push($vf5e638cc78dd325906c1298a0c21fb6b);}}return $vdb6d9b451b818ccc9a449383f2f0c450;}public function mapCollectionWithRelations(array $v8e4a156539e5e358472044b3e46a1fa1) {$vdb6d9b451b818ccc9a449383f2f0c450 = $this->mapCollection($v8e4a156539e5e358472044b3e46a1fa1);$this->loadRelations($vdb6d9b451b818ccc9a449383f2f0c450);return $vdb6d9b451b818ccc9a449383f2f0c450;}public function create(array $v6dd047148d685270458ecc44ee128a4d = []) {$vf5e638cc78dd325906c1298a0c21fb6b = $this->getFactory()    ->create();$this->getBuilder()    ->buildAttributesList($vf5e638cc78dd325906c1298a0c21fb6b, $v6dd047148d685270458ecc44ee128a4d);$this->getRepository()    ->save($vf5e638cc78dd325906c1298a0c21fb6b);$this->getCollection()    ->push($vf5e638cc78dd325906c1298a0c21fb6b);return $vf5e638cc78dd325906c1298a0c21fb6b;}public function save(iEntity $vf5e638cc78dd325906c1298a0c21fb6b) {if (!$this->isValidEntity($vf5e638cc78dd325906c1298a0c21fb6b)) {throw new \ErrorException('Incorrect entity given');}$this->getRepository()    ->save($vf5e638cc78dd325906c1298a0c21fb6b);return $this;}public function delete($vb80bb7740288fda1f201890375a60c8f) {$this->getRepository()    ->delete($vb80bb7740288fda1f201890375a60c8f);$this->getCollection()    ->pull($vb80bb7740288fda1f201890375a60c8f);return $this;}public function deleteList(array $v5a2576254d428ddc22a03fac145c8749) {$this->getRepository()    ->deleteList($v5a2576254d428ddc22a03fac145c8749);$this->getCollection()    ->pullList($v5a2576254d428ddc22a03fac145c8749);return $this;}public function deleteByEqualityMap(array $v5802a0c16daf57810f3df4f0233e541f) : int {$ve2942a04780e223b215eb8b663cf5353 = $this->getRepository()    ->deleteByEqualityMap($v5802a0c16daf57810f3df4f0233e541f);$vdb6d9b451b818ccc9a449383f2f0c450 = $this->getCollection();$v97895b323f7a2f865dd8030e12094e9d = $vdb6d9b451b818ccc9a449383f2f0c450->copy()    ->filterByEqualityMap($v5802a0c16daf57810f3df4f0233e541f);$vdb6d9b451b818ccc9a449383f2f0c450->pullCollection($v97895b323f7a2f865dd8030e12094e9d);return $ve2942a04780e223b215eb8b663cf5353;}public function deleteAll() {$this->getRepository()    ->clear();return $this;}protected function getListByValueList($vb068931cc450442b63f5b3d276ea4297, array $v993fcb1e163e40a45771f626d3ea0f0f) {if (isEmptyArray($v993fcb1e163e40a45771f626d3ea0f0f)) {return [];}$vb3f2035551f6e48c67489ace9f588f94 = $this->getRepository();$vdb6d9b451b818ccc9a449383f2f0c450 = $this->getCollection();$v8e4a156539e5e358472044b3e46a1fa1 = [];if ($vb3f2035551f6e48c67489ace9f588f94->getHistory()->isGettingLogged($vb068931cc450442b63f5b3d276ea4297, $v993fcb1e163e40a45771f626d3ea0f0f)) {$v8e4a156539e5e358472044b3e46a1fa1 = $vdb6d9b451b818ccc9a449383f2f0c450->getListBy($vb068931cc450442b63f5b3d276ea4297, $v993fcb1e163e40a45771f626d3ea0f0f, Filter::COMPARE_TYPE_IN_LIST);}if (isEmptyArray($v8e4a156539e5e358472044b3e46a1fa1)) {$v8e4a156539e5e358472044b3e46a1fa1 = $vb3f2035551f6e48c67489ace9f588f94->getListByValueList($vb068931cc450442b63f5b3d276ea4297, $v993fcb1e163e40a45771f626d3ea0f0f);$vdb6d9b451b818ccc9a449383f2f0c450->pushList($v8e4a156539e5e358472044b3e46a1fa1);}return $v8e4a156539e5e358472044b3e46a1fa1;}protected function getListBy($vb068931cc450442b63f5b3d276ea4297, $v2063c1608d6e0baf80249c42e2be5804) {$vb3f2035551f6e48c67489ace9f588f94 = $this->getRepository();$vdb6d9b451b818ccc9a449383f2f0c450 = $this->getCollection();$v8e4a156539e5e358472044b3e46a1fa1 = [];if ($vb3f2035551f6e48c67489ace9f588f94->getHistory()->isGettingLogged($vb068931cc450442b63f5b3d276ea4297, $v2063c1608d6e0baf80249c42e2be5804)) {$v8e4a156539e5e358472044b3e46a1fa1 = $vdb6d9b451b818ccc9a449383f2f0c450->getListBy($vb068931cc450442b63f5b3d276ea4297, $v2063c1608d6e0baf80249c42e2be5804);}if (isEmptyArray($v8e4a156539e5e358472044b3e46a1fa1)) {$v8e4a156539e5e358472044b3e46a1fa1 = $vb3f2035551f6e48c67489ace9f588f94->getListBy($vb068931cc450442b63f5b3d276ea4297, $v2063c1608d6e0baf80249c42e2be5804);$vdb6d9b451b818ccc9a449383f2f0c450->pushList($v8e4a156539e5e358472044b3e46a1fa1);}return $v8e4a156539e5e358472044b3e46a1fa1;}abstract protected function isValidEntity($vf5e638cc78dd325906c1298a0c21fb6b);protected function isValidMoveMode($v15d61712450a686a7f365adf4fef581f) {if (!is_string($v15d61712450a686a7f365adf4fef581f) || isEmptyString($v15d61712450a686a7f365adf4fef581f)) {return false;}return in_array($v15d61712450a686a7f365adf4fef581f, $this->getMoveModeList());}protected function getMoveModeList() {return [    self::MOVE_MODE_BEFORE_ENTITY,    self::MOVE_MODE_AFTER_ENTITY,    self::MOVE_MODE_AS_ENTITY_CHILD   ];}}