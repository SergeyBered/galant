<?php
 namespace UmiCms\System\Request;use UmiCms\System\Request\Http\iRequest;use UmiCms\Utils\Browser\iDetector as BrowserDetector;use UmiCms\System\Request\Mode\iDetector as ModeDetector;use UmiCms\System\Request\Path\iResolver as PathResolver;use UmiCms\Classes\System\PageNum\Agent\iFacade as iPageNumAgentFacade;class Facade implements iFacade {private $request;private $browserDetector;private $modeDetector;private $pathResolver;private $queryHash;private $pageNumAgentFacade;public function __construct(   iRequest $v10573b873d2fa5a365d558a45e328e47,   BrowserDetector $v70fef00db84e5862fcedc2c32d20f98a,   ModeDetector $v4076631aa75ae111b33f593b0558da6a,   PathResolver $v4cb6e1fae20c2f513df8e826f6ba45df,   iPageNumAgentFacade $v4758a382fe1989dc0e618056bc811080  ) {$this->request = $v10573b873d2fa5a365d558a45e328e47;$this->browserDetector = $v70fef00db84e5862fcedc2c32d20f98a;$this->modeDetector = $v4076631aa75ae111b33f593b0558da6a;$this->pathResolver = $v4cb6e1fae20c2f513df8e826f6ba45df;$this->pageNumAgentFacade = $v4758a382fe1989dc0e618056bc811080;}public function Cookies() {return $this->getRequest()    ->Cookies();}public function Server() {return $this->getRequest()    ->Server();}public function Post() {return $this->getRequest()    ->Post();}public function Get() {return $this->getRequest()    ->Get();}public function Files() {return $this->getRequest()    ->Files();}public function getPath() {return $this->getPathResolver()    ->get();}public function pageNumber() : int {try {return $this->pageNumAgentFacade->getAgent($this)     ->resolve($this->uri());}catch (\Exception $v42552b1f133f9f8eb406d4f306ea9fd1) {\umiExceptionHandler::report($v42552b1f133f9f8eb406d4f306ea9fd1);return 0;}}public function issetPageNumber() : bool {try {return $this->pageNumAgentFacade->getAgent($this)     ->issetPageNumber($this->uri());}catch (\Exception $v42552b1f133f9f8eb406d4f306ea9fd1) {\umiExceptionHandler::report($v42552b1f133f9f8eb406d4f306ea9fd1);return false;}}public function removePageNumber(string $v9305b73d359bd06734fee0b3638079e1) : string {try {return $this->pageNumAgentFacade->getAgent($this)     ->cleanUrl($v9305b73d359bd06734fee0b3638079e1);}catch (\Exception $v42552b1f133f9f8eb406d4f306ea9fd1) {\umiExceptionHandler::report($v42552b1f133f9f8eb406d4f306ea9fd1);return $v9305b73d359bd06734fee0b3638079e1;}}public function appendPageNumber(string $v9305b73d359bd06734fee0b3638079e1, int $vb1bc248a7ff2b2e95569f56de68615df) : string {try {return $this->pageNumAgentFacade->getAgent($this)     ->generateUri($v9305b73d359bd06734fee0b3638079e1, $vb1bc248a7ff2b2e95569f56de68615df);}catch (\Exception $v42552b1f133f9f8eb406d4f306ea9fd1) {\umiExceptionHandler::report($v42552b1f133f9f8eb406d4f306ea9fd1);return $v9305b73d359bd06734fee0b3638079e1;}}public function uriWithoutPageNumber() : string {return $this->removePageNumber($this->uri());}public function getCleanPath() {$vd6fe1d0be6347b8ef2427fa629c04485 = $this->getPath();$vd6fe1d0be6347b8ef2427fa629c04485 = $this->removePageNumber($vd6fe1d0be6347b8ef2427fa629c04485);return $this->deleteFormat($vd6fe1d0be6347b8ef2427fa629c04485);}public function getPathParts() {return $this->getPathResolver()    ->getParts();}public function getCleanPathParts() {$v1bbcb648e0b1869444f3a2d344a5b3ac = $this->getPathResolver()    ->getParts();$v1bbcb648e0b1869444f3a2d344a5b3ac = array_filter($v1bbcb648e0b1869444f3a2d344a5b3ac, function ($vf4c9385f1902f7334b00b9b4ecd164de) {return !in_array($vf4c9385f1902f7334b00b9b4ecd164de, ['.xml', '.json']);});$v1bbcb648e0b1869444f3a2d344a5b3ac = array_map(function ($vf4c9385f1902f7334b00b9b4ecd164de) {return $this->removePageNumber($vf4c9385f1902f7334b00b9b4ecd164de);}, $v1bbcb648e0b1869444f3a2d344a5b3ac);return array_map([$this, 'deleteFormat'], $v1bbcb648e0b1869444f3a2d344a5b3ac);}public function getFirstPart() : string {return (string) getFirstValue($this->getCleanPathParts());}public function isStream() {return $this->Get()->isExist('scheme');}public function getStreamScheme() {return $this->Get()->get('scheme');}public function isJson() {return contains($this->getPath(), '.json') ||  $this->Get()->get('jsonMode') === 'force';}public function isXml() {if ($this->isStream()) {return !$this->isJson();}return contains($this->getPath(), '.xml') || $this->Get()->get('xmlMode') === 'force';}public function isHtml() {return (!$this->isJson() && !$this->isXml());}public function isMobile() {$v55e7dd3016ce4ac57b9a0f56af12f7c2 = $this->Cookies();if ($v55e7dd3016ce4ac57b9a0f56af12f7c2->isExist('is_mobile')) {return (bool) $v55e7dd3016ce4ac57b9a0f56af12f7c2->get('is_mobile');}$v21aed3df2077b5d91ce46bf123446731 = $this->getBrowserDetector();try {return ($v21aed3df2077b5d91ce46bf123446731->isMobile() || $v21aed3df2077b5d91ce46bf123446731->isTablet());}catch (\Exception $ve1671797c52e15f763380b45e841ec32) {return false;}}public function isLocal() {$v593be52a46f869eea8b31d146d21de7a = $this->Server()->get('SAAS');$v3c5b83c42f023e845cd62e112fb1cbe4 = isset($v593be52a46f869eea8b31d146d21de7a) ? contains($v593be52a46f869eea8b31d146d21de7a, 'umi') : false;return ($this->isLocalIp() && $this->isLocalHost()) || $v3c5b83c42f023e845cd62e112fb1cbe4;}public function getBrowser() {return $this->getBrowserDetector()    ->getBrowser();}public function getPlatform() {return $this->getBrowserDetector()    ->getPlatform();}public function isRobot() {return $this->getBrowserDetector()    ->isRobot();}public function isStreamCallStack() {return (bool) $this->Get()->get('showStreamsCalls');}public function method() {return $this->getRequest()    ->method();}public function isPost() {return $this->getRequest()    ->isPost();}public function isGet() {return $this->getRequest()    ->isGet();}public function isAdmin() {return $this->getModeDetector()    ->isAdmin();}public function isNotAdmin() {return !$this->isAdmin();}public function isSite() {return $this->getModeDetector()    ->isSite();}public function isCli() {return $this->getModeDetector()    ->isCli();}public function mode() {return $this->getModeDetector()    ->detect();}public function host() {return $this->getRequest()    ->host();}public function isHttps() : bool {$vcf1e8c14e54505f60aa10ceb8d5d8ab3 = $this->Server();return $vcf1e8c14e54505f60aa10ceb8d5d8ab3->get('REDIRECT_HTTPS') || $vcf1e8c14e54505f60aa10ceb8d5d8ab3->get('HTTPS') || $vcf1e8c14e54505f60aa10ceb8d5d8ab3->get('HTTP_HTTPS') || $vcf1e8c14e54505f60aa10ceb8d5d8ab3->get('HTTP_X_SSL');}public function userAgent() {return $this->getRequest()    ->userAgent();}public function remoteAddress() {return $this->getRequest()    ->remoteAddress();}public function referrer() {return $this->getRequest()    ->referrer();}public function origin() : ?string {return $this->getRequest()    ->origin();}public function serverAddress() {return $this->getRequest()    ->serverAddress();}public function uri() {return (string) $this->getRequest()    ->uri();}public function query() {return $this->getRequest()    ->query();}public function time() : int {return (int) $this->Server()->get('REQUEST_TIME');}public function documentRoot() {return $this->Server()->get('DOCUMENT_ROOT');}public function queryHash() {if ($this->queryHash !== null) {return $this->queryHash;}$v1b1cc7f086b3f074da452bc3129981eb = '';$v9c28d32df234037773be184dbdafc274 = [];$v260ca9dd8a4577fc00b7bd5810298076 = preg_match('/([\?|\&][^\/#]*)/', $this->query(), $v9c28d32df234037773be184dbdafc274);if ($v260ca9dd8a4577fc00b7bd5810298076 && isset($v9c28d32df234037773be184dbdafc274[0])) {$v1b1cc7f086b3f074da452bc3129981eb = $v9c28d32df234037773be184dbdafc274[0];}return $this->queryHash = md5($v1b1cc7f086b3f074da452bc3129981eb);}public function getRawBody() {return $this->getRequest()    ->getRawBody();}public function isAjax() {$vf99cd1d90b86aef43e5149d8831aed85 = $this->Server()->get('HTTP_X_REQUESTED_WITH');return isset($vf99cd1d90b86aef43e5149d8831aed85) && strtolower($vf99cd1d90b86aef43e5149d8831aed85) === 'xmlhttprequest';}public function isUmiManager() {$vf452eb6f41635b4e9a7854a8e0ff4a8c = $this->Get()->get('mobile_application') ?: $this->Post()->get('mobile_application');return $vf452eb6f41635b4e9a7854a8e0ff4a8c == 'true';}private function deleteFormat($vb45cffe084dd3d20d928bee85e7b0f21) {$vb45cffe084dd3d20d928bee85e7b0f21 = str_replace('.xml', '', $vb45cffe084dd3d20d928bee85e7b0f21);$vb45cffe084dd3d20d928bee85e7b0f21 = str_replace('.json', '', $vb45cffe084dd3d20d928bee85e7b0f21);return $vb45cffe084dd3d20d928bee85e7b0f21;}private function getRequest() {return $this->request;}private function getBrowserDetector() {if (!$this->browserDetector->getUserAgent()) {$this->browserDetector->setUserAgent($this->userAgent());}return $this->browserDetector;}private function getModeDetector() {return $this->modeDetector;}private function getPathResolver() {return $this->pathResolver;}private function isLocalIp() {return contains($this->serverAddress(), '127.0.0.') || contains($this->serverAddress(), '::1');}private function isLocalHost() {$v5c8abb984f9d55ee3e138125bffeefa0 = preg_match('|^[^\.]*$|', $this->host());return $v5c8abb984f9d55ee3e138125bffeefa0 || $this->isLocalDomainZone();}private function isLocalDomainZone() {return (bool) preg_match('/\.(loc|local|localhost)$/', $this->host());}public function getPathWithoutFormat() {return $this->getCleanPath();}public function getPathPartsWithoutFormat() {return $this->getCleanPathParts();}}