<?php
 namespace UmiCms\Classes\System\Entities\Image;use UmiCms\Classes\System\Entities\File\iFactory as iFileFactory;use UmiCms\Classes\System\Entities\File\Uploader as FileUploader;use UmiCms\System\Utils\Image\Processor\iFactory as iImageProcessorFactory;use UmiCms\Classes\System\Entities\Directory\iFactory as iDirectoryFactory;class Uploader extends FileUploader implements iUploader {private $imageFactory;private $imageProcessorFactory;public function __construct(   \iRegedit $va9205dcfd4a6f7c2cbe8be01566ff84a,   \mainConfiguration $vccd1066343c95877b75b79d47c36bebe,   iDirectoryFactory $vb7a82c37d8c13db7202ec4890aa47a7d,   iFileFactory $ve9d2ea3c13cc8f3b974ffbe8695cba02,   iFactory $vc76618e39a97c7e3d6d7ab8973932e05,   iImageProcessorFactory $v5638ae746929c7251806f5f69a1d2a26  ) {parent::__construct(    $va9205dcfd4a6f7c2cbe8be01566ff84a,    $vccd1066343c95877b75b79d47c36bebe,    $vb7a82c37d8c13db7202ec4890aa47a7d,    $ve9d2ea3c13cc8f3b974ffbe8695cba02   );$this->imageFactory = $vc76618e39a97c7e3d6d7ab8973932e05;$this->imageProcessorFactory = $v5638ae746929c7251806f5f69a1d2a26;}public function uploadByHttpLink($v2a304a1348456ccd2234cd71a81bd338, $v026442921e91920ee15601bc865a844e) {$v5f8f22b8cdbaeee8cf857673a9b6ba20 = $this->directoryFactory->create($v026442921e91920ee15601bc865a844e);if (!$v5f8f22b8cdbaeee8cf857673a9b6ba20->isExists()) {$v5f8f22b8cdbaeee8cf857673a9b6ba20::requireFolder($v5f8f22b8cdbaeee8cf857673a9b6ba20->getPath());$v5f8f22b8cdbaeee8cf857673a9b6ba20->refresh();}if ($v5f8f22b8cdbaeee8cf857673a9b6ba20->getIsBroken() || !$v5f8f22b8cdbaeee8cf857673a9b6ba20->isWritable()) {return false;}$v78b145c82f40fdfd1c994f0e9f1dd689 = \umiRemoteFileGetter::get($v2a304a1348456ccd2234cd71a81bd338, $this->getTemporaryFilePath());if (!$this->isAllowedImageSize($v78b145c82f40fdfd1c994f0e9f1dd689->getSize())) {$v78b145c82f40fdfd1c994f0e9f1dd689->delete();return false;}$vd833f6a7fa188532a7e5937356764b6d = $v026442921e91920ee15601bc865a844e . basename($v2a304a1348456ccd2234cd71a81bd338);$v78805a221a988e79ef3f42d7c5bfd418 = $this->imageFactory->create($vd833f6a7fa188532a7e5937356764b6d);if (!$v78805a221a988e79ef3f42d7c5bfd418 instanceof \iUmiImageFile) {$v78b145c82f40fdfd1c994f0e9f1dd689->delete();return false;}if (!$v78805a221a988e79ef3f42d7c5bfd418::getIsImage($v78805a221a988e79ef3f42d7c5bfd418->getFilePath()) || !$v78805a221a988e79ef3f42d7c5bfd418->putContent($v78b145c82f40fdfd1c994f0e9f1dd689->getContent())) {$v78b145c82f40fdfd1c994f0e9f1dd689->delete();$v78805a221a988e79ef3f42d7c5bfd418->delete();return false;}if ($this->configuration->get('kernel', 'jpg-through-gd')) {$this->imageProcessorFactory     ->create()     ->optimize(      $v78805a221a988e79ef3f42d7c5bfd418->getFilePath(true),      $this->configuration->get('system', 'image-compression')     );}return $v78805a221a988e79ef3f42d7c5bfd418;}private function isAllowedImageSize($v0ece96e997e3e5c4398ccdaa5b16377b) {$v6a552807863028b28e40aa335999e53e = (int) $this->registry->get('//settings/max_img_filesize');$vbe905588ea202167017a18989f6306a5 = (int) ini_get('upload_max_filesize');$v6a552807863028b28e40aa335999e53e = ($v6a552807863028b28e40aa335999e53e < $vbe905588ea202167017a18989f6306a5) ? $v6a552807863028b28e40aa335999e53e : $vbe905588ea202167017a18989f6306a5;$v6a552807863028b28e40aa335999e53e = $v6a552807863028b28e40aa335999e53e * 1024 * 1024;return $v6a552807863028b28e40aa335999e53e > 0 && $v6a552807863028b28e40aa335999e53e > $v0ece96e997e3e5c4398ccdaa5b16377b;}private function getTemporaryFilePath() {return sys_get_temp_dir() . '/php' . substr(md5(microtime()), rand(0, 26), 6);}}