<?php
 namespace UmiCms\Classes\System\Utils\Robots;use \iRegedit as iRegistry;use \iConfiguration as iConfig;use UmiCms\System\Selector\iFactory as iSelectorFactory;use UmiCms\System\Events\iEventPointFactory as iEventFactory;use UmiCms\System\Hierarchy\Domain\iDetector as iDomainDetector;use UmiCms\System\Hierarchy\Language\iDetector as iLanguageDetector;class Generator implements iGenerator {private $config;private $registry;private $eventFactory;private $domainDetector;private $selectorFactory;private $languageDetector;public function __construct(   iConfig $v2245023265ae4cf87d02c8b6ba991139, iRegistry $va9205dcfd4a6f7c2cbe8be01566ff84a, iEventFactory $v67c06be409275078f3a98d129b0123c8,   iDomainDetector $v45651ec82e45766b3d707ee33df1a61a, iSelectorFactory $vdff401a605e5f6984373466cddee7287, iLanguageDetector $vf24870e9df244bb77374445d936a6741  ) {$this->config = $v2245023265ae4cf87d02c8b6ba991139;$this->registry = $va9205dcfd4a6f7c2cbe8be01566ff84a;$this->eventFactory = $v67c06be409275078f3a98d129b0123c8;$this->domainDetector = $v45651ec82e45766b3d707ee33df1a61a;$this->selectorFactory = $vdff401a605e5f6984373466cddee7287;$this->languageDetector = $vf24870e9df244bb77374445d936a6741;}public function execute() {$v3d9123b4278acba1e86dd04b19506375 = $this->getCrawlDelay();$va4f86f7bfc24194b276c22e0ef158197 = $this->getRules();$v67b3dba8bc6778101892eb77249db32e = $this->getHost();$result = $this->getRobotCustomContent($va4f86f7bfc24194b276c22e0ef158197, $v67b3dba8bc6778101892eb77249db32e, $v3d9123b4278acba1e86dd04b19506375);if ($result !== null) {return $result;}$va4f86f7bfc24194b276c22e0ef158197 = 'Disallow: /?' . PHP_EOL . $va4f86f7bfc24194b276c22e0ef158197 . PHP_EOL . PHP_EOL;$va4f86f7bfc24194b276c22e0ef158197 = explode(PHP_EOL, $va4f86f7bfc24194b276c22e0ef158197);$v7c27c416b75c77012f5c378837e5bb19 = $this->getSiteMap();$v4119639092e62c55ea8be348e4d9260d = $this->eventFactory->create('formationRobots', 'before');$v4119639092e62c55ea8be348e4d9260d->addRef('rules', $va4f86f7bfc24194b276c22e0ef158197)    ->addRef('host', $v67b3dba8bc6778101892eb77249db32e)    ->addRef('sitemap', $v7c27c416b75c77012f5c378837e5bb19)    ->addRef('crawlDelay', $v3d9123b4278acba1e86dd04b19506375)    ->call();$v9a0364b9e99bb480dd25e1f0284c8555 = [    'User-Agent: Googlebot' => $va4f86f7bfc24194b276c22e0ef158197,    'User-Agent: Yandex' => $va4f86f7bfc24194b276c22e0ef158197,    'User-Agent: *' => $va4f86f7bfc24194b276c22e0ef158197,    'Host: ' => $v67b3dba8bc6778101892eb77249db32e,    'Sitemap: ' => $v7c27c416b75c77012f5c378837e5bb19,    'Crawl-delay: ' => $v3d9123b4278acba1e86dd04b19506375,   ];$v4119639092e62c55ea8be348e4d9260d->setMode('after')    ->addRef('bufferContent', $v9a0364b9e99bb480dd25e1f0284c8555)    ->call();$result = '';foreach ($v9a0364b9e99bb480dd25e1f0284c8555 as $v3c6e0b8a9c15224a8228b9a98ca1531d => $v2063c1608d6e0baf80249c42e2be5804) {$result .= $v3c6e0b8a9c15224a8228b9a98ca1531d;if (is_array($v2063c1608d6e0baf80249c42e2be5804)) {foreach ($v2063c1608d6e0baf80249c42e2be5804 as $v981c1e7b3795da18687613fbd66d4954) {$result .= PHP_EOL . $v981c1e7b3795da18687613fbd66d4954;}}else {$result .= $v2063c1608d6e0baf80249c42e2be5804 . PHP_EOL;}}return $result;}private function getCrawlDelay() {return (string) $this->config->get('seo', 'crawl-delay');}private function getHost() {$vad5f82e879a9c5d6b5b442eb37e50551 = $this->domainDetector->detect();$v67b3dba8bc6778101892eb77249db32e = $vad5f82e879a9c5d6b5b442eb37e50551->getHost();$v67b3dba8bc6778101892eb77249db32e = preg_replace('/^www./', '', $v67b3dba8bc6778101892eb77249db32e);$va6abcab795d7917615e71d1cd0be0d6f = (bool) $this->config->get('seo', 'primary-www');if ($va6abcab795d7917615e71d1cd0be0d6f) {$v67b3dba8bc6778101892eb77249db32e = 'www.' . $v67b3dba8bc6778101892eb77249db32e;}return $vad5f82e879a9c5d6b5b442eb37e50551->getProtocol() . "://{$v67b3dba8bc6778101892eb77249db32e}";}private function getRules() {if ($this->isDisallowAll()) {return 'Disallow: /';}$v962d6f8508f8815ff059fc863fe189c3 = $this->selectorFactory->createPage();$v962d6f8508f8815ff059fc863fe189c3->where('robots_deny')->equals(1);$v962d6f8508f8815ff059fc863fe189c3->where('lang')->isnotnull();$va4f86f7bfc24194b276c22e0ef158197 = '';foreach ($v962d6f8508f8815ff059fc863fe189c3 as $v71860c77c6745379b0d44304d66b6a13) {if ($v71860c77c6745379b0d44304d66b6a13->getHierarchyType()->hidePages()) {continue;}$va4f86f7bfc24194b276c22e0ef158197 .= 'Disallow: ' . $v71860c77c6745379b0d44304d66b6a13->link . PHP_EOL;}$va4f86f7bfc24194b276c22e0ef158197 .= <<<RULES
Disallow: /admin
Disallow: /index.php
Disallow: /emarket/addToCompare
Disallow: /emarket/basket
Disallow: /emarket/gateway
Disallow: /go-out.php
Disallow: /cron.php
Disallow: /filemonitor.php
Disallow: /search
Disallow: /captcha.php
Disallow: /counter.php
Disallow: /license_restore.php
Disallow: /packer.php
Disallow: /save_domain_keycode.php
Disallow: /session.php
Disallow: /standalone.php
Disallow: /static_banner.php
Disallow: /updater.php
Disallow: /users/login_do
Disallow: /autothumbs.php
Disallow: /~/
Disallow: /install.php
Disallow: /installer.php
RULES;   $v4119639092e62c55ea8be348e4d9260d = $this->eventFactory->create('formationRobotsRules', 'after');$v4119639092e62c55ea8be348e4d9260d->addRef('rules', $va4f86f7bfc24194b276c22e0ef158197)    ->call();return $va4f86f7bfc24194b276c22e0ef158197;}private function isDisallowAll() {$v72ee76c5c29383b7c9f9225c1fa4d10b = $this->domainDetector->detectId();$vf585b7f018bb4ced15a03683a733e50b = $this->languageDetector->detectId();$ve1dc8b73d884ea4262c18256aa77f033 = (bool) $this->registry->get('//umiStub/robot-stub');$va4cd1e204dc425bc644cb41d5cbba7fc = (bool) $this->registry->get("//umiStub/$v72ee76c5c29383b7c9f9225c1fa4d10b/$vf585b7f018bb4ced15a03683a733e50b/use-custom-settings");$v58f584385d3f00bc6038e555f0b84348 = (bool) $this->registry->get("//umiStub/$v72ee76c5c29383b7c9f9225c1fa4d10b/$vf585b7f018bb4ced15a03683a733e50b/robot-stub");return ($va4cd1e204dc425bc644cb41d5cbba7fc && $v58f584385d3f00bc6038e555f0b84348) || (!$va4cd1e204dc425bc644cb41d5cbba7fc && $ve1dc8b73d884ea4262c18256aa77f033);}private function getRobotCustomContent($va4f86f7bfc24194b276c22e0ef158197, $v67b3dba8bc6778101892eb77249db32e, $v3d9123b4278acba1e86dd04b19506375) {$v709388ed6c19eda9c87a82b2acbcf295  = $this->getRobotsCustom();if (!$v709388ed6c19eda9c87a82b2acbcf295) {return null;}$v335768203d12ed5c9875a671c9178bb3 = [    '%disallow_umi_pages%',    '%host%',    '%crawl_delay%'   ];$v44b4e8658a7cacfdba5718af8e7461f3 = [    $va4f86f7bfc24194b276c22e0ef158197,    $v67b3dba8bc6778101892eb77249db32e,    $v3d9123b4278acba1e86dd04b19506375   ];$v9a0364b9e99bb480dd25e1f0284c8555 = str_replace($v335768203d12ed5c9875a671c9178bb3, $v44b4e8658a7cacfdba5718af8e7461f3, $v709388ed6c19eda9c87a82b2acbcf295);return $v9a0364b9e99bb480dd25e1f0284c8555;}private function getSiteMap() {$v67b3dba8bc6778101892eb77249db32e = $this->getHost();return $v67b3dba8bc6778101892eb77249db32e . '/sitemap.xml' . PHP_EOL . 'Sitemap: ' . $v67b3dba8bc6778101892eb77249db32e . '/sitemap-images.xml' . PHP_EOL;}private function getRobotsCustom() {$v72ee76c5c29383b7c9f9225c1fa4d10b = $this->domainDetector->detectId();$vd6fe1d0be6347b8ef2427fa629c04485 = CURRENT_WORKING_DIR . '/robots/' . $v72ee76c5c29383b7c9f9225c1fa4d10b . '.robots.txt';if (file_exists($vd6fe1d0be6347b8ef2427fa629c04485)) {return file_get_contents($vd6fe1d0be6347b8ef2427fa629c04485);}return $this->getSeoRobotsCustom($v72ee76c5c29383b7c9f9225c1fa4d10b);}private function getSeoRobotsCustom($v72ee76c5c29383b7c9f9225c1fa4d10b) {$v5b3c32009797feb79096d52e56a56b82 = $this->selectorFactory->createObjectTypeName('seo', 'robots-txt');$v5b3c32009797feb79096d52e56a56b82->where('domain_id')->equals($v72ee76c5c29383b7c9f9225c1fa4d10b);$v5b3c32009797feb79096d52e56a56b82->limit(0, 1);$va8cfde6331bd59eb2ac96f8911c4b666 = $v5b3c32009797feb79096d52e56a56b82->first();return $va8cfde6331bd59eb2ac96f8911c4b666 ? $va8cfde6331bd59eb2ac96f8911c4b666->getValue('robots_txt') : null;}}