<?php
 namespace UmiCms\Classes\System\Utils\Api\Http;use GuzzleHttp\Psr7\Request;use GuzzleHttp\Client as HttpClient;use Psr\Http\Message\MessageInterface;use Psr\Http\Message\RequestInterface;use Psr\Http\Message\ResponseInterface;use UmiCms\Utils\Logger\iFactory as iLoggerFactory;use UmiCms\Classes\System\Utils\Api\Http\Exception\BadResponse;abstract class Client {private $httpClient;private $lastRequestData = [];private $keepLog = true;private $logger;public function setKeepLog($v327a6c4304ad5938eaf0efb6cc3e53dc = true) {$this->keepLog = (bool) $v327a6c4304ad5938eaf0efb6cc3e53dc;return $this;}abstract protected function getServiceUrl();protected function getHttpClient() {return $this->httpClient;}protected function initHttpClient() {$this->httpClient = new HttpClient([    'base_uri' => $this->getServiceUrl(),    'http_errors' => false,    'decode_content' => false,    'verify' => false   ]);return $this;}protected function getDefaultHeaders() {return [];}protected function getOptions() {return [];}protected function buildUrl(array $v1bbcb648e0b1869444f3a2d344a5b3ac = [], array $v09de9b89300d55eec77867f15e4d9531 = []) {$v09de9b89300d55eec77867f15e4d9531 = array_merge($v09de9b89300d55eec77867f15e4d9531, $this->getDefaultQuery());if ($this->getPrefix()) {array_unshift($v1bbcb648e0b1869444f3a2d344a5b3ac, $this->getPrefix());}return $this->buildPath($v1bbcb648e0b1869444f3a2d344a5b3ac) . $this->buildQuery($v09de9b89300d55eec77867f15e4d9531);}protected function getPrefix() {return '';}protected function buildPath(array $v1bbcb648e0b1869444f3a2d344a5b3ac = []) {$v1bbcb648e0b1869444f3a2d344a5b3ac = array_map(function($vd6fe1d0be6347b8ef2427fa629c04485) {return trim($vd6fe1d0be6347b8ef2427fa629c04485, '/');}, $v1bbcb648e0b1869444f3a2d344a5b3ac);$v1bbcb648e0b1869444f3a2d344a5b3ac[] = '';return implode('/', $v1bbcb648e0b1869444f3a2d344a5b3ac);}protected function buildQuery(array $v09de9b89300d55eec77867f15e4d9531 = []) {return empty($v09de9b89300d55eec77867f15e4d9531) ? '' : '?' . http_build_query($v09de9b89300d55eec77867f15e4d9531);}protected function send(RequestInterface $v10573b873d2fa5a365d558a45e328e47) {return $this->getHttpClient()->send($v10573b873d2fa5a365d558a45e328e47, $this->getOptions());}protected function getResponse(RequestInterface $v10573b873d2fa5a365d558a45e328e47) {$vd1fc8eaf36937be0c3ba8cfe0a2c1bfe = $this->send($v10573b873d2fa5a365d558a45e328e47);return $this->getResponseBody($vd1fc8eaf36937be0c3ba8cfe0a2c1bfe);}protected function getResponseBody(ResponseInterface $vd1fc8eaf36937be0c3ba8cfe0a2c1bfe) {return $vd1fc8eaf36937be0c3ba8cfe0a2c1bfe->getBody()->__toString();}protected function encodePostData($v8d777f385d3dfec8815d20f7496026dc) {return $v8d777f385d3dfec8815d20f7496026dc;}protected function createGetRequest(array $v1bbcb648e0b1869444f3a2d344a5b3ac = [], array $v09de9b89300d55eec77867f15e4d9531 = [], array $v4340fd73e75df7a9d9e45902a59ba3a4 = null) {return new Request(    'GET',    $this->buildUrl($v1bbcb648e0b1869444f3a2d344a5b3ac, $v09de9b89300d55eec77867f15e4d9531),    $v4340fd73e75df7a9d9e45902a59ba3a4 ?: $this->getDefaultHeaders()   );}protected function createPostRequest($v0546e8b62aa5fd8bf2522c04ae878d90 = [], array $v1bbcb648e0b1869444f3a2d344a5b3ac = [], array $v09de9b89300d55eec77867f15e4d9531 = [], array $v4340fd73e75df7a9d9e45902a59ba3a4 = null) {$this->setLastRequestData($v0546e8b62aa5fd8bf2522c04ae878d90);return new Request(    'POST',    $this->buildUrl($v1bbcb648e0b1869444f3a2d344a5b3ac, $v09de9b89300d55eec77867f15e4d9531),    $v4340fd73e75df7a9d9e45902a59ba3a4 ?: $this->getDefaultHeaders(),    $this->encodePostData($v0546e8b62aa5fd8bf2522c04ae878d90)   );}protected function createPutRequest($v0546e8b62aa5fd8bf2522c04ae878d90 = [], array $v1bbcb648e0b1869444f3a2d344a5b3ac = [], array $v09de9b89300d55eec77867f15e4d9531 = [], array $v4340fd73e75df7a9d9e45902a59ba3a4 = null) {$this->setLastRequestData($v0546e8b62aa5fd8bf2522c04ae878d90);return new Request(    'PUT',    $this->buildUrl($v1bbcb648e0b1869444f3a2d344a5b3ac, $v09de9b89300d55eec77867f15e4d9531),    $v4340fd73e75df7a9d9e45902a59ba3a4 ?: $this->getDefaultHeaders(),    $this->encodePostData($v0546e8b62aa5fd8bf2522c04ae878d90)   );}protected function createDeleteRequest(array $v1bbcb648e0b1869444f3a2d344a5b3ac = [], array $v09de9b89300d55eec77867f15e4d9531 = [], array $v4340fd73e75df7a9d9e45902a59ba3a4 = null) {return new Request(    'DELETE',    $this->buildUrl($v1bbcb648e0b1869444f3a2d344a5b3ac, $v09de9b89300d55eec77867f15e4d9531),    $v4340fd73e75df7a9d9e45902a59ba3a4 ?: $this->getDefaultHeaders()   );}protected function getDefaultQuery() {return [];}protected function getLastRequestData() {return $this->lastRequestData;}protected function setLastRequestData($vbe579a850a97252f923168786a91703e = []) {$this->lastRequestData = $vbe579a850a97252f923168786a91703e;return $this;}protected function getKeepLog() {return $this->keepLog;}protected function initLogger(iLoggerFactory $v9549dd6065d019211460c59a86dd6536, \iConfiguration $vccd1066343c95877b75b79d47c36bebe) {$v09e9c782a5ed138d15633e9347fd7379 = $vccd1066343c95877b75b79d47c36bebe->includeParam('sys-log-path');$vbc2d2d9e8a87a7c9d6204182efcba66b = sprintf('%s/%s/', rtrim($v09e9c782a5ed138d15633e9347fd7379, '/'), $this->getLogDirectory());$v6db435f352d7ea4a67807a3feb447bf7 = $v9549dd6065d019211460c59a86dd6536->create($vbc2d2d9e8a87a7c9d6204182efcba66b);$v6db435f352d7ea4a67807a3feb447bf7->setFileName(date('Y-m-d'));return $this->setLogger($v6db435f352d7ea4a67807a3feb447bf7);}protected function getLogger() {return $this->logger;}protected function setLogger(\iUmiLogger $v6db435f352d7ea4a67807a3feb447bf7) {$this->logger = $v6db435f352d7ea4a67807a3feb447bf7;return $this;}protected function getLogDirectory() {return 'HttpClient';}protected function log(RequestInterface $v10573b873d2fa5a365d558a45e328e47, ResponseInterface $vd1fc8eaf36937be0c3ba8cfe0a2c1bfe) {if (!$this->getKeepLog()) {return $this;}$v78e731027d8fd50ed642340b7c9a63b3 = $this->prepareLogMessage($v10573b873d2fa5a365d558a45e328e47, $vd1fc8eaf36937be0c3ba8cfe0a2c1bfe);$v6db435f352d7ea4a67807a3feb447bf7 = $this->getLogger();$v6db435f352d7ea4a67807a3feb447bf7->push($v78e731027d8fd50ed642340b7c9a63b3);$v6db435f352d7ea4a67807a3feb447bf7->save();return $this;}protected function prepareLogMessage(RequestInterface $v10573b873d2fa5a365d558a45e328e47, ResponseInterface $vd1fc8eaf36937be0c3ba8cfe0a2c1bfe) {$v07cc694b9b3fc636710fa08b6922c42b = strftime('%d/%b/%Y %H:%M:%S');$vea9f6aca279138c58f705c8d4cb4b8ce = $v10573b873d2fa5a365d558a45e328e47->getMethod();$v572d4e421e5e6b9bc11d815e8a027112 = $this->getServiceUrl() . $v10573b873d2fa5a365d558a45e328e47->getUri();$vf9a31c6b3670c772d11230c8d4d1f33f = $vd1fc8eaf36937be0c3ba8cfe0a2c1bfe->getStatusCode();$vd2013170f9870890e8c8e9e0851ca83e = $this->prepareHeaders($v10573b873d2fa5a365d558a45e328e47);$vbe579a850a97252f923168786a91703e = '';if (($vea9f6aca279138c58f705c8d4cb4b8ce === 'POST' || $vea9f6aca279138c58f705c8d4cb4b8ce === 'PUT') && umiCount($this->getLastRequestData()) > 0) {$vbe579a850a97252f923168786a91703e = 'Request Data: ' . print_r($this->getLastRequestData(), true);$this->setLastRequestData();}$ve70f9e6634e2d14f02c4a4a366d3f40d = $this->prepareHeaders($vd1fc8eaf36937be0c3ba8cfe0a2c1bfe);$v1a2567345bba0c62a6859cb5030ec65e = self::getResponseBody($vd1fc8eaf36937be0c3ba8cfe0a2c1bfe);$v1a2567345bba0c62a6859cb5030ec65e = 'Response Data: ' . print_r($v1a2567345bba0c62a6859cb5030ec65e, true);$va0f0bc95016c862498bbad29d1f4d9d4 = str_repeat('-', 80);return <<<MESSAGE
[$v07cc694b9b3fc636710fa08b6922c42b] $vea9f6aca279138c58f705c8d4cb4b8ce $v572d4e421e5e6b9bc11d815e8a027112 $vf9a31c6b3670c772d11230c8d4d1f33f

$vd2013170f9870890e8c8e9e0851ca83e
$vbe579a850a97252f923168786a91703e

$ve70f9e6634e2d14f02c4a4a366d3f40d
$v1a2567345bba0c62a6859cb5030ec65e
$va0f0bc95016c862498bbad29d1f4d9d4


MESSAGE;  }protected function prepareHeaders(MessageInterface $v78e731027d8fd50ed642340b7c9a63b3) {$va9c82692957f6b9ab0f61d663e20f8fb = [];foreach ($v78e731027d8fd50ed642340b7c9a63b3->getHeaders() as $vb068931cc450442b63f5b3d276ea4297 => $vf09cc7ee3a9a93273f4b80601cafb00c) {$va9c82692957f6b9ab0f61d663e20f8fb[] = $vb068931cc450442b63f5b3d276ea4297 . ": " . implode(", ", $vf09cc7ee3a9a93273f4b80601cafb00c);}try {$v6f66e878c62db60568a3487869695820 =  trimNameSpace(get_class($v78e731027d8fd50ed642340b7c9a63b3)) . ' ';}catch (\ErrorException $v42552b1f133f9f8eb406d4f306ea9fd1) {$v6f66e878c62db60568a3487869695820 = '';}return $v6f66e878c62db60568a3487869695820 . 'Headers: ' . print_r($va9c82692957f6b9ab0f61d663e20f8fb, true);}protected function parseJson($v1a2567345bba0c62a6859cb5030ec65e) {$v8d777f385d3dfec8815d20f7496026dc = json_decode((string) $v1a2567345bba0c62a6859cb5030ec65e, true);if (JSON_ERROR_NONE !== json_last_error()) {throw new BadResponse('Unable to parse response body into JSON: ' . json_last_error());}return $v8d777f385d3dfec8815d20f7496026dc === null ? [] : $v8d777f385d3dfec8815d20f7496026dc;}protected function parseXml($v1a2567345bba0c62a6859cb5030ec65e) {$vbc681290d0bd0be5d0f93c128555c63d = libxml_disable_entity_loader(true);try {$v0f635d0e0f3874fff8b581c132e6c7a7 = new \SimpleXMLElement((string) $v1a2567345bba0c62a6859cb5030ec65e ?: '<root />');libxml_disable_entity_loader($vbc681290d0bd0be5d0f93c128555c63d);}catch (\Exception $ve1671797c52e15f763380b45e841ec32) {libxml_disable_entity_loader($vbc681290d0bd0be5d0f93c128555c63d);throw new BadResponse('Unable to parse response body into XML: ' . $ve1671797c52e15f763380b45e841ec32->getMessage());}return $v0f635d0e0f3874fff8b581c132e6c7a7;}}